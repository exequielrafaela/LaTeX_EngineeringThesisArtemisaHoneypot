\documentclass[a4paper,12pt]{report}


\usepackage[utf8x]{inputenc} 
\usepackage[spanish]{babel}
\usepackage[T1]{fontenc} 
\usepackage{times}
\usepackage{verbatim}
\usepackage[dvips]{graphicx}
\usepackage{xcolor}
\usepackage{color}
%\usepackage{hyperref}
\usepackage{geometry}
\geometry{verbose,a4paper,tmargin=30mm,bmargin=20mm,lmargin=30mm,
rmargin=20mm}
\usepackage{setspace}
\usepackage{url}
\usepackage{tocvsec2}
\usepackage{float}
\usepackage[nottoc,notlof,notlot]{tocbibind}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{textcomp}
\usepackage[font=footnotesize,labelfont=bf]{caption}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{multicol} % tabular mgmt
\usepackage{bm}
\usepackage{pdfpages} % to import PDF pages
\usepackage{acronym}
\usepackage{multicol}
%\usepackage{subfigure}
%\usepackage[caption=false]{subfig}
\usepackage{subfig}
%\usepackage{subcaption}
\usepackage{listings}
\usepackage{graphicx}

\newenvironment{mytinylisting}
{\begin{list}{}{\setlength{\leftmargin}{1em}}\item\tiny\bfseries}
{\end{list}}

\newenvironment{myscriptlisting}
{\begin{list}{}{\setlength{\leftmargin}{1em}}\item\scriptsize\bfseries}
{\end{list}}

\makeatletter
\def\@biblabel#1{}
\makeatother

\begin{document}

\spanishdecimal{.}
\bibliographystyle{apalike}
\renewcommand{\figurename}{\emph{Figura}} %Cambia la palabra "Figura" por "Fig."
\renewcommand{\tablename}{Tabla} %Cambia la palabra "Cuadro" por "Tabla"
\renewcommand{\listtablename}{Índice de tablas}
\renewcommand\chaptername{}

\begin{titlepage}


\thispagestyle{empty}
\vspace*{1cm}

{\centering     

\Large
{\Huge\bf UNIVERSIDAD BLAS PASCAL}\\
\vspace{1.3cm}
{\bf Ingeniería en Telecomunicaciones}\\
\vspace{1cm}
\includegraphics[scale=1]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/LogoUBP.jpg} \\
\vspace{1cm}
Trabajo Final de Carrera \\
\vspace{1cm}

{\bf
\setlength{\fboxrule}{1pt}
\setlength{\fboxsep}{0.35cm}
\fbox{\parbox{15cm}{\centering Implementación, evaluación y desarrollos funcionales
sobre Artemisa \mbox{(Open Source back-end} honeypot)}}\\}
 
\vspace{1cm}
\large
Barrirero, E.\\
Villarroel, M. T.

}

\vspace{1cm}
\large
\noindent 
%Director: Ing. Biasutto, G.\\
Director: Dr.-Ing. Do Carmo, R. D.\\
Asesor: Ing. Olocco, G.\\
Asesor Metodológico: Dr. Ing. Argüello, J.A.\\

{

\centering 
\vspace{0.5cm}
-- 2016 --

}


\end{titlepage}


\newpage

\chapter*{Agradecimientos}

Al director y desarrollador de Artemisa, Dr.-Ing. Rodrigo D. Do Carmo por contagiarnos su espíritu 
colaborativo y fomentar la filosofía Open Source. Sin dejar de remarcar su aliento y apoyo para 
que se continúe el proyecto Artemisa \emph{honeypot}.\\

Al que fue nuestro director de carrera, Ing. Raúl E. Echegaray, por incentivarnos y promover
este proyecto y abrirnos el camino institucional para llevarlo adelante con mayor facilidad. 
Y por su puesto, al actual director de la carrera de Ingeniería en Telecomunicaciones,
el Ing. \mbox{Victor} H. Frison por darle continuidad al mismo.\\

A los asesores, Ing. Gino Olocco y Dr. Ing. Juan A. Argüello, por sus aportes y valioso tiempo.\\

Al Ing. Gustavo Biasutto por su colaboración y contribuciones en el trabajo.\\

A la Lic. Cristina Ferreyra por haber sido una docente y guía fundamental durante los primeros
años de nuestra carrera.\\ 

A la revisora voluntaria, Ing. Carolina Rey Pizza, por su esfuerzo y empeño porque la entrega final logre 
la mejor redacción técnica y calidad literaria posible.\\

A todos los profesores de la carrera de Ing. en Telecomunicaciones de la Universidad Blas Pascal,
por habernos guiado y apoyado a lo largo de toda la carrera, y por habernos
entregado las herramientas necesarias para finalmente lograr esta meta. Un gran aprendizaje que
veo reflejado actualmente en mi vida profesional.\\

Al Centro de Relaciones Internacionales (CRI) de la \ac{ubp} por brindar la oportunidad de
acceder a intercambios académicos internacionales estimulando el desarrollo humano, educativo
y de la carrera profesional de los estudiantes de la \ac{ubp}.

\thispagestyle{empty}
\newpage

\chapter*{Dedicatorias}

A mi familia, a quien le debo lo que soy y todo lo que construí con ello.\\

A mi futura esposa y madre de mi primer hijo Facundo, Carolina, por ser la razón 
que alegra mi corazón y en reconocimiento a su apoyo, aliento, contención y afecto
incondicional. Siempre compañera y cariñosa.\\ 

A mi madre, Carmen, por ser siempre un pilar emocional, por su confianza y acompañamiento
incondicional y quien me enseño a siempre sonreír y mirar hacia delante en la vida. Y
por siempre creer en mí.\\

A mi padre, Domingo, por contagiarme su espíritu perseverante, a enseñarme que siempre
podemos mejorar, y por ayudarme a encontrar la fortaleza necesaria durante todo este proceso.\\

A mi hermana, Jenifer, por haberme ayudado a través del ejemplo y de su palabra a entender casi
``todo`` con lo que tuve que convivir, desde las cosas más simples, hasta lo más complejo que uno
podría imaginar. Siempre en el momento justo. Ejemplar por donde la mire, mi admiración y orgullo
por ella son uno de los motores que me llevó y lleva a lograr mis objetivos en la vida.\\  

A mi abuela, Nucha (Margarita), quien me lleno siempre de vida y energía con su amor sincero.
Sin dejar de reconocer su apoyo escolar en los primeros años de mi educación. Y a mi abuela,
Amanda, quien nos dejó hace algunos años, pero que siempre va a vivir en mí su nobleza, empatía y
bondad. Enormes valores que agradezco haber recibido de ella.\\ 

A mis amigos de la vida, por su demostración de afecto y buena energía. Por siempre haber estado
cerca a pesar de la distancia y ayudarme a superar todas las dificultades. Por dejarme saber que
siempre están y sentirme querido por todos ellos.\\

A quienes fueron mis compañeros de carrera, en su gran mayoría hoy mis amigos y colegas, por su
intercambio y cooperación a través de los años. Durante esta etapa pude aprender muchísimo de cada
uno de ellos, y por llenarme de momentos inolvidables.\\

\begin{flushright}
\textbf{Exequiel Barrirero}\\
\end{flushright}

\clearpage
A mis padres, Pedro y Elsa, por formar tan hermosa familia. Por brindarnos toda su vida. Porque sin contagiarme su ansiedad,
vivieron atentos cada paso de este camino.\\

A los más grandes hermanos que alguien pueda anhelar, Germán, Liliana y Cecilia, de quienes siempre recibí todo su apoyo, guía y
cariño, y estaré eternamente agradecido.\\

A Yamile, con quien nos elegimos para ser compañeros en toda la vida. Por acompañarme con infinito amor y paciencia.\\

\begin{flushright}
\textbf{Mauro T. Villarroel}
\end{flushright}

\thispagestyle{empty}
\newpage

\chapter*{Resumen}

El objetivo general de este trabajo final de carrera fue el de implementar, evaluar y llevar a cabo
desarrollos funcionales sobre el \emph{honeypot} de código abierto Artemisa. A través de un programa
de incentivos a proyectos de investigación del ministerio de ciencia y tecnología de
la provincia de Córdoba en conjunto con 
la \ac{ubp}, se \mbox{evaluaron} requerimientos de \emph{hardware}, y como resultado se
adquirieron servidores, dispositivos de \emph{networking},
y teléfonos de \ac{voip}, los cuales nos encargamos de equipar y acondicionar en el laboratorio
de redes de la universidad, para la implementación en laboratorio de un escenario de prueba
y de\-sa\-rro\-llo. El proceso fue conformado por la implementación de Artemisa en entornos reales en mesa
de prueba (\emph{testbed}), llevando a cabo configuración, mejoras y riguroso \emph{testing} de la plataforma.
Luego se continuó con la ejecución de instancias del \emph{honeypot} (Artemisa) accesibles y expuestas a Internet y
capturando ataques reales. Paralelamente, se redactó y difundió una carta de \mbox{participación} en foros y 
comunidades de seguridad informática, adjunta en el Anexo A, para captar ataques auténticos y de fuentes
internacionales, favoreciendo así el planteo de los parámetros óptimos de configuración 
para entornos reales.
Este \emph{honeypot} se hace fuerte en entornos de red privada, acusando en
tiempo real y con registros detallados la presencia de un atacante interno.
Una configuración en el \emph{registrar} de \ac{sip} del entorno que encamine hacia
el \emph{honeypot} todo intento de comunicación contra un agente \ac{sip} que no 
pertenezca al dominio, aumenta el grado de detección de atacantes, tanto internos como
externos.
En cuanto a la cantidad de llamadas \ac{voip} \ac{sip} total (\emph{registrars})
se validó un número importantísimo de llamadas rechazadas, lo que se ve directamente
reflejado por las estadísticas del método REGISTER, como así también de los mensajes \ac{sip}
\emph{401 unauthorized} y \emph{404 not found} presentes en gran número e involucrados en este proceso. 
Por su número exagerado y \mbox{contrastando} con los \emph{logs} de Asterisk es que 
se acreditaron como intentos de
registro mal intencionados. Integrando todo el tráfico con origen o destino 
a direcciones \ac{ip} públicas se destaca que Argentina y Alemania fueron los países de mayor protagonismo.
En tercer lugar Estados Unidos, y por último Corea, Irlanda y Polonia.
Se hizo notorio que permitiría proteger de forma más efectiva
el dominio de comunicaciones \ac{sip} si se incrementa el alcance del
\emph{honeypot} para simular el rol de un servidor de registro \ac{sip}, es decir, agregar algunos
métodos para que tenga funciones básicas de un \emph{registrar} y así lograr desviar todos los ataques
a los que la actual versión de Artemisa no se ve expuesto por su rol de \emph{back-end user-agent}.
La interfaz de \ac{xmlrpc} añadida al código fuente agiliza y facilita la
configuración, y permite la integración del \emph{honeypot} con otros agentes de la
red. 
Cabe mencionar que en base a la realización y los resultados del trabajo,
hoy la \ac{ubp} cuenta con los dispositivos y recursos necesarios para hacer viable la implementación
del proyecto en materias como Redes II, Seguridad Informática, Protocolos y Gestión de Red, 
dentro de la carrera de Ingeniería
en Telecomunicaciones, contribuyendo con experiencia práctica muy valiosa al perfil profesional del egresado.

\begin{flushleft}
\textbf{Palabras claves:} honeypot, seguridad informática, \ac{sip}, \ac{voip}, voz sobre ip.
\end{flushleft}


\chapter*{Abstract}
The overall purpose of this engineering degree final work was to implement, evaluate and develop 
new functional features over the Open Source honeypot Artemisa. Through an \mbox{incentive} program for
research projects from the Science and Technology Department from Cordoba province together with 
Blas Pascal University, hardware requirements were evaluated, and as a result, servers, networking 
devices and \ac{voip} phones were acquired. Furthermore, we take care of the installation of all 
these new equipment and network elements in the university's \mbox{computer} networks lab, for the 
implementation of a development and experimentation testbed. The first stage of the project consisted 
in the implementation of Artemisa in testbeds, and \mbox{during} this process, carry out configurations,
upgrades and rigorous testing of the platform. Next steps continued with the execution of Artemisa
honeypot instances directly exposed  and accessible via the Internet in order to capture real attacks.
At the same time, a participation letter was drafted and shared in several computer security communities
and forums, which is presented in the Annex A, so that authentic and international sources attacks were
captured, thus enabling the proposition of
optimal settings and configurations for real world scenarios. This honeypot is really strong in private
network environments, exposing in real-time and with detailed logs the presence of an internal attacker.
Additionally, a configuration in the \ac{sip} \emph{registrar} that forwards all communication attempts
destined to a user-agent that it's not registered in the domain to the honeypot, increases the level of
attacks detection, both internal and external. Then considering the total number of \ac{voip} SIP calls
received by the registrars, a significant number of rejected calls were validated, which is directly
reflected in the REGISTER method statistics, as well as SIP 401 \emph{unauthorized} and 
404 \emph{not found} messages present in a 
substantial number and involved in this process. Directly related with the excessive amount of the before 
mentioned events and contrasted with Asterisk logs, is possible to certify that the mentioned traffic were
malicious registration attempts. Moreover, when integrating all the network traffic, to or from public IP 
addresses, it stands out that Argentina and Germany were the countries with greater traffic presence.
In third place the United States, and finally Korea, Ireland and Poland. In addition, it was clear that 
if the scope of the honeypot is increased to simulate the role of a SIP registrar server, that will 
protect in a more effective manner the \ac{sip} domain communications, that is to say, that adding 
some \ac{sip} methods to have basic registrar functions will achieve to evade all the attacks that 
the current version of Artemisa is not exposed because of its back-end user-agent role. The \ac{xmlrpc}
interface added to the source code speeds up and facilitates the honeypot configuration, it also allows 
Artemisa integration with other network agents. It should be noted that after the concretion of this 
project, today \ac{ubp} has all the necessary resource and devices to make an implementation of the 
project in courses such as Computer Networks II, Computer Security, Network Protocols and Network 
Management that conforms the Telecommunications Engineering degree, contributing with valuable 
practical experience for the graduate student professional profile.

\begin{flushleft}
\textbf{Keywords:} honeypot, computer security, information security, \ac{sip}, \ac{voip}, voice over ip.
\end{flushleft}

\thispagestyle{empty}

\newpage

\pagenumbering{roman}

\setcounter{page}{5}

\tableofcontents
\listoffigures
\listoftables
\setcounter{secnumdepth}{3}
\settocdepth{subsection}

\newpage
\pagenumbering{arabic}

\chapter{Introducci\'on}


En la actualidad, existen aproximadamente 650 millones de usuarios de
Internet en el continente Americano, y alrededor de 3345 millones a
nivel mundial. \cite{inetworld} Sin
embargo, gran cantidad de usuarios, administradores o proveedores
conectados a la red no tienen un conocimiento claro de las debilidades o
vulnerabilidades de seguridad a la que su información está expuesta. La
gran variedad de protocolos, tecnologías y servicios que sustentan
Internet, hacen que la posibilidad de ejecutar un ataque sea muy
elevada, debido a que el concepto de seguridad no fue un elemento
primordial del diseño inicial de Internet a fines de la década del 60’ y
comienzos de la del 70’.

 En las redes corporativas en estado de producción, es una tarea muy
compleja llevar un \mbox{registro} oficial, específico y detallado sobre el
número de incidentes o ataques de seguridad que se presentan. Saber
identificar los eventuales riesgos a los que se pueda ver expuesta dicha
información es imprescindible para asegurar la integridad y el correcto
uso que a ésta se le puede dar. \cite{espinoza}
Principalmente, si la información en la que nos concentramos en proteger
son las comunicaciones telefónicas. La seguridad es un requisito
indispensable en el desarrollo confiable de una red de \ac{voip}.
Infortunadamente, asegurar \ac{voip} es más complejo que asegurar una red
de circuitos conmutados de telefonía tradicional. Con la voz como un
servicio sobre la red \ac{ip} (Internet), esta hereda ambas ventajas y
desventajas de dicha red. A partir de su implementación a mediados de
los noventa, han comenzado a desarrollarse diferentes tipos de ataques
haciéndolo un servicio endeble a escuchas ilegales, falsificación de
identidad, \ac{dos}, virus y gusanos, entre otros.
\cite{collier}   

El \emph{exploit} más común contra \ac{pbx} que fueron comprometidas es \emph{toll fraud} 
(fraude en tasas o tarifas telefónicas), utilizando el sistema telefónico de alguien
más para realizar llamadas de larga distancia. En segundo lugar se encuentra forzar a la
\ac{pbx} para llamar a números \emph{premium} controlados por el atacante para cobrarles 
por minuto, por lo que las empresas que han visto sus \ac{pbx}s atacadas, serán cargadas 
con estas facturas. Un reporte de Sipera Viper Labs argumenta que frente a ambos tipos de fraude,
las organizaciones frecuentemente no tienen 
la posibilidad de realizar el descargo de estos costos debido a que no son capaces de 
proveer evidencia suficiente de que los cargos facturados son un error.

Cisco también notó la prevalencia del \emph{vishing}, \emph{telephone-based phising} (\emph{phising}
basado en telefonía), donde los llamantes pretenden ser de bancos, del gobierno u otras
instituciones y buscan hacer que las víctimas engañadas entreguen sus datos, 
como su número de seguridad social o números de tarjetas de crédito. Cisco en uno de sus 
reportes del 2011, acerca de seguridad en \ac{it}, expresó
que el abuso en \ac{voip} está en alza y listo para un \mbox{mayor} crecimiento. Dentro de la
categorización de diferentes clases de ataques pone a \ac{voip} entre aquellos con mayor
potencial y dentro del grupo que Cisco llama como ''\emph{rising stars}`` (estrellas en
ascenso) que incluyen \emph{exploits} web y troyanos para robo de datos y lavado de dinero. 
Por su parte, Sipera Viper Labs notó que los porcentajes pico de ataques contra \ac{voip}
ascendieron rutinariamente a un nivel de 30\% con respecto a años anteriores, y que estos
picos continúan. En investigaciones previas, habían encontrado que estas acciones mal 
intencionadas dirigidas a \ac{voip} eran solo del 10\% con respecto al total de ataques
 analizados. \cite{greene}

En cuanto a los ataques \ac{dos}, más específicamente los ataques de \ac{ddos}, son una amenaza
creciente a los servicios de \ac{voip}. Tal fue 
el caso de un \ac{ddos} en 2011 que derribó totalmente el servicio de \ac{voip}
suministrado a miles de clientes por la compañía estadounidense TelePacific Communications.
El ataque \ac{ddos} masivo provino fugazmente desde Internet en forma 
de una inundación de solicitudes de registro \ac{voip} inválidas. El ataque resultó
en una mayúscula degradación y pérdida de servicio por una serie de días y le costó a la
compañía cientos de miles de dolares en crédito de clientes.       
El vicepresidente de ingeniería de red de TelePacific expresó que si bien existen multitud de 
escaneos diarios contra su red, y que ataques a bajo nivel pueden ocurrir hasta dos veces 
por día, este proveedor de servicios nunca antes había visto lo que ocurrió en este 
período del 2011, cuando el nivel normal de 34 millones de solicitudes de registro de tráfico \ac{sip}
para conexiones \ac{voip} repentinamente se disparó por encima de 69 millones e inundó su 
sistema, lo cual resultó en imposibilidad a la hora de realizar llamados.
Otro dato muy relevante que detalló es que contactaron a la \ac{fbi} para reportar el ataque, pero encontraron 
que TelePacific simplemente no disponía de toda la información necesaria que el \ac{fbi} requería
para ser capaz de analizar el evento y llevar adelante el caso. Consideraron que no se encontraban
preparados defensivamente y que no pudieron capturar suficiente información, por lo cual rectificaron esta 
situación con nuevos \emph{data-capture systems} (sistemas de captura de datos). \cite{messmer}

De acuerdo a un informe presentado por el Computer Security Institute,
se observa un incremento considerable de ataques año a año y una pérdida
de cerca de 20 millones de dólares únicamente por infección de virus, sin
considerar las pérdidas ocasionadas por otros tipos de ataques. Este
incremento ha venido de la mano con una evolución de las técnicas y
herramientas utilizadas por los atacantes. 
En la actualidad, una gran parte de las organizaciones poseen sus
sistemas informatizados e íntimamente relacionados a Internet. Siendo
esta última estructura fundamental para su diario funcionamiento, es por
ello que la seguridad informática es sin duda de gran relevancia.
Principalmente, ya que tanto la disponibilidad como la confiabilidad de
la información son un tema crítico dentro de la organización. \cite{computersec}
Con los datos de utilización de Internet anteriormente descritos,
podríamos acotar que si tan sólo el 1 por ciento de la población realiza
ataques mediante la red, se tiene que existen casi 33 millones de
posibles atacantes, una cifra considerablemente significativa.

Cabe mencionar que desde sus comienzos y por un prolongado período, la
seguridad informática ha sido meramente defensiva. Esta consistía
principalmente en defender la infraestructura de la información,
detectar fallos y reaccionar ante estos. Debido al cambio que está
surgiendo en Internet, el cual se debe principalmente al gran avance
tecnológico y a la evolución de las técnicas de los usuarios maliciosos,
se requiere un nuevo modelo que permita ampliar el concepto de seguridad. \cite{delaetcisco}

Dentro de este nuevo modelo aparece el concepto de proactividad dentro
de la seguridad informática, en el cual no se dejan de lado herramientas
antes utilizadas, sino que junto a éstas aparecen nuevas técnicas que
permiten detectar e incluso prevenir nuevos ataques. Una de estas nuevas
técnicas es el \emph{sinkhole} (sumidero), la cual
consiste en eliminar el tráfico sospechoso de la red. Además, mediante el uso de
señuelos se puede obtener información valiosa sobre las amenazas, las
cuales pueden ser observadas, analizadas y monitorizadas previniendo
nuevos ataques. El \emph{sinkhole} es implementado principalmente por los
proveedores de Internet, lo que al sumarle señuelos produce una
interesante aplicación, ya que el tráfico malintencionado, no sólo se
elimina, sino que permite realizar estudios estadísticos, los que a su
vez facilitan identificar cuáles son las técnicas más utilizadas en los
ataques. En torno a esta nueva forma de ver la seguridad, aparecen los
\emph{honeypots y
HoneyNets}. Estos, pretenden conocer al enemigo, conocer sus técnicas y
formas de actuar. \cite{trapp} 

Los \emph{honeypots} aún son una táctica subutilizada. Todos los ataques, ya
sean manuales o \mbox{automatizados}, tienen un componente exploratorio. Cuando los
hackers o virus se encuentran probando un sistema o una red generalmente
pasan desapercibidos. A menos que produzcan un \emph{crash} (colapso) o
recarga del sistema, las chances de detección son muy bajas. Un \emph{honeypot}
es un sistema que detecta actividad no esperada o sospechosa mediante la 
creación de \emph{targets} (objetivos) falsos. En una red, por ejemplo, un
\emph{honeypot} simple puede reservar y hacer uso del espacio de direccionamiento \ac{ip}
no ocupado. Luego, si alguien intenta acceder a esta dirección \ac{ip} que no debería
estar en uso, se puede generar una alerta. De forma similar, un \emph{honeypot} basado en 
puertos podría responder a solicitudes en puertos de \ac{tcp} no utilizados, creando
la ilusión de servicios de red. Computadoras enteras, o incluso redes de computadoras,
pueden ser creadas para atraer y tentar atacantes. Los \emph{honeypots} pueden incluso
automatizar la prevención de intrusiones al bloquear temporalmente direcciones \ac{ip},
actuando así como trampas activas para los atacantes.

Lo que aún sorprende, es que solo unos pocos proveedores ofrecen soluciones
\emph{honeypot-like} (tipo \emph{honeypot}) dentro de sus estándares como una característica
de seguridad embebida en sus productos, lo que hace más valioso a Artemisa y 
a lo desarrollado en este \ac{tfc}. Equipos de red (\emph{routers} y \emph{switches})
podrían ofrecer redes \emph{honeypot} fantasmas que generan alertas preventivas.
Softwares de virtualización podrían crear \emph{data centers} \emph{honeypot} fantasmas. Un
\ac{isp} podría implementar \emph{honeypots} en espacios de direccionamiento no reservados. Más
aún, \emph{honeypots} sofisticados tendrían la capacidad de atraer y emboscar atacantes 
creando la ilusión de que han logrado violar la seguridad de la plataforma y permitiendo que 
la intrusión escale, aprovechando este proceso para obtener la mayor cantidad de información
posible sobre el perfil del atacante.

Los \emph{honeypots} nos dan una oportunidad para colocar una trampa es esos vacíos que 
poseen la mayoría de los \ac{os}, aplicaciones, infraestructuras de red y entornos \ac{voip}, 
haciendo más riesgosas para el atacante sus incursiones exploratorias y que sea más probable
poder detectarlas. Un señuelo de cualquier \ac{ua} o componente de la red puede retrasar al
usuario mal intencionado dándonos la delantera para comenzar la detección, identificación y 
frustración de tal intrusión. Así es como se atrapan hackers con \emph{honey} (miel). \cite{antonopolous}

\ac{voip} y \ac{sip} se están estableciendo como participantes
protagónicos en el campo de las comunicaciones multimedia sobre \ac{ip},
respaldados por su bajo costo y accesible manejo. Sin embargo, los
aspectos de seguridad no han sido completamente logrados. Se presenta de
forma específica a Artemisa, como la implementación de un
\emph{honeypot} de código abierto orientado a \ac{voip}, basado en \ac{sip}. El \emph{honeypot} esta
diseñado para conectarse a un dominio corporativo de \ac{voip} como un
\emph{back-end user-agent} o agente-usuario en plano implícito, con el
fin de detectar actividad maliciosa en una etapa temprana. Asimismo, el
\emph{honeypot} puede jugar un rol fundamental en el ajuste de las políticas de
seguridad del dominio corporativo en producción donde está actuando en
tiempo real. Se apunta a motivar el desarrollo e implementación de este
tipo de \emph{honeypots} a gran escala, capturando y rastreando ataques. Se ha
testeado la capacidad de Artemisa para sobrellevar una serie ataques \ac{sip}
conocidos. \cite{docarmof}

Este sistema de seguridad consiste en diseñar e implementar un prototipo
de \emph{honeypot}, en nuestro caso el ya desarrollado Artemisa, el cual
permitirá mejorar considerablemente el nivel de seguridad presente en la red de \ac{voip} \ac{sip}.
El antes mencionado, permite asegurar  las comunicaciones telefónicas en
una red corporativa en producción, la cual permitirá analizar, controlar
y monitorear la red ante oportunos ataques, tanto internos como externos
a la organización en cuestión.

Además, permitirá utilizar los datos obtenidos como un valioso recurso
de investigación y facilitar estudios de \emph{remote penetration}
(penetración remota) y \emph{vulnerability assessment} (evalua\-ción de
vulnerabilidades), aplicados a ámbitos corporativos en producción. En
los cuales prima la disponibilidad y confiabilidad para un estable
funcionamiento de la infraestructura; garantizando así, la seguridad y
estabilidad de los sistemas en los que se basa una organización,
enfocados a sus comunicaciones de voz.

Sin dejar de mencionar que el objetivo general de este trabajo final de carrera fue el de implementar, evaluar y llevar a cabo
desarrollos funcionales sobre el \emph{honeypot} de código abierto Artemisa.\\

\chapter{Materiales y M\'etodos}

\begin{enumerate}

{\bf \item Estudio exploratorio de carácter bibliográfico de \ac{voip} \ac{sip} sus conceptos básicos, entidades y
su seguridad:}

Para este estudio se consultó:

\begin{itemize}
 
  \item \cite{nassarm}

\end{itemize}

{\bf \item Estudio exploratorio de carácter bibliográfico de señalización \ac{sip} (llamada y registro):}

Para este estudio se consultó:

\begin{itemize}

  \item \cite{johnrfc3665}

  \item \cite{weichen}

\end{itemize}

{\bf \item Estudio exploratorio de carácter bibliográfico de los riesgos y
seguridad en \ac{voip}:}

Para este estudio se consultó:

\begin{itemize}

  \item \cite{johnrfc3665}
  
  \item \cite{nassarm} 

  \item \cite {wheeler}

\end{itemize}

{\bf \item Estudio exploratorio sobre \emph{honeypots} \ac{voip} específicos y Artemisa \emph{honeypot}:}

Para este estudio se consultó:

\begin{itemize}

  \item \cite{acunetix}  

  \item \cite{digium}

  \item \cite{docarmof}  

  \item \cite{docarmom}

  \item \cite{ewaldt}

  \item \cite{microsoftsql}

  \item \cite{netfilterneira}

  \item \cite{reingold}

  \item \cite{symantec}

\end{itemize}

{\bf \item Evaluación de respuestas empíricas y enfoque en desarrollos funcionales
del sistema de seguridad Artemisa a partir de
su implementación y experimentación en los entornos propuestos:}

\begin{enumerate}

   \item Se estudiaron los ataques, tipos de ataques de hackers y tipos de
hackers.

  \item Se plantearon modelo de atacante: interno y externo. A partir de estos, se definieron tres 
casos de pruebas de penetración.

  \item Se definió la topología física y lógica de la red acorde a lo planteado para cada caso.

  \item Se instalaron dos servidores físicos en el laboratorio de redes de la \ac{ubp}, en los cuales se
virtualizaron los entornos en mesa de prueba mediante VMWare y Virtual\-Box, corriendo los \ac{os}
GNU/Linux Debian, Ubuntu y Centos como invitados.

  \item Se realizaron pruebas de uso ideal del sistema de telefonía para captar y lograr un mejor
entendimiento del funcionamiento de Artemisa, \ac{ser} y el \emph{registrar} Asterisk frente a una situación libre de
ataques. 

  \item Se implementó y se realizó prueba de penetración sobre Artemisa en dominio de colisión y \emph{broadcast}
compartidos (con \emph{hub}).

  \item Se implementó y se realizó prueba de penetración sobre Artemisa en dominio de \emph{broadcast} 
compartidos (con \emph{switch} Ethernet).

  \item Se implementó y se realizó prueba de penetración sobre Artemisa en dominio público. Colisión 
y \emph{broadcast} no compratidos (con \emph{router} y \emph{switch} Ethernet).

  \item Se presentó en diagramas de flujo el tráfico de paquetes de los agentes involucrados en el ataque, 
y se capturaron las respuestas por consola y/o archivos \emph{logs} de Artemisa, \emph{proxy} \ac{sip}, \emph{registrar}
y de cada herramienta en cuestión.
  
  \item Se desarrolló analíticamente lo observado en cada ataque para ayudar a entender a lo que se 
enfrentan los dispositivos \ac{sip} por cada herramienta de penetración.
 
  \item Se resumió y tabuló el análisis de los tres casos de prueba de penetración.

\end{enumerate}

{\bf \item Estudio descriptivo estadístico de las características de Artemisa
\emph{honeypot} en entornos reales en mesa de prueba (\emph{testbed}):}

Se realizó un extensivo relevamiento, de un período de aproximadamente seis meses (01/11/2012
- 01/06/2013), que permitió apreciar tendencias y lograr inferir conclusiones respecto a las variables
 analizadas. Se detallan los pasos de este proceso debajo:

\begin{enumerate}

  \item Se gestionó una conexión a Internet independiente de la proporcionada por la \ac{ubp} para exponer 
Artemisa a una red pública y aumentar la precisión de los resultados.

  \item Se implementó \emph{testbed} \ac{ubp}.

  \item Se implementó el \emph{testbed} Metropolitan fuera de las instalaciones de la \ac{ubp} con un segundo
proveedor de Internet.

  \item Se crearon cuentas en un \ac{sip} \emph{registrar}/\emph{proxy} externo, \emph{iptel.org}, para plantear
también un escenario de tipo \emph{hosted-services}. 

  \item Se presentaron las configuraciones de los \emph{testbed}.
   
  \item Se configuró \emph{Iptables} como \emph{firewall} y \emph{port filtering} en los \emph{routers} de
 frontera hacia internet en ambos \emph{testbeds}.
  
  \item Se programaron Bash scripts para automatizar la ejecución de todos los agentes
 de la red en ambos \emph{testbeds}.
  
  \item Se almacenaron durante el período de prueba de aproximadamente seis meses en un \ac{nfs} 
centralizado, \emph{logs} y capturas de tráfico
(\mbox{Tcpdump}) para Artemisa, \ac{sip} \emph{proxies}  y Asterisk. Y con herramientas propias de Bash se guardó 
la \ac{stderr} \& \ac{stdout} de los componentes de la arquitectura \ac{sip} antes mencionados.

  \item Se utilizó Wireshark y scripts en Python para procesar capturas, \emph{logs} y archivos generados
durante el período de exposición. En base a sus resultados, se realizó estudio descriptivo estadístico de 
los entornos reales en mesa de prueba. 

\end{enumerate}

{\bf \item Desarrollos Funcionales sobre Artemisa:}

Se desarrolló una \ac{api} implementando el módulo
\emph{SimpleXMLRPCServer} de la librería estándar de Python. Permitiendo de esta
manera crear un servidor \ac{xmlrpc}. El cual utiliza en su código fuente el
protocolo de Internet, como también el módulo de sistema \emph{socket} embebido
en la mayoría de los \ac{os}.

\begin{enumerate}

  \item Se desarrolló la \ac{api} \ac{xmlrpc} implementando el módulo \emph{SimpleXMLRPCServer} de la librería estándar de Python.

  \item Se elaboró un ejemplo de implementación \ac{xmlrpc} como caso de estudio. Consta de un cliente \ac{xmlrpc} en Python en
combinación de Bash \emph{scripting}. 

  \item Se actualizaron \emph{fingerprints} de la base de firmas de Artemisa, con aparejado ejemplo de detección de las mismas.

\end{enumerate}

%\begin{enumerate}
%  \item Se desarrolló una interfaz programable de aplicación (API: Aplication programming interface) implementando el módulo
%  SimpleXMLRPCServer de la librería estándar de Python
%  \item Se sumó al código fuente de Artemisa una instancia de Servidor XML que mediante el protocolo HTTP permite modificar las
%extensiones registradas por Artemisa de manera remota.
% \item Se desarrolló en Python un cliente XML-RPC para poner a prueba la nueva característica de Artemisa.
%  \item Se desarrolló un caso de estudio con un SCRIPT que extrae del log de Asterisk, extensiones atacadas y configura Artemisa
% automáticamente para que sean analizadas.
%  \item Se sumaron nuevos fingerprints a la base de firmas utilizada por Artemisa.
%  \item Se desarrolla un ejemplo de detección con la base de firmas actualizada.
%\end{enumerate}
\end{enumerate}

\addcontentsline{toc}{section}{2.1\ \ \ \ Estudio exploratorio de carácter bibliográfico de \ac{voip} \ac{sip}
conceptos básicos, entidades y su seguridad}

\addcontentsline{toc}{section}{2.2\ \ \ \ Estudio exploratorio de carácter bibliográfico de señalización \ac{sip} (llamada y
registro)}

\addcontentsline{toc}{section}{2.3\ \ \ \ Estudio exploratorio de carácter bibliográfico de los
riesgos y seguridad en \ac{voip}}

\addcontentsline{toc}{section}{2.4\ \ \ \ Estudio exploratorio sobre \emph{honeypots} \ac{voip} específicos y
Artemisa \emph{honeypot}}

\addcontentsline{toc}{section}{2.5\ \ \ \ Evaluación de respuestas empíricas y enfoque en
desarrollos funcionales del sistema de seguridad Artemisa a partir de su implementación y experimentación en los entornos
propuestos}

\addcontentsline{toc}{section}{2.6\ \ \ \ Estudio descriptivo estadístico de las características de
Artemisa \emph{honeypot} en entornos reales en mesa de prueba (\emph{testbed})}

\addcontentsline{toc}{section}{2.7\ \ \ \ Desarrollos Funcionales sobre Artemisa}

\chapter{Resultados y Discusiones}

\section{Estudio exploratorio de carácter bibliográfico de \ac{voip} \ac{sip} sus
conceptos básicos, entidades y su seguridad}

\ac{voip} es una reciente y muy prometedora
tecnología de comunicaciones por voz. Su definición, claramente sobrepasa la
simple transmisión de paquetes conmutados por redes \ac{ip} para alcanzar otro tipo
de aplicaciones y asegurar dinamismo, movilidad e innovar posibles aplicaciones.
Debido a su demostrada flexibilidad y conveniencia económica por sobre la \ac{pstn},
se ha visto aumentar su penetración tanto en el ámbito
corporativo como en usuarios finales. Basada en un serie de estándares y
protocolos pro\-pie\-ta\-rios, los productos \ac{voip} no solo están limitados a equipos de
usuario final, sino que también dispositivos de procesamiento de llamadas,
señalización, \emph{media gateways}, \emph{proxies} y \emph{firewalls}.
 
Será primordial remarcar que voz sobre \ac{ip}, más allá de heredar todas las
fortalezas del protocolo de Internet, también lo ha hecho con los problemas de
seguridad asociados a este protocolo, y aún más, otras desventajas específicas
en relación a \ac{voip}. Vulnerabilidades de señalización y de protocolos de \emph{media}
(\emph{media protocols}) pueden ser explotados para escuchar secretamente
(\emph{eavesdropping}), uso fraudulento (falsificación de identidad) y ataques
de \ac{dos}. Por
ejemplo \ac{voip} será atractivo para publicistas que pueden muy fácilmente
implementar un centro de llamadas automáticas por Internet a un bajo coste. En
ocasiones el usuario final no deseará recibir este tipo de llamadas
considerándolas como \emph{spam} o más precisamente \ac{spit}.

Las consideraciones en cuanto a seguridad para voz sobre \ac{ip} han sido un
tema que atrae una gran audiencia en el ámbito industrial, gubernamental y
académico. Es preciso considerar que la seguridad en \ac{voip} se ve limitada por
sus especiales características en torno a lo que concierne a calidad de
servicio, traducción de direcciones y establecimiento dinámico de llamadas a
través de \emph{firewalls}. Por su parte, políticas de redes de datos convencionales
como cifrado (\emph{\mbox{encryption}}), autenticación e integridad de datos son
altamente recomendables. Sin embargo, estas no se adecúan por completo a las
implementaciones de las arquitecturas de voz sobre \ac{ip}, las cuales son de gran
escala, y de naturaleza dinámica y abierta. Dichas políticas son incompatibles
con \ac{nat}, generan un incremento de retardos
y necesitan una llave de infraestructura distribuida. Es por lo anterior, que
debe ponerse mayor énfasis en políticas de defensa de segunda línea. Como por
ejemplo defensa proactiva y preventiva, detección de intrusos y mecanismos de
monitoreo para la mitigación o prevención de ataques. 

Trabajos relevantes se han realizado para detección de intrusos tanto en
dispositivos terminales (\emph{host}) como redes de datos. Estos han sido
llevados adelante por la comunidad corporativa industrial y por la académica.
Estos desarrollos fueron enfocados para lograr la detección de
intrusos en protocolos de capa de transporte, red y aplicación. Sin embargo,
podría considerarse que estas aproximaciones en cuanto a seguridad para
\ac{voip} aún se encuentran en una fase \mbox{preliminar}. Este trabajo final de carrera
se concentra principalmente en presentar de forma teórica y práctica una
solución de detección de intrusos para un entorno \ac{voip} \ac{sip}.                
Este análisis consta de la implementación del \emph{honeypot} Artemisa, el
cual actúa dentro del entorno de voz sobre \ac{ip} como \emph{back-end} \emph{user-agent}
(agente-usuario en plano implícito), con el fin de detectar actividad maliciosa
en una etapa temprana. Esta puesta a prueba y en funcionamiento del aplicativo
de seguridad Artemisa nos facilitará exponer este nuevo modelo y
arquitectura para ejecutar una defensa proactiva, monitoreo y detección de
intrusos en redes \ac{voip}. \cite{nassarm}

\subsection{Entidades de red \ac{sip}}

En su tesis postdoctoral \cite{nassarm} refiere a los diferentes clientes 
y servidores \ac{sip} como se introducen a continuación:

\begin{itemize}
\item Agente de usuario (\emph{user-agents}):
un \ac{ua} establece o cierra una sesión de \emph{media} (audio) con otros
\ac{ua}s y debe mantener el estado de las llamadas. Un \ac{ua} está compuesto por dos
aplicaciones; el \ac{uac} para iniciar solicitudes
a otros \ac{ua}s y recibir sus respuestas, y el \ac{uas} para procesar las solicitudes recibidas desde otros \ac{ua}s y
generar las respuestas asociadas. Un \ac{ua} debería publicar sus capacidades y
características de \emph{media} en el cuerpo de la solicitud \ac{sip} permitiendo de esta
manera a otros agentes de usuario aprender de él y establecer la comunicación
en base a estas.

\item Agente de presencia (\emph{presence agents}):
un agente de presencia notifica a sus suscriptores de cierta información de
presencia. Fuentes de esta información pueden ser \ac{ua}s \ac{sip}, los cuales se
registran al agente de presencia y publican sus estados como también otras
entidades no \ac{sip}.

\item \ac{b2bua}:
este oculta o enmascara el número de \ac{ua}s como si el
originador de la solicitud fuera de él. Cuando un \ac{b2bua}
recibe una solicitud de uno de sus \ac{ua}s, este reemplaza tanto la
información de señalización como la de \emph{media} y reenvía una solicitud
reformulada. Por su parte, la operación inversa es llevada a cabo en la
dirección opuesta cuando se reciben las respuestas a la solicitud previamente
realizada. Así también, el \ac{b2bua} transmite la sesión de \emph{media} para sus \ac{ua}s.
B2BUAs son utilizados para implementar servicios anónimos, \ac{pbx} y emulación de servicios \ac{pstn}
(PSTN Emulation Service). 

\item Puertas de enlace (\emph{gateways}):
una interfaz de \emph{gateway} \ac{sip} hacia otra red, por ejemplo ISUP (Parte de Usuario
ISDN), \ac{cas} y
H.225 puede ser definida como un agente de usuario que actúa en representación
o como traductor de otro protocolo. Un \emph{gateway} cierra el camino de señalización
pero no necesariamente el camino o vínculo de \emph{media} que fue establecido (por
ejemplo, en el caso de un \emph{gateway} \ac{sip}/H.323, el punto de finalización \ac{sip} (\ac{sip}
\emph{endpoint}) y el \emph{endpoint} H.323 intercambian la sesión de \emph{media} directamente o
mediante un \emph{gateway}). En un contexto MGCP, es decir un \ac{mgc}
controla uno o varios \ac{mg}. El \ac{mgc} controla la
apertura y cierre de \emph{media endpoints} en el \ac{mg} mediante el protocolo MGCP. Los
protocolos no \ac{sip} (\emph{Non}-\ac{sip} \emph{protocols}) entre los cuales \ac{trip}
y \ac{tgrep} proveen información de ruteo
a los \emph{proxy} \ac{sip} y a los \ac{ua}s con el fin de encontrar su ruta hacia los GWs
cuando necesitan interconectarse con otras redes de telefonía.

\item Servidores \emph{proxy} (\emph{proxy servers}):
facilita el encaminamiento de mensajes \ac{sip} para los
remitentes, o más precisamente los usuarios o agentes de usuario de la llamada
telefónica. Está permitido para estos, realizar una pequeña modificación es sus
solicitudes mientras se preserva la comunicación transparente de extremo a
extremo (\emph{end-to-end}) entre el remitente y el receptor. Un servidor \emph{proxy} tienen
acceso a una o varias base de datos con el fin de consultar información de
presencia o ubicación. A su vez, un \emph{proxy} \emph{server} puede hacer uso de \ac{dns} 
para resolver nombres de las solicitudes \ac{sip}. Casos especiales de
\ac{dns} son ENUM, el cual realiza la asociación de numeros telefónicos globales
(E.164) e \ac{uri} \ac{sip} en conjunto con la \ac{naptr} y registros \ac{dns}, con el fin de interconectar la \ac{pstn}.
Complementariamente, \ac{dns} SRV (\emph{service locator}) que ayuda a localizar \ac{sip} \emph{proxies} 
dentro de un dominio. 
Se tienen dos tipos de servidores \emph{proxy}: con monitoreo o seguimiento de estado
(\emph{stateful}) y sin monitoreo o seguimiento de estado (\emph{stateless}). Una transacción
\emph{proxy stateful} debe mantener el estado de las transacciones que se están
llevando adelante mientras que por ejemplo, un \emph{proxy stateless} nunca debería
retransmitir un mensaje perdido al no mantener un seguimiento de los mensajes.
Un \emph{proxy stateful} debe iniciar un reloj (\emph{timer}) siempre que una solicitud es
reenviada y esperar por su respuesta. Si no se recibe dicha respuesta dentro de
un período de tiempo preestablecido, retransmite la solicitud. 

\item Servidores de redirección (\emph{redirect servers}): no encamina o enruta ningún mensaje. En cambio,
responde con un mensaje de redirección conteniendo información de ubicación.

\item Servidor de registro (\emph{registrar server}):
es responsable de procesar mensajes de registro \ac{sip} (\ac{sip}
REGISTER). Este crea asociaciones temporarias entre un numero telefónico \ac{ip}, 
también conocidos como \ac{aor} y
direcciones \ac{ip} (o alias) del \emph{registering device} (dispositivo de registro). Un
servidor de registro, autentica, y registra un dispositivo utilizando un
esquema de llave secreta compartida orientado a \ac{http} o \ac{http}-\emph{like}.
Un \ac{ua} puede utilizar REGISTER \emph{messages} (mensajes de registro) especiales para obtener una
lista de los registros actuales, limpiar todos los registros o agregar un alias
a sus registros.
\end{itemize}
%\cite{nassarm}

\pagebreak

\section{Estudio exploratorio de carácter bibliográfico de señalización \ac{sip} (llamada y registro)}
\label{llamada_y_reg_sip}

El lector podrá interpretar un ejemplo de establecimiento de sesión entre dos
agentes de usuarios \ac{sip} en la Figura~\ref{ej_llamada_sip}. 
La sesión comienza con una solicitud INVITE enviada desde el
usuario que origina la llamada (\emph{caller}) al destinatario de la misma
(\emph{callee}). Luego de esto, el receptor responde automáticamente con
respuestas informativas, primero \emph{TRYING} (intentando),
inmediatamente después \emph{RINGING} (timbrando). Una vez que la
llamada fue atendida, el receptor envía una respuesta satisfactoria
\emph{200 OK}. El llamante confirma  esta respuesta mediante el envío
de un mensaje de confirmación (ACK), inmediatamente después
comienza la sesión de datos (\emph{media session}). Puede verse un comportamiento similar
pero con la intervención de una entidad \ac{sip} intermediaria como es el 
\ac{sip} \emph{proxy} en la Figura~\ref{ej_llamada_sip_proxy}. 

El \ac{sdp} es el responsable por la caracterización de los datos (\emph{media}) y de la
negociación entre ambas partes. El usuario que comienza la llamada podría
insertar un cuerpo \ac{sdp} en el mensaje INVITE mientras que el receptor lo hace en el
mensaje de respuesta \emph{200 OK}. De está manera estableciendo con anterioridad al
comienzo del flujo de datos el tipo de codificación (ej.: \emph{U-law} o
\emph{A-law encoding}) que será utilizado en esta llamada. 
Las partes se pondrán de acuerdo al aceptar el protocolo de
codificación soportado por ambas, para luego comenzar la comunicación bilateral
respetando la misma. Por su parte, el emisor elegirá el puerto \ac{rtp}, 
por ejemplo: puerto \ac{rtp} de origen 10604, en el cual
recibirá la sesión de datos y el usuario que fue llamado podría elegir el
puerto 32706. Finalmente ambos interlocutores deberán enviar una solicitud de
cierre BYE. En respuesta a la misma el extremo opuesto
responderá con una confirmación \emph{200 OK}.  

\begin{figure}[h!] 
\centering
\includegraphics[width=.9 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig1a.jpg}
\caption{Ejemplo de llamada \ac{sip}.}
\label{ej_llamada_sip}
\end{figure}

\begin{figure}[h!] 
\centering
\includegraphics[width=.9 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig1b.jpg}
\caption{Ejemplo de llamada \ac{sip} via \emph{proxy} \ac{sip}.}
\label{ej_llamada_sip_proxy}
\end{figure}

\newpage

Se adjunta en Anexo B un apartado del documento \emph{Establecimiento de
sesión \ac{sip}} según RFC 3665 para tener un
entendimiento más profundo en relación a la sintaxis del protocolo \ac{sip},
principalmente orientado al establecimiento de sesión y liberación de la
misma.\\

Servicios \ac{sip}: los servicios basados en \ac{sip} (\emph{\ac{sip}-based services}) son servidores
\ac{sip} que ofrecen servicios relacionados, como por ejemplo encaminamiento de mensajes a
terminales \ac{sip}, entre los cuales se incluyen los teléfonos \ac{ip}. Por ejemplo, en la 
Figura~\ref{ej_reg_y_call_sip}, el \ac{sip} \emph{proxy} y \emph{registrar} ofrecen la posibilidad de
realizar el registro \ac{sip} y el servicio \emph{proxy} facilita a los terminales \ac{sip} 
a descubrirse y comunicarse entre ellos.

\begin{figure}[h!] 
\centering
\includegraphics[width=.9 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig1c.jpg}
\caption{Ejemplo de registro y llamada \ac{sip} via \emph{proxy} \ac{sip}. \cite{weichen}} 
\label{ej_reg_y_call_sip}
\end{figure}

Puede resumirse lo presentado por el desarrollador de software \cite{weichen}
en la Figura~\ref{ej_reg_y_call_sip} mediante los pasos detallados debajo:
\begin{enumerate}
\item El usuario que recibe la llamada se registra en el
servidor de registro al enviar una petición de registro
(\emph{REGISTER message}).

\item El \emph{registrar server} acepta esta solicitud de registro mediante una
respuesta satisfactoria con el código de estado \emph{200 OK}. La solicitud
contiene la dirección del nombre del usuario llamado.

\item El \emph{caller} solicita establecer una sesión de
comunicación con el destinatario de la misma enviando un mensaje o solicitud de
invitación, INVITE al servidor \emph{proxy}. El mensaje INVITE usualmente
contiene la descripción de la sesión \ac{sip} que el usuario que realiza la llamada
desea establecer, es decir, el protocolo de codificación de la voz, nivel de
seguridad, o dirección \ac{ip}. La descripción nombrada generalmente respeta el
formato del protocolo \ac{sdp}. 

\item El servidor \emph{proxy} apunta su búsqueda (\emph{lookup}) al servidor de registro
para encontrar la dirección actual del destinatario de la llamada. Se deberá
notar que el \emph{lookup} en el \emph{registrar server} es un procedimiento externo a
\ac{sip} en sí mismo. 

\item El servidor \emph{proxy} reenvía la solicitud INVITE desde el terminal que
realiza la llamada al destinatario de la misma basándose en su dirección
actual. 

\item El usuario que fue llamado confirma la comunicación al responder con el código
de estado \emph{200 OK}. La respuesta \emph{200 OK} a un INVITE
usualmente contiene la descripción de la sesión \ac{sip} que el receptor puede
establecer con el emisor de la comunicación. 

\item El servidor \emph{proxy} reenvía una respuesta \emph{200 OK} desde el
\emph{callee} al \emph{caller}.

\item El terminal llamante confirma el establecimiento de la sesión mediante el envío
de un mensaje ACK al \emph{proxy server}. El mensaje ACK puede contener
el acuerdo final (\emph{final agreement}) de la sesión.

\item Llegado su turno, el servidor \emph{proxy} reenvía el ACK al \emph{callee}. De
esta forma, el intercambio de tres vías (\emph{three-way handshake}) se
completa mediante el servidor \emph{proxy}, y la sesión \ac{sip} finalmente queda
establecida.

\item A partir de este momento, la comunicación \ac{voip} entre las dos partes se ha
establecido. El protocolo utilizado para la señalización y establecimiento de
la llamada puede o no ser \ac{sip}. Por ejemplo, pueden enviarse mensajes
instantáneos (\emph{instant messages}) a través de \ac{sip}. Por otro lado, las
conversaciones de voz son típicamente transmitidas sobre \ac{rtp}.  

\item Finalmente, el usuario que recibió la comunicación termina la conversación y
finaliza la sesión mediante el envío de un (\emph{BYE message}). 

\item El \emph{caller} responde a el mensaje BYE con un mensaje de estado
\emph{200 OK} aceptando la terminación de la sesión \ac{sip}.

\end{enumerate}


En el escenario descripto anteriormente, el servidor \emph{proxy} \ac{sip} simplemente
encamina los mensajes a la dirección actual del destinatario de la
conversación. Existen implementaciones más avanzadas de un servidor \emph{proxy} \ac{sip},
como por ejemplo que el servidor \emph{proxy} realice un seguimiento de donde se
encuentra registrado el usuario, a título de ejemplo su celular, o computadora de
escritorio en su trabajo. De esta manera la llamada será enrutada de manera
inteligente a través del dominio \ac{sip}.

\section{Estudio exploratorio de carácter bibliográfico de los riesgos y
seguridad en \ac{voip}}
\label{seguridad_voip}
La aparición de nuevas tecnologías de telecomunicaciones está cambiando
drásticamente nuestro estilo de vida. La integración de Internet, la telefonía
conmutada tradicional y las redes de telefonía móvil en una sola red global,
provee nuevos e innovadores medios para las aplicaciones de datos, voz y video.
Sin embargo, como nunca antes, preocupaciones extremadamente relevantes en
torno a la seguridad informática tienen que ser consideradas. Como nombramos
anteriormente, \ac{voip} hereda la carencia de seguridad de las diferentes capas de
Internet (vulnerabilidades de red, \ac{os}/software y
humanas). A diferencia de las redes de telefonía pública conmutada
\ac{pstn}, Internet es abierta y accesible a hackers con basta experiencia a
un bajo costo. Las llamadas de voz sobre IP cursadas a través de una \ac{lan} se
encuentran altamente expuestas a escuchas telefónicas no deseadas, llevadas
a cabo por alguien dentro de esta misma \ac{lan}, violando
la privacidad del usuario.  Se deben también considerar las actualizaciones de
software para \ac{voip}, las cuales están expuestas a modificaciones maliciosas que
no podrán ser detectadas sin revisiones de integridad de código estrictas y
bien ejecutadas.

En este apartado se presenta de forma resumida los tipos
de riesgos en torno a \ac{voip} y su clasificación. Si basamos la clasificación
considerando su objetivo, los diferentes ataques pueden clasificarse en tres
categorías: ataques contra servicios de red, protocolos de datos (o \emph{media}) y
por último protocolos de señalización.  

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig1d.jpeg}
\caption{Diagrama de ataques \ac{voip} específicos. \cite{nassarm}}
\label{diagrama_ataques_voip}
\end{figure}

\subsection{Servicios de red}

El despliegue y el funcionamiento de un agente de usuario \ac{sip} es generalmente
soportado por diferentes servicios de la infraestructura de red. Entre ellos
podemos nombrar los protocolos \ac{dns}, \ac{arp},
\ac{dhcp} y \ac{tftp}. En el cual \ac{arp} administra la
capa dos (capa de enlace de datos) del \emph{stack} de \ac{tcp}/\ac{ip} y 
\ac{dhcp} permite obtener de manera dinámica los parámetros \ac{ip} para nuestros
terminales \ac{sip} en la red. Luego \ac{dns} resuelve los nombres de dominio \ac{sip} y \ac{tftp}
obtiene actualizaciones de \emph{firmware} para los dispositivos \ac{voip}. Al
comprometer cualquiera de estos protocolos dentro de la \ac{lan} se estaría impactando
de forma directa sobre el dominio de telefonía \ac{ip}. Desde obtener una
actualización de un servidor \ac{tftp} no deseado, o recibir una resolución de
dominio desde un servidor \ac{dns} envenenado (\emph{\ac{dns}-cache poissoning}) el cual lo
direccione a un \emph{host} malicioso. Se puede decir, que la suplantación de identidad
mediante la suplantación de direcciones MAC e \ac{ip} se encuentran dentro de los
principales ataques en Internet, los cuales causan muchos problemas en la
infraestructura \ac{voip}. \cite{nassarm} 

\newpage

\subsection{Protocolos de \emph{media}}

Las aplicaciones \ac{voip} son en tiempo real (\emph{real-time}) por lo que alterar
su \ac{qos} podría tornar su uso en no conveniente o hasta
imposible. Con un retardo (\emph{\mbox{delay}}) de 150 milisegundos o un 5\% de paquetes
perdidos, una llamada \ac{voip} se transforma en incomprensible, incluso cuando
\emph{codecs} eficientes son implementados. Como para interrumpir la transmisión
entre las dos partes comunicadas, un atacante solo deberá congestionar la red
en algún punto del camino de transporte. Si el atacante es capaz de predecir el
número de secuencia de un flujo \ac{rtp} (ej.: mediante \emph{sniffing} (espiando)
cuando el flujo de datos no se encuentra cifrado, este podría
inyectar datos extraños en el flujo de transmisión.

La se\-ña\-li\-za\-ción \ac{sip} es fuera de banda, por lo que no existe un mecanismo para
monitorizar y controlar las sesiones de \emph{media} establecidas por \ac{sip}. Por
ejemplo, cualquier modificación en los \emph{codecs} utilizados y consecuentemente las
condiciones de \ac{qos} no son transparentes para \ac{sip}. De esta manera podría
fácilmente existir abuso de facturación basada en \ac{qos}. \cite{nassarm}


\subsection{Protocolos de señalización} 

De acuerdo a lo desarrollado por el investigador francés \cite{nassarm} el plano
de señalización de cualquier arquitectura de telecomunicaciones incluyendo \ac{voip},
es el \emph{backbone} (red troncal o segmento de red principal), por
lo que es objeto de análisis de una gran cantidad de riesgos de seguridad. Considerando la 
Figura~\ref{diagrama_ataques_voip} se detallan los ataques presentados en la misma:
\begin{itemize}
\item \emph{Profiling}:
\emph{sniffing} e interceptación del trafico \ac{sip} podrían revelar porciones de
información sensible o valiosa. La interceptación o captura de un mensaje
INVITE no cifrado brinda al llamante (en el encabezado \emph{From}), el
que recibe el llamado (en el encabezado \emph{To}) y la ruta de la
llamada (en el encabezado \emph{Via}). El cuerpo \ac{sdp} contiene la
descripción de \emph{media} de la llamada lo que permitirá el filtrado de los
paquetes correspondientes, reconstrucción de llamada y escuchar secretamente
(\emph{eavesdropping}). 
A veces, el cuerpo \ac{sdp} contiene la llave de cifrado (\emph{encryption key}) de
la sesión de datos que hace que el \emph{eavesdropping} a una sesión cifrada
también sea posible. 
El \emph{cracking} (quebrado) consiste en un algoritmo de fuerza bruta
que intenta adivinar el \emph{password} (clave) de una cuenta \ac{sip} mediante
solicitudes recursivas contra el \ac{sip} \emph{proxy} o \emph{registrar servers}.
Los ataques de \emph{cracking} son usualmente precedidos por un escaneo de
dispositivos \ac{sip} (puertos \ac{tcp}/\ac{udp} 5060 abiertos) dentro de un rango de
direcciones IPs y la enumeración y descubrimiento de los usuarios existentes.
La enumeración (\emph{enumeration}) consiste en realizar solicitudes para
asociar números \ac{voip} (\ac{sip} \ac{uri}) y un usuario existente en la base de datos de
ubicación. Dependiendo el caso (ya sea que el usuario existe, existe pero no
está disponible, o no existe) la respuesta del servidor de ubicación
(\emph{location server}) podría ser diferente. Mediante el análisis de las
respuestas, el usuario existente podría ser filtrado y utilizado en pasos
futuros del ataque. Mientras que el tipo de enumeración antes descripto es del
tipo activo, hay formas pasivas como el \emph{web browsing} (ej.: los números
\ac{voip} de una empresa pueden encontrarse en su página de Internet) y \emph{sniffing}
(ej.: extraer una extensión valida de un mensaje \ac{sip} capturado).
 
\item \ac{mitm}:
debido a la falta de buenas prácticas de autenticación, muchas situaciones
permiten un ``Hombre en el Medio'' (Man In The Middle -MITM) a ``estacionar''
entre el caller y su callee. \ac{sip} implementa un fuerte esquema de autenticación
similar al de \ac{http}. Un \ac{uas}, \emph{proxy}, \emph{redirect}, o \emph{registrar} debería
autenticar un \ac{uac}
mediante una prueba de cifrado basado en un secreto compartido. Inversamente, un
\ac{uac} puede autenticar el servidor. En la mayoría de las implementaciones, es
aplicada la autenticación en una sola dirección. Este ataque es posible, se
consideran los interlocutores Bob y Alice a los cuales se hace referencia en \ac{sip}
- RFC 3665 \cite{johnrfc3665} y una tercer parcipante Trudy
(MITM usuario malicioso):

Bob está llamando a Alice.Bob envía un mensaje INVITE a su \emph{proxy} de salida
(\emph{outbound proxy}). Trudy intercepta el mensaje y envía una redirección
modificada personalmente a Bob para que apunte o alcance su dirección \ac{ip}
(\ac{ip} de Trudy). Bob no necesita la autenticación de su \emph{proxy}, acepta la
respuesta y la redirecciona la llamada para que está pase por Trudy. El \emph{proxy}
verdadero puede ser neutralizado mediante un \ac{dos} o explotando un condición de
carrera (\emph{race condition}) \footnote{Una condición de carrera puede
ser definida como ''Comportamiento anómalo debido a una dependencia crítica no
esperada en el tiempo relativo de los eventos`` [FOLDOC]. Dichas condiciones 
generalmente involucran uno o más procesos de acceso a un recurso compartido
(como ser un servicio de red, archivo o variable), donde este acceso múltiple no
ha sido adecuadamente controlado. En general, los procesos no se ejecutan
automáticamente; otro proceso podría interrumpirlo esencialmente entre
cualquiera dos instrucciones. \cite{wheeler}}. Al mismo tiempo, Trudy remplaza la localización de Bob porsu \ac{ip} de
contacto (\emph{Contact \ac{ip}}) en el encabezado y encamina el INVITE hacia Alice.
A partir de este momento toda la señalización entre Bob y Alice va a pasar por
Trudy. Secuestrar (\emph{hijack}) el vinculo de señalización es un paso
previo a secuestrar el de datos. Trudy puede hacerse pasar por Alice
considerándolo desde la perspectiva de Bob y puede hacerse pasar por Bob desde
el lugar de Alice.
En otro escenario, Trudy explota la falta de autenticación de extremo-a-extremo
(\emph{end-to-end authentication}). Trudy intercepta el INVITE desde Bob hacia
Alice, espera a que la sesión esté establecida, luego realiza un siguiente paso
y envía (a Bob o Alice) un nuesvo INVITE de Bob a Alice con los mismos
encabezados \emph{Call-ID, To} y \emph{From} y un número de
secuencia de comando incrementado (en \emph{CSeq}). Por medio de este
mensaje creado manualmente, Trudy puede cambiar las condiciones de \emph{media}
(datos), (ej.: remplazando \emph{reception via route port} 
(puerto en tránsito de recepción), agregando o borrando cadenas de datos), o el
vinculo de señalización (por medio de los encabezados \emph{Via} y
\emph{Route}). Por un momento, la sesión habrá sido secuestrada por
Trudy. Este caso teórico es el implementado en fraudes de tasas y
facturación telefónica. 

\item Mensajes malformados (\emph{malformed messages}):
las vulnerabilidades de software \ac{voip} son un objetivo de ataques remotos tales como
sobre carga de memoria intermedia (\emph{buffer overflow}) y mensajes
manualmente modificados. Posibles daños son colapso del sistema (\emph{system
crash}), código de ejecución remota y acceso no autorizado. 

\item Mensajes falsificados (\emph{spoofed messages}):
los ataques de CANCEL y BYE son un tipo de ataque de denegación de
servicio contra el procedimiento de establecimiento de una llamada \ac{sip}. 
Aquí damos cuatro ejemplos:

• Si en cualquier momento alguien trata de llamar a Bob, Trudy envía un CANCEL
falsificado (\emph{spoofed CANCEL}) (como si sería originado desde el usuario
que realiza la llamada) para Bob, luego podrá prevenirse a Bob de recibir
cualquier llamada.

• Si en cualquier momento Bob intenta hacer una llamada, Trudy envía un CANCEL
falsificado (como si este fuese originado por Bob) hacia el destino, luego
podrá prevenirse a Bob de realizar cualquier llamada. Además,

• Trudy envía un BYE falsificado para terminar la sesión luego de un corto
tiempo desde su comienzo. 

• Trudy toma el lugar del \emph{proxy} de salida mediante el envío de respuestas de
error falsificadas como 4xx (\emph{client error}), 5xx (\emph{server error}) o 6xx (\emph{global
error}) de manera de persuadir a Bob de que existe alguna situación de error
previniendo la continuidad de sus llamadas.  

\item \emph{Flooding attacks}:
los ataques de inundación tienen como objetivo los
elementos del plano de señalización (ej.: \emph{proxy}, \emph{gateway}, etc.) con el fin de
tirarlo abajo y producir un colapso en la red de \ac{voip}. Basados en la técnica de
uso, estos ataques pueden ser clasificados como inundación de mensajes legales,
mensajes mal formados aleatoriamente, o mensajes mal formados explotando
vulnerabilidades específicas del objetivo. 
El autor \cite{nassarm}, categoriza alguno de estos
ataques basados en el \ac{uri} del solicitante y lleva adelante un estudio
comparativo de estos en contra de equipos \ac{voip} de código abierto populares.
Adoptaremos la misma categorización, la cual se presenta a continuación:

• Inundación \ac{udp}: considerando que la gran mayoría de los sistemas \ac{sip} usan \ac{udp}
como protocolo de transporte, un gran número de paquetes \ac{udp} aleatorios son
enviados en un intento de congestionar el ancho de banda de red del objetivo.
Dichos ataques producen una alta tasa de pérdida de paquetes, por lo qué el
tráfico de señalización \ac{sip} de llamada legítima verá sus probabilidades de
alcanzar su destino para ser procesada de manera muy reducida.
 
• Inundación INVITE con un \ac{uri} de solicitud válido: el atacante llama a un
teléfono \ac{sip} registrado en el objetivo. El objetivo transmite la llamada al
teléfono. Si el \emph{proxy} es con monitoreo o seguimiento de estado
(\emph{stateful proxy}) manejará una máquina de estados para cada transacción. El
teléfono será rápidamente sobrecargado por la alta tasa de llamadas y no le
será posible terminar las llamadas. Como resultado, el servidor se encontrará
reservando recursos por un largo período de tiempo y se quedará sin memoria
disponible.

• Inundación INVITE con teléfono \ac{sip} inexistente: si el atacante no conoce
ningún \ac{uri} \ac{sip} válido registrado en el objetivo, puede enviar llamadas a una
dirección no válida. El objetivo del ataque responde como ''usuario no
encontrado`` (\emph{``user not found''}). Cuando la tasa ataques es superior a
la capacidad del objetivo, sus recursos quedarán exhaustos. Este tipo de
inundaciones es menos perturbadora que la explicada en el item anterior, pero
el CPU del dispositivo afectado sera cargado con transacciones inútiles y de
esa forma se rechazarán solicitudes válidas.    
                                  
• Inundación INVITE con una dirección \ac{ip} de domínio inválida: el usuario
malicioso llama a un usuario con una dirección \ac{ip} de origen (de destino para el
usuario llamado) falsa. En este caso la víctima intentará varias veces
comunicarse con esta red/\emph{host} no alcanzable quedando atrapado por este
tiempo al mantener el estado de la transacción \ac{sip}. Este ataque es eficiente
contra algunos \emph{proxies} como OpenSER. 

• Inundación INVITE con un nombre de dominio inválido: también conocido como un
ataque \ac{sip}-\ac{dns}. El usuario mal intencionado llama al usuario con un nombre de
dominio de destino no posible de resolver. La víctima se ve forzada a preguntar
al servidor \ac{dns} para resolver el nombre de dominio y esperar su respuesta. La
respuesta del \ac{dns} podría tomar un largo lapso de tiempo, especialmente bajo
ciertos errores de configuración. Algunos \emph{proxies} son síncronos (ej.: estos
bloquean el proceso hasta que una respuesta del \ac{dns} es recibida) mientras que
otros son asíncronos  (ej.: estos guardan el estado de la llamada y toman una
nueva solicitud, una vez que la respuesta desde el \ac{dns} es recibida, estos serán
notificados). Los \emph{proxies} síncronos son fáciles de bloquear por este tipo de
ataques, mientras que los asíncronos borrarán su memoria en cierto momento
disminuyendo el impacto del mismo. 
                                     
• Inundación \emph{INVITE/REGISTER} con autenticación activada: el atacante envía un
mensaje INVITE o REGISTER y luego detienen el proceso de \emph{handshaking}. El
\emph{proxy/registrar} responde con un \emph{challenge} y espera que la respuesta sea
enviada nuevamente con las credenciales de autenticación. Este proceso es
costoso para el \emph{proxy/registrar} en cuanto a términos de procesamiento (generando
muchas transacciones y \emph{nonces} relacionadas a la autenticación) y uso de
memoria (diálogos/transacciones de estado de los clientes). 

\item \emph{Gateways}, \ac{pbx} y \ac{fw}:
los \ac{mgc} y servidores \ac{pbx} son puntos críticos en las
arquitecturas de voz sobre \ac{ip}. Los \ac{mgc} son responsables de realizar la
intercomunicación entre diferentes tipos de redes. Tal es el caso, entre una red
\ac{sip}-based y la \ac{pstn} ISUP/SS7-based. La traducción entre mensajes \ac{sip} y un
mensaje ISUP consiste en el mapeo de los parámetros correspondientes. La
administración maliciosa de este proceso de mapeo es una fuente de peligro o
amenaza causada por la carencia de mecanismos de autenticación e integridad en
la red SS7-based. \ac{pbx} es un término usado en redes \ac{pstn} y adoptado por \ac{voip}
para representar el suministro de servicios \ac{voip} (Conmutación de llamadas,
voice-mail, respuestas automáticas, etc). Un ejemplo de una \ac{pbx} \ac{voip} es
Asterisk. Desde el punto de vista de \ac{sip}, una \ac{pbx} es equivalente a
un \ac{b2bua}. En \ac{pbx}, los servidores de facturación y
voice mail, los \ac{cdr} y
la información confidencial de usuario debe ser protegida contra intrusiones
basadas en \emph{hosts} (\emph{host-based intrusions}) podemos nombrar entre otros el acceso no autorizado o
destrucción de datos. 
\ac{voip} requiere una nueva generación de \emph{firewalls} con características dinámicas
para abrir y cerrar puertos de \emph{media} considerando los parámetros de la sesión
negociados. Atacando los \emph{firewalls} dinámicos o comprometiéndolos revela los
dispositivos protegidos. Una forma es consumir todos los recursos del \emph{firewall}
mediante varias solicitudes de apertura y cierre de puertos. En otra dirección,
los \emph{malwares} (softwares maliciosos) podrían ocultar su tráfico al
transmitir el mismo mediante un puerto de \emph{media} que se encuentre abierto. Si
son atacadas, algunas aplicaciones \ac{voip} pueden ser utilizadas como
\emph{backdoors}.


\item Falsificación de identificador de llamante (\emph{caller-id spoofing}): 
en la \ac{pstn}, \ac{cdn} es un servicio telefónico que permite a la parte llamante proveer el
\ac{cpe} de la parte llamada con el número de directorio durante el ciclo de timbrado
(\emph{ringing}). \ac{ani} es un sistema utilizado por la compañías telefónicas y clientes
para identificar los números de los usuarios llamantes. Tradicionalmente,
la suplantación o falsificación del \emph{caller-id}/\ac{ani} era un proceso complicado que
requería acceso a los \emph{switches} o \ac{pbx}s de la compañía operadora. Con \ac{voip}, puede
fácilmente falsificarse el caller-id (ej.: campo \emph{From} en el encabezado \ac{sip}) y
engañar al usuario llamado con un numero falso. El reemplazo del caller-id
promueve la suplantación de identidad (\emph{identity theft}) y el \emph{by-passing}
(sobrepaso) de algunas verificaciones de sistema (ej.: obtener acceso al buzón
de voz).   

\item Amenazas sociales (\emph{social threats}): 
las amenazas sociales son ataques que van desde la generación de comunicaciones no solicitadas que son
molestas y perturbadoras para los usuarios, hasta otras más peligrosas como
ataques de robo de datos. La amenaza es clasificada como social debido a que el
termino ``no solicitada'' está estrictamente contenido a las preferencias
específicas de usuario. Esto hace que este tipo de ataques sean difíciles de
identificar.
Un ejemplo de esto es una amenaza comúnmente referida como \ac{spit}. 
\ac{spit} es similar a \emph{spam} en el sistema de e-mail pero entregado 
por medio de llamados de voz. Las llamadas \ac{spit} pueden ser llamadas de
\emph{telemarketing} utilizadas para guiar a los llamados a un servicio de vente de
productos. Son los más perturbadores para las víctimas considerando que
requieren su reacción momentánea para detener la perturbación.
La cantidad diaria de publicidad recibida en una casilla de correo postal es
muchísimo menor al \emph{spam} masivo recibido cada día en el correo electrónico. Esto
es muy intuitivo ya que el \emph{spam} prácticamente no apareja costos para los
publicadores. Ahora que pasaría si las llamadas telefónicas fueran de un costo
mínimo o sin costo alguno? \ac{spit} se vale del bajo costo que tienen las llamadas
\ac{voip} con respecto a los sistemas de vos telefonía tradicional. Actualmente está
estimado que generar una llamada de voz sobre \ac{ip} es tres ordenes de magnitud
más económico que las llamadas generadas en \ac{pstn}.
Una variante de \ac{spit} es la comúnmente llamada ataque de \emph{vishing} (\ac{voip}
\emph{phishing}). En general, phising se trata de enmascarar una tercer parte
confiable en el intento de adquirir información confidencial de las víctimas.
Por ejemplo, el phisher (atacante) usa un link en un e-mail como señuelo,
persuadiendo a la víctima mediante una página web con la misma apariencia que
la de su banco y solicitando que complete algunos campos con información
sensitiva. Con \ac{voip}, \emph{vishing} apunta tanto a realizar que el usuario de \ac{voip}
lleve a cabo llamadas a números excesivamente caros con el fin de obtener el
premio prometido o para colectar información personal redirigiendo a los
usuarios mediante un número DID (Direct Inward Dialing - Discado Interno
Directo) hacia un IVR (Interactive Voice Responder) simulando ser confiable. 
La mayoría de estos ataques van a ser generados por máquinas (\emph{bot-nets})
programadas para realizar dicho trabajo. Comunicaciones no solicitadas (como
ser \ac{spit} o \emph{vishing}) son, desde un punto de vista de señalización, transacciones
correctas técnicamente. No es posible distinguir de un mensaje INVITE si dicha
transacción es \ac{spit} o no. Desde un punto de vista técnico el reto es aun más
complicado  considerando que el contenido no está disponible para ayudar en la
detección hasta que el teléfono timbre (interrumpiendo al usuario) y el
usuario receptor de la llamada responde la misma. Por esta razón, técnicas
usadas con éxito contra e-mail \emph{spam} por citar un caso alteración de texto, serán
difícilmente reusables en la esfera de \ac{voip}. Aún si la transacción es
identificada como no solicitada, su procesamiento dependerá en gran medida del
entorno legal en el país del usuario que realiza la llamada.
\end{itemize}

\section{Estudio exploratorio sobre \emph{honeypots} \ac{voip} específicos y Artemisa \emph{honeypot}}
\label{honeypot_artemisa}

Encontraremos en la literatura sobre el tema, que un \emph{honeypot} es una trampa
instalada para detectar, desviar y monitorear ataques a sistemas informáticos.
Generalmente consiste en una computadora, datos o un sitio de red que parecería
ser parte de una red pero que en realidad está aislada y bajo monitoreo. Un
\emph{honeypot} tienen un valor específico en la detección y desvío de ataques. Los
\emph{honeypots} usualmente son un sistema particular que normalmente no deberían ver
ningún tipo de tráfico o actividad legítima. Cualquiera sea la actividad vista
en un \emph{honeypot} puede ser interpretada como maliciosa o no autorizada. 

El concepto de \emph{honeypot} puede ser muy útil como componente específico de una
arquitectura de prevención e intrusión de \ac{voip} como la presentada en 
la Figura~\ref{arquitectura_de_red_sip}.
Este concepto es traído al mundo de la voz sobre \ac{ip} desarrollando una infraestructura de \ac{voip}
completamente paralela, totalmente separada tanto lógica como físicamente de
la infraestructura real actividad de la cual estaremos monitoreando de manera
continua.La separación física es necesaria de modo de evitar que el atacante
quiebre la seguridad de de nuestro \emph{honeypot} y esto le permita atacar la
infraestructura \ac{voip} real desde allí. 

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig2a.jpg}
\caption{Arquitectura de red. \cite{ewaldt}}
\label{arquitectura_de_red_sip}
\end{figure}

Las características fundamentales de un \emph{honeypot} especifico de \ac{voip} son la
mitigación de la amenaza de \ac{spit} con una infraestructura de bajo
costo como puede verse en la
Figura~\ref{arquitectura_honeypot_sip}. Además, el hecho de que dicha infraestructura
complementa adecuadamente a todos los posibles sistemas de detección y
prevención de intrusiones mediante la recopilación de información, muy útil para
mejorar la tasa de error de otras metodologías.

El \emph{honeypot} específico \ac{voip} presentado en la Figura~\ref{arquitectura_honeypot_sip} en el
cual está basado Artemisa está compuesto por componentes \ac{voip} \emph{Open Source}
(código abierto) estándares basados en el protocolo \ac{sip}. El principal objetivo
de un \emph{honeypot} es atraer ataques hacia un entorno seguro y protegido para
posteriormente analizar los esquemas de ataque y deducir nuevas maneras y
métodos preventivos en contra de estos. Para alcanzar esta meta el \emph{\mbox{honeypot}}
tienen que ofrecer servicios atractivos que valgan la pena ser atacados. En
nuestro estudio si bien estos servicios fueron expuestos a la \ac{wan}, los mismo
son simulando un prestador de \ac{voip}. Consideramos que sería de gran valor
implementarlos en una red en producción. Un \emph{\mbox{honeypot}} \ac{sip} debería o podría
simular una red \ac{sip} completa que pueda ofrecer muchos entidades
alcanzables. \cite{ewaldt}

\begin{itemize}
\item \ac{sip} \emph{components}.
\item \ac{sip} \emph{services}.
\item \ac{sip} \emph{users}.
\end{itemize}

\begin{figure}[h!] 
\centering
\includegraphics[width=.8 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig2b.jpg}
\caption{Arquitectura del \emph{honeypot} \ac{sip}. \cite{ewaldt}}
\label{arquitectura_honeypot_sip}
\end{figure}




\subsection{Introducción a Artemisa honeypot}
\label{intro_arte} 

El \emph{honeypot} es diseñado para conectarse al dominio \ac{voip} de una compañía como un
\emph{\mbox{back-end} \mbox{user-agent}} con el fin de
detectar actividad maliciosa en una etapa temprana. Asimismo, el \emph{\mbox{honeypot}} puede
jugar un rol en el ajuste en tiempo real de las políticas de seguridad del
dominio corporativo en el que se encuentre implementado.
Es bueno recordar que el esquema de direccionamiento \ac{sip} está basado en el
\ac{uri} con la siguiente sintaxis: \texttt{sip:user@host:port;}
\texttt{parameters}. 

Un dominio \ac{sip} corporativo está típicamente compuesto por las instalaciones de
usuario (\emph{hard} y \emph{softphones}), una infraestructura \ac{sip} (ej.: \emph{proxy}, \emph{registrar},
\emph{back-to-back} \ac{ua}) y soportando servicios asociados (ej.: administración
WEB (\emph{web-based management}, \ac{tftp}, \ac{dns}). 

Para el desarrollo Artemisa se propuso su diseño de arquitectura
implementada con he\-rra\-mien\-tas \emph{Open Source}, haciendo las veces de \emph{honeypot} de
\ac{sip} específico que puede ejecutarse como \emph{back-end} \emph{user-agent} en el dominio de
la organización. Debido al hecho de que las extensiones del \emph{honeypot} no
representan extensiones reales (de usuario reales), toda actividad que lo
alcance será percibida como sospechosa. La misma atiende las llamadas y las
graba incluyendo la traza \ac{sip}. Artemisa es capaz de clasificar varios tipos de
anomalías y reportarlos al ad\-mi\-nis\-tra\-dor de la red o automáticamente controlar
las políticas de seguridad del dominio bajo su protección. Las configuraciones
de utilización típicas de un \emph{honeypot} como se muestra en la Figura~\ref{implentacion_artemisa}, el
mismo se registra a uno o mas \ac{sip} \emph{registrars} y queda a la espera de llamadas y
mensajes \ac{sip}. Dos opciones son posibles, la primer opción es  conectar el
\emph{honeypot} en la \ac{dmz}.
Consecuentemente, estará aislado de \ac{lan} y la VLAN de
\ac{voip} en caso que la máquina se vea comprometida. La segunda opción es
conectarlo a través de Internet considerando que hoy en día muchos proveedores
de voz sobre \ac{ip} tienen abonados de todo el mundo a través de Internet.

\begin{figure}[h!] 
\centering
\includegraphics[width=.8 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig2c.jpg}
\caption{Implementación de Artemisa \emph{honeypot}. \cite{docarmof}}
\label{implentacion_artemisa}
\end{figure}

\subsection{Artemisa honeypot y sus características funcionales}
\label{caracteristicas_arte}

El \emph{honeypot} registra una serie de extensiones virtuales contra uno o más \ac{sip}
\emph{registrars}. Las extensiones virtuales deben ser seleccionadas de modo de
proteger a las reales. Por ejemplo, si las extensiones reales están todas
compuestas por números de tres dígitos, sería recomendable que las extensiones
virtuales cubran todos los números de 3 dígitos que son utilizados por los
abonados reales. Alternativamente, el \emph{proxy} de dominio o la \ac{pbx} pueden ser
configurados para reenviar todos los mensajes que no tengan como destino
extensiones reales hacia el \emph{honeypot}. Las metas funcionales de dicha
configuración van desde detección de enumeración y mitigación de \emph{spam} sobre
\ac{voip}, hasta la colección de firmas y \emph{fingerprints} (huellas digitales o identificador
de dispositivos), como también el
\emph{blacklisting} (poner en lista negra o de bloqueados) a los atacantes. La
política de seguridad del dominio \ac{voip} puede ser controlado en tiempo real. Se
detallaran las metas antes mencionadas dentro de esta unidad. 

\begin{figure}[h!] 
\centering
\includegraphics[width=.9 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig2d.jpg}
\caption{Módulos de Artemisa \emph{honeypot}. \cite{docarmof}}
\label{modulos_artemisa}
\end{figure}

\begin{itemize}

\item Detección de enumeración (\emph{Enumeration detection}):
una enumeración es detectada como una serie de mensajes OPTIONS, REGISTER o
INVITE destinados a una serie de extensiones virtuales. La fuente del ataque
debe poder recibir las respuestas asociadas de manera de poder analizarlas. En
modo activo, nuestro \emph{honeypot} recolecta información de al fuente (ej.: la
herramienta de ataque, el \ac{ua}, la dirección \ac{ip} y el dominio, la
ubicación geográfica, el numero de sistema autónomo) y los reporta al
administrador de dominio. La recolección de información esta basada en
herramientas de \emph{networking} tales como Nmap, Sipsaky y \ac{dns} Lookup. 
Esta información puede ser interpretada automáticamente con el objetivo
de bloquear un ataque de enumeración en tiempo real.

\item Mitigación de \emph{spam} \ac{voip} (\emph{VoIP spam mitigation}):
\ac{spit} es detectada como una serie de mensajes INVITE dirigidos a una serie de
extensiones de Artemisa seguidos del envío de trafico de \emph{media} (voz). Los
\emph{spitters} (generadores de \ac{spit}) esperan las respuestas de \emph{200 OK} cargando
los \ac{sdp} recibidos y envían su \emph{spam} a la \ac{ip} y puerto \ac{rtp} anunciados. Nuestro
\emph{honeypot} responde a las llamadas de \ac{spit} y las graba para un posterior análisis
de contenido. El análisis de las llamadas de \ac{spit} es muy útil para desarrollar
filtros anti \emph{spam} asociados a casillas de correo de voz (\emph{voice
mail-boxes}), o para ser aplicados a ``Pruebas de Turin`` o ''El Juego de la
Imaginación`` (\emph{Turing Test - The Imagination Game}) \footnote{Turing, en
1951, propuso un test, ``The Imagiantion Game'', que resolvió la
problemática de la máquina inteligente. El juego no
involucraba IA computacional. Luego propuso un cambio, en el cual en lugar de
que los participantes sean personas, había un humano y una computadora. El
trabajo del juez sería decidir cual de los contendientes es humano, y cual la
máquina. Propuso que si bajo estas condiciones, un juez tenía una efectividad
menor al 50\%, esto refleja que es tan probable seleccionar tanto al humano como
la computadora. Luego, la computadora sería una simulación pasable de un
ser humano, en consecuencia, inteligente. Actualmente, el juego ha sido 
modificado de modo tal que hay solo un contendiente, y el rol del juez no es
seleccionar entre dos participantes, sino simplemente decidir si el participante
es un humano o una máquina. \cite{reingold}} para distinguir
entre un humano de los patrones de \ac{spit} automatizado. El \emph{honeypot} recolecta
piezas de información sobre la fuente de \ac{spit} y las reporta al administrador
del dominio. Estas piezas pueden ser interpretadas automáticamente y ser usadas
para bloquear a los \emph{spammers}. 

\item Colección de firmas y \emph{fingerprints} (\emph{signatures and
fingerprint collection}):
   diferentes equipos \ac{voip} y Firmwares (entre estos teléfonos, \emph{call
managers}, servidores) han sido identificados como vulnerables a ataques dentro de los cuales
se encuentran
\emph{remote crash, SQL injection \footnote{SQL injection (inyección SQL) es un ataque en el cual
el código malicioso es insertado dentro de una cadena de caracteres que luego son pasados a una
instancia de servidor SQL para \emph{parsing} (análisis sintáctico) y ejecución. Cualquier proceso que
construye una instrucción SQL sera revisada para vulnerabilidades de inyección (\emph{injection
vulnerabilities}) debido que el servidor SQL ejecutará todas las consultas (\emph{queries}) válidas
que este reciba. Incluso los datos parametrizados pueden ser manipulados por un
atacante especializado y determinado. \cite{microsoftsql}}, XSS cross-site \emph{scripting}
\footnote{Cross-Site Scripting
(también conocido como XSS) es uno de los ataques de capa de aplicación web
(\emph{\mbox{application} \mbox{layer}}) más comunes. Las vulnerabilidades XSS tienen como blanco
scripts embebidos en una página, los cuales son ejecutados en el extremo del
cliente (\emph{client side}, es decir en el navegador web del usuario) en lugar de ser
ejecutado del lado del servidor (\emph{server side}). XSS en si mismo es una amenaza
que es traída por las debilidades de la seguridad en Internet de los lenguajes
de \emph{scripting} del lado del cliente como HTML y JavaScript. El concepto de
XSS es manipular los \emph{client side} scripts de una aplicación web para ser
ejecutado de la manera deseada por el usuario malicioso. Este tipo  de
manipulación puede embeber un script en una página la cual puede ejecutar el
mismo cada vez que es cargada, o cuando quiera un evento asociado a esta sea
ejecutado. \cite{acunetix}}} y \emph{remote eavesdropping}
(escuchas a escondidas remotas). Estas vulnerabilidades pueden ser explotadas
mediante el envío de mensajes \ac{sip} especialmente trabajados. El \emph{fingerprint} del
dispositivo de la víctima debería anteceder el ataque con el fin de seleccionar
un \emph{exploit} (algoritmo malicioso) adecuado al mismo. Nuestro \emph{honeypot}
anuncia \emph{fingerprints} falsos (ej.: fabricante, nombre del producto, versión
\emph{firmware}) en el \ac{ua} o encabezado del servidor
cuando el \emph{fingerprinting} se realiza de forma activa (por ejemplo mediante un
mensaje OPTIONS). Por ejemplo, un administrador de dominio \ac{voip} puede tener
interés en anunciar \emph{fingerprints} similares a los utilizados en de forma activa
en el dominio en producción. Asimismo, los mensajes \ac{sip} modificados que son
recibidos serán recolectados y reportados al administrador de la red. Estos
mensajes son importantes al objeto de extraer \emph{signatures} (firmas) y \emph{fingerprints}
e incorporarlas en los \emph{\ac{sip}-aware firewalls} (\emph{firewalls} que interpretan
\ac{sip}). Se reportan los \emph{zero day exploits} (\emph{exploits} de día cero)
\footnote{Vulnerabilidades \emph{zero day} (\emph{zero day vulneravilities}) son vulnerabilidades de las cuales
los fabricantes no han lanzado un parche (\emph{patch}) para corregirlo. La
ausencia de un parche para una \emph{zero day} \emph{vulnerability} presenta una amenaza para
las organizaciones y los usuarios, ya que en muchos casos este tipo de amenazas
pueden evadir la detección basada en firmas (\emph{signature based}) hasta que un
parche sea lanzado. La naturaleza inesperada de una amenaza de día cero es una
preocupación muy seria, especialmente porque podrían ser usadas en ataques
específicos y en la propagación de código malicioso. \cite{symantec}} al fabricante a fin de corregir
sus sistemas. Se reporta y se crean
listas negras o de bloqueo (\emph{black list}) basados en la fuente de los ataques si
estás no son identificadas como falsificadas (\emph{spoofed}).

\item Control en tiempo real y en circuito cerrado de la política
de seguridad del dominio (\emph{real-time closed-loop control of the domain security
policy}):
como fue mencionado anteriormente en las funcionalidades previas, se apuntó a la
automatización de la interpretación y el reconocimiento de las actividades
percibidas en tiempo real. El resultado de este análisis es reportado al
administrador, pero también puede disparar un script de respuesta e intercambiar
datos con otros componentes en la arquitectura \ac{voip} aplicado de manera
progresiva y continúa, especialmente cuando el ataque persiste. El control de
circuito cerrado (\emph{closed-loop}) de toda la amplitud del dominio permite
establecer un compromiso entre la seguridad y el alcance del servicio. Por
ejemplo cuando debemos tratar con \ac{spit}, podemos comenzar por una política de
``intente más tarde`` \emph{(''try later``}). Si el ataque persiste,
terminaremos por bloquear totalmente las \ac{ip} de origen. Desde otro enfoque, la
reacción en tiempo real a las amenazas de seguridad es mandatorio para
servicios sensibles y de alto costo como \ac{voip}.

\item Configurando el \emph{honeypot}:
las funcionalidades del \emph{honeypot} son definidas a través de un modo de
comportamiento representado por una máquina de estados. La máquina de estados
es descripta mediante reglas y operaciones cuidadosas. Modos personalizados
pueden ser definidos por el administrador. Complementariamente, definimos dos
modos primitivos: pasivo y activo. En el modo pasivo, Artemisa no utiliza
ninguna herramienta de \emph{networking}, por ende, no envía ningún tipo de solicitud
que pueda revelar su presencia. En modo activo y cuando el \emph{honeypot} revela que
el ataque proviene de una fuente real, el mismo intenta recolectar información
acerca de este, entre los cuales se encuentran: el \emph{fingerprint} \ac{sip}, el \emph{fingerprint} del sistema
operativo de la fuente de ataque, la ruta \ac{ip}, los puertos y servicios abiertos
(varios puertos abiertos pueden indicar que una serie de sesiones están siendo
mantenidas en paralelo).  
\end{itemize}


\subsection{Modulos e implementación del honeypot}
\label{modulos_arte}

Artemisa está compuesto por una serie de módulos integrados utilizando el
lenguaje de \emph{scripting} Python. Estos módulos son representados en la Figura~\ref{modulos_artemisa}
que fue presentada anteriormente.
El módulo Tcpdump controla la colección de tráfico de red en bruto (\emph{raw
network traffic}) en la máquina donde se está ejecutando el \emph{honeypot} empleando
la herramienta \mbox{Tcpdump}. Los módulos de grabación de llamada trabajan con la
librería PJMedia para salvaguardar los flujos de audios recibidos en un formato
apropiado. Se describirán brevemente los módulos restantes a continuación. 

\begin{figure}[h!] 
\centering
\includegraphics[width=.6 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig2e.jpg}
\caption{Módulos de Artemisa \emph{honeypot}. \cite{docarmof}}
\label{digrama_flujo_artemisa}
\end{figure}

\begin{itemize}

\item PJSIP \emph{user-agent}, \emph{stacks} (pilas) PJSIP y PJMEDIA:
el \ac{sip} \ac{ua} es el responsable de registrar la
extensión virtual en uno o varios servidores de registro, respuesta de
llamadas, respuesta a solicitudes \ac{sip} y anunciar los \emph{fingerprints} virtuales.
Complementariamente, controla el resto de los componentes basados en el modo de
comportamiento. El aplicativo utiliza la vinculación de Python (\emph{Python
binding}) de la librería PJSIP6 \emph{user-agent} (PJSUA) de C/C++. Esta librería hace
uso de dos pilas (\emph{stacks}): PJSIP y PJMedia para el manejo de los
protocolos \ac{sip} y \ac{rtp}. PJSUA permite emular un agente de usuario \ac{sip} de una
manera simple. En contraste, los binding de librería no ofrecen acceso por
completo al \emph{stack} del protocolo \ac{sip} (ej.: para el manejo de mensajes OPTIONS).
PJSUA recibe como parámetro la cuentas \ac{sip} virtuales y configurada a través de
los archivos de configuración en el momento de \emph{bootstrap} (arranque) y
vía una Interfaz de Linea de Comandos (\emph{\ac{cli}}) en
ejecución.  

\item Herramientas activas. Recopilación de información:
este componente es responsable de correr herramientas de reconocimiento con el
fin de colectar información complementaria acerca de las fuentes de los
mensajes recibidos. Aquí se investigan varios items en los mensajes \ac{sip} y \ac{sdp}:
la \ac{ip} de origen del mensaje, el \ac{uri} del llamante, el encabezado \mbox{Contact}
(contacto), el encabezado(s) \emph{Via}, los encabezados de Ruta (\emph{Route})
y \emph{\mbox{Record-Route}} si los hubiere, la \ac{ip} y puerto de \emph{media} (en los atributos
\ac{sdp}: Connection(c), Owner(o) and Media(m)). Estos componentes invocan las
siguientes herramientas: 

• Dig: siendo la alternativa del precursor Nslookup, esta herramienta
se aprovecha para consultar los registro de \ac{dns}. Lleva a cabo búsquedas \ac{dns} y
\ac{dns} reversas (\emph{Reverse \ac{dns} lookups}) 

• Jwhois: siendo este un \emph{whois} a nivel de Internet (\emph{Internet
whois}), esta herramienta ayuda a obtener información disponible públicamente
acerca de los nombres de dominio relacionados a los mensajes \ac{sip}.

• Sipsak: esta es una herramienta \ac{sip} que puede realizar diferentes
pruebas \ac{sip} pudiendo nombrar el envío de un mensaje OPTIONS a una \ac{uri} de destino. 

• Nmap: esta es una herramienta de escaneo que podemos usar para
escanear el terminal (\emph{host}) del llamante y determinar si \ac{sip}, \emph{media}, o ambos
puertos se encuentran abiertos.  

• Traceroute: ayuda a trazar y rastrear las rutas \ac{ip} hacia los
diferentes \emph{proxies} \ac{sip} y \ac{ua}s envueltos en el mensaje \ac{sip}.

• P0f: es una herramienta de \emph{fingerprinting} pasivo que nos facilita
recuperar información adicional acerca de la fuente, tal como el sistema
operativo. 

La información colectada es formateada y provista al conjunto de
clasificaciones y reglas de correlación. 

\item Clasificación basada en reglas (\emph{rule-based classification}):
el clasificador interpreta los datos obtenidos por las herramientas de
reconocimiento y genera conclusiones cualitativas basadas en reglas formando un
árbol de decisión (\emph{decision tree}). Se presenta un ejemplo en la
Figura~\ref{digrama_flujo_artemisa}. Este árbol de decisión recibe e interpreta un mensaje
INVITE y genera un o más conclusiones acerca de la naturaleza del mensaje. Los
óvalos representan acciones llevadas a cabo y los rectángulos (los nodos
''hoja`` o \emph{''leaf``} en inglés) representan las conclusiones.

El primer y más importante paso es chequear si el mensaje posee algún
\emph{fingerprint} conocido de alguna herramienta de ataque, ya que es fácil tratar con
ataque si sabemos como ha sido generado el mismo. 

El segundo paso es determinar si el mensaje ha sido falsificado (alguno de sus
campos) o no (\emph{spoofed message}). Los mensajes que no han sido
falsificados o modificados serán señal de un ataques interactivos
(\emph{interactive attacks}) donde el atacante necesita capturar las respuestas
y analizarlas. Esto puede ser llevado a cabo verificando que los nombres de
dominios usados sean reales, y revisando si el puerto anuncio \ac{sip} (puerto
\ac{udp}:5060 y/o de \emph{media} (\ac{rtp}) están abiertos. 

El tercer paso es verificar si el \ac{uri} solicitado transporta una de las
extensiones virtuales. En caso negativo, revisamos si el mensaje está viniendo
a través del \emph{proxy} en uso (\emph{Via header}), o \ac{pbx} (\ac{ip} de origen). Esto
puede diferenciar un ataque directo (probablemente desde dentro de la red \ac{lan})
de un error en el plan de discado (\emph{dial plan error}). Podríamos
preguntarnos. ¿Por qué este mensaje es enrutado hacia el \emph{honeypot} considerando
que no apunta a una extensión virtual?.

Otras verificaciones aplican al diálogo completo iniciado por dicho mensaje INVITE. 
Artemisa responde con un \emph{200 OK} y espera por un ACK y \emph{media}. Si es
recibido, este diálogo es considerado como \ac{spit}. De lo contrario, el INVITE
necesita ser correlacionado con otros eventos porque podría ser parte de un
escaneo (\emph{scanning} intentando alcanzar un \emph{gateway} hacia la \ac{pstn} o
extensiones válidas) o un intento de \emph{ringing} (haciendo timbrar todos los
teléfonos en el dominio comprometido). 

Se da al administrador la posibilidad de definir el proceso de
operaciones de investigación, y las reglas a ser aplicadas en los resultados de
investigación. Y de esta forma, controlar el proceso de decisión del \emph{honeypot}.
Las reglas de clasificación son ubicadas bajo un contexto (por ejemplo el
mensaje INVITE recibido) y están compuestos por una pre-acción
(\emph{pre-action}), una condición y una acción. 
 
Se usa una sintaxis simple \texttt{attribute = value} para describir las
reglas. Por e\-jem\-plo, el primer nodo del árbol de decisiones previamente
mencionado puede ser representado por la siguiente regla:

\begin{verbatim}
[rule_1]
type = Classification
context = INVITE
pre-action = assign %a Check_Fingerprint()
condition= %a in FINGERPINTS
action= add \
"Tool identified as: %a" CONCLUSIONS
\end{verbatim}

Donde \texttt{assign, in} y \texttt{add} son operadores específicos,
\texttt{FINGERPINTS} y \texttt{CONCLUSIONS} son arreglos (\emph{arrays}) de
datos predefinidos y \texttt{Check\_Fingerprint} es una operación predefinida. 

\item \emph{Rule-based fingerprinting}:
las reglas de \emph{fingerprinting} son aplicadas cuando la operación
\texttt{Check\_Fingerprint} es ejecutada. Una regla de \emph{fingerprinting}
busca una expresión regular (\emph{regular expression}) en un encabezado o
atributo \ac{sip} específico, o en el mensaje \ac{sip} completo. Por ejemplo la siguiente
regla localiza la cadena de caracteres \\
\texttt{friendly-scanner} en el encabeza
de agente de usuario del el mensaje \ac{sip} en cuestión:

\begin{verbatim}
[rule_2]
type = Fingerprinting
context = INVITE
re = ’friendly-scanner’
where = SipMessage.UserAgent action is executed at the end.
action = return "SIPVicious"
\end{verbatim}

\item Correlación basada en reglas (\emph{rule-based correlation}):
las reglas de correlación son aplicadas cuando varios mensajes \ac{sip} son
considerados para inferir una conclusión. Se definen diversos tipos de reglas
de correlación. Estos tipos son particularmente necesarios para detectar series
de eventos como inundaciones (\emph{flooding}), escaneo (\emph{scanning}) y
\ac{spit}.

Este tipo de reglas soporta atributos de temporizador y umbrales (\emph{timer
and threshold attributes}). Como referencia, la siguiente regla es usada para
verificar si un ACK es recibido luego de un INVITE en una ventana de tiempo de
5 segundos. 

\begin{verbatim}
[rule_3]                         
type = Correlation.EventInWindow
context = INVITE
scope = DIALOG
timer = 5
condition = context == ACK       
action-if-false = add \          
"no ACK is received" CONCLUSIONS
\end{verbatim}


El atributo \texttt{scope} define a cual mensaje \ac{sip} esta regla puede ser
aplicada. \texttt{scope = DIALOG} significa que la regla solo podrá ser
aplicada al mensaje que posea el mismo call-ID que el INVITE que lo antecede.
El atributo \texttt{action-if-false} significa que la acción será ejecutada en
caso de que la ventana de tiempo haya expirado y la condición antes mencionada
todavía sea falsa (en contraste con el atributo \texttt{action}). 

\begin{figure}[h!] 
\centering
\includegraphics[width=.6 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig2f.jpg}
\caption{Integración en tiempo real de los resultados del \emph{honeypot}. \cite{docarmof}}
\label{diagrama_integracion_honeypot}
\end{figure}

\item Defensa o blindaje contra inundaciones (\emph{flooding armor}):
este componente protege al \emph{honeypot} de ser inundado (\emph{flooded}) por
solicitudes \ac{sip} (\emph{\ac{sip} requests}). Esto se lleva a cabo asegurándose de que
el \emph{honeypot} procese un número limitado de solicitudes en un período de tiempo
determinado. Las reglas de correlación son utilizadas. Por ejemplo, la
siguiente regla detecta si 3 mensajes INVITE son recibidos desde la misma \ac{ip} de
origen en un ventana de tiempo de un segundo. La acción requerido es ejecutada
al final.  

\begin{verbatim}
[rule_4]
type = Correlation.ThresholdInWindow
context = INVITE
scope = IPSrc
timer = 1
threshold = 3
action = system "bash ./on_flood.sh %IPSrc"
\end{verbatim}

\item Scripts de respuesta (\emph{response scripts}):
los scripts de respuesta (\emph{response scripts}) son ejecutados por el
\emph{honeypot} con el fin de reaccionar a un ataque detectado a través del bloqueo o
mitigación del mismo. Podemos visualizar esto en la Figura~\ref{diagrama_integracion_honeypot}, 
la cual muestra un intento de enumeración que es bloqueado en tiempo real luego de ser detectado por
Artemisa. Los scripts de respuesta son llamados dentro de las definiciones de
las reglas mediante el empleo de la palabra clave
(\emph{keyword}) \texttt{system} y pasando los argumentos necesarios de la
fuente del ataque (ej., \ac{ip} de origen, \ac{sip} \emph{From} \ac{uri}). La reacción puede ser
efectuada en diferente niveles: \emph{firewall} \ac{ip}, \emph{firewall \ac{sip}-aware}, plan de
llamado (\emph{\mbox{dial} \mbox{plan}}), entre otros. El administrador definirá los scripts
apropiados con respecto a las configuraciones del dominio. 

\item Resultados, alertas, y notificaciones via e-mail. Existen dos tipos de alerta: 

• Un alerta de mensaje: Contiene todas las conclusiones que son inferidas acerda
de un mensaje \ac{sip}.

• Un alerta compuesta: Contiene información acerca de una lista de mensajes \ac{sip}
correlacionados. 

\begin{figure}[h!] 
\centering
\includegraphics[width=.85 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig2g.jpg}
\caption{Ejemplo de un mensaje de alerta. \cite{docarmof}}
\label{ej_mje_alerta}
\end{figure}

Las alertas son provistas a la interfaz de linea de comandos y registradas 
(\emph{logged}) en formato de texto y HTML. Artemisa peude ser
configurado para enviar alertas al ad\-mi\-nis\-tra\-dor via e-mail. Un ejemplo de
mensaje de alerta se muestra en la Figura~\ref{ej_mje_alerta}.

El código fuente del \emph{honeypot} es distribuido bajo la licencia GPLv310. El
último release del proyecto se encuentra disponible en su \emph{home page}:
http://artemisa.sourceforge.net/.               

\end{itemize}                   

\newpage
                                                                 
\subsection{Experimentación y casos de estudio}   
\label{exp_casos_estudio_arte}
                     
El investigador y desarrollador de Artemisa \cite{docarmof} llevó a cabo un caso de estudio en el cual nos basaremos
para desarrollar esta sección. Se ha probado la performance en términos de robustez y precisión de la
herramienta Artemisa. El fin de la prueba de robustez es asegurar que el
\emph{honeypot} no se quiebre (\emph{crash}) fácilmente cuando es alcanzado por ataques
o cuando es inundado de forma anormal. El fin de la prueba de precisión es
verificar que efectúa una interpretación acertada de los mensajes \ac{sip}
recibidos. 

A continuación, se comenzará mostrando la interpretación fuera de linea
(\emph{offline}) de un mensaje \ac{sip} detectado por un sensor desarrollado. Luego
de eso, se presenta un \emph{testbed} de referencia y se resumen los resultados de 4
escenarios que involucran varias herramientas de ataque. Por su parte, se expone
cómo las respuestas pueden ser disparados en niveles de protección paralelos. 

\begin{figure}[h!] 
\centering
\includegraphics[width=.8 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig2h.jpg}
\caption{Mensaje INVITE de una traza de ataque. \cite{docarmof}}
\label{mje_invite_ataque}
\end{figure}
                        
\begin{itemize}
  
\item Interpretación de un mensaje \ac{sip}: 
se supone el mensaje INVITE detallado en la Figura~\ref{mje_invite_ataque} recibido
por el \emph{honeypot} Artemisa e interpretado por el árbol de decisión
clasificatoria. Del cual se obtienen las siguientes observaciones:       
  
• Falta el encabezado de Agente de Usuario (\emph{user-agent header}): no se
puede estimar que herramienta fue usada.

• La verificaciónde \ac{dns} (\emph{check \ac{dns}}) devuelve negativo. La \ac{ip} en el \ac{sdp}
(1.1.1.1) presenta que el mensaje es falsificado (\emph{spoofed}).

• Verifica si el \emph{host} esta arriba y si \ac{sip}, \emph{media}, o ambos puertos están
abiertos: el \emph{host} y los puertos ciertamente no están disponibles.

• Verificar el ACK y los datos (\emph{media}) recibidos: no se notificó la entrega de
\emph{media} o ACK. En este nivel, el mensaje recibido es reportado como \emph{spoofed}: del
lado del atacante se puede decir que no hay involucrada una máquina de estado
real \ac{sip}. La \ac{ip} utilizada esta falsificada o pertenece a una máquina
comprometida.

Para disponer de un panorama general, el otro mensaje reportado debe ser
considerado y correlacionado. Si todos los mensajes apuntan a la misma
extensión, el correlacionador reporta un \emph{flooding}. Si varias extensiones son
alcanzadas en un período de tiempo corto, existen tres posibles conclusiones:

\begin{enumerate}
   
\item          
El objetivo del atacante puede ser generar un disturbio máximo al hacer sonar
todos los teléfonos del dominio. Esto es probable si el ataque persiste en el
tiempo.

\item
El objetivo del atacante es enumerar todas las extensiones posibles en el
dominio. Esto es de esperar si una gran cantidad de extensiones son alcanzadas
(parte de usuario del \ac{uri}). Sin embargo, uno podría preguntarse, porque el
atacante no utiliza el escaneo OPTIONS, el cual es más sigiloso. Al mismo
tiempo, no se puede asumir el comportamiento lógico del atacante. 

\item 
La meta es identificar los \emph{gateways} \ac{sip}/\ac{pstn}. Esto será cierto si algunos pocos
mensajes tienen como objetivo varios \emph{gateways} (parte de dominio de la solicitud
\ac{uri} - \emph{request \ac{uri}}).

\end{enumerate}

\item \emph{Testing} contra herramientas de ataque:
físicamente nuestro \emph{testbed} está compuesto por dos máquinas: la primer máquina
contiene al \emph{honeypot} y un servidor \ac{pbx} Asterisk \footnote{Asterisk es un
framework de código abierto (\emph{Open Source}) para el armado de aplicaciones
de comunicaciones. Asterisk convierte un computadora ordinaria en un servidor
de comunicaciones. Asterisk impulsa sistemas \ac{pbx} \ac{ip}, \emph{gateways} \ac{voip}, servidores
de conferencia y otras soluciones personalizadas o a medida. Es implementado en
pequeños y grandes negocios, call centers, \emph{carriers}
(operadores) y agencias de gobierno, alrededor del mundo. Asterisk es gratuito
y \emph{Open Source}. Asterisk está esponsoreado por Digium. \cite{digium}}.

La segunda máquina contiene dos máquinas virtuales vinculadas en modo puente o
\emph{bridge} una representando las herramientas de ataque y una disponiendo de
un \emph{softphone} para e\-mu\-lar un
llamante externo legal. Se utiliza un \emph{hardphone} para representar un usuario
del servidor Asterisk que debe ser protegido. El teléfono \ac{sip}
(\emph{hardphone}) registra la extensión 305 en el servidor Asterisk. El
\emph{honeypot} registra las extensiones 300-304 y 306-310 con el fin de
proteger la extensión atacada por ambos lados. Otra opción es configurar
Asterisk para reenviar todas las llamadas a extensiones no registradas hacia el
\emph{honeypot}.

Debajo se desarrollan cuatro casos de estudio y se muestra como Artemisa
puede reaccionar y ayudar a soportar la seguridad de la cama de prueba. 

\begin{enumerate}

\item Detectar e interrumpir a SIPVicious: 
en este escenario, disparamos la herramienta SIPVicious en contra de nuestro
dominio. Esta tiene tres scripts principales: 
\begin{itemize}
\item{SVMAP que identifica \emph{hosts} con puertos \ac{sip} abiertos}
\item{SVWAR que identifica extensiones válidas en el dominio}
\item{SVCRACK que quiebra claves de autenticación débiles
(\emph{weak authentication passwords}) mediante la utilización de ataques de diccionario.}
\end{itemize}
  
Así también, SVCRACK es un script
provisto en la \emph{suite} SIPVicious que puede quebrar (inhibir) la herramienta
atacante. Se hace uso de este script del lado del \emph{honeypot} cuando se detecta la
herramienta SIPVicious. Este puede mostrarse en la siguiente regla:  

\begin{verbatim}
[rule_sip_vicious]
type = classification
context = INVITE
pre-action = assign %a Check_Fingerprint()
condition= %a == "SIPVicious"                                     
action = system ’python /sipvicious/svcrash.py \
-d SipMsg.Contact.Ip \                                         
-p SipMsg.Contact.Port’
\end{verbatim}

\begin{figure}[h!] 
\centering
\includegraphics[width=.7 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig2i.jpg}
\caption{La cama de prueba (\emph{testbed}). \cite{docarmof}}
\label{cama_de_prueba}
\end{figure}

%\clearpage

\item Atrapar y bloquear \ac{spit} a nivel de \emph{dial plan}:
en este escenario, como se muestra en la Figura~\ref{cama_de_prueba}, se lanza la herramienta de \ac{spit}
o \emph{Spitter tool} contra nuestro dominio. Cuando el 
\emph{honeypot} detecta el arribo de las llamadas de \ac{spit}, agrega
la fuente de estas \emph{calls} a un lista negra (\emph{backlist}) en la \ac{astdb}.
La extensión del \emph{hardphone} es
protegida por un script \ac{agi} dentro de el
plan de discado (\emph{dial plan}) de Asterisk. En otras pa\-la\-bras, cada vez que esta
extensión sea llamada, el script \ac{agi} es ejecutado primero. El script \ac{agi}
verifica si la fuente de la llamada se encuentra en la \emph{blacklisted} 
antes de reenviar la llamada al destino. De esta forma,
las llamadas de \ac{spit} son bloqueadas, mientras que las llamadas ``buenas'' se
continúan encaminando. La lista negra esta basada en la dirección \ac{ip} de una
fuente externa y el identificador \ac{sip} \ac{uri} para una fuente interna
registrada. 
         
\item Atrapar y bloquear un escaneo a nivel \ac{ip}:
en este escenario, se dispara un intento de escaneo en contra de nuestro
dominio. Cuando el \emph{honeypot} clasifica los mensajes recibidos como escaneo, el
mismo agrega una regla al \emph{firewall} al nivel de \emph{firewall} \ac{ip}
(\emph{IPTables})\footnote{IPTables es el programa de linea de comandos de
espacio de usuario usado para configurar el conjunto de reglas de filtrado de
paquetes (\emph{packet filtering ruleset}) de Linux 2.4.x y posteriores. Está
apuntado a administradores de sistemas. Considerando que el \ac{nat} también
es configurado desde el conjunto de reglas de
filtrado de paquetes, IPTables también se usa para esto. El paquete de IPTables
también incluye ip6tables. ip6tables es usado para configurar el filtro
de paquetes de IPv6. Sus principales funcionalidades son: listado del
contenido del conjunto de reglas del filtrado de paquetes. Y
agregado/borrado/modificación de reglas en el paquete de filtrado del conjunto
de reglas. Por último, listado/puesta a cero los contadores de paquetes de
filtrado del \emph{ruleset} (conjunto de reglas). \cite{netfilterneira}} para bloquear el ataque en
una etapa temprana. 

                                                                 
\item \emph{Fingerprint} de un grupo de herramientas de ataque \ac{sip}: lanzamos una serie de
herramientas de hack \ac{sip} en contra del \emph{honeypot} con el fin de probar su
robustez. Particularmente, la robustez del análisis sintáctico es heredado del
\emph{stack} PJSIP. Al mismo tiempo mostramos la capacidad de \emph{fingerprinting}
del \emph{honeypot}. Las si\-gui\-en\-tes herramientas fueron utilizadas:\\

• PROTOS Test-Suit (c07-\ac{sip}): una ``Prueba de Tortura`` \ac{sip} que permite enviar
una mayor cantidad de mensajes mal formados.

• Sipscan: soporta escaneo REGISTER, OPTIONS e INVITE.

• SIPVicious: enumera los servidores \ac{sip} en un rango de IPs dado a través del
envío de mensajes OPTIONS o INVITE.

• Inviteflood: herramienta simple que permite varios tipos de ataques basados
en inundación.

• Sipp: posibilita probar la performance de los servidores \ac{sip} bajo condiciones
de stress.

• Sipsak: herramienta de prueba \ac{sip} de línea de comando, útil para tests de
inundación y robustez.

• Spitter: funciona sobre Asterisk y genera automáticamente llamadas con un
mensaje de audio a ser entregado.

• \ac{sip} Send Fun: soporta un variedad de mensajes INVITE confusos (modificados)
para \emph{testing} de rebustez. 

• SipBot: herramienta de ataque \ac{sip} controlada remotamente la cual soporta
varios comandos de ataque.

• VoIPER: set de herramientas de ataque, entre ellos \emph{fuzzing}
(envío de mensajes \ac{sip} malformados) y \emph{torturing} (para ataques de \emph{brute force}).\\

El software \emph{honeypot} presenta una buena performance en términos de robustez: no
se evidenció un \emph{crash} (colapso) incluso contra el \emph{fuzzing} y las
herramientas de i\-nun\-da\-ción. También ha demostrado buen rendimiento en términos
de la precisión en cuanto a la interpretación. Esta es la ventaja de la
aproximación basada en reglas (\emph{rule-based approach}) cuando tratamos con
ataques bien conocidos (\emph{well-known attacks}). Seremos capaces de
identificar y sacar las huellas de todas las herramientas de ataque
conocido como \emph{fingerprinting}. Los resultados son resumidos en la Tabla~\ref{resultados_pruebas}.
Las dos primeras columnas representan la expresión regular y los campos usados
en las reglas de \emph{fingerprinting} respectivamente. La 4ta columna indica
si existe una \ac{ip} real en el mensaje enviado por la herramienta o si todas las
IPs están falsificadas. La última columna indica en qué encabezado o campos las
IPs reales pueden ser encontradas.

\begin{table}
\caption{Resultado de las pruebas. \cite{docarmof}}
%\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig2k.jpg}
%\end{figure}
\label{resultados_pruebas}
\end{table}

\end{enumerate}

\end{itemize}


Para mayor información y un ejemplo de implementación con los parámetros
básicos de Artemisa \emph{honeypot} referirse a \cite{docarmom}.

\newpage

\section{Evaluación de respuestas empíricas y enfoque en
desarrollos funcionales del sistema de seguridad Artemisa a
partir de su implementación y experimentación en los entornos
propuestos}
\label{casos_1_2_3}

Se debe tener en cuenta que en los tres casos desarrollados en esta sección se
considera lo estudiado en las anteriores secciones \ref{intro_arte}, \ref{caracteristicas_arte}, 
\ref{modulos_arte} y \ref{exp_casos_estudio_arte}.

\subsection{Ataques, tipos de ataques de hackers y tipos de hackers}

\subsubsection{Ataques}
El recurso o activo de información que está siendo protegido de los ataques es
usualmente referido como el destino u objetivo de evaluación. Este puede ser
definido como un sistema, producto o componente de \ac{it}, que es identificado de
requerir una evaluación de seguridad. Un ataque es un asalto deliberado en este
sistema de seguridad. Los ataques pueden ser clasificados de forma general en
pasivos y activos.

\begin{itemize}
     \item Ataques activos: modifican el sistema de destino. Por
ejemplo \ac{dos} ataca los recursos del objetivo disponibles en la red. Los ataques
activos pueden afectar la disponibilidad, integridad, confidencialidad y
autenticidad del sistema. 

    \item Ataques pasivos: violan la confidencialidad de los datos
del sistema sin afectar el estado de tal sistema, tales como las escuchas
electrónicas ilegales (colectando información confidencial enviada de manera no
cifrada). La palabra clave aquí es la confidencialidad.
\end{itemize}

La diferencia entre estas categorías es que mientras un ataque activo intenta
alterar los recursos del sistema o afectar su operación, un ataque pasivo
intenta aprender o hacer uso de la información del sistema, pero no afecta los
recursos del mismo.\\

Los ataques también pueden categorizarse como ataques internos o
externos.

\begin{itemize}
  \item Ataque interno: es iniciado desde dentro de una red
por un usuario autorizado. Esto puede ser de alguien con intenciones maliciosas,
sin embargo sería apresurado darlo por asumido; un incidente involuntario también podría derivar en un
daño no intencional al recurso de red.
  \item Ataque externo: es causado por un intruso externo que no
posee autorización para acceder a la red.
\end{itemize}

\subsubsection{Tipos de ataques de hackers}

La seguridad es una preocupación crítica de cara a los brotes de intentos de
intrusión, \emph{\mbox{phising}}, hackeo, gusanos y virus.    

Hay varias maneras mediante la cual el atacante puede obtener acceso a una red
a través de la explotación de vulnerabilidades. Los ataques de hackers
pueden categorizarse como:

\begin{itemize}
\item Ataques de \ac{os}:
  \begin{itemize}
   \item Los \ac{os} de hoy en día contienen varias
características, haciéndolos cada vez más complejos. Estas características o
prestaciones utilizan servicios y procesos adicionales, lo que significa una
mayor cantidad de vulnerabilidades a ser explotadas por los hackers.
  \item Mantener nuestro sistema con los últimos parches y
actualizaciones (\emph{patches} \& \emph{\mbox{hotfixes}}) puede ser muy desafiante con
las complejas redes que se manejan actualmente. La mayoría de los parches y correcciones
tienden a resolver una falla o problema inmediato, pero no proveen soluciones
permanentes.
  \item Los atacantes están constantemente buscando vulnerabilidades de
\ac{os} para explotar. Los administradores de sistemas deben mantenerse informados 
de la gran variedad de nuevos \emph{exploits}, y monitorear sus redes continuamente. 
  \end{itemize}       

\item Ataques a nivel aplicación:
los desarrolladores de software generalmente se encuentran bajo una intensa
presión para alcanzar los plazos de entrega, y esto puede significar que ellos
no disponen de suficiente tiempo para probar completamente sus productos antes
de entregarlos, dejando agujeros de seguridad no descubiertos. Esto es
especialmente problemático en nuevas aplicaciones de software que vienen con
una multitud de características y funcionalidades, haciéndolas cada vez más
complejas de mantener. Como con los \ac{os}, mayor complejidad
significa más oportunidades para vulnerabilidades. 

La seguridad no siempre es una prioridad para los desarrolladores de software,
y es frecuentemente entregada como un componente agregado o algo complementario
luego de lanzada la \emph{app} (aplicativo de software). Esto significa que no todas las instancias del
software van a presentar el mismo nivel de seguridad. El chequeo de errores en
estas aplicaciones puede ser muy pobre o incluso inexistente, resultando en
ataques de saturación de \emph{buffer} (\emph{buffer overflow attacks}). 

\item Ataques de código \emph{shrink-wrap}:
los desarrolladores de software implementarán usualmente librerías gratuitas y
licencias de código de otras fuentes en sus programas. Esto significa que
grandes porciones de varias partes del software van a ser exactamente iguales,
y si se descubren vulnerabilidades en esas porciones de código, muchas partes
del software estarán en riesgo.  

El problema es que los \emph{developers} (desarrolladores de software) dejan las librerías y el
código sin cambios. Los \emph{developers} necesitan personalizar y afinar su
código de modo no solo de hacerlo más seguro, pero lo suficientemente diferente
para que el mismo código malicioso (\emph{exploit}) no funcione.

\item Ataques por malas configuraciones:
incluso sistemas que son diseñados con mucha seguridad pueden ser hackeados si
no son correctamente configurados. Los administradores de sistemas deben tener
cuidado al momento de configurar un sistemas, y siempre saber lo que se está
ejecutando. Es muy importante crear una configuración simple pero utilizable,
removiendo todas las configuraciones y software innecesario.
\end{itemize}

\subsubsection{\emph{Hacktivism} \& clases de hackers}

El hacktivismo (\emph{hacktivism}) es cuando un hacker quiebra y gana acceso a
sistema de computadoras gubernamentales o corporativas en un acto de
protesta. Los hactivistas (\emph{hacktivists}) utilizan el \emph{hacking} para acentuar
su preocupación en relación a la agenda política y social, tanto en el plano
\emph{online} como \emph{offline}.
Objetivos comunes de los hacktivistas incluyen agencias de gobierno,
corporaciones multinacionales, o cualquier otra entidad que perciban como una
amenaza. Sin embargo, es un hecho, que ganar acceso no autorizado sigue siendo
un crimen sin importar las razones o intenciones para tal acción.\\

    
\textbf{Clases de hackers}\\
Los hackers usualmente caen dentro de las siguientes categorías basados en sus
actividades:

\begin{itemize}
\item \emph{Black hats} (sombrero negro): usan sus habilidades
para fines ilegales y maliciosos. Esta categoría de hacker está generalmente
involucrada en actividades criminales y es buscado por agencias de orden
público.

\item \emph{White hats} (sombrero blanco): usan
sus habilidades de \emph{hacking} para fines defensivos. Dentro de los \emph{white
hat} hackers se incluyen analistas de seguridad que tienen conocimiento acerca
de contra ataques o tácticas defensivas de hackeo.

\item \emph{Gray hats} (sombrero gris): creen en la divulgación
o revelación total. Ellos creen que la información es mejor mantenerla
abierta que mantenerla en secreto y la persona promedio hará buen uso de
esa información en lugar de abusar de la misma. 

\item \emph{Suicide hackers} (hackers suicidas): son hacktivistas
que quieren convertirse en mártires para sus causas. Estos intentan sabotear
infraestructuras de gran escala y están totalmente dispuestos a afrontar
consecuencias por sus acciones.
\end{itemize}

\cite{eccouncil}

\subsection{Modelo de atacante: interno y externo}
\label{modelo_atacante}
Nos basamos en un modelo de atacante que posee la \emph{suite} de herramientas
\emph{BackTrack 5 R2} con conocimientos avanzados sobre Ethernet, \ac{tcp}/\ac{ip}, \ac{voip}; 
sin realizar modificación del código fuente de las herramientas disponibles,
pero con utilización de todas sus variantes. El atacante tendrá como objetivo
en la mayoría de los casos, un usuario final \ac{ua}, 
llevando adelante intentos de detección de dispositivos y enumeración de
extensiones, \ac{dos}, suplantación de  identidad y derivados de los
anteriores. Resultando en un perfil tanto de hacker activo como
pasivo. Valiéndose principalmente de ataques por malas
configuraciones del entorno. El tipo de hacker podría considerarse un
\emph{black hat} hacker intentando sabotear o inmiscuirse ilegalmente
en una infraestructura \ac{sip} privada.\\
Plantearemos este mismo atacante en tres escenarios de configuración de red 
distintos. 

\subsubsection{Atacante interno}
%\begin{center}
%\textbf{\large{\color[rgb]{1,0,0}{A DESARROLLAR}}} 
%\end{center} 
En el primer caso (caso 1) el atacante se encuentra dentro de la red \ac{lan} con
medio compartido (capa 2 compartida, \emph{hub}, WiFi). En el caso 2 la capa de enlace
ya no es un medio compartido, forma parte de una red \ac{lan} con concentradores
\emph{switch} sin uso de 802.1q (VLAN) para diferenciar el tipo de tráfico. Solo fue
utilizado para segmentar los escenarios en cama de prueba dentro del laboratorio. 

\subsubsection{Atacante externo}
%\begin{center}
%\textbf{\large{\color[rgb]{1,0,0}{A DESARROLLAR}}} 
%\end{center}
Finalmente, el caso 3, es un escenario más cotidiano, el atacante se encuentra 
detrás de los \emph{routers} de frontera de la red, es un agente más de Internet. \\\\

En todo momento se utilizó tráfico \ac{sip} sin cifrar.
Se presupone que el atacante no posee información de la topología lógica de la 
red ni numeración telefónica y llevará adelante tareas de escaneo y
enumeración.

\subsection{Caso 1: dominio de colisión y \emph{broadcast} compartidos}
\label{caso1}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig3.jpg}
\caption{Diagrama topología \emph{testbed} \emph{testing} \ac{ubp}, caso 1.}
\label{caso1_topología}
\end{figure}

\begin{table}[h!]
\caption{Características y especificaciones topología \emph{testbed} \emph{testing} \ac{ubp}, caso 1.}
%\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab4.jpg}
%\end{figure}
\label{caso1_topología_tabla}
\end{table}


\newpage

En este primer caso (caso 1) según puede verse en la Figura~\ref{caso1_topología} 
el atacante se encuentra dentro de la red \ac{lan}, la 
misma cuenta con una capa física con medio compartido. Se utilizó concentrador
de red de tipo \emph{hub} con el fin de poder capturar el tráfico de red con más
facilidad. Otro motivo muy importante para el uso de un medio compartido, es la
realidad de este escenario en la actualidad con el uso de tecnología 802.11
(WiFi), ya que existe una amplia utilización de \emph{softphones} \ac{voip} corriendo sobre
dispositivos móviles (\emph{notebooks}, \emph{smartphones}, etc.), expuestos a las
vulnerabilidades que mostraremos a continuación, para mayor detalle del entorno referirse 
a la Tabla~\ref{caso1_topología_tabla}. De forma complementaria puede consultarse en el Anexo D
las configuraciones de los componentes y agentes \ac{sip} para el caso 1.

En este primer caso además de mostrar la respuesta empírica de Artemisa frente a
 las he\-rra\-mien\-tas, nos explayaremos en mostrar el modo de trabajo de las mismas
para aportar entendimiento respecto de lo que enfrenta el \emph{honeypot}.

Antes de comenzar con las herramientas de seguridad, en la
Figura~\ref{call_fono_to_twincle} 
se muestra el diagrama temporal de una llamada regular desde un teléfono \ac{ip} a un
\emph{\mbox{softphone}}, para esta implementación se usó el \emph{softphone} \emph{Open Source} Twinkle.

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/llamada_fono_a_twincle.jpg}
\caption{Llamada regular entre dos agentes \ac{sip} finales.}
\label{call_fono_to_twincle}
\end{figure}

La Figura~\ref{call_twincle_to_Artemisa} corresponde al diagrama temporal de un 
intento de llamada desde el \emph{softphone} a una extensión logueada por Artemisa. 

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Llamada_twincle_a_Artemisa.jpg}
\caption{Llamada regular entre un \emph{softphone} y Artemisa \emph{honeypot}.}
\label{call_twincle_to_Artemisa}
\end{figure}

La intención de estos diagramas previos es refrescar los mensajes utilizados en
 una sesión \ac{voip}-\ac{sip} normal, a fin de poder ser contrastados con los enviados
por las herramientas de seguridad.
\newpage

\subsubsection{Information gathering (recopilación de información)}
\label{scanning}

Esta fase cuenta de dos etapas, escaneo y enumeración:

\paragraph{\emph{Scanning} (escaneo)\\}
 
En esta etapa se busca recopilar información sobre la topología, servidores y
clientes. Existe el interés en encontrar \emph{live hosts} (\emph{hosts} activos); tipos y
versiones de PBXs, servidores/pasarelas (\emph{servers/gateways}) y clientes
(\emph{hardphones} y \emph{softphones}). Por lo tanto en esta etapa se destinan los ataques a
la dirección \ac{ip} de cada \emph{host}, en nuestro caso la dirección \ac{ip} de Artemisa
(10.10.0.250 utilizada en este escenario).

A continuación se realizará un desarrollo de las herramientas 
utilizadas: SMAP, \ac{sip}-SCAN, SVMAP, \emph{METASPLOIT}.\\

SMAP\footnote{SMAP:
http://www.backtrack-linux.org/wiki/index.php/Pentesting\_VOIP\#SMAP}: 
herramienta que combina las funcionalidades de Nmap y SIPSAK. La misma tiene por
objetivo detectar elementos de red con protocolo \ac{sip} habilitado. Para tal fin
envía distintos mensajes de métodos de solicitud  \ac{sip} (\emph{\ac{sip} request method)} a una
dirección \ac{ip} puntual, o a un rango de ellas, a la espera de mensajes
\ac{sip}-\emph{response}. Cuenta también con la opción heredada de Nmap para identificación
de tipo de agente (\emph{user-agent fingerprinting}).

Primero realizamos un escaneo a la red completa en busca de dispositivos con 
protocolo \ac{sip} habilitado (sobre puerto \ac{udp} 5060 por defecto). SMAP indicará qué
dispositivos han sido alcanzados a nivel de red (\ac{icmp}) y cuales de ellos cuentan
con protocolo \ac{sip} habilitado. En caso de mostrar \emph{host} activos a nivel de red
pero sin \ac{sip} habilitado puede repetirse el escaneo indagando en otros puertos y
sobre el protocolo \ac{tcp}.

\begin{myscriptlisting}
 \begin{verbatim}
root@bt# ./smap 10.10.0.0/24
smap 0.6.0 <hs@123.org> http://www.wormulon.net/
10.10.0.240: ICMP reachable, SIP enabled
10.10.0.250: ICMP reachable, SIP enabled
10.10.0.1: ICMP unreachable, SIP disabled
10.10.0.2: ICMP unreachable, SIP disabled
10.10.0.3: ICMP unreachable, SIP disabled
….
10.10.0.99: ICMP unreachable, SIP disabled
10.10.0.100: ICMP reachable, SIP disabled
10.10.0.253: ICMP unreachable, SIP disabled
10.10.0.254: ICMP unreachable, SIP disabled
10.10.0.255: ICMP unreachable, SIP disabled
256 hosts scanned, 3 ICMP reachable, 2 SIP enabled (0.8%)
 \end{verbatim}
\end{myscriptlisting}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/smap_10-10-0-0.jpg}
\caption{Mensajes \ac{sip} enviados a aquellas interfaces que han respondido al mensaje \ac{icmp}.}
\label{sip_icmp}
\end{figure}
Se puede apreciar en la Figura~\ref{sip_icmp}, como SMAP envía mensajes OPTIONS a los \emph{host} que 
han respondido previamente a un paquete PING-\ac{icmp} (no presente en la Figura~\ref{sip_icmp}).
Aquellos \emph{hosts} que escuchan mensajes \ac{sip} (en puerto \ac{udp} 5060) responden al
método OPTIONS con una descripción de sus capacidades de sesión (\ac{sip} \emph{session
description}), indicando de este modo a SMAP que son \emph{hosts} atractivos para
continuar con un escaneo puntual. En el caso de la dirección \ac{ip} 10.10.0.100, la
cual no tiene \ac{sip} activo, SMAP indaga sobre ésta enviando otros tipos de
mensajes \ac{sip} (INVITE, PRACK, etc.) a la espera de un \ac{sip}-RESPONSE.
Artemisa, para esta configuración de la herramienta, sólo muestra el arribo un
un mensaje OPTIONS, ya que por sí sólo no aparenta ser un ataque. Si lo sería, si
llegan varios mensajes OPTIONS consecutivos, lo cual veremos más adelante con
otras herramientas.\\
Salida de Artemisa por consola:

\begin{myscriptlisting}
 \begin{verbatim}
2012-07-11 17:29:48,877 OPTIONS message detected in extension smap from 201.252.57.89:12345	
 \end{verbatim}
\end{myscriptlisting}

Para aquellos \emph{host} que indicaron tener \ac{sip}-\emph{enabled} continuaremos enviándoles un
ataque puntual. En este caso apuntamos el ataque a la dirección \ac{ip} de Artemisa y
agregamos el modificador “-o” para obtener más información acerca del objetivo.

\begin{myscriptlisting}
 \begin{verbatim}
root@bt# ./smap -o 10.10.0.250
smap 0.6.0 <hs@123.org> http://www.wormulon.net/
10.10.0.250: ICMP reachable, SIP enabled
FP match: options
FP match: accept_class
FP match: accept_class
….
FP match: accept_class
FP match: options
….
FP match: accept_class
FP match: options
FP match: options
       Guess: LANCOM 1[78]xx Series (VPN/VoIP/Wireless) / 6.xx.xxxx
  User-Agent: D-Twinkle/1.4.2
1 host scanned, 1 ICMP reachable, 1 SIP enabled (100.0%)
1 host scanned, 1 ICMP reachable, 1 SIP enabled (100.0%)

 \end{verbatim}
\end{myscriptlisting}

El \emph{user-agent} que detecta SMAP (D-Twinkle/1.4.2) es, justamente, el 
configurado para ser mostrado por Artemisa.
En la Figura~\ref{ataque_dir_ip} se aprecian los distintos mensajes utilizados para obtener un 
\emph{fingerprint} del dispositivo apuntado.

\begin{figure}[h!] 
\centering
\includegraphics[width=.85 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/smap-250.jpg}
\caption{Mensajes \ac{sip} enviados cuando el ataque apunta a una dirección \ac{ip} puntual.}
\label{ataque_dir_ip}
\end{figure}

Ante la presencia de mensajes consecutivos y fundamentalmente por el mensaje 
INVITE, Artemisa lanza el algoritmo de detección de ataques. 
A continuación se puede observar un resumen del informe creado, el cual es 
enviado al administrador de la red y guardado como archivo de texto.

\begin{myscriptlisting}
 \begin{verbatim}
2012-07-11 18:02:37,658 Extension "phone_9" <sip:phone_9@10.10.0.240:5060> registered, status=200
(OK)
2012-07-11 18:02:43,186 OPTIONS message detected in extension smap from 201.252.57.89:12345
2012-07-11 18:02:44,157 OPTIONS message detected in extension  from 201.252.57.89:12345
2012-07-11 18:02:47,172 INVITE message detected.
….
2012-07-11 18:02:47,175 Call from <sip:smap@localhost> is EARLY, last code = 180 (Ringing)
2012-07-11 18:02:47,176 Call from <sip:smap@localhost> is CONNECTING, last code = 200 (OK)
….
2012-07-11 18:02:49,174 Incoming call from <sip:smap@localhost>
****************** Information about the call *********************
2012-07-11 18:02:52,179 
2012-07-11 18:02:52,179 From: smap in localhost:12345/udp
2012-07-11 18:02:52,179 To: smap in localhost
2012-07-11 18:02:52,179 Contact: smap in 201.252.57.89:12345/udp
2012-07-11 18:02:52,180 Connection: 
2012-07-11 18:02:52,180 Owner: 
2012-07-11 18:02:52,180 Via 0: 201.252.57.89:12345/udp
2012-07-11 18:02:52,180 User-Agent: smap 0.6.0
2012-07-11 18:02:52,180 
******************* Classification ****************** 
….
2012-07-11 18:02:52,705 + The message is classified as:
2012-07-11 18:02:52,705 | Interactive attack
2012-07-11 18:02:52,706 | Spoofed message
2012-07-11 18:02:52,706 | Dial plan fault
2012-07-11 18:02:52,706 | Scanning
2012-07-11 18:02:52,706 | Ringing
2012-07-11 18:02:52,706 
******************* Correlation *******************
2012-07-11 18:02:52,706 
2012-07-11 18:02:52,706 Artemisa concludes that the arrived message is likely to be:
2012-07-11 18:02:52,707 
2012-07-11 18:02:52,708 * A scanning attempt.
….
2012-07-11 18:02:52,711 This report has been saved on file ./results/2012-07-11_5.txt
2012-07-11 18:02:52,711 NOTICE This report has been saved on file ./results/2012-07-11_5.html
2012-07-11 18:02:52,711 Sending this report by e-mail…

 \end{verbatim}
\end{myscriptlisting}

 Una copia completa del informe generado para este ataque se encuentra en
 Anexo E.
Para un estudio del comportamiento de Artemisa como el que proponemos en esta 
sección, debemos prestar atención al item \emph{correlation} donde se
encuentra plasmada la conclusión a la que arribó el software.
En este caso, indica correctamente que se trata de un intento de escaneo.\\

\ac{sip}-SCAN\footnote{\ac{sip}-SCAN:
http://skora.net/voice-over-ip-security}: una herramienta simple para detectar \emph{hosts} con \ac{sip}
habilitado mediante el envío de mensajes OPTIONS \emph{request}. No debe confundirse con
\emph{sipscan} \footnote{sipscan: herramienta de escaneo desarrollada por los autores de \emph{Hacking \ac{voip}
exposed} (www.hackingvoip.com)}

Los resultados obtenidos con esta herramienta no fueron útiles desde el punto de
 vista del atacante, solamente detectó la presencia de Artemisa, y esto debido a
los intentos del \emph{honeypot} por recabar más datos del origen del mensaje recibido.
Así mismo, no se logra concluir que es un ataque por la falta de mensajes
consecutivos o la ejecución de otro tipo de método por parte de la herramienta
atacante. 

\begin{myscriptlisting}
 \begin{verbatim}
root@bt# ./sipscan -v -i eth0 10.10.0.1-254
Using interface eth0
Using own IP 10.10.0.50
Scan 10.10.0.1
….
Scan 10.10.0.39
Scan 10.10.0.40
Scan 10.10.0.41
….
Scan 10.10.0.239
Scan 10.10.0.240
….
Scan 10.10.0.249
Scan 10.10.0.250
10.10.0.250: D-Twinkle/1.4.2
….
Scan 10.10.0.254
Done...waiting for remaining answers!

 \end{verbatim}
\end{myscriptlisting}

En el diagrama de flujo de la Figura~\ref{escaneo_sipscan} de la comunicación \ac{sip} se observa que el único 
dispositivo \ac{sip} que responde con un mensaje distinto a  \emph{404 Not Found} es
Artemisa.

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/sip-scan_attack.jpg}
\caption{Escaneo a toda la red con la herramienta \ac{sip}-SCAN.}
\label{escaneo_sipscan}
\end{figure}


SVMAP\footnote{SVMAP: http://code.google.com/p/sipvicious/wiki/SvmapUsage}: es parte de la \emph{suite} de herramientas SIPVicious
y permite escanear
 direcciones \ac{ip} puntuales o un grupo de ellas, detectar el tipo de agente y
seleccionar el método enviado (OPTIONS por defecto, REGISTER,
INVITE).

La respuesta de esta herramienta es muy efectiva y precisa, enviando un mensaje
OPTIONS únicamente, motivo por el cual Artemisa no pudo detectarla como puede deducirse
del diagrama de flujo que corresponde a la Figura~\ref{escaneo_svmap}.

\begin{myscriptlisting}
 \begin{verbatim}
root@bt#./svmap -v 10.10.0.1-254 --fp

| SIP Device       | User Agent                      | Fingerprint                                  
        |
---------------------------------------------------------------------------------
| 10.10.0.40:5060  | Twinkle/1.4.2   | T-Com Speedport W500V / Firmware v1.37 MxSF/v3.2.6.26 |
| 10.10.0.250:5060 | D-Twinkle/1.4.2 | T-Com Speedport W500V / Firmware v1.37 MxSF/v3.2.6.26 |
| 10.10.0.240:5060 | Asterisk PBX 1.6.2.9-2+squeeze6 |SJphone/1.60.289a (SJ Labs)            |
 \end{verbatim}
\end{myscriptlisting}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/SVMAPattack.jpg}
\caption{Escaneo a toda la red con SVMAP.}
\label{escaneo_svmap}
\end{figure}

METASPLOIT: “Metasploit es un proyecto \emph{Open Source} de seguridad informática que proporciona
 información  acerca de vulnerabilidades de seguridad y ayuda en tests de
penetración y en el desarrollo de firmas para sistemas de detección de intrusos.
Su subproyecto más conocido es el Metasploit Framework, una herramienta para
desarrollar y ejecutar \emph{exploits} contra una máquina
remota.” \cite{metasploit}


De esta \emph{suite} de seguridad se utilizaron tres módulos explicados en cada categoría.
Para esta etapa del ataque se usó el módulo auxiliar para escaneo de
agentes con \ac{sip} habilitado, el cual utiliza \ac{tcp} ó \ac{udp} como protocolo de
transporte y permite descubrir dispositivos con \ac{sip} habilitado utilizando el
método OPTIONS, lo que se refleja en la Figura~\ref{escaneo_metaexploit}.

\begin{myscriptlisting}
 \begin{verbatim}
msf > use auxiliary/scanner/sip/options
msf  auxiliary(options) > set RHOSTS 10.10.0.0/24 
RHOSTS => 10.10.0.0/24
msf  auxiliary(options) > run

[*] 10.10.0.50 sip:nobody@10.10.0.0 agent='CgHua4' 
[*] 10.10.0.240 404 server='Asterisk PBX 1.6.2.9-2+squeeze6' verbs='INVITE, ACK, CANCEL, OPTIONS,
BYE, REFER, SUBSCRIBE, NOTIFY, INFO' 
[*] 10.10.0.240 404 server='Asterisk PBX 1.6.2.9-2+squeeze6' verbs='INVITE, ACK, CANCEL, OPTIONS,
BYE, REFER, SUBSCRIBE, NOTIFY, INFO' 
[*] 10.10.0.50 sip:nobody@10.10.0.50 agent='EPjc8TUn' 
[*] 10.10.0.240 404 server='Asterisk PBX 1.6.2.9-2+squeeze6' verbs='INVITE, ACK, CANCEL, OPTIONS,
BYE, REFER, SUBSCRIBE, NOTIFY, INFO' 
[*] 10.10.0.250 200 agent='D-Twinkle/1.4.2' verbs='PRACK, INVITE, ACK, BYE, CANCEL, UPDATE,
SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS' 
[*] 10.10.0.50 sip:nobody@10.10.0.255 agent='6AsY' 
[*] 10.10.0.240 404 server='Asterisk PBX 1.6.2.9-2+squeeze6' verbs='INVITE, ACK, CANCEL, OPTIONS,
BYE, REFER, SUBSCRIBE, NOTIFY, INFO' 
[*] 10.10.0.240 404 server='Asterisk PBX 1.6.2.9-2+squeeze6' verbs='INVITE, ACK, CANCEL, OPTIONS,
BYE, REFER, SUBSCRIBE, NOTIFY, INFO' 
[*] Scanned 256 of 256 hosts (100% complete)
[*] Auxiliary module execution completed

 \end{verbatim}
\end{myscriptlisting}

Del mismo modo que la herramienta anterior, METASPLOIT con el envío de mensajes
OPTIONS únicamente, logró obtener la información deseada para la etapa de
escaneo. 

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Metaexploit_scanning-attack.jpg}
\caption{Escaneo a toda la red con módulo de escaneo de METAEXPLOIT.}
\label{escaneo_metaexploit}
\end{figure}

Artemisa detecta este mensaje pero no dispara el algoritmo de detección por no 
tratarse de más de tres mensajes consecutivos.

\begin{myscriptlisting}
 \begin{verbatim}
2012-07-12 20:32:57,202 OPTIONS message detected in extension nobody from 10.10.0.50:5060
 \end{verbatim}
\end{myscriptlisting}

\subsubsection{\emph{Enumerating} (enumeración)}

Consiste en descubrir extensiones \ac{sip} válidas para el entorno, lo que permite 
luego apuntar los ataques de \emph{brute force} (fuerza bruta) y demás sobre
tales cuentas. Trabaja analizando los mensajes de error ante las solicitudes de
métodos OPTIONS, INVITE y REGISTER enviadas apuntando a distintas extensiones
para determinar cuales son válidas en el entorno \ac{sip} en cuestión. 
Herramientas utilizadas para este tipo de ataque fueron: SVWAR y METASPLOIT. 

Para un resultado útil, desde el punto de vista del atacante, los mensajes deben
 ser enviados al servidor de registro Asterisk para este escenario de pruebas.
Así mismo, también pusimos a prueba al \emph{honeypot} como objetivo directo del ataque,
ya que puede configurarse a Artemisa que devuelva como su \emph{fingerprint}, el
de un Asterisk \ac{pbx} por ejemplo, y convertirse de este modo en objeto de una
enumeración.
 Debe tenerse en cuenta que un factor importante del éxito del ataque, es el 
diccionario o rango de extensiones utilizadas con la herramienta, en nuestro
diccionario agregamos intencionalmente, valores de extensiones utilizados en el entorno.\\

SVWAR\footnote{SVWAR:
http://code.google.com/p/SIPVicious/wiki/Svwarusage}: es una herramienta que permite enumerar extensiones probando con valores
dentro de un rango o tomados de un archivo de diccionario. Puede enviar mensajes de
métodos OPTIONS, INVITE y REGISTER. 


Con la dirección \ac{ip} de Asterisk como objetivo, se obtuvo la enumeración deseada
utilizando los métodos INVITE y REGISTER, no así con el método OPTIONS. Esto, 
ya que con los dos primeros, Asterisk devuelve un mensaje (\emph{401Unauthorized}) con los
parámetros necesarios para la autenticación cuando se trata de una extensión registrable en
este servidor ó de un nombre de usuario de extensión registrable en este
servidor. Si no se trata de extensión propia
de este servidor, Asterisk devuelve un mensaje \emph{100 Trying} y luego un
\emph{200 OK} indicando que trataŕa de cursar la llamada. 

\begin{myscriptlisting}
 \begin{verbatim}
  root@bt#./svwar -d dict 10.10.0.240 -m INVITE 
| Extension   | Authentication |
--------------------------------
| phone_4     | reqauth        |
| phone_5     | reqauth        |
| phone_2     | reqauth        |
| phone_3     | reqauth        |
| phone_0     | reqauth        |
| phone_1     | reqauth        |

 \end{verbatim}

\end{myscriptlisting}

\begin{figure}[h!]
 \centering
  \subfloat[Extensión NO perteneciente al dominio \ac{sip}.]{
   \label{svwar_bad_ext}
   
\includegraphics[width=0.5\textwidth]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/INVITE_sip2370167112.jpg}}
  \subfloat[Extensión o nombre de usuario de extensión válido para el 
servidor de registro.]{
   \label{svwar_well_ext}
   
\includegraphics[width=0.5\textwidth]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/INVITE_sip_phone_0.jpg}}
 \label{svwar}
 \caption{Mensajes intercambiados entre SVWAR y el servidor de registro 
para distintas extensiones.}
\end{figure}

En las Figuras~\ref{svwar_bad_ext} y \ref{svwar_well_ext} se pueden observar los
 mensajes explicados anteriormente, los cuales se repiten modificando el
\emph{status code} del campo \emph{status line}, seis reenvíos sin tener respuesta.
La diferencia en utilizar el ataque con método REGISTER o INVITE radica en el 
tratamiento que hará Asterisk con el mensaje. Para el primero solamente genera
un registro de error que veremos a continuación, cuando se intenta registrar una
extensión no perteneciente al dominio.
\begin{myscriptlisting}
 \begin{verbatim}
 [Jul 11 20:49:09] NOTICE[2825] chan_sip.c: Registration from ->
 '"2348559351"<sip:2348559351@10.10.0.240>' failed for '10.10.0.50' ->
 No matching peer found 
 \end{verbatim}
\end{myscriptlisting}
En cambio, si se trata de un mensaje INVITE, y de una extensión que se encuentra
 registrada, el \emph{proxy} \ac{sip} generará un nuevo mensaje INVITE con destino al
\ac{ua} propietario de la extensión en cuestión tal puede verificarse en
la Figura~\ref{SVWAR_INVITE_full_dialog}.
          
\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/INVITE_phone_1_full_dialog.jpg}
\caption{Dialogo completo provocado por el mensaje INVITE.}
\label{SVWAR_INVITE_full_dialog}
\end{figure}
Es en esta situación donde Artemisa, al recibir un mensaje INIVTE apuntado a una
 de sus extensiones logueadas, detecta el mensaje y comienza a recopilar
información.

\begin{myscriptlisting}
 \begin{verbatim}
2012-07-11 20:51:59,338 INVITE message detected.
2012-07-11 20:51:59,341 Incoming call from "1001" <sip:1001@10.10.0.240>
2012-07-11 20:51:59,342 Call from "1001" <sip:1001@10.10.0.240> is EARLY, last code = 180 (Ringing)
2012-07-11 20:51:59,345 Call from "1001" <sip:1001@10.10.0.240> is CONNECTING, last code = 200 (OK)
….
2012-07-11 20:51:59,357 Call from "1001" <sip:1001@10.10.0.240> is CONFIRMED, last code = 200 (OK)
2012-07-11 20:52:04,345 **************** Information about the call ********************* 
2012-07-11 20:52:04,345 From: 1001 in 10.10.0.240:5060/udp
2012-07-11 20:52:04,346 To: phone_1 in 10.10.0.250
2012-07-11 20:52:04,346 Contact: 1001 in 10.10.0.240:5060/udp
2012-07-11 20:52:04,346 Connection: 10.10.0.240
2012-07-11 20:52:04,346 Owner: 10.10.0.240
2012-07-11 20:52:04,346 Via 0: 10.10.0.240:5060/udp
2012-07-11 20:52:04,346 User-Agent: Asterisk PBX 1.6.2.9-2+squeeze6
2012-07-11 20:52:04,346 
2012-07-11 20:52:04,346 *********************** Classification *******************
 \end{verbatim}
\end{myscriptlisting}

Como podemos apreciar en el fragmento de la salida de Artemisa, la información 
que llega tiene como fuente al \emph{proxy server}, de modo que no podemos
obtener datos sobre el verdadero origen del ataque. Igualmente, dependiendo de
la cantidad de mensajes INVITE que llegan se puede inferir sobre el tipo de
ataque (\emph{scanning, flooding,} etc).
Es importante destacar que si se utiliza \ac{ser} como 
\emph{registrar server}, el campo \emph{user-agent} de la cabecera \ac{sip} no es
enmascarado, motivo por el cual Artemisa podría determinar  e indicar la
presencia de un ataque utilizando alguna de las herramientas de la \emph{suite}
SIPVicious.
También hay que destacar que aunque la herramienta no logró su cometido de 
detectar las extensiones válidas del dominio, por la frecuencia de arribo de los
mensajes, Artemisa detecta la presencia de un ataque cuando utilizamos el método
OPTIONS.

Cuando apuntamos el ataque a la dirección \ac{ip} de Artemisa, sin importar el método
utilizado, SVWAR no logra enumerar las extensiones por no recibir por parte de
Artemisa ningún mensaje solicitando autenticación. Sin embargo el \emph{honeypot} si es
capaz de recopilar datos acerca del atacante.
Ya sea con método INVITE u OPTIONS, Artemisa indica intento de escaneo o \mbox{inundación}
dependiendo de la frecuencia de arribo de los mensajes, si son
mensajes esporádicos o continuos respectivamente. Lo importante aquí es que
detecta ciertamente que el ataque fue realizado con la herramienta
SIPVicious, esto gracias al (\emph{fingerprinting}), proceso mediante el cual
llevamos a cabo la correlación de huella que nos facilita dicho resultado.

\begin{myscriptlisting}
 \begin{verbatim}
2012-07-11 20:46:18,122 INVITE message detected.
2012-07-11 20:46:18,122 Waiting for SIP messages (5)...
2012-07-11 20:46:18,124 Incoming call from "4184408506" <sip:4184408506@10.10.0.250>
2012-07-11 20:46:18,125 Call from "4184408506" <sip:4184408506@10.10.0.250> is EARLY, last code =
180 (Ringing)
2012-07-11 20:46:18,126 Call from "4184408506" <sip:4184408506@10.10.0.250> is CONNECTING, last code
= 200 (OK)
2012-07-11 20:46:18,177 INVITE message detected.
….
2012-07-11 20:46:18,186 The maximum number of calls to simultaneously analyze has been reached.
2012-07-11 20:46:18,186 INVITE message detected.
2012-07-11 20:46:18,187 The maximum number of calls to simultaneously analyze has been reached.
….
2012-07-11 20:46:18,419 INVITE message detected.
2012-07-11 20:46:18,420 The maximum number of calls to simultaneously analyze has been reached.
2012-07-11 20:46:19,124 Waiting for SIP messages (4)...
….
2012-07-11 20:46:23,129 ************ Information about the call *****************
2012-07-11 20:46:23,129 
2012-07-11 20:46:23,129 From: 4184408506 in 10.10.0.250:5060/udp
2012-07-11 20:46:23,129 To: 4184408506 in 10.10.0.250
2012-07-11 20:46:23,129 Contact: 4184408506 in 10.10.0.250:5060/udp
2012-07-11 20:46:23,129 Connection: 
2012-07-11 20:46:23,129 Owner: 
2012-07-11 20:46:23,130 Via 0: 127.0.1.1:5060/udp
2012-07-11 20:46:23,130 User-Agent: friendly-scanner
….
2012-07-11 20:46:25,447 *********** Correlation **********************
2012-07-11 20:46:25,447 
2012-07-11 20:46:25,447 Artemisa concludes that the arrived message is likely to be:
2012-07-11 20:46:25,448 
2012-07-11 20:46:25,448 * The attack was created employing the tool SIPVicious.
2012-07-11 20:46:25,448 * A flooding attack.
2012-07-11 20:46:25,448 
 \end{verbatim}
\end{myscriptlisting}

Puede verse en la salida de consola de Artemisa, que luego de un determinado número 
de mensajes consecutivos (tres configurados en este caso), se comienzan a
ignorar mensajes posteriores por un cierto lapso de tiempo. Esto mismo se
muestra a continuación en el diagrama de flujo en la Figura \ref{SVWAR_INVITE_flood_protection}.
 
\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/flood_protection.jpg}
\caption{Protección de Artemisa \emph{honeypot} contra inundación de mensajes.}
\label{SVWAR_INVITE_flood_protection}
\end{figure}

Con el método REGISTER (apuntando a un \emph{user-agent client}), SVWAR devuelve
 un error y termina su ejecución sin generar salida por consola.\\

METASPLOIT: el módulo auxiliar scanner/\ac{sip}/enumerator nos permite enumerar extensiones 
utilizando los métodos OPTIONS ó REGISTER también sobre \ac{tcp} ó \ac{udp}.

El comportamiento de este módulo de METASPLOIT es similar al mismo tipo de 
ataque utilizando SVWAR, pero existen dos diferencias importantes que trataremos
a continuación. La primera de ellas es que no permite hacer uso de un
diccionario como fuente de nombres de extensiones para probar, sólo puede
configurarse un rango de extensiones numéricas, lo que en nuestro caso, impidió
a la herramienta enumerar exitosamente. La segunda diferencia con SVWAR es que
no finaliza su ejecución al apuntar el ataque a la dirección \ac{ip} de un
\emph{user-agent client}, de modo que podremos observar el comportamiento de
Artemisa ante mensajes REGISTER apuntados a su dirección \ac{ip}.
Artemisa recibe los mensajes REGISTER sin emitir respuesta alguna a estos, ya que no es 
menester de un cliente \ac{sip} de extremo final el proceso de desafío de
autenticación que debería seguir a mensajes de este tipo. 
Más allá de no haber  respuesta, igualmente puede detectarse la existencia de un
 intento de denegación de servicio mediante un (\emph{flooding
attack}). También puede obtenerse la \ac{ip} de la fuente, aunque no debe confiarse en
este dato ya que puede ser falsificada con la misma herramienta. 

\begin{myscriptlisting}
 \begin{verbatim}
  2012-07-12 20:48:46,912 ******************** REGISTER message ******************
2012-07-12 20:48:46,912  To: 
2012-07-12 20:48:46,913 
2012-07-12 20:48:46,913  From: 10.10.0.50:5060
2012-07-12 20:48:46,913  To: 
2012-07-12 20:48:46,913 
2012-07-12 20:48:46,913  From: 10.10.0.50:5060
2012-07-12 20:48:46,914 ***************** REGISTER analysis********************
2012-07-12 20:48:46,914 The REGISTER message is detected as a flood attack!
2012-07-12 20:48:46,914 
2012-07-12 20:48:46,914 
2012-07-12 20:48:46,914 The REGISTER message is detected as a flood attack!
2012-07-12 20:48:46,914 * A flooding attack.
2012-07-12 20:48:46,914 
 \end{verbatim}
\end{myscriptlisting}

Los mensajes generados con este módulo de METASPLOIT son mal formados, motivo 
por el cual pueden ser descartados según el agente de usuario, y en nuestro
caso, lleva a que Artemisa no muestre los nombres de las extensiones que se
utilizan en el ataque.

\subsubsection{Monitoreo de tráfico y espionaje de llamadas.\\}
BackTrack cuenta con varias herramientas pensadas para monitoreo de tráfico y 
espionaje utilizando técnicas como  \ac{arp}-spoofing, las cuales aprovechan
vulnerabilidades subyacentes a \ac{sip}/\ac{voip} propias de las capas de protocolos de
red  inferiores para las cuales Artemisa se encuentra totalmente indefenso y
escapa a sus capacidades y objetivos.


\subsubsection{Denegación de Servicio.\\}
Un ataque de denegación de servicio \ac{dos} apunta a afectar 
la disponibilidad del servicio de \ac{voip} enviando grandes cantidades de datos en
general o solicitudes específicas de un protocolo, para consumir los recursos de
la red o sobrecargar un servidor específico respectivamente. Herramientas
utilizadas: Inviteflood y Rtpflood.\\

Inviteflood: es una herramienta que realiza una inundación de mensajes \ac{sip}-INVITE sobre 
\ac{tcp}/IP. Inviteflood realiza envío de mensajes únicamente y no responde cuando es
consultada desde el \emph{host} objetivo. 

\begin{myscriptlisting}
 \begin{verbatim}
  root@bt#./inviteflood eth0 1001 10.10.0.250 10.10.0.40 100 
inviteflood - Version 2.0
              June 09, 2006
source IPv4 addr:port   = 10.10.0.50:9
dest   IPv4 addr:port   = 10.10.0.250:5060
targeted UA             = 1000@10.10.0.240
Flooding destination with 100 packets
sent: 1
sent: 2
sent: 3
....
sent: 98
sent: 99
sent: 100

 \end{verbatim}
\end{myscriptlisting}

Vale aclarar que, si bien la herramienta no responde a los mensajes \ac{sip} 
recibidos debido a los ataques generados, si se crea, un paquete de respuesta a
nivel \ac{tcp}(\ac{udp})/IP.
La mínima cantidad de mensajes que se generan apuntando el ataque a un cliente 
\ac{sip} es de tres mensajes, dos \ac{sip} y uno \ac{icmp} por cada uno generado por la
herramienta, tal se aprecia en la Figura~\ref{Inviteflood_3msj}.

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/INVITEFLOOD_tres_msjs.jpg}
\caption{Diálogo mínimo al utilizar Inviteflood.}
\label{Inviteflood_3msj}
\end{figure}

Cuando el ataque es apuntado a un servidor \ac{sip}, el número de paquetes 
intercambiados aumenta a QUINCE paquetes por cada uno enviado por la
herramienta, esto último debido a que el servidor envía siete veces el mensaje
200-OK en caso de no recibir el ACK desde su par, como se evidencia en la Figura~\ref{Inviteflood_9msjs}.

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/INVITEFLOOD_siete200OK.jpg}
\caption{Mensajes generados cuando el objetivo del ataque es un \ac{sip} \emph{registrar}.}
\label{Inviteflood_9msjs}
\end{figure}
Es entonces notable el tráfico que genera en la red la herramienta INVITEFLOOD 
con su consecuente procesamiento.
En caso de ser apuntado el ataque a Artemisa, el intento de obtener maś 
información del posible atacante, genera un tráfico de 19 paquetes por cada uno
enviado por INIVTEFOOD.
Debido a que lo indicado puede perjudicar la estabilidad de la red y del
 \emph{host} donde reside Artemisa, es que el \emph{honeypot} atenderá solo el numero
de mensajes configurados mediante MAX\_CALLS en \emph{artemisa.conf}. Superado
este número responderá al ataque con un mensaje \emph{“486 BUSY HERE”}, puede
observarse gráficamente en la Figura~\ref{SVWAR_INVITE_flood_protection}.

\begin{myscriptlisting}
 \begin{verbatim}
  2012-07-12 13:12:02,269 INVITE message detected.
2012-07-12 13:12:02,269 Waiting for SIP messages (5)...
2012-07-12 13:12:02,271 Incoming call from <sip:10.10.0.50>
2012-07-12 13:12:02,272 Call from <sip:10.10.0.50> is EARLY, last code = 180 (Ringing)
….
2012-07-12 13:12:02,276 Call from <sip:10.10.0.50> is CONNECTING, last code = 200 (OK)
…
2012-07-12 13:12:02,291 The maximum number of calls to simultaneously analyze has been reached.
….
2012-07-12 13:12:07,277 **************** Information about the call *************
2012-07-12 13:12:07,277 
2012-07-12 13:12:07,277 From:  in 10.10.0.50:9/udp
….
2012-07-12 13:12:07,278 User-Agent: Elite 1.0 Brcm Callctrl/1.5.1.0 MxSF/v.3.2.6.26
2012-07-12 13:12:07,278 
2012-07-12 13:12:07,278 *************** Classification ***************
2012-07-12 13:12:07,278 
2012-07-12 13:12:07,278 + Checking fingerprint...
2012-07-12 13:12:07,278 |
2012-07-12 13:12:07,278 | User-Agent: Elite 1.0 Brcm Callctrl/1.5.1.0 MxSF/v.3.2.6.26
2012-07-12 13:12:07,278 |
2012-07-12 13:12:07,279 | Fingerprint found. The following attack tool was employed: inviteflood
2012-07-12 13:12:07,279 |
2012-07-12 13:12:07,279 | Category: Attack tool
2012-07-12 13:12:07,279 
….
2012-07-12 13:12:08,401 ************** Correlation *********************
2012-07-12 13:12:08,401 
2012-07-12 13:12:08,401 Artemisa concludes that the arrived message is likely to be:
2012-07-12 13:12:08,401 
2012-07-12 13:12:08,401 * The attack was created employing the tool inviteflood.
2012-07-12 13:12:08,402 * A flooding attack.

 \end{verbatim}
\end{myscriptlisting}

RTP Flood: crea paquetes \ac{rtp} válidos (\emph{well-formed packet}) que son enviados en multitud 
hacia un teléfono \ac{ip} (\emph{softphone} o \emph{hardphone}) ó un \emph{proxy} \ac{rtp}. Por tratarse de un
agente \ac{sip} exclusivamente, Artemisa no atiende este tipo de ataque. 

\subsubsection{Suplantación de identificación de llamadas\\}

En entornos de \ac{voip} la suplantación de identidad es tan simple como modificar el
 campo \emph{From} de la cabecera del mensaje INVITE. El destino de su utilización
puede obedecer a necesidades de privacidad o intenciones de estafa. Herramientas
utilizadas: Inviteflood y \mbox{METASPLOIT}.\\

Inviteflood y METASPLOIT: en este caso utilizaremos estas herramientas para modificar el 
campo \emph{From} de mensajes INVITE adulterados. Las analizaremos juntas debido a que el mensaje
resultado que generan  tiene una gran similitud. 
Cuando utilizamos estas herramientas apuntando a Asterisk pero con extensiones 
pertenecientes a Artemisa, esta última no puede detectar la falsedad del mensaje
porque este pertenece al \ac{ua} indicado en el campo \emph{From}, el
cual indica a Asterisk.
Un caso distinto es cuando el ataque es apuntado a la dirección \ac{ip} de Artemisa
sin importar la extensión que se coloque,  aquí el \emph{honeypot} sí podrá evaluar
los datos presentados en el campo \emph{From} y detectar la presencia de un mensaje
adulterado. Más aún, cuando se utiliza la herramienta Inviteflood, Artemisa
acusa su uso.

\begin{myscriptlisting}
 \begin{verbatim}
  ….
2012-07-12 21:03:41,266 ******** Classification *****
2012-07-12 21:03:41,266 
2012-07-12 21:03:41,266 + Checking fingerprint...
2012-07-12 21:03:41,266 |
2012-07-12 21:03:41,266 | 
2012-07-12 21:03:41,280 |
2012-07-12 21:03:41,280 | No fingerprint found.
2012-07-12 21:03:41,280 
2012-07-12 21:03:41,280 + Checking DNS...
2012-07-12 21:03:41,280 |
2012-07-12 21:03:41,280 | + Checking 192.168.1.1...
2012-07-12 21:03:41,281 | |
2012-07-12 21:03:41,281 | | This is already an IP address. Nothing done.
2012-07-12 21:03:41,281 |
2012-07-12 21:03:41,281 | + Checking 127.0.0.1...
2012-07-12 21:03:41,281 | |
2012-07-12 21:03:41,281 | | This is already an IP address. Nothing done.
2012-07-12 21:03:41,281 |
2012-07-12 21:03:41,281 | + Checking ...
2012-07-12 21:03:41,282 | |
2012-07-12 21:03:41,282 | | IP cannot be resolved.
2012-07-12 21:03:41,282 | |
2012-07-12 21:03:41,282 | | Category: Spoofed message
2012-07-12 21:03:41,282 |
2012-07-12 21:03:41,282 | + Checking 10.10.0.250...
2012-07-12 21:03:41,282 | |
2012-07-12 21:03:41,282 | | This is already an IP address. Nothing done.
2012-07-12 21:03:41,282 
2012-07-12 21:03:41,283 + Checking if SIP port is opened...
2012-07-12 21:03:41,283 |
2012-07-12 21:03:41,283 | + Checking 127.0.0.1:5060/udp...
2012-07-12 21:03:41,283 | |
2012-07-12 21:03:41,391 | | Port state: closed
2012-07-12 21:03:41,391 | |
2012-07-12 21:03:41,391 | | Category: Spoofed message
2012-07-12 21:03:41,391 
2012-07-12 21:03:41,391 + Checking if media port is opened...
2012-07-12 21:03:41,392 |
2012-07-12 21:03:41,392 | No RTP info delivered.
2012-07-12 21:03:41,392 |
2012-07-12 21:03:41,392 | Category: Spoofed message
2012-07-12 21:03:41,392 
2012-07-12 21:03:41,392 + Checking request URI...
2012-07-12 21:03:41,392 |
2012-07-12 21:03:41,392 | Extension in field To: 
2012-07-12 21:03:41,392 |
2012-07-12 21:03:41,393 | Request addressed to the honeypot? No
2012-07-12 21:03:41,393 
2012-07-12 21:03:41,393 + Checking if proxy in Via...
2012-07-12 21:03:41,393 |
2012-07-12 21:03:41,393 | + Checking 10.10.0.250:/udp...
2012-07-12 21:03:41,393 | |
2012-07-12 21:03:41,393 | | Error while scanning.
2012-07-12 21:03:41,393 | |
2012-07-12 21:03:41,394 | | Category: -
2012-07-12 21:03:41,394 
2012-07-12 21:03:41,394 + Checking for ACK...
2012-07-12 21:03:41,394 |
2012-07-12 21:03:41,394 | ACK received: No
2012-07-12 21:03:41,394 |
2012-07-12 21:03:41,394 | Category: Scanning
2012-07-12 21:03:41,394 
2012-07-12 21:03:41,394 + Checking for received media...
2012-07-12 21:03:41,395 |
2012-07-12 21:03:41,395 | Media received: No
2012-07-12 21:03:41,395 |
2012-07-12 21:03:41,395 | Category: Ringing
2012-07-12 21:03:41,395 
2012-07-12 21:03:41,395 + The message is classified as:
2012-07-12 21:03:41,395 | Spoofed message
2012-07-12 21:03:41,395 | Scanning
2012-07-12 21:03:41,396 | Ringing
2012-07-12 21:03:41,396
 \end{verbatim}
\end{myscriptlisting}

\subsubsection{Ringing attack}

Si bien este ataque no está contemplado como tal por la \emph{suite} BackTrack, su
existencia es consecuencia del envío de mensajes INVITE a los clientes \ac{sip}. Ya
sea con la intención de una inundación ó en el intento de enumerar extensiones,
cuando se enviaban mensajes de este tipo los \emph{hardphone} y \emph{softphone}
comenzaban a sonar.

\newpage

\subsection{Caso 2: dominio de \emph{broadcast} compartido}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig4.jpg}
\caption{Diagrama topología \emph{testbed} \emph{testing} \ac{ubp}, caso 2.}
\label{caso2_topología}
\end{figure}

\begin{table}[h!]
\caption{Características y especificaciones topología \emph{testbed} \emph{testing} \ac{ubp}, caso 2.}
%\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab5.jpg}
%\end{figure}
\label{caso2_topología_tabla}
\end{table}


Aquí se presenta un típico escenario de red \ac{lan}, en el cual no se utiliza IEEE 
802.3Q (VLAN) según puede verse en la Figura~\ref{caso2_topología} con sus respectivos componentes
en la Tabla~\ref{caso2_topología_tabla}. 
Se denomina atacante interno a quien hará uso en este escenario
de las herramientas vistas en el caso anterior.
Cabe aclarar que en el caso 1 sólo se utilizaron configuraciones de red en 
modo promiscuo para la interfaz de red donde se realizaba la captura de tráfico.
De modo que desde el punto de vista de \ac{sip}, como protocolo de capa de
aplicación, no existe diferencia entre el uso de un dispositivo \emph{hub} o \emph{switch}
como concentrador de red. 
Sí existen diferencias desde la perspectiva del atacante, ya que pudiendo lograr
 capturas de tráfico tan completas, logrará obtener ciertos datos sin necesidad
de hacer uso de las herramientas utilizadas en los primeros ataques, con la
ventaja de mantenerse más oculto. Se puede dar como ejemplo el caso donde el
atacante capture tráfico entre un \emph{UA} y su \emph{registrar server},
obteniendo así la dirección \ac{ip} de servidor y el posible software que obra de
\emph{proxy} \ac{sip} en el mismo, obteniendo también el nombre de usuario y valor de
una extensión utilizada en el dominio; comenzando de este modo con un ataque de
fuerza bruta con el método REGISTER contra el servidor \ac{sip}, pasando de este modo
totalmente desapercibido para el \emph{honeypot}.
Otra diferencia importante radica en el deterioro de desempeño de la red cuando
 el atacante realice un intento de denegación de servicio mediante una
inundación de mensajes \ac{sip}. En este punto, la degradación de la calidad del audio
se hacía notable al utilizar algunos miles de mensajes con la herramienta
Inviteflood, no siendo así con el uso de un \emph{switch} y su consecuente segmentación
de dominio de colisión.    


\subsection{Caso 3: dominio público. Colisión y \emph{broadcast} no compratidos}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig4a.jpg}
\caption{Diagrama topología \emph{testbed} \emph{testing} \ac{ubp}, caso 3.}
\label{caso3_topología}
\end{figure}

\begin{table}[h!]
\caption{Características y especificaciones topología \emph{testbed} \emph{testing} \ac{ubp}, caso 3.}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab4a.jpg}
\label{caso3_topología_tabla}
\end{table}

\pagebreak

Un escenario al que nos enfrentamos diariamente, y en el que una simple conexión
a Internet contratada a casi cualquier \ac{isp} del mundo entero por un atacante, lo
coloca a este último en posición para intentar vulnerar nuestro sistema \ac{voip}.
Se realizaron aquí las pruebas como atacantes externos utilizado los servicios de
acceso a Internet provistos por dos diferentes \ac{isp} dentro de las facilidades de la 
\ac{ubp}, tal como se describe en la Figura~\ref{caso3_topología} y Tabla \ref{caso3_topología_tabla}.
 La división del dominio de \emph{broadcast} que este escenario plantea, no permitirá
 al atacante acceder a interfaces con direcciones \ac{ip} que se encuentren dentro de
la \ac{lan}, excepto a aquellas a las que el \emph{router/firewall} de la frontera
\ac{lan}/\ac{wan} les reenvíe los paquetes que cumplan con las reglas configuradas por los
administradores. Si bien ciertos paquetes son reenviados desde la \ac{wan} hacia
interfaces de la \ac{lan}, el atacante externo observará una única dirección \ac{ip} del
dominio, aquella que es pública. Esta situación no permitirá a las herramientas
tener acceso a todos los agentes \ac{sip} de nuestra red, sino sólo a aquellos que
están expuestos públicamente con sus debidas reglas configuradas en el
\emph{firewall}. De forma complementaria puede consultarse en el Anexo D
las configuraciones de los componentes y agentes \ac{sip} para el caso 3.

Utilizando las herramientas de escaneo, se logra, por lo expuesto en el párrafo 
anterior, obtener únicamente información sobre el \ac{sip} \emph{registrar}.
Con respecto a los ataques de enumeración, estos pueden ser dirigidos, 
nuevamente, sólo al \ac{sip} \emph{registrar}, y los ataques realizados utilizando
los métodos OPTIONS e INVITE, serán los que lleguen a Artemisa, acusando su
presencia, pero sin poder determinar más datos que el \ac{ua} (en caso
de utilizar \ac{ser} como \emph{proxy} \ac{sip}).
En este escenario un ataque de inundación podría afectar los recursos de red y 
procesamiento del servidor \ac{sip}, pero un ataque de este tipo es fácilmente
evitable con técnicas como TARPIT en Iptables.

\subsection{Resumen de resultados casos 1, 2 y 3}

A continuación se encuentran las Tablas~\ref{tabla_resumen_caso1}, \ref{tabla_resumen_caso2}
y \ref{tabla_resumen_caso3} donde se resumieron los resultados obtenidos frente a los diferentes 
tipos de ataques y herramientas en los tres escenarios propuestos en la unidad \ref{casos_1_2_3}.

\begin{table}[h!]
\caption{Tabla resumen resultados caso 1.}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Caso1.jpg}
\label{tabla_resumen_caso1}
\end{table}

\begin{table}[h!]
\caption{Tabla resumen resultados caso 2.}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Caso2.jpg}
\label{tabla_resumen_caso2}
\end{table}

\begin{table}[h!]
\caption{Tabla resumen resultados caso 3.}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Caso3.jpg}
\label{tabla_resumen_caso3}
\end{table}

\pagebreak

\textbf{Sobre la evaluación de respuestas empíricas a partir de su implementación y
experimentación:}

\begin{itemize}
\item{Artemisa se presenta como una solución proactiva, estable y de fácil
integración al entorno. Entrega al administrador información procesada y en
tiempo real, de la presencia de entes que intenten vulnerar la seguridad del
dominio \ac{sip}.}

\item{Este \emph{honeypot} se hace fuerte en entornos de red privada, acusando en
tiempo real y con registros detallados la presencia de un atacante interno.}

\item{Quedó demostrada la robustez de Artemisa ante intentos de \ac{dos} ya que
frente a un gran número de ataques simultáneos, el \emph{honeypot} pudo valerse de
su mecanismo configurable de limitación de atención de llamadas 
para no verse comprometido.}

\item{Una configuración en el \ac{sip} \emph{registrar} del entorno que encamine hacia
el \emph{honeypot} todo intento de comunicación contra un agente \ac{sip} que no 
pertenezca al dominio, aumenta el grado de detección de atacantes, tanto internos como
externos.}

\item{Considerar en el caso de un atacante interno, que disponer de dos instancias de Artemisa,
una con \emph{fingerprint} de un \emph{softphone} y otra de \emph{registrar} será muy ventajoso.
Ya que de esta manera podremos detectar a través de nuestros \emph{honeypots} tanto las \ac{ip} de
origen y de destino de los ataques dentro de la \ac{lan}. 
Esto se debe a que con una sola instancia de Artemisa esta información quedaría enmascarada por el \ac{sip} 
\emph{proxy/registrar} del dominio, ej:. Asterisk, agente \ac{sip} que recibe la comunicación y encamina
la llamada modificando el campo \ac{ip} de origen por su propia \ac{ip}. Más aun teniendo en cuenta
que la mayoría de los ataques tienen como \emph{target} el servidor de registro del entorno \ac{voip}.}

\item{El uso del \emph{honeypot} demostró que al colocar una trampa en la
infraestructura de red \ac{voip}, hace claramente más riesgosas a las incursiones exploratorias
para un atacante y que sea más probable poder detectarlo. El señuelo Artemisa
pudo retrasarnos cuando asumimos el rol del usuario mal intencionado, lo cual nos daría la delantera
para comenzar la detección, identificación y frustración de tal intrusión en el rol de administrador
de la red.}
\end{itemize}

\section{Estudio descriptivo estadístico de las características de Artemisa
honeypot en entornos reales en mesa de prueba}
\label{estudio_estadístico}

Se realizó un extensivo relevamiento de un período de seis
meses (1/11/2012 - 1/06/2013), que permitió apreciar tendencias e 
inferir conclusiones respecto a las variables analizadas. Según se
presentan debajo:\\

Variables:
\begin{itemize}
\item [•] Aplicativo Artemisa y su código fuente:
se toma como una constante la última versión estable del código disponible en el 
repositorio oficial de SourceForge \footnote{http://sourceforge.net/projects/artemisa/files/ de la versión
artemisa\_1.0.91.tar.gz (2011-02-22 1.7 MB - autor: rodrigodocarmo)}.
 
\item [•] Topología de la red: se adjuntan los diagramas topológicos de los
entornos en las Fi\-gu\-ras~\ref{testbed_ubp} y \ref{testbed_metropolitan} . Pueden diferenciarse dos configuraciones lógicas en
cuanto a la implementación del \ac{sip} \emph{registrar}. Por un lado \emph{self-
hosted} (entorno privado) y por el otro \emph{hosted-services} (entorno rentado). 
Se usó iptel.org para la implementación de \emph{hosted-services}.

\item [•] Sistemas de seguridad existente: 
considerando las camas de prueba (entornos \emph{self-hosted}) se optó por la
misma solución de seguridad para ambas implementaciones. En las cuales
se configuró \emph{IPtables Linux firewall} y \emph{Port Filtering} a través de los \ac{gw}
\emph{routers}. En cuanto a los \emph{hosted-services} de iptel.org no se dispone de esta
información.

\item [•] Componentes y características particulares de la red:
se plantearon dos entornos de características muy próximas entre sí. Estos fueron instalados
con componentes muy similares de hardware y software. Entre ellos, número de
servidores (\ac{sip} \emph{registrar}, \ac{sip} \emph{proxy server} y \emph{gateway}),
equipos \ac{voip} (\ac{ip} \emph{phones}, \emph{softphones}) 
y equipamiento de \emph{networking} necesario (\emph{firewall}, \emph{routers} y
\emph{switches}) recordando que gran parte de estos componentes fueron virtualizados
con VMWare y VirtualBox. Como única diferencia considerable los \emph{testbeds}
accedían a Internet a través de dos \ac{isp}s diferentes
dentro de la misma ciudad. Pero en base a los resultados obtenidos
puede considerarse como una variable individual o constante. 
Cabe aclarar que se estudio el aplicativo Artemisa bajo diferentes
topologías de red en la unidad anterior ``Evaluación de respuestas empíricas
y enfoque en desarrollos funcionales del sistema de seg Artemisa'' - casos 1, 2 y 3
(sección \ref{casos_1_2_3}). De forma complementaria puede consultarse en el Anexo D
las configuraciones de los componentes y agentes \ac{sip} de las 2 implementaciones estudiadas
en esta sección.

\item [•] Análisis del tráfico de voz, posibles vulnerabilidades y
ataques: se analizó tráfico de señalización de voz (\ac{voip}), posibles
vulnerabilidades y ataques. Considerando todos los gráficos de esta sección, se presenta un
análisis comparativo entre trafico procesado por Artemisa
y \emph{registrars}. Esto será por método \ac{sip} y tipo de mensajes \ac{sip}, cantidad de llamadas,
trafico sospechoso y ataques, como así también geolocalización por \ac{ip} \emph{address}. 

%NOTA1:
%Diferenciar que las \ac{ip}s obtenidas con \emph{Wireshark} son del campo \ac{ip} (el
%cual muy posiblemente no este \emph{spoofed}) a diferencia del campo \ac{ip} de \ac{sip} (a nivel
%capa aplicación) el cual es fácilmente \emph{spoofed}. 

%NOTA2:
%Centos Artemisa: la mayoría de los REGISTER son generados por el propio Artemisa.
%Ayudaría a validar los resultados obtenidos con el parser. Como así también el
%trafico que genera Artemisa por si mismo. No dejar de nombrar esto
%en la tesis, ya que puede confundirse este elevado caudal de mjes REGISTER, con
%un \emph{flooding attack} (de registers). Hacer referencia a las capturas que se
%adjunten en Anexo C (más precisamente a las imágenes de \emph{Wireshark}). 

\item [•] \emph{Threat model or adversary model} (modelo de atacante): Durante el análisis que se
realizó en esta sección se mantuvo el perfil de atacante que se modelizó en 
la sección \ref{modelo_atacante}.
\end{itemize}

En el transcurso de esta etapa, se pusieron en funcionamiento cinco
instancias de Artemisa \emph{honeypot}. Dos de ellas en la implementación
\emph{testbed \ac{ubp}} dentro de los laboratorios de la \ac{ubp}. Las
restantes en la implementación \emph{testbed Metropolitan}. En todas
estas instancias de Artemisa expuestas a Internet
durante el plazo detallado, se llevaron adelante capturas de tráfico y \emph{logs} a
nivel de aplicación, con el claro objetivo de obtener información relevante de
ataques reales. Deberá considerarse que se dispuso de números telefónicos \ac{sip}
gratuitos (\emph{iptel.org}), los cuales son con frecuencia un buen objetivo de
ataque además de los configurados localmente en nuestras arquitecturas \ac{sip} de
prueba. Podrán apreciarse sus configuraciones y componentes en las Tablas \ref{testbed_ubp_tabla},
\ref{testbed_metropolitan_tabla} y diagramas que se presentan en las Figuras \ref{testbed_ubp},
\ref{testbed_ubp_rack} y \ref{testbed_metropolitan} 
de las siguientes subsecciones \ref{imple_tetsbed_ubp} y \ref{imple_testbed_metropolitan}.

A partir de lo anterior, se procedió al estudio de las óptimas
condiciones de instalación y distribución de las instancias de Artemisa. Y tuvo
lugar el estudio técnico, y posteriores ajustes funcionales en base a la
experimentación en entornos de prueba como se verá en
sección \ref{desarrollos_funcionales}. Durante este trabajo se asentaron y categorizaron las
mediciones realizadas. 

Luego de la recopilación de extensivos resultados, apropiadamente
categorizados y tratados en base a métricas claramente definidas,
se plasmará a continuación  un análisis estadístico de los mismos en
este \ac{tfc}, para nuestro caso de estudio, desde la
perspectiva del administrador de seguridad del sistema.

%\begin{center}
%\textbf{\large{\color[rgb]{1,0,0}{Desarrollo y analisis estadisticos de las
%capturas de los entornos Metropolitan y UBP. Hacer un planteo orientado a
%ataques en gral en seguridad en VoIP, y luego otro analisis orientado a las
%capturas y el funcionamiento puntual de Artemisa. Tener en cuenta (como
%posibilidad) realizar comparativas entre los 2 fire. -
%PENDIENTE}}} 
%\end{center}


\subsection{Implementación \emph{testbed} \ac{ubp}}
\label{imple_tetsbed_ubp}

\begin{table}[h!]
\caption{Características y especificaciones topología \emph{testbed} \ac{ubp}.}
%\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab1.png}
\label{testbed_ubp_tabla}
\end{table}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig1.jpg}
\caption{Diagrama topología \emph{testbed} \ac{ubp}.}
\label{testbed_ubp}
\end{figure}

\begin{figure}[h!] 
\centering
\includegraphics[width=.5 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig5.jpg}
\caption{Diagrama rack \emph{testbed} \ac{ubp}.}
\label{testbed_ubp_rack}
\end{figure}

\begin{center}
\color{white}{.}
\end{center}
\begin{center}
\color{white}{.}
\end{center}

\begin{figure}[h!] 
\centering
\includegraphics[width=.8 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig6_n.jpg}
\caption{Foto rack \emph{testbed} \ac{ubp}.}
\label{testbed_ubp_rack_foto}
\end{figure}

\clearpage

\subsection{Implementación \emph{testbed} Metropolitan}
\label{imple_testbed_metropolitan}
\begin{center}
\color{white}{.}
\end{center}
\begin{figure}[h!] 
\centering
\includegraphics[width=.9 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig2.jpg}
\caption{Diagrama topología \emph{testbed} Metropolitan.}
\label{testbed_metropolitan}
\end{figure}

\newpage

\begin{table}%[h!]
\caption{Características y especificaciones topología \emph{testbed} West Metropolitan.}
%\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab2.jpg}
\label{testbed_metropolitan_tabla}
\end{table}

%\clearpage

\subsection{Configuraciones}
En las secciones subsiguientes se presentan las configuraciones de los
componentes fundamentales implementados en los dos \emph{testbeds} en
cuestión. Las cuales son equivalentes, esto se debe a que los servicios fueron
implementados en máquinas virtuales como se detalla a continuación:\\

Virtual machines:
\begin{itemize}
    \item \emph{Oracle VM VirtualBox v4.1.x machines}
    \begin{itemize}
     \item \emph{VirtualBox Asterisk guest}:
	\subitem $\Rightarrow$ CPU = Shared
	\subitem $\Rightarrow$ RAM = 512Mb (shared)
	\subitem $\Rightarrow$ NetCard = Intel Corp. 82543GC Gig-Eth
Controller (rev 02)
	\subitem $\Rightarrow$ OS = Linux Debian 6.0.5 2.6.32-5-686 i686 GNU/Linux
	\subitem $\Rightarrow$ Service 1 = Asterisk v1.6.2.9-2+squeeze5
	\subitem $\Rightarrow$ Service 2 = \ac{sip} Protocol (RFC 3261)
	\subitem $\Rightarrow$ Service 3 = IP PBX (registrar) - Voicemail
	\subitem $\Rightarrow$ Service 4 = VoIP-\ac{pstn} Gateway (simulated)
    \item \emph{VirtualBox SER guest}:
	\subitem $\Rightarrow$ CPU = Shared
	\subitem $\Rightarrow$ RAM = 512Mb (shared)
	\subitem $\Rightarrow$ NetCard = Intel Corp. 82543GC Gig-Eth
Controller (rev 02)
	\subitem $\Rightarrow$ OS = Linux Debian 6.0.5 2.6.32-5-686 i686 GNU/Linux
	\subitem $\Rightarrow$ Service 1 = SER v0.9.8 i386
	\subitem $\Rightarrow$ Service 2 = \ac{sip} Protocol (RFC 3261)
	\subitem $\Rightarrow$ Service 3 = \ac{sip} Express Router
  \end{itemize}
\end{itemize}

\begin{itemize}
    \item \emph{VMware Player v4.0.x Machines}
    \begin{itemize}
     \item \emph{VMware Debian Artemisa guest}
	\subitem $\Rightarrow$ CPU = Shared
	\subitem $\Rightarrow$ RAM = 512Mb (shared)
	\subitem $\Rightarrow$ NetCard = Eth controller Micro
Dev [AMD] 79c970 (rev 10)
	\subitem $\Rightarrow$ OS = Linux Debian 6.0.5 2.6.32-5-686 i686 GNU/Linux
	\subitem $\Rightarrow$ Service 1 = ARTEMISA honeypot v1.0.91
	\subitem $\Rightarrow$ Service 2 = Registered to SER or Asterisk
\item \emph{VMware Centos Artemisa guest}
	\subitem $\Rightarrow$ CPU = Shared
	\subitem $\Rightarrow$ RAM = 512Mb (shared)
	\subitem $\Rightarrow$ NetCard = Eth controller Micro
Dev [AMD] 79c970 (rev 10)
	\subitem $\Rightarrow$ OS = Linux CentOS 6.2
2.6.32-220.17.1.el6.i686 i386
	\subitem $\Rightarrow$ Service 1 = ARTEMISA honeypot v1.0.91
	\subitem $\Rightarrow$ Service 2 = Registered to iptel.org
  \end{itemize}
\end{itemize}


\subsection{Estudio descriptivo estadístico en entornos reales en mesa de
prueba}

Mediante la utilización de herramientas de captura de tráfico y eventos. Entre
estas tcpdump, Wireshark, \emph{logs} de aplicación (Artemisa/Asterisk) se recopiló
valiosa información. Tal cual fue presentado al comienzo de esta unidad, se
realizó un extensivo relevamiento, de un período de aproximadamente seis
meses (1/11/2012 - 1/06/2013). Este permitió apreciar tendencias e
inferir conclusiones respecto a las variables analizadas.

Partiendo del análisis de las tablas y figuras de esta sección donde se presenta de forma
detallada los entornos \ac{ubp} (Tabla \ref{testbed_ubp_tabla} y Figura \ref{testbed_ubp})
y Metropolitan \emph{testbed} (Tabla \ref{testbed_metropolitan_tabla} y Figura y \ref{testbed_metropolitan}) 
se detallan las herramientas
utilizadas para realizar las capturas y el almacenamiento de los \emph{logs}. Cabe
aclarar que en ambos entornos se monto un NFS \emph{server} permitiendo archivar todos
los datos de forma centralizada.\\

\paragraph{Metropolitan testbed \\ \\} 

Artemisa \emph{instance} \ac{stdout} \& \ac{stderr} \emph{responses} (Ubuntu \emph{host}
\emph{instance} \#1):
\begin{myscriptlisting}   
  \begin{verbatim}
delivery@localhost artemisa_1.0.91]$ sudo ./artemisa 2>&1 | tee
/media/Storage/nfs\_server/DUHUbuArtemisa/artemisa\_stdout\_stderr\_dd\_mm\_aa
  \end{verbatim}
\end{myscriptlisting}

Tcpdump \emph{captures} (Ubuntu \emph{host}):
\begin{myscriptlisting}   
  \begin{verbatim}
delivery@deliveryUbuntuHOME:~$ sudo tcpdump -s0 -n -vvv -i wlan0 udp and \(port
5060 or 5063\) or icmp -w
/media/Storage/nfs_server/DUHUbuArtemisa/Ubuntu_Artemisa_asteriskserver_dd_mm_aa
  \end{verbatim}
\end{myscriptlisting}

Artemisa \ac{stdout} \& \ac{stderr} \emph{responses} (Debian Artemisa
VMWare \emph{guest} \emph{instance} \#2):
\begin{myscriptlisting}   
  \begin{verbatim}
root@debianDUH:/home/delivery/Artemisa/artemisa_1.0.91
2010-2015# ./artemisa 2>&1 | tee
/media/Storage/nfs_server/DUHDebArtemisa/artemisa_SER_2010-2015_stdout_stderr_06
_07_12
  \end{verbatim}
\end{myscriptlisting}

Artemisa \ac{stdout} \& \ac{stderr} \emph{responses} (Debian Artemisa VMWare
\emph{guest} \emph{instance} \#3):
\begin{myscriptlisting}   
  \begin{verbatim}
root@debianDUH:/home/delivery/Artemisa/artemisa_1.0.91
2016-2020# ./artemisa 2>&1 | tee
/media/Storage/nfs_server/DUHDebArtemisa/artemisa_SER_2016-2020_stdout_stderr_dd
_mm_aa
  \end{verbatim}
\end{myscriptlisting}

Tcpdump \emph{captures} (Debian Artemisa VMWare \emph{guest}):
\begin{myscriptlisting}   
  \begin{verbatim}
delivery@deliveryUbuntuHOME:~$ sudo tcpdump -s0 -p -n -vvv -i eth0 udp and
\(port 5060 or 5061 or 5062\) or ICMP -w
/media/nfs/DUHDebArtemisa/Debian_Artemisa_SER_asteriskserver_dd_mm_aa
  \end{verbatim}
\end{myscriptlisting}

Artemisa \emph{instance} \ac{stdout} \& \ac{stderr} \emph{responses} (Centos Artemisa
VMWare \emph{guest} \emph{instance} \#4):
\begin{myscriptlisting}   
  \begin{verbatim}
[delivery@localhost artemisa_1.0.91]$ sudo ./artemisa 2>&1 | tee
/media/Storage/nfs_client/DUHCentosArtemisa/artemisa_stdout_stderr_dd_mm_aa
  \end{verbatim}
\end{myscriptlisting}

Tcpdump \emph{captures} (Centos Artemisa VMWare \emph{guest}):
\begin{myscriptlisting}   
  \begin{verbatim}
[delivery@localhost DUHCentosArtemisa]$ sudo tcpdump -s0 -n -p -vvv -i eth0 udp
and \(port 5060 or 5062\) or icmp -w
/media/Storage/nfs_client/DUHCentosArtemisa/Centos_Artemisa_metropolitan1_dd_mm_
aa
  \end{verbatim}
\end{myscriptlisting}

\emph{Instance} \emph{logs} (Debian Asteriks VirtualBox \emph{guest} \emph{instance}):
\begin{myscriptlisting}   
  \begin{verbatim}
delivery@debiannv:~$ sudo tail -f /var/log/asterisk/messages | tee
/media/Storage/nfs_server/DUHDebAsterisk/var_log_asterisk_messages_dd_mm_aa
  \end{verbatim}
\end{myscriptlisting}

Tcpdump \emph{captures} (Debian Asterisk VirtualBox \emph{guest}):
\begin{myscriptlisting}   
  \begin{verbatim}
delivery@debiannv:~$ sudo tcpdump -s0 -n -p -vvv -i eth1 udp and \(port 5060 or
5063\) or icmp -w
/media/Storage/nfs_server/DUHDebAsterisk/Debian_Asterisk_1xxx_asteriskserver_dd_
mm_aa
  \end{verbatim}
\end{myscriptlisting}


Tcpdump \emph{captures} (Debian \ac{ser} VirtualBox \emph{guest}):
\begin{myscriptlisting}   
  \begin{verbatim}
delivery@debiannv:~$ sudo tcpdump -s0 -n -p -vvv -i eth1 udp and \(port 5060 or
5063\) or icmp -w
/media/Storage/nfs_server/DUHDebAsterisk/Debian_Asterisk_1xxx_asteriskserver_dd_
mm_aa
  \end{verbatim}
\end{myscriptlisting}


\paragraph{\ac{ubp} \emph{testbed} \\ \\} 
Artemisa \ac{stdout} \& \ac{stderr} \emph{responses} (Debian Artemisa VMWare
\emph{guest} \emph{instance} \#1):
\begin{myscriptlisting}   
  \begin{verbatim}
$ sudo ./artemisa 2>&1 | tee
/media/nfs/captures/UBPDebArtemisa_2000-2007_stdout_stderr_dd_mm_aa
  \end{verbatim}
\end{myscriptlisting}

Artemisa \ac{stdout} \& \ac{stderr} \emph{responses} (Debian Artemisa VMWare
\emph{guest} \emph{instance} \#2):
\begin{myscriptlisting}   
  \begin{verbatim}
$ sudo ./artemisa 2>&1 | tee
/media/nfs/captures/UBPDebArtemisa_2008-2009_2020-2024_stdout_stderr_dd_mm_aa
  \end{verbatim}
\end{myscriptlisting}

Artemisa \ac{stdout} \& \ac{stderr} \emph{responses} (Debian Artemisa VMWare
\emph{guest} \emph{instance} \#3):
\begin{myscriptlisting}   
  \begin{verbatim}
$ sudo ./artemisa 2>&1 | tee
/media/nfs/captures/UBPDebArtemisa_2025-2030_stdout_stderr_dd_mm_aa
  \end{verbatim}
\end{myscriptlisting}

Tcpdump \emph{captures} (Debian Artemisa VMWare \emph{guest}):
\begin{myscriptlisting}   
  \begin{verbatim}
$ sudo ./artemisa 2>&1 | tee
/media/nfs/captures/UBPDebArtemisa_2025-2030_stdout_stderr_dd_mm_aa
  \end{verbatim}
\end{myscriptlisting}

Tcpdump \emph{captures} (Debian \ac{ser} \emph{host}):
\begin{myscriptlisting}   
  \begin{verbatim}
$ sudo tcpdump -s0 -n -p -vvv -i eth0 udp and port 5060 or icmp -w
/media/nfs/captures/UBPDebSER_ubpsipserver_dd_mm_aa
  \end{verbatim}
\end{myscriptlisting}

Tcpdump \emph{captures} (Centos Artemisa VMWare \emph{guest} \emph{instance} \#4):
\begin{myscriptlisting}   
  \begin{verbatim}
[delivery@localhost DUHCentosArtemisa]$ sudo tcpdump -s0 -n -p -vvv -i eth0 udp
and \(port 5060 or 5062\) or icmp -w
/media/Storage/nfs_client/DUHCentosArtemisa/Centos_Artemisa_metropolitan1_dd_mm_
aa
  \end{verbatim}
\end{myscriptlisting}

Tcpdump \emph{captures} (Centos Artemisa VMWare \emph{guest} \emph{instance} \#5):
\begin{myscriptlisting}   
  \begin{verbatim}
[delivery@localhost DUHCentosArtemisa]$ sudo tcpdump -s0 -n -p -vvv -i eth0 udp
and \(port 5060 or 5062\) or icmp -w
/media/Storage/nfs_client/DUHCentosArtemisa/Centos_Artemisa_metropolitan1_dd_mm_
aa
  \end{verbatim}
\end{myscriptlisting}

Tcpdump \emph{captures} (Centos Artemisa VMWare \emph{guest} \emph{instance} \#6):
\begin{myscriptlisting}   
  \begin{verbatim}
[delivery@localhost DUHCentosArtemisa]$ sudo tcpdump -s0 -n -p -vvv -i eth0 udp
and \(port 5060 or 5062\) or icmp -w
/media/Storage/nfs_client/DUHCentosArtemisa/Centos_Artemisa_metropolitan1_dd_mm_
aa
  \end{verbatim}
\end{myscriptlisting}

A fines prácticos se automatizó mediante Bash \emph{scripting} al momento de iniciar
las VMs tal como se muestra a continuación:\\

Tcpdump \emph{captures} (VMs Init Bash script):
\begin{myscriptlisting}   
  \begin{verbatim}
#!/bin/sh
#
# This script will be executed *after* all the other init scripts.
# You can put your own initialization stuff in here if you don't
# want to do the full Sys V style init stuff.

touch /var/lock/subsys/local
/etc/init.d/network restart

# 1 - mount NFS
mount 10.10.0.254:/media/nfs_server/UBPCentosArtemisa /media/nfs_client/

# 2 - kill gnome
#telinit 3

# 3 - tcpdump 
/usr/sbin/tcpdump -s0 -n -p -i eth1 udp and \(port 5060 and 5061\) or icmp -w
/media/nfs_client/captures/Centos_Artemisa_SER_$(date
+%m'_'%d''_%Y'_'%H'_'%M'_'%S).cap

# 4 - Artemisa UBP1 stdout & stderr responses
python /home/delivery/Artemisa\
iptel.org/artemisa_1.0.91_ubp1\@iptel.org/artemisa 2>&1 | tee
/media/nfs_client/logs/artemisa_ubp1_stdout_stderr_$(date
+%m'_'%d''_%Y'_'%H'_'%M'_'%S)

# 5 - Artemisa UBP2 stdout & stderr responses
python /home/delivery/Artemisa\
iptel.org/artemisa_1.0.91_ubp2\@iptel.org/artemisa  2>&1 | tee
/media/nfs_client/logs/artemisa_ubp2_stdout_stderr_$(date
+%m'_'%d''_%Y'_'%H'_'%M'_'%S)
  \end{verbatim}
\end{myscriptlisting}

\subsection{Estadísticas Artemisa}

En ambos entornos los \emph{logs} de las instancias de Artemisa se obtuvieron de los
archivos de \emph{logging} generados en tiempo real por la propia aplicación,
accesibles desde el árbol de directorio en el que se encontraba el mismo, debajo ruta de directorio 
a modo de referencia:\\
{\texttt{root\_directory/../
artemisa\_1.0.91/logs/artemisa\_yyyy-dd-mm.log}

\subsubsection{Cantidad de paquetes \ac{sip} total por tipo de mensaje \ac{sip} instancias Artemisa}

En las figuras que contienen los gráficos axiales debajo 
Figuras~\ref{cant_paq_sip_x_mje_sip_barras_arte}, \ref{cant_paq_sip_x_mje_sip_barras_arte_sh},
\ref{cant_paq_sip_x_mje_sip_barras_arte_hs} se presentan el número de paquetes \ac{sip}
total por cada tipo de mensaje \ac{sip} de todas las instancias de Artemisa
configuradas. 

Se especifican a continuación los mensajes \ac{sip} para ambos \emph{testbeds} \ac{ubp} y Metropolitan 
para todas las instancias de Artemisa mencionadas tanto \emph{self-hosted} como \emph{hosted-services}:\\

\begin{itemize}
\item 100 \emph{Trying}:
esta respuesta indica que la solicitud ha sido recibida por el servidor de
\mbox{siguiente} salto (\emph{next-hop}) y que alguna acción no especificada está siendo
tomada en \mbox{representación} de esta llamada (por ejemplo, una base de datos está
siendo consultada). Esta respuesta, como toda otra respuesta provisoria,
detiene la retransmisión de un \mbox{INVITE} mediante un \ac{uac}. La
respuesta \ac{sip} 100 (\emph{Trying}) es diferente de otras respuestas provisorias, en que
nunca será reenviada a contramano por un \emph{stateful proxy}. Recordar lo
analizado en la subsección \ref{llamada_y_reg_sip}. 

\item 180 \emph{Ringing}:
el \ac{ua} recibiendo el INVITE está tratando de alertar al usuario. Esta
\mbox{respuesta} puede ser utilizada para iniciar el timbrado local del dispositivo
\ac{sip}. 

\item 200 \emph{OK}:
la solicitud ha sido exitosa. La información retornó con la respuesta. Esto
depende del método que haya sido utilizado en la solicitud.

\item 401 \emph{Unauthorized}:
la solicitud requiere de autenticación. Esta respuesta es emitida por los UASs
y \emph{registrars}, mientras que 407 (Requerimiento de autenticación de \emph{proxy} - \emph{Proxy
Authentication Required}) es usada por \emph{proxy servers}.

\item 405 \emph{Method Not Allowed}:
el método especificado en la \emph{Request-Line} (línea de solicitud) es entendido,
pero no permitido para la dirección identificada por el \emph{Request}-\ac{uri}
(\ac{uri}-solicitado). La respuesta tiene que incluir un campo de encabezado
permitido que contenga la lista de métodos válidos para la dirección indicada.

\item 408 \emph{Request Timeout}:
el servidor no puede producir una respuesta dentro de un período de tiempo
apropiado, por ejemplo, si no puede determinar la ubicación del usuario a
tiempo. El cliente podría repetir la solicitud sin ningún tipo de
modificaciones en cualquier momento más adelante. 

\item 486 \emph{Busy Here}:
el sistema final llamado, fue contactado satisfactoriamente, pero el receptor de
la llamada no se encuentra actualmente disponible para tomar llamadas
adicionales en este sistema final. La respuesta podría indicar un mejor momento
para llamar en el campo del encabezado \emph{Retry-After}. El usuario también
podría estar disponible en cualquier forma, por ejemplo a través de un servicio
de mensajes de voz (\emph{voice mail \mbox{service}}). El mensaje \emph{Status
600 (Busy Everywhere)} podría ser usado si el cliente sabe que ningún otro
sistema final podrá aceptar esta llamada.

\item 500 \emph{Server Internal Error}:
el servidor encontró una condición inesperada que impidió al mismo, 
completar la solicitud. El cliente podría presentar la condición de error
específica y puede reiterar la solicitud luego de algunos segundos. Si la
condición es temporal, el servidor podría indicar cuando el cliente puede
intentar reiterar la solicitud, utilizando el campo del
encabezado \emph{Retry-After}.
\end{itemize}

\cite{rosenberg}.\\

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9a.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de mensaje \ac{sip} (instancias Artemisa).}
\label{cant_paq_sip_x_mje_sip_barras_arte}
\end{figure}

\clearpage

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9b.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de mensaje \ac{sip}
(Artemisa \emph{self-hosted}).}
\label{cant_paq_sip_x_mje_sip_barras_arte_sh}
\end{figure}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9c.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de mensaje \ac{sip}
(Artemisa \emph{hosted-services}).}
\label{cant_paq_sip_x_mje_sip_barras_arte_hs}
\end{figure}

\clearpage

\begin{figure}[h!]
 \centering
  \subfloat[Artemisa.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.3 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9d.jpg}}
  \subfloat[Artemisa \emph{self-hosted}.]{
   %\label{svwar_well_ext}

\includegraphics[width=.305 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9e.jpg}}
  \subfloat[Artemisa \emph{hosted-services}.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.3 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9f.jpg}}
 \caption{Cantidad de paquetes \ac{sip} total por tipo de mensaje \ac{sip}
(instancias Artemisa).}
\label{cant_paq_sip_x_mje_sip_torta_arte}
\end{figure}


Se aprecian en los gráficos de las Figuras~\ref{cant_paq_sip_x_mje_sip_barras_arte}, \ref{cant_paq_sip_x_mje_sip_barras_arte_sh},
\ref{cant_paq_sip_x_mje_sip_barras_arte_hs} y \ref{cant_paq_sip_x_mje_sip_torta_arte} que los tipos de mensajes que
predominan son:

\begin{itemize}
\item 200 \emph{OK}: en respuesta a las solicitudes exitosas procesadas por
Artemisa, tanto recibidas como realizadas.

\item 401 \emph{Unauthorized}: error en la autenticación contra Artemisa,
podrían ser asociados a intentos de registro fallidos. Posiblemente no
esperados, es decir generados por un atacante.

\item 500 \emph{Server Internal Error}: esta respuesta está íntimamente
relacionada a que el servidor, en nuestro caso Artemisa, se enfrentó con una
condición inesperada que impidió que al mismo completar la solicitud. Esto está
asociado a que Artemisa solo tienen la capacidad de responder a ciertos
mensajes \ac{sip} considerando que el mismo actua como un \emph{user-agent} y no tiene la
capicidad de un \emph{proxy} \ac{sip} o \emph{registrar}.\\
\end{itemize}

\subsubsection{Cantidad de paquetes \ac{sip} total por tipo de método \ac{sip} instancias Artemisa}

En cuanto a los gráficos de cantidad de paquetes \ac{sip} total por tipo de
método \ac{sip} \emph{Sip Request}\footnote{\ac{sip} Request: La especificación del
\emph{core \ac{sip}} define seis tipos de solicitudes
\ac{sip}, cada una de ellas con un propósito diferente. Cada solicitud \ac{sip} contiene
un campo, llamado ``método'', que denota su propósito. La lista muestra los
seis métodos: INVITE, ACK, OPTIONS, BYE, CANCEL, REGISTER. \cite{camarillo}} de las instancias de 
Artemisa de las Figuras~\ref{cant_paq_sip_x_metodo_barras_arte}, \ref{cant_paq_sip_x_metodo_barras_arte_sh}, 
\ref{cant_paq_sip_x_metodo_barras_arte_hs} y \ref{cant_paq_sip_x_metodo_torta_arte} puede verse que
los métodos con mayor recurrencia son:

\begin{itemize}
\item INVITE: esta solicitud invita a los usuarios a participar en la sesión. El cuerpo
de la solicitud contiene la descripción de la sesión. Por ejemplo,
cuando un usuario A llama a otro B, su \ac{ua} envía un INVITE con la descripción de
sesión al \ac{ua} de B. En este caso con la descripción \ac{sdp}.

\item REGISTER:
los usuarios envían una solicitud de REGISTER para informar al servidor acerca de su ubicación actual. El
usuario A puede enviar un REGISTER al \emph{registrar} a su dominio ``company.com''
especificando que todas las solicitudes entrantes para \ac{sip}:usuarioA@company.com
deberán utilizar \emph{proxy}, o redirigidas a una cierta dirección \ac{sip}:usuarioA@IP

Los servidores \ac{sip} son usualmente co-ubicados con un \ac{sip} \emph{registrar}. Un
\ac{sip} \emph{registrar} puede enviar toda la información recibida en varias solicitudes
REGISTER a un servidor de locación única, haciendo que éste se encuentre
disponible para cualquier servidor \ac{sip} intentando encontrar un usuario. 
  
Los mensajes REGISTER también contienen los momentos en los que se dio el
registro. Por ejemplo, el usuario A puede registrar su ubicación actual hasta
las cuatro de la tarde, ya que sabe que luego dejará su oficina. Un usuario
también podría estar registrado en varias locaciones al mismo tiempo, indicando
al servidor que puede buscar al usuario en todas las ubicaciones registradas
hasta que éste sea alcanzado.

\item ACK:
las \emph{ACK requests} (solicitudes ACK) son utilizadas para acusar el recibo
de una respuesta final a un INVITE. De esta forma, un cliente originando una
solicitud INVITE genera un \emph{ACK-response} (respuesta de ACK) cuando recibe el \emph{final-INVITE} 
(repuesta final para el INVITE), proveyendo un intercambio de tres vías (\emph{three-way
handshake}).

\item BYE:
las solicitudes BYE (\emph{BYE requests}) se usan para abandonar una sesión. En
una sesión de dos partes, el abandono de una de las partes implica la
terminación de la sesión. Por ejemplo, cuando un usuario A envía un BYE al
usuario B, su sesión es terminada automáticamente. En escenarios \emph{multicast}, sin
embargo, una solicitud BYE de uno de los participantes solo significa que un
participante particular deja la conferencia. La sesión en si misma no se ve
afectada. De hecho, es una práctica común en grandes sesiones \emph{multicast} no
enviar un BYE cuando se deja la sesión.
\end{itemize}

\cite{camarillo}\\

Debajo un establecimiento de sesión exitoso donde se puede ver lo descripto
en los párrafos anteriores.

\begin{myscriptlisting}
\begin{verbatim}

   Alice                     Bob
     |                        |
     |       INVITE F1        |
     |----------------------->|
     |    180 Ringing F2      |
     |<-----------------------|
     |                        |
     |       200 OK F3        |
     |<-----------------------|
     |         ACK F4         |
     |----------------------->|
     |   Both Way RTP Media   |
     |<======================>|
     |                        |
     |         BYE F5         |
     |<-----------------------|
     |       200 OK F6        |
     |----------------------->|
     |                        |

\end{verbatim}
\end{myscriptlisting}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9g.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de método \ac{sip}
(instancias Artemisa).}
\label{cant_paq_sip_x_metodo_barras_arte}
\end{figure}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9h.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de método \ac{sip}
(Artemisa \emph{self-hosted}).}
\label{cant_paq_sip_x_metodo_barras_arte_sh}
\end{figure}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9i.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de método \ac{sip}
(Artemisa \emph{hosted-services}).}
\label{cant_paq_sip_x_metodo_barras_arte_hs}
\end{figure}


\begin{figure}[h!]
 \centering
  \subfloat[Artemisa.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.3 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9j.jpg}}
  \subfloat[Artemisa \emph{self-hosted}.]{
   %\label{svwar_well_ext}

\includegraphics[width=.3 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9k.jpg}}
  \subfloat[Artemisa \emph{hosted-services}.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.3 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9l.jpg}}
 \caption{Cantidad de paquetes \ac{sip} total por tipo de método \ac{sip}
(instancias Artemisa).}
\label{cant_paq_sip_x_metodo_torta_arte}
\end{figure}

\clearpage

Del análisis realizado a los primeros gráficos incluidos en las
Figuras \ref{cant_paq_sip_x_mje_sip_barras_arte}, \ref{cant_paq_sip_x_mje_sip_barras_arte_sh},
\ref{cant_paq_sip_x_mje_sip_barras_arte_hs}, \ref{cant_paq_sip_x_mje_sip_torta_arte},
\ref{cant_paq_sip_x_metodo_barras_arte}, \ref{cant_paq_sip_x_metodo_barras_arte_sh},
\ref{cant_paq_sip_x_metodo_barras_arte_hs} y \ref{cant_paq_sip_x_metodo_torta_arte}
en el comienzo de esta sección, se puede inferir que debido a un posible intento de 
intrusión existe un muy elevado número de REGISTERS. 

\subsubsection{Cantidad de llamadas \ac{voip} \ac{sip} total instancias Artemisa}

Se continúa con el análisis de la cantidad de llamadas \ac{voip} total en las 
instancias de Artemisa presentadas en los gráficos incluidos en
las figuras \ref{cant_llamadas_sip_arte_barras} y \ref{cant_llamadas_sip_arte_torta}.
Por un lado se observa un número importante de llamadas completadas y rechazadas.
Aunque no son significativas con respecto a la cantidad de intentos de
REGISTER. Por su parte, más acorde a la cantidad de \mbox{INVITES} capturados. En
cuanto al entorno \emph{hosted-services} se puede apreciar que solo hubo una
llamada exitosa evidenciada con los 2 INVITES presentes.

\begin{figure}[h!]
 \centering
  \subfloat[Artemisa.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.3 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9m.jpg}}
  \subfloat[Artemisa \emph{self-hosted}.]{
   %\label{svwar_well_ext}

\includegraphics[width=.31 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9n.jpg}}
  \subfloat[Artemisa \emph{hosted-services}.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.309 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9o.jpg}}
 \caption{Cantidad de llamadas \ac{voip} total (instancias Artemisa).}
\label{cant_llamadas_sip_arte_barras}
\end{figure}

\begin{figure}[h!]
 \centering
  \subfloat[Artemisa.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.3 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9p.jpg}}
  \subfloat[Artemisa \emph{self-hosted}.]{
   %\label{svwar_well_ext}

\includegraphics[width=.3 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9q.jpg}}
  \subfloat[\emph{hosted-services}.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.31 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9r.jpg}}
 \caption{Cantidad de llamadas \ac{voip} total (instancias Artemisa).}
\label{cant_llamadas_sip_arte_torta}
\end{figure}

\subsection{Estadísticas \emph{registrars} SIP}

\subsubsection{Cantidad de paquetes \ac{sip} total por tipo de mensaje \ac{sip} \emph{registrars}}
En cuanto a la cantidad de paquetes \ac{sip} total por tipo de mensaje \ac{sip}
de las Figuras~\ref{cant_paq_sip_x_mje_sip_barras} y \ref{cant_paq_sip_x_mje_sip_barras} 
se encontraron otros tipos de paquetes \ac{sip}
no considerados anteriormente los cuales se detallan debajo:

\begin{itemize}
\item 404 \emph{Not Found}: el servidor posee información definitoria de que el
usuario no existe en el dominio especificado en el \emph{Request \ac{uri}}. Este
estado es también devuelto si el dominio en el \emph{Request \ac{uri}} no coincide
con ninguno de los dominios manejados por el receptor de la solicitud.

\item 405 \emph{Method Not Allowed}: el método especificado en la 
\emph{Request-Line} es entendible, pero no permitido por la
dirección identificada mediante el \emph{Request \ac{uri}}. La respuesta debe
incluir un campo de encabezado \emph{Allow header field} que contenga una lista
de los métodos válidos para la dirección indicada.  

\item 408 \emph{Request Timeout}: el servidor no ha podido producir una respuesta
dentro de un tiempo apropiado, por ejemplo, si este no ha podido determinar la
localización del usuario a tiempo. El cliente podría repetir la solicitud sin
realizar modificaciones en cualquier momento posterior.

\item 483 \emph{Too Many Hops}: el servidor recibió una solicitud que contiene el
campo \emph{Max-Forwards header field} (encabezado Máximos-Reenvíos) con el
valor en cero. 

\item 486 \emph{Busy Here}: el sistema final del usuario que recibe el llamado, fue
contactado de ma\-ne\-ra satisfactoria, pero este usuario actualmente no tiene
intenciones o no está disponible para tomar llamadas adicionales en este
sistema final. El usuario podría también estar disponible.

\item 488 \emph{Not Acceptable Here}: la respuesta tiene el mismo significado que
un 606 (No aceptable - \emph{Not Acceptable}), pero solo aplica a una dirección
de recurso específico mediante el \emph{Request \ac{uri}} y la solicitud puede ser
exitosa en cualquier lugar. Un cuerpo de mensaje que contenga una descripción
de las capacidades puede estar presente en la respuesta, la cual está
formateada de acuerdo al campo \emph{Accept} del encabezado en el mensaje
INVITE (o \emph{application/\ac{sdp}} si no se encuentra presente), de igual forma
que en el cuerpo de un mensaje en una respuesta 200 (OK) a una solicitud
OPTIONS.

\item 501 \emph{Not Implemented}: el servidor no soporta la funcionalidad requerida
para completar la solicitud. Esta es la respuesta apropiada cuando un \ac{uas} no 
reconoce el método de solicitud y no es capaz de soportarlo para ningún usuario.
(Los \emph{proxies} reenvían todas las solicitudes a pesar del método).
Notar que un 405 \emph{Method Not Allowed} (Método no Permitido) es enviado cuando
un servidor reconoce el método de solicitud, pero ese método no está permitido o soportado.

\item 513 \emph{Message Too Large}: el servidor no fue capaz de procesar la
solicitud ya que la longitud del mensaje excede sus capacidades.

\item 603 \emph{Decline}: la máquina del usuario que recibe la llamada fue
contactada satisfactoriamente, pero el usuario explícitamente no desea o no
puede participar. La respuesta puede indicar un mejor horario para llamar en el
campo \emph{Retry-After} del encabezado. Este estado de respuesta es solo
devuelto si el cliente sabe que ningún otro \emph{endpoint} responderá la
solicitud.\\
\end{itemize}

Más allá de estos nuevos tipos de mensajes \ac{sip} es posible apreciar que el
comportamiento del \emph{registrar} se encuentra directamente relacionado con las
capturas analizadas de las instancias de Artemisa.
Es decir que también se aprecian en los gráficos, que los tipos de mensajes que
predominan son:

\begin{itemize}
\item 100 \emph{Trying}: es un mensaje \ac{sip} muy común al intentar establecer una
llamada, podría o no estar relacionada con una llamada mal intencionada.\\

\item 200 \emph{OK}: en respuesta a las solicitudes exitosas procesadas por
Artemisa. Tanto recibidas como realizadas.

\item 401 \emph{Unauthorized}, error en la autenticación contra Artemisa,
podrían ser asociados a intentos de registro fallidos. Posiblemente no
esperados, es decir generados por un atacante.

\item 404 \emph{Not Found}: el servidor posee información definitoria de que el
usuario no existe en el dominio especificado en el \emph{Request \ac{uri}}. Este
estado es también devuelto si el dominio en el \emph{Request \ac{uri}} no coincide
con ninguno de los dominios manejados por el receptor de la solicitud.
Claramente pueden estar asociados a solicitudes de un atacante al intentar
alcanzar usuarios inexistentes en un \emph{scanning attack}.

\item 483 \emph{Too Many Hops} y 513 \emph{Message Too Large}: aunque no
necesariamente, estos podrían estar relacionados a mensajes mal formados de un
usuario malicioso.

\item 500 \emph{Server Internal Error}: esta respuesta está íntimamente
relacionada a que el servidor, en nuestro caso Asterisk, se enfrentó con una
condición inesperada que impidió al mismo completar la solicitud. Esto está
asociado a que Artemisa solo tienen la capacidad de responder a ciertos
mensajes \ac{sip} considerando que el mismo actua como un \ac{ua} y no tiene la
capacidad de un \emph{proxy} \ac{sip} o \emph{registrar}.
\end{itemize}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9s.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de mensaje \ac{sip}
(\emph{self-hosted} \emph{registrars}).}
\label{cant_paq_sip_x_mje_sip_barras}
\end{figure}

\begin{figure}[h!] 
\centering
\includegraphics[width=.8 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9t.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de mensaje \ac{sip}
(\emph{self-hosted} \emph{registrars}).}
\label{cant_paq_sip_x_mje_sip_torta}
\end{figure}

\subsubsection{Cantidad de paquetes \ac{sip} total por tipo de método \ac{sip} \emph{registrars}}
Analizando ahora las Figuras~\ref{cant_paq_sip_x_metodo_barras_reg_sh} y
\ref{cant_paq_sip_x_metodo_torta_reg_sh} de la cantidad de
paquetes por tipo de método \ac{sip} para los \emph{regitrar} Asterisk y \ac{ser}
de las camas de prueba.\\ 

\begin{itemize}
\item SUBSCRIBE: el \ \emph{framework} \footnote{\textbf{Framework}: en el de\-sa\-rro\-llo
de software es una estructura conceptual y tecnológica de soporte definido, normalmente con
artefactos o módulos de software concretos, que puede servir de base para la
organización y de\-sa\-rro\-llo de software. Típicamente, puede incluir soporte de
programas, bibliotecas, y un lenguaje interpretado, entre otras herramientas,
para así ayudar a desarrollar y unir los diferentes componentes de un
proyecto. Representa una arquitectura de software que modela las relaciones
generales de las entidades del dominio y provee una estructura y una especial
metodología de trabajo, la cual extiende o utiliza las aplicaciones del
dominio. \cite{riehle}} de notificación de eventos \ac{sip}
permite a \ac{sip} informar a los usuarios acerca de una variedad de eventos en los
cuales han indicado un previo interés mediante señalización. Como por ejemplo,
solicitando el estado de un usuario en particular para saber en qué momento
poder comunicarse en caso de que al momento de llamar este ocupado, evitando así
llamar reiteradas veces. Como es esto realizado, dos métodos fueron definidos
para proveer notificación de eventos asíncronos: SUBSCRIBE y NOTIFY.
SUBSCRIBE es usado por una entidad \ac{sip} para declarar su interés en un evento en
particular. Una entidad \ac{sip} se suscribe a un cierto evento de una clase de
eventos. Cuando el evento al que el usuario se ha suscrito ocurre, las
solicitudes NOTIFY son enviadas conteniendo información acerca de la sesión. 

\item CANCEL: son solicitudes que cancelan las transacciones pendientes.
Si un servidor \ac{sip} ha recibido un INVITE pero aun no ha retornado una
respuesta final, va a parar de procesar el INVITE en cuanto reciba un CANCEL.
Pero, sin embargo, ha respondido con una respuesta final para este INVITE, la
solicitud CANCEL no tendrá efecto en la transacción. 

\item OPTIONS: estas solicitudes consultan al servidor acerca de sus capacidades
y funciones, incluyendo qué métodos y que tipos de sesión soportan. Un
servidor \ac{sip} podría responder a una solicitud OPTIONS que soporta \ac{sdp} como
protocolo de descripción de sesión y cinco métodos: INVITE,
ACK, CANCEL, BYE, y OPTIONS. Debido que el servidor no soporta el método
REGISTER, luego se podría deducir que este dispositivo no es un \emph{registrar}. El
método OPTIONS, podría no verse útil en este momento, pero a medida que
nuevas extensiones agregan nuevos métodos a \ac{sip}, el método OPTIONS es una
excelente manera de descubrir qué métodos específicos son soportados por un
servidor en particular.
\end{itemize}

\cite{camarillo}

\begin{itemize}
\item PUBLISH: se declaró un nuevo método \ac{sip}, PUBLISH, para publicar estado de eventos.
PUBLISH es similar a REGISTER permitiendo a un usuario crear, modificar, y
remover estados en otra entidad que maneja este estado en nombre del usuario
(ej. un \emph{registrar server}). Direccionar una solicitud PUBLISH es idéntico a
direccionar una solicitud \mbox{SUBSCRIBE}. El \emph{Request \ac{uri}} de una
solicitud PUBLISH, es completada con la dirección del recurso para el cual el
usuario desea publicar el estado del evento. El usuario podría tener múltiples
\emph{endpoints} o \emph{user-agents} que publican estado de eventos. Cada
\emph{endpoint} podría publicar su propio estado único, a partir del cual el
compositor de estado de eventos genera el estado de evento compuesto del
recurso. Adicionalmente, a un recurso en particular, todo evento de estado
publicado es asociado con un paquete de eventos específico. A través de una
suscripción a este paquete de eventos, el usuario es capaz de descubrir el
estado de eventos compuesto de todas las publicaciones activas.  
\end{itemize}

\cite{niemi}\\

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9u.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de método \ac{sip}
(\emph{self-hosted} \emph{registrars}).}
\label{cant_paq_sip_x_metodo_barras_reg_sh}
\end{figure}

\begin{figure}[h!] 
\centering
\includegraphics[width=.8 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9v.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de método \ac{sip}
(\emph{self-hosted} \emph{registrars}).}
\label{cant_paq_sip_x_metodo_torta_reg_sh}
\end{figure}

\clearpage

\subsubsection{Cantidad de llamadas \ac{voip} \ac{sip} total \emph{registrars}}
Tal se muestra en los gráficos de la Figura~\ref{cant_llamadas_sip_reg}, 
por un lado se ve un número importantísimo de llamadas
rechazadas, lo que se ve directamente reflejado por las estadísticas del método REGISTER, como así
también de los mensajes \ac{sip} que 401 Unauthorized y 404 Not Found involucrados en
este proceso. Los cuales resultan de una gran cantidad de registros fallidos.
Por su número exagerado, podría ser asociado a intentos de registro mal
intencionados. Se puede confirmar la anterior suposición al verificar los
\emph{logs} de Asterisk. Por su parte, se aprecian un número importante de \ac{sip} \emph{200 OK},
\ac{sip} 100 \emph{trying} y \ac{sip} 180 \emph{ringing} relacionados a las 591 llamadas realizadas. Las
cuales podrían haber sido generadas por atacantes considerando que no se
esperaban llamadas dentro del dominio. Cabe aclarar que un porcentaje de las
mismas se encuentran asociadas a llamadas intencionadas que se realizaron para
probar el \ac{sip} \emph{registrar}.

\begin{figure}[h!]
 \centering
  \subfloat[\emph{self-hosted registrars.}]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.504 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9w.jpg}}
  \subfloat[\emph{self-hosted registrars.}]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.5 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9x.jpg}}
 \caption{Cantidad de llamadas \ac{voip} \ac{sip} total (\emph{registrars}).}
\label{cant_llamadas_sip_reg}
\end{figure}

\subsection{Estadísticas ataques \ac{voip}}

\subsubsection{Cantidad de paquetes \ac{sip} total por tipo de ataque}
Recordando lo estudiado en el marco teórico de la sección \ref{seguridad_voip}
de riesgos y seguridad en \ac{voip}, como así también la descripción y respuesta a
cada tipo de ataque detectado por Artemisa en la unidad \ref{caso1}, a través del caso 1.
Se resumen a continuación los tipos de ataques y resultados obtenidos de los \emph{logs}
de Artemisa de las 
\mbox{Figuras}~\ref{ataques_artemisa}, \ref{ataques_artemisa_sh}, \ref{ataques_artemisa_hs} y
\ref{cant_paq_sip_x_ataque_arte}. Cabe destacar la efectividad que tuvo la plataforma
en los tres entornos propuestos para
detectar los ataques cubiertos por la misma. Principalmente los ataques de
inundación en un número mayor a 180.000 durante el período de exposición de
seis meses. Sin descontar los 102 ataques de \emph{\emph{ringing}} y \emph{scanning
attemps}. Luego se podría decir que los entornos no recibieron ataques de
\ac{spit}.

\begin{itemize}

\item \ac{dos} - \emph{flooding attacks}.
Los ataques \emph{\ac{dos}} son probablemente el tipo de ataques
más comunes en las comunicaciones VoIP. Un \ac{dos} \emph{attack} puede ocurrir
cuando un gran número de solicitudes INVITE inválidas son enviadas a un
\emph{proxy server} en un intento de congestionar el sistema. Los ataques son
relativamente simples de implementar, y su efecto en los usuarios del sistema
son inmediatos. \ac{sip} tiene varios métodos para minimizar los efectos de los
ataques \ac{dos}, pero finalmente estos son imposibles de prevenir. \cite{madsen}  
Directamente relacionado con un \ac{dos}, se encuentran los ataques de inundación
que tienen como objetivo los elementos del plano de señalización
(ej.: \emph{proxy}, \emph{gateway}, etc.) con el fin de tirarlo abajo y producir un colapso en
la red de VoIP. \cite{nassarm}
En otras palabras, un ataque de denegación de servicio (\ac{dos})
apunta a afectar la disponibilidad del servicio de \ac{voip} enviando grandes
cantidades de datos en general o solicitudes específicas de un protocolo, para
consumir los recursos de la red o sobrecargar un servidor específico
respectivamente. Las posibles herramientas a ser utilizadas serían: Iviteflood y Rtplood.

\item \emph Scanning attemp (escaneo).
   A través de este tipo de ataques se busca recopilar información sobre la
topología, servidores y clientes del entorno  \ac{voip}. El usuario malicioso estaría
interesado en encontrar \emph{hosts} activos; tipos y versiones de \ac{pbx}s,
\emph{servers/gateways} y clientes (\emph{hardphones} y \emph{softphones}).
Por lo tanto se destinan los ataques a la dirección \ac{ip} de cada
\emph{host}, por  ejemplo la dirección \ac{ip} de Artemisa. Las  herramientas utilizadas
podrían ser: SMAP, \ac{sip}-SCAN, SVMAP y METASPLOIT, entre otras.

\item Enumeración (\emph{enumerating}).
   Podría considerarse como \emph{scanning}. Consiste en descubrir extensiones
\ac{sip} válidas para el entorno, lo que permite luego apuntar los ataques de fuerza
bruta y demás sobre tales cuentas. Trabaja analizando los
mensajes de error ante las solicitudes de métodos OPTIONS, INVITE y REGISTER,
enviadas apuntando a distintas extensiones para determinar cuales son válidas en
el entorno \ac{sip} en cuestión. Herramientas utilizadas: SVWAR y METASPLOIT.
    Para un resultado útil, desde el punto de vista del atacante, los mensajes
deben ser enviados al servidor de registro, Asterisk para este escenario de
pruebas. Debe tenerse en cuenta que un factor importante del éxito del
ataque, es el diccionario o rango de extensiones utilizadas con la
herramienta.

\end{itemize}

\begin{figure}[h!] 
\centering
\includegraphics[width=.9 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig91a.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de ataque (instancias Artemisa).}
\label{ataques_artemisa}
\end{figure}

\begin{figure}[h!] 
\centering
\includegraphics[width=.9 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig91b.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de ataque
(Artemisa \emph{self-hosted} \emph{registrars}).}
\label{ataques_artemisa_sh}
\end{figure}

\begin{figure}[h!] 
\centering
\includegraphics[width=.9 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig91c.jpg}
\caption{Cantidad de paquetes \ac{sip} total por tipo de ataque (Artemisa
\emph{hosted-services registrars}).}
\label{ataques_artemisa_hs}
\end{figure}


\begin{figure}[h!]
 \centering
  \subfloat[Artemisa.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.304 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig91d.jpg}}
  \subfloat[Artemisa \emph{self-hosted}.]{
   %\label{svwar_well_ext}

\includegraphics[width=.3 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig91e.jpg}}
  \subfloat[Artemisa \emph{hosted-services}.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.3 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig91f.jpg}}
 \caption{Cantidad de paquetes \ac{sip} total por tipo de ataque (instancias Artemisa).}
\label{cant_paq_sip_x_ataque_arte}
\end{figure}

\subsubsection{Cantidad de paquetes \ac{sip} por tipo ataque (Asterisk Metropolitan)}
Recordando que para este caso de estudio se expuso una instancia de Asterisk
la cual reportó en sus \emph{logs} como se aprecia en la Figura \ref{cant_paq_sip_x_ataque_reg} un 
números muy significativos de eventos, \emph{No matching peer found}
(no se encuentra coincidencia con un par).
\ac{sip} dispone de un sistema de autenticación de usuarios
\emph{challenge/response} (desafío/respuesta). Un INVITE inicial es enviado al 
\emph{proxy} con el cual el dispositivo final desea comunicarse. El \emph{proxy} responde
luego con un mensaje \emph{407 Proxy Authorization Request}, que contiene un 
set random de caracteres al cual nos
referimos como \emph{``nonce''}. Este es usado conjuntamente con el
\emph{password} para generar el \emph{hash MD5}
\footnote{\textbf{hash MD5}: El algoritmo de mensaje-resumen
(\emph{message-digest}) es una función de resumen criptográfico
(\emph{\mbox{cryptographic} hash function}) que produce un valor de hash (o resumen
criptográfico) de 128-bits (16-bytes), típicamente expresado en formato de texto
como un número de 32 dígitos hexadecimales. MD5 ha sido utilizado en una amplia
variedad de aplicaciones criptográficas, y también es comúnmente usado para
verificar la integridad de datos. Los MD5 \emph{digests} han sido ampliamente
empleados en el mundo del software para proveer alguna garantía de que un
archivo ha arribado intacto. Por ejemplo, los servidores de archivos
generalmente proveen un \emph{checksum} MD5 pre-computado (conocido como un MD5sum)
para los archivos, de forma tal que los usuarios sean capaces de contrastar el
\emph{checksum} del archivo descargado con éste. La mayoría de los \ac{os}
basados en Unix incluyen utilidades MD5sum en sus paquetes de distribución;
los usuarios de Windows deberían instalar una utilidad de Microsoft o correr
alguna aplicación de tercero para poder realizarlo. \cite{pachghare}.}, 
el cual luego es enviado como respuesta en el INVITE subsecuente.
Asumiendo que el hash MD5 coincide con el que fue generado  por el \emph{proxy}, el
cliente luego se encuentra autenticado. 

Si se expone al sistema Asterisk a la Internet pública, una de las cosas que
con seguridad se ve es un \emph{scan} para descubrir cuentas válidas (lo cual
claramente podrá validarse en los \emph{logs} presentados debajo). Este tipo de
escaneos comienzan chequeando varios nombres de usuarios comunes, y a
continuación de estos se comienza a escanear por cuentas numeradas. Es común
dentro de los usuarios configurar el nombre para sus cuentas \ac{sip} de la misma forma que
que su extensión en la \ac{pbx}. Ej.: extensión \ac{pbx} = ``1001`` y usuario \ac{sip} = ``1001``. 
Este \emph{scan} saca ventaja de esta realidad. Esto nos
lleva a un primer consejo relacionado a la seguridad de Asterisk:

\emph{Tip} \#1: se deberían seleccionar nombres de usuario no-numéricos para las
cuentas VoIP para que así se dificulte la posibilidad de adivinarlas. Por
ejemplo, se podría usar la dirección MAC de un teléfono \ac{sip} como su nombre de
cuenta en Asterisk. Estos escaneos de cuenta sacan ventaja del hecho de que las
respuestas que provienen del servidor por un intento de registro van a diferir
dependiendo de si la cuenta existe o no. Si esta existe, el servidor solicitará
autenticación. Si la cuenta no existe, el servidor inmediatamente denegará el
intento de registro. Este comportamiento es simplemente como se define el
protocolo. Esto nos lleva a un segundo consejo de seguridad para Asterisk: 

\emph{Tip} \#2: setear ``\emph{alwaysauthreject}'' a ``\emph{yes}'' en la
sección [general] de \\
\texttt{/etc/asterisk/sip.conf}. Esta opción indica a Asterisk a
responder como si cualquier cuenta fuera válida, lo que hace inútiles a los
escaneos por nombres de usuarios. Incluso si tenemos nombres de usuarios que
son difíciles de adivinar, es de vital importancia que a su vez dispongamos de
contraseñas fuertes. Si un atacante es capaz de obtener un nombre de usuario
válido, este va a intentar quebrarla mediante fuerza bruta. \emph{Passwords} fuertes
van a hacer que esto sea mucho más difícil de llevar a cabo.
El esquema de autenticación por defecto para el protocolo \ac{sip} es débil. La
autenticación es realizada a través de un desafío MD5 (\emph{MD5 challenge}) y
mecanismo de respuesta a este desafío. Si el atacante es capaz de capturar
cualquier tráfico de llamada, como una llamada \ac{sip} realizada desde una
\emph{laptop} en una red \emph{wireless} abierta, sería mucho más fácil trabajar en quebrar
el \emph{password} mediante fuerza bruta. Esto se debe a que ya que no requeriría la
solicitud de autenticación al servidor porque se trabajaría sobre el \emph{challenge}
capturado. 

\emph{Tip} \#3: hacer uso de \emph{passwords} fuertes. Existen innumerables recursos
disponibles en Internet que pueden ayudar a definir lo que constituye un
\emph{password} fuerte. Por su parte también hay disponibles muchos generadores de
\emph{passwords} fuertes los cuales podrían ser usados.\\  

\begin{figure}[h!]
 \centering
  \subfloat[\emph{Barras.}]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.505 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig91g.jpg}}
  \subfloat[\emph{Torta.}]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.3 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig91h.jpg}}
 \caption{Cantidad de paquetes \ac{sip} por tipo ataque (Asterisk
Metropolitan \emph{registrar}).}
\label{cant_paq_sip_x_ataque_reg}
\end{figure}

Captura \emph{brute-force attack ''No matching peer found``} en el directorio\\
\texttt{/var/log/asterisk/messages.x}:

\begin{myscriptlisting}
 \begin{verbatim}
 [0K[Feb 22 19:01:06] [1;33mNOTICE [0m[1486]: [1;37mchan_sip.c
[0m:[1;37m21770[0m [1;37mhandle_request_register[0m: Registration from
'"1"<sip:1@186.137.221.179>' failed for '192.168.0.101' - No matching peer found
[0K[Feb 22 19:01:06] [1;33mNOTICE [0m[1486]: [1;37mchan_sip.c [0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"2"<sip:2@186.137.221.179>'
failed for '192.168.0.101' - No matching peer found
[0K[Feb 22 19:01:06] [1;33mNOTICE [0m[1486]: [1;37mchan_sip.c [0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"3"<sip:3@186.137.221.179>'
failed for '192.168.0.101' - No matching peer found
[0K[Feb 22 19:01:06] [1;33mNOTICE [0m[1486]: [1;37mchan_sip.c [0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"10"<sip:10@186.137.221.179>' failed for '192.168.0.101' - No matching peer
found
[0K[Feb 22 19:01:06] [1;33mNOTICE [0m[1486]: [1;37mchan_sip.c [0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"11"<sip:11@186.137.221.179>' failed for '192.168.0.101' - No matching peer
found
[0K[Feb 22 19:01:06] [1;33mNOTICE [0m[1486]: [1;37mchan_sip.c [0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"12"<sip:12@186.137.221.179>' failed for '192.168.0.101' - No matching peer
found
[0K[Feb 22 19:01:06] [1;33mNOTICE [0m[1486]: [1;37mchan_sip.c [0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"13"<sip:13@186.137.221.179>' failed for '192.168.0.101' - No matching peer
found
...
[0K[Feb 22 19:01:09] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"Administator"<sip:Administator@186.137.221.179>' failed for '192.168.0.101' -
No matching peer found
[0K[Feb 22 19:01:09] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"administator"<sip:administator@186.137.221.179>' failed for '192.168.0.101' -
No matching peer found
[0K[Feb 22 19:01:09] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"superuser"<sip:superuser@186.137.221.179>' failed for '192.168.0.101' - No
matching peer found
[0K[Feb 22 19:01:09] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"security"<sip:security@186.137.221.179>' failed for '192.168.0.101' - No
matching peer found
[0K[Feb 22 19:01:09] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"sysadmin"<sip:sysadmin@186.137.221.179>' failed for '192.168.0.101' - No
matching peer found
[0K[Feb 22 19:01:09] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"Manager"<sip:Manager@186.137.221.179>' failed for '192.168.0.101' - No
matching peer found
[0K[Feb 22 19:01:09] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"manager"<sip:manager@186.137.221.179>' failed for '192.168.0.101' - No
matching peer found
...
[0K[Feb 22 19:01:15] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"Agberto"<sip:Agberto@186.137.221.179>' failed for '192.168.0.101' - No
matching peer found 
[0K[Feb 22 19:01:15] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"Agilberto"<sip:Agilberto@186.137.221.179>' failed for '192.168.0.101' - No
matching peer found
[0K[Feb 22 19:01:15] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from
'"Albert"<sip:Albert@186.137.221.179>' failed for '192.168.0.101' - No matching
peer found
 \end{verbatim}
\end{myscriptlisting}

Contraseña incorrecta (\emph{wrong password}): 
luego de poner en funcionamiento Asterisk, el siguiente paso es configurar los
teléfonos en si mismos para comunicarlos con Asterisk. Por la manera en la que
han sido configuradas las cuentas \ac{sip} en nuestro servidor de registro, este
esperará que los teléfonos se registren a él. El proceso de registro es
simplemente un \mbox{mecanismo} donde un agente de usuario comunica \emph{Soy el
teléfono X...aquí mi nombre de usuario y \emph{password}. Y en caso de que reciba una
llama mi dirección \ac{ip} es la siguiente}. Luego cuando Asterisk ha detectado
que el \emph{password} ingresado para un teléfono no coincide con el seteo secreto en
la sección sip.conf acusara \emph{Wrong password}.

Queda demostrado por los resultados, los cuales evidencian en base a la
altísima cantidad de intentos de \emph{password cracking} mediante \emph{brute
force} que \emph{toll fraud} (fraude en tasas o tarífas telefónicas) evidentemente 
el mayor riesgo para los sistemas telefónicos en términos del potencial
para costos que podrían llevar a la ruina a casi cualquier compañía. No es
desconocido para los estafadores acumular miles de dólares en llamadas robadas
en el curso de unos pocos días. 
\emph{Toll fraud} no es algo nuevo, incluso ha existido antes de VoIP. Sin
embargo, la naturaleza permisiva de VoIP significa que es más fácil para los
fraudulentos tomar ventaja de sistemas no seguros. La mayoría de los
proveedores de Internet no se harán responsables de estos costos, y de esta
forma si su sistema ha sido comprometido usted podría tener que lidiar con una
cuenta telefónica muy grande. A medida que los \emph{carriers} van mejorando la forma
de alertar a sus clientes de actividad sospechosa, esto no lo absuelve a uno de
la responsabilidad que implica asegurar que el sistema del cliente está
protegido contra una amenaza peligrosa y real. Dentro del sistema Asterisk,
es de vital importancia que saber qué recursos en el sistema están
expuestos al mundo exterior y garantizar que esos recursos están seguros.

La forma más común de fraude de tarifas telefónicas en estos días es alcanzada
mediante ataques de fuerza bruta. En este
escenario, los ladrones tendrán un script que va a contactar nuestro sistema e
intentar registrarse como un usuario válido. Si son capaces de registrarse
como un teléfono en su sistema, la inundación de llamadas va a comenzar, y
usted, como dijimos anteriormente, se verá involucrado con la factura asociada
a las mismas. Si el administrador usa números de extensiones simples,
contraseñas fáciles de adivinar, y su entorno acepta registros externos a su
\emph{firewall}, es muy probable que eventualmente sea víctima de un fraude de cuenta
telefónica. 

Los \emph{Brute-force attacks} pueden también causar problemas de performance
en su sistema, ya que uno de estos scripts pueden inundar su \emph{router} y \ac{pbx} con
números masivos de intentos de registro. Se presentan de modo complementario
algunas tácticas que han sido satisfactoriamente probadas en minimizar el
riesgo de \emph{toll fraud}:

\begin{enumerate}
  \item No utilice contraseñas fáciles de adivinar (\emph{easy-to-guess
passwords}). Los \emph{passwords} deberían ser de al menos ocho caracteres de largo y
contener una combinación de dígitos, letras y caracteres. Ej.: ``8aj03H''
es una buena contraseña, mientras que ``1234`` is not.
  \item No utilice números de extensiones para los dispositivos \ac{sip} a ser
registrados en sip.conf, es decir, en lugar de [1000], use algo como una MAC
address (por ejemplo: [0004f2123456] podría ser mucho más dificil de
adivinar para un ataque de fuerza bruta).
  \item Implemente un script de análisis como la conocida herramienta \emph{fail2ban} para
convertir su \emph{firewall} interno con el fin de bloquear direcciones \ac{ip} que están
presentando comportamiento abusivo, como por ejemplo paquetes masivos de
inundación.
\end{enumerate}
\cite{madsen}\\  

Captura \emph{brute-force attack ''Wrong password``} \texttt{/var/log/asterisk/messages.x}:

\begin{myscriptlisting}
 \begin{verbatim}
[0K[Feb 22 19:01:19] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1010"
<sip:1010@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[0K[Feb 22 19:01:19] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1010"
<sip:1010@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[0K[Feb 22 19:01:19] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1010"
<sip:1010@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[0K[Feb 22 19:01:19] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1010"
<sip:1010@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[0K[Feb 22 19:01:19] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1010"
<sip:1010@186.137.221.179>' failed for '192.168.0.101' - Wrong password
...
[0K[Feb 23 13:14:47] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1011"
<sip:1011@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[Feb 23 13:14:47] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1011"
<sip:1011@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[Feb 23 13:14:47] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1011"
<sip:1011@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[Feb 23 13:14:47] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1011"
<sip:1011@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[Feb 23 13:14:47] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1011"
<sip:1011@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[Feb 23 13:14:47] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1011"
<sip:1011@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[Feb 23 13:14:47] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1011"
<sip:1011@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[Feb 23 13:14:47] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1011"
<sip:1011@186.137.221.179>' failed for '192.168.0.101' - Wrong password
...
[Feb 23 13:16:45] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1014"
<sip:1014@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[Feb 23 13:16:45] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1014"
<sip:1014@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[Feb 23 13:16:45] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1014"
<sip:1014@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[Feb 23 13:16:45] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1014"
<sip:1014@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[Feb 23 13:16:45] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1014"
<sip:1014@186.137.221.179>' failed for '192.168.0.101' - Wrong password
[Feb 23 13:16:45] [1;33mNOTICE[0m[1486]: [1;37mchan_sip.c[0m:[1;37m21770[0m
[1;37mhandle_request_register[0m: Registration from '"1014"
<sip:1014@186.137.221.179>' failed for '192.168.0.101' - Wrong password
 \end{verbatim}
\end{myscriptlisting}

Se adjuntan tablas y gráficos relacionadas en Anexo C para mayor información.

\subsection{Estadística tráfico \ac{voip} \ac{sip}}
Las Tablas~\ref{tabla_ip_origen_metro} y \ref{tabla_ip_destino_metro} y 
Figuras~\ref{ip_origen_pp_metro}, \ref{ip_origen_pais_metro}, \ref{ip_destino_pp_metro} y
\ref{ip_destino_pais_metro}  del \emph{testbed} Metropolitan, 
como también las Tablas~\ref{tabla_ip_origen_ubp} y \ref{tabla_ip_destino_ubp} y 
Figuras~\ref{ip_origen_pp_ubp}, \ref{ip_origen_pais_ubp}, \ref{ip_destino_pp_ubp} y
\ref{ip_destino_pais_ubp} del
\emph{testbed} \ac{ubp}, presentan una comparativa entre el tráfico
generado por un \ac{ua} o un posible atacante con origen externo a nuestro
dominio, es decir desde Internet, al cual llamaremos tráfico
público/externo con \ac{ip} de origen pública. Contrastado con
el tráfico restante, el cuál será el originado dentro de nuestra red
\ac{lan}, es decir tráfico privado/interno, los paquetes tendrán \ac{ip} origen
asociadas al \emph{registrar}, Artemisa o \ac{ua} del entorno privado en cuestión. Ya sea
Metropolitan \emph{testbed} o \ac{ubp} \emph{testbed}. 

De la misma manera, se trato al tráfico con destino externo a nuestro entorno (\ac{ip} destino
pública/externa) para reflejarlo en las tablas y gráficos mencionados en el párrafo anterior.
Éste, claramente en respuesta a las solicitudes desde Internet descriptas anteriormente. Y por otro
lado las \ac{ip} de destino privadas/internas de paquetes encaminados dentro de
nuestra \ac{lan} por todas las entidades \ac{sip}. Luego de este estudio y considerando la
arquitectura de los \emph{testbeds} implementados, podemos concluir que prevalece
ampliamente el tráfico privado (\ac{ip} origen/destino internas). Ésto se debe al
comportamiento inherente de un entorno \ac{voip} \ac{sip}, donde existe un intercambio
constante entre el \emph{registrar} y los \ac{ua}, más aún en las implementaciones con
Asterisk (Metropolitan \emph{testbed}) donde todo el tráfico de señalización \ac{sip} debe
transitar a través de este. Habrá que recodar que a modo de \emph{keepalive} los \ac{ua}s
se vuelven a registrar cada cierto \emph{timeout} (tiempo muerto). Cabe aclarar, que
al capturar con una herramienta ejecutada en ciertos dispositivos del dominio, más específicamente
en el \ac{sip} \emph{proxy/registrar}
estamos captando todo el tráfico de señalización y encaminamiento \ac{sip} de todos
los componentes del dominio. Se puede señalar que para ambos \emph{testbed} se aprecia el
tráfico analizado según \ac{ip} de origen y como refleja la Figura \ref{ip_origen_pp_metro} tenemos un
porcentaje considerable, del 28,21\% de tráfico público/externo para Metropolitan \emph{testbed}, y como se
observa en la Figura \ref{ip_origen_pp_ubp} un 10,56\% para \ac{ubp} \emph{testbed},
lo cual explica el origen de los ataques de enumeración y de \emph{password crack} sufridos por Asterisk. 

De manera complementaria se clasificó el tráfico con \ac{ip} de origen o \ac{ip} destino
pública con su correspondencia por zona geográfica, más precisamente a que país
está asociado ese rango de \ac{ip} pública. Esto fue consultado a través del servicio web de 
geolocalización \ac{ip} 
\emph{iplocation}\footnote{https://www.iplocation.net/}. Y también se tuvo de referencia la distribución de direcciones \ac{ip}
supervisada por \ac{iana}, y la manera en que las direcciones \ac{ip} de los países son emitidas por sus
agencias gobierno. Ciertamente, la actual emisión de direcciones \ac{ip} es manejada por
diferentes agencias de \ac{rir}s en diferentes partes del mundo, como se muestra en la
Figura~\ref{iana_rir}:
\cite{hundley}  

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig93.jpg}
\caption{Los \ac{rir} alocan direcciones \ac{ip} públicas. \cite{hundley}}
\label{iana_rir}
\end{figure}

Tal puede verse en los gráficos de las Figuras \ref{ip_origen_pais_metro}, \ref{ip_destino_pais_metro}, 
\ref{ip_origen_pais_ubp} y \ref{ip_destino_pais_ubp},
que integra todo el tráfico con origen o destino a direcciones \ac{ip} públicas
podemos destacar que Argentina y Alemania fueron los países de mayor
protagonismo. Clarificamos que todo el tráfico recibido de una
nacionalidad diferente a la Argentina puede considerarse sospechoso. A su vez
será menester puntualizar que si bien es 100\% objetivo el origen del tráfico, éste
podría estar siendo encaminado a través de \emph{proxies} intermedios. Al utilizar
esta técnica de encaminamiento es posible enmascarar el origen real del tráfico.
En tercer lugar está Estados Unidos, habiendo generado un tráfico también
considerable. Y por último Corea, Irlanda y Polonia con un porcentaje mucho
menor.

\begin{table}[h!]
\caption{Estadísticas por dirección \ac{ip} de origen (Metropolitan \emph{testbed}).}
\centering
\includegraphics[width=.8 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab5c.jpg}
\label{tabla_ip_origen_metro}
\end{table}

\begin{figure}[h!]
 \centering
  \subfloat[Barras.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.53 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92i.jpg}}
  \subfloat[Torta.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.4 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92j.jpg}}
 \caption{Estadísticas por dirección \ac{ip} de origen pública/privada (Metropolitan
\emph{testbed}).}
\label{ip_origen_pp_metro}
\end{figure}

\begin{figure}[h!]
 \centering
  \subfloat[Barras.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.537 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92k.jpg}}
  \subfloat[Torta.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.4 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92l.jpg}}
 \caption{Estadísticas por dirección \ac{ip} de origen por país (Metropolitan
\emph{testbed}).}
\label{ip_origen_pais_metro}
\end{figure}

\begin{table}[h!]
\caption{Estadísticas por dirección \ac{ip} de destino (Metropolitan \emph{testbed}).}
\centering
\includegraphics[width=.7 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab5d.jpg}
\label{tabla_ip_destino_metro}
\end{table}

\begin{figure}[h!]
 \centering
  \subfloat[Barras.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.524 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92m.jpg}}
  \subfloat[Torta.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.4 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92n.jpg}}
 \caption{Estadísticas por dirección \ac{ip} de destino pública/privada
(Metropolitan \emph{testbed}).}
\label{ip_destino_pp_metro}
\end{figure}

\begin{figure}[h!]
 \centering
  \subfloat[Barras.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.552 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92o.jpg}}
  \subfloat[Torta.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.4 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92p.jpg}}
 \caption{Estadísticas por dirección \ac{ip} de destino por país 
(Metropolitan \emph{testbed}).}
\label{ip_destino_pais_metro}
\end{figure}

\begin{table}[h!]
\caption{Estadísticas por dirección \ac{ip} de origen (\ac{ubp} \emph{testbed}).}
\centering
\includegraphics[width=.7 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab5a.jpg}
\label{tabla_ip_origen_ubp}
\end{table}
\clearpage

\begin{figure}[h!]
 \centering
  \subfloat[Barras.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.424 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92a.jpg}}
  \subfloat[Torta.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.4 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92b.jpg}}
 \caption{Estadísticas por dirección \ac{ip} de origen pública/privada (\ac{ubp}
\emph{testbed}).}
\label{ip_origen_pp_ubp}
\end{figure}

\begin{figure}[h!]
 \centering
  \subfloat[Barras.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.43 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92c.jpg}}
  \subfloat[Torta.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.4 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92d.jpg}}
 \caption{Estadísticas por dirección \ac{ip} de origen por país (\ac{ubp} \emph{testbed}).}
\label{ip_origen_pais_ubp}
\end{figure}

\begin{table}[h!]
\caption{Estadísticas por dirección \ac{ip} de destino (\ac{ubp} \emph{testbed}).}
\centering
\includegraphics[width=.65 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab5b.jpg}
\label{tabla_ip_destino_ubp}
\end{table}
\clearpage

\begin{figure}[h!]
 \centering
  \subfloat[Barras.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.437 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92e.jpg}}
  \subfloat[Torta.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.4 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92f.jpg}}
 \caption{Estadísticas por dirección \ac{ip} de destino pública/privada (\ac{ubp}
\emph{testbed}).}
\label{ip_destino_pp_ubp}
\end{figure}

\begin{figure}[h!]
 \centering
  \subfloat[Barras.]{
   %\label{svwar_bad_ext}
   
\includegraphics[width=.435 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92g.jpg}}
  \subfloat[Torta.]{
   %\label{svwar_well_ext}
   
\includegraphics[width=.4 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92h.jpg}}
 \caption{Estadísticas por dirección \ac{ip} de destino por país (\ac{ubp}
\emph{testbed}).}
\label{ip_destino_pais_ubp}
\end{figure}

\footnote{Geolocalización de las direcciones \ac{ip} a través
de http://www.iplocation.net/}

\newpage

\subsection{Resumen de resultados}

\textbf{Sobre el estudio descriptivo estadístico de las características de Artemisa
\emph{honeypot} en entornos reales en mesa de prueba:}

\begin{itemize}
\item{Los registros de ataques colectados muestran la existencia de ataques
reales a los que se enfrentan a diario los servidores del entorno \ac{voip}. Se hace
evidente la necesidad de contar con herramientas que provean facilidades para
llevar adelante el análisis de los \emph{logs} de los servidores buscando una detección
temprana de ataques.}

\item{Al exponer al \emph{honeypoy} a Internet y recibir un sin numero de
intentos de comunicaciones \ac{sip} se descubrió predominancia de mensajes 
\emph{500 Server Internal Error} en el \emph{\mbox{environment}}
de prueba. Sabemos que estos mensajes de respuesta están íntimamente relacionados a que el
servidor, en nuestro caso Artemisa, se enfrentó con una 
condición inesperada que impidió al mismo completar la solicitud \ac{sip}. Se notó que esto 
está asociado a que Artemisa solo tiene la capacidad de responder
a ciertos \ac{sip} \emph{messages} considerando que el mismo actua como un \ac{ua} y no tiene la
capacidad de un \emph{proxy} \ac{sip} o \emph{registrar}. A pesar de esto llegamos a la conclusión
de que como herramienta de estudio sobre ataques en la red pública,  Artemisa, o mejor aún, una 
segunda instancia de Artemisa
debe configurarse idealmente para que entregue como su \emph{fingerprint},
el de un \emph{proxy} \ac{sip} por ejemplo: Asterisk PBX 1.6.2.9-2+squeeze5,
e instalarse a la escucha sobre el puerto estándar \ac{sip} (5060) de una \ac{ip} pública para
disuadir al atacante.}

\item{A través de las capturas se pudo corroborar que los tipos de mensajes \ac{sip} que predominan
en los \emph{testbeds} son \emph{401 unauthorized} por error en la autenticación contra Artemisa, 
asociados a intentos de registro fallidos. En su gran mayoría no esperados, por lo que podemos decir 
que fueron generados por un atacante.}

\item{Se puede inferir directamente del análisis estadístico realizado en las dos camas de prueba
que existe un muy elevado número de REGISTERS asociados a intentos de intrusión.}

\item{En cuanto a la cantidad de llamadas \ac{voip} \ac{sip} total (\emph{registrars})
se validó un número importantísimo de llamadas rechazadas, lo que se ve directamente
reflejado por las estadísticas del método REGISTER, como así también de los mensajes \ac{sip}
\emph{401 unauthorized} y \emph{404 not found} presentes en gran número e involucrados en este proceso. 
Los cuales resultan de una gran cantidad de registros fallidos. Por su número exagerado y \mbox{contrastando}
con los \emph{logs} de Asterisk es que se acreditaron como intentos de
registro mal intencionados.}

\item{Cabe destacar que para ambos \emph{testbed} se aprecia que el
tráfico analizado según \ac{ip} de origen, tenemos un
porcentaje considerable, del 28,21\% de tafico público/externo, lo cual
refleja los ataques de enumeración y de \emph{password crack} sufridos por Asterisk.}

\item{Integrando todo el tráfico con origen o destino a direcciones \ac{ip} públicas
se destaca que Argentina y Alemania fueron los países de mayor
protagonismo. Todo el tráfico recibido de una
nacionalidad diferente a la Argentina, puede considerarse sospechoso. A su vez
será menester aclarar que si bien es 100\% objetivo el origen del tráfico, este
podría estar siendo encaminado a través de \emph{proxies} intermedios. Al utilizar
está técnica de enrutamiento es posible enmascarar el origen real del tráfico.
En tercer lugar Estados Unidos habiendo generado un tráfico también
considerable. Y por último Corea, Irlanda y Polonia con un porcentaje mucho
menor.}

\item{La efectividad que tuvo la plataforma en los entornos propuestos 
para detectar los ataques cubiertos por la misma. Principalmente, los ataques de inundación 
en un número mayor a 180.000 durante el período de exposición de seis meses. Sin descontar 
los 102 ataques de \emph{ringing} y \emph{scanning attemps}. Luego podríamos decir que los entornos no 
recibieron ataques de \ac{spit}.}

\item{Quedó en evidencia que si se expone al sistema Asterisk a la Internet pública, una de las
cosas que casi con seguridad veremos es un \emph{scan} para descubrir cuentas válidas. 
Esto quedó reflejado a través de nuestro caso de estudio, la instancia de Asterisk expuesta
reportó en sus \emph{logs} números muy significativos
de eventos: \emph{No matching peer found} y \emph{Wrong password}.
Este tipo de escaneos comienza chequeando varios nombres de
usuarios comunes, y a continuación de estos se comienza a escanear por cuentas \mbox{numeradas}. Esto muestra que
el atacante supone como patrón común dentro de los usuarios, usar el número de extensión de la \ac{pbx} como 
nombre para la cuenta \ac{sip}}.

\item{En base a la altísima cantidad
de intentos de \emph{password cracking} mediante \emph{brute force} que \emph{toll fraud} 
(fraude en tasas o tarífas telefónicas) es evidentemente el mayor riesgo para los sistemas telefónicos en términos del potencial
para costos que podrían llevar a la ruina a casi cualquier compañía. No es desconocido para los
estafadores acumular miles de dólares en llamadas robadas en el curso de unos pocos días. 
\emph{Toll fraud} no es algo nuevo, incluso ha existido antes de \ac{voip}. Sin embargo, la naturaleza permisiva
de VoIP significa que es más fácil para los fraudulentos tomar ventaja de sistemas no seguros.}

\item{Tomando como referencia todas las conclusiones antes presentadas sobre el estudio 
descriptivo estadístico de Artemisa, se hace notorio que permitiría proteger de forma más efectiva
el dominio de comunicaciones \ac{sip} si se incrementa el alcance del
\emph{honeypot} para simular el rol de un servidor de registro \ac{sip}, es decir, agregar algunos
métodos para que tenga funciones básicas de un \emph{registrar} y así lograr desviar todos los ataques
a los que la actual versión de Artemisa no se ve expuesto por su rol de \emph{back-end user-agent}.}
\end{itemize}

\clearpage

\section{Desarrollos Funcionales sobre Artemisa}
\label{desarrollos_funcionales}
%\subsection{Papers y Journals analizados}
\subsection{\ac{xmlrpc} \ac{api}}

Como el lector habrá apreciado, en primera instancia se efectuó la
implementación de Artemisa en dos \emph{testbeds}. Por un lado en el
laboratorio de redes de la \ac{ubp}, y paralelamente, en otro
punto de la ciudad de Córdoba. Se apuntó a lograr mejoras funcionales y
concluir en \mbox{configuraciones} óptimas.
Se persiguió desarrollar nuevas funcionalidades, y sus consecuentes ajustes al
código como se verá en esta sección. Fue de carácter
primordial mantener esta tendencia a lo largo del proyecto.   

Se ha desarrollado una \ac{api} implementando el módulo
\emph{SimpleXMLRPCServer} de la librería estándar de Python. Permitiendo de esta
manera crear un servidor \ac{xmlrpc}. El cual utiliza en su código fuente el
protocolo de Internet, como también el módulo de sistema \emph{socket} embebido
en la mayoría de los \ac{os}.

El módulo \emph{SimpleXMLRPCServer} provee un \emph{framework} básico para
servidores \ac{xmlrpc} escritos en Python.

Antes de detallar los parámetros que espera Artemisa en su interfaz RPC
resulta de interés presentar de manera resumida al protocolo \ac{xmlrpc}.

El mismo es la especificación y un set de implementaciones que permite a
software corriendo en diferentes \ac{os} y entornos, realizar una
llamada de procedimiento \emph{(call procedure)} a través
de Internet. 

Su procedimiento de llamada remoto \emph{(RPC - Remote Procedure Call)} usa
\ac{http} como protocolo de transporte y \ac{xml} como lenguaje de codificación. \ac{xmlrpc}
esta diseñado para ser lo más simple posible, y a su vez permitir transmitir,
procesar y devolver estructuras complejas.

Puede ser utilizado con lenguajes de programación como Perl, Java, C, C++, PHP, entre otros,
en nuestro caso Python. Sus implementaciones están disponibles para
Unix, Windows y Macintosh. \cite{kidd}

\subsubsection{Clase \ac{xmlrpc} Server}
\begin{myscriptlisting}
 \begin{verbatim}
class SimpleXMLRPCServer.SimpleXMLRPCServer
(addr[, requestHandler[,logRequests[, allow_none[, encoding[,
bind_and_activate]]]])
 \end{verbatim}
\end{myscriptlisting}

Esta clase permitirá crear una nueva instancia de servidor. También
provee métodos para el registro de funciones que podrán ser llamadas por el
protocolo \ac{xmlrpc}. El parámetro \emph{\mbox{requestHandler}} (solicitud de manejo)
debería ser un factor para las instancias de \emph{Simple\-XML\-Ser\-ver}; resulta
por defecto ser \emph{\mbox{SimpleXMLRPCRequestHandler}}. Los parámetros dirección y
\emph{request\-Handler} son pasados al \emph{SocketServer}.\emph{TCPServer} . 

\subsubsection{Clase \ac{xmlrpc} Server para manejo de solicitudes}
\begin{myscriptlisting}
 \begin{verbatim}
class SimpleXMLRPCServer.SimpleXMLRPCRequestHandler
 \end{verbatim}
\end{myscriptlisting}

Crea una nueva instancia de manejo de solicitudes. 
Este \emph{request handler} soporta solicitudes de publicación \emph{POST
request} y modifica el \emph{logging} de manera que el parámetro \emph{logRequests}
para el constructor de la clase \emph{SimpleXMLRPCServer} sea
honorado. \\\cite{python}. 

Se presenta al pie de este párrafo el código desarrollado para este trabajo
final de carrera. A fines prácticos y de simplificar su exposición se obviaran
algunas líneas de código relacionadas a importar la clase, librerías, asignación
de variables, comienzo, terminación del \ac{xmlrpc} \emph{server}. Como así también
obtención y seteo de algunas variables relacionadas al mismo. El código completo puede ser
descargado desde el repositorio de Artemisa en SourceForge
\footnote{https://sourceforge.net/p/artemisa/code/HEAD/tree/trunk/1.1/}.
 
%\include{XML-RPC}
\subsubsection{Código método XmlServer()}
\begin{myscriptlisting}
 \begin{verbatim}
     def XmlServer(self):
        """
        Creation of the XML Server
        """
        global xml_serv
        xml_serv = SimpleXMLRPCServer((self.Local_IP,
int(self.Local_xml_port)),
requestHandler=RequestHandler)
        ### Function to allow Clients (XML-RPC connections) to access XML-RPC
service methos - API Interface
        xml_serv.register_introspection_functions()
        
        print '' # necessary to correct the console for a better output
visualization
        #logger.info('XML-RPC service running...')
       
        xml_serv.register_function(self.ModifyExt,'modify_extension')
              
        def RestartArtemisa():
            f= open('/dev/stdin','w')
            f.write('restart\n')
            #self.ArtemisaRestart()
        xml_serv.register_function(RestartArtemisa,'restart')
        
        #### Run the XML-RPC_service main loop
        xml_serv.serve_forever()
\end{verbatim}
\end{myscriptlisting}
 
\subsubsection{Código método ModifyExt()}
\begin{myscriptlisting}
 \begin{verbatim}             
    def ModifyExt(self,mod,ext,user,passwd):
        """
        Modify extensions from file extensions.conf
        """
        
        config = ConfigParser.ConfigParser()
        config.read(EXTENSIONS_FILE_PATH)
        
        config1 = ConfigParser.ConfigParser()
        config1.read(SERVERS_FILE_PATH)
        
        ext_aux = []
        
        # se usara la instancia configServer de la clase ConfigParser para
        # escribir en server.conf 
        #configServer = ConfigParser.ConfigParser()
        #configServer.read(EXTENSIONS_FILE_PATH)
        
        if mod == 'add':
            if config.has_section(ext):
                logger.info ('Extension '+ext+' already exists in
extensions.conf')
                return 'Extension '+ext+' already exists'

            elif len(config.sections()) <= 7:
                
                config.add_section(ext)
                config.set(ext,'username','"'+user+'"')
                config.set(ext,'password',passwd)
                
                with open(EXTENSIONS_FILE_PATH,'wb') as configfile:
                    config.write(configfile)
                
                archi=open(EXTENSIONS_FILE_PATH,'r')
                lineS=archi.readlines()
                archi.close()

                archi=open(EXTENSIONS_FILE_PATH,'w')                
                archi.write("# Artemisa - Extensions configuration file...")
                archi.writelines(lineS)
                archi.close()
                
                logger.info ('Extension '+ext+' added in extensions.conf')
            
                if config1.has_option('myproxy','exten'):
                    b = False
                    ext_aux = config1.get('myproxy','exten').split(',')
                    for i in ext_aux:
                        if ext == i:
                            logger.info ('Extension '+ext+' already exists in
servers.conf')
                            return 'Extension '+ext+' already exists.'
                       
                        aux_str = '%s' % ','.join(map(str, ext_aux))
                        config1.set('myproxy','exten',str(aux_str)+','+ext)
                        with open(SERVERS_FILE_PATH,'wb') as configfile:
                            config1.write(configfile)
                        
                        archi=open(SERVERS_FILE_PATH,'r')
                        lineS=archi.readlines()
                        archi.close()

                        archi=open(SERVERS_FILE_PATH,'w')                
                        archi.write("# Artemisa - Servers configuration
file...")
                        archi.writelines(lineS)
                        archi.close()
                                                
                        logger.info ('Extension '+ext+' added in servers.conf')
                        return 'Extension '+ext+' added'
                       
            else:
                logger.info ('Max number of extensions registered. Run another
artemisa instance to register more extensions.')
                return 'Max number of extensions registered. Run another
artemisa instance to register more extensions.'
        elif mod == 'delete':
            if config.has_section(ext):
                config.remove_section(ext)
                with open(EXTENSIONS_FILE_PATH,'wb') as configfile:
                    config.write(configfile)
                
                archi=open(EXTENSIONS_FILE_PATH,'r')
                lineS=archi.readlines()
                archi.close()

                archi=open(EXTENSIONS_FILE_PATH,'w')                
                archi.write("# Artemisa - Extensions configuration file...")
                archi.writelines(lineS)
                archi.close()
                
                logger.info ('Extension '+ext+' deleted in extensions.conf')
                
            else:
                
                logger.info ('Extension '+ext+' does not exists in
extensions.conf')
        
            if config1.has_option('myproxy','exten'):
                b = False
                ext_aux = config1.get('myproxy','exten').split(',')
                
                #len_list_aux = len(ext_aux)
                j=0
                while j<len(ext_aux):
                    if ext ==  ext_aux[j]:
                        del(ext_aux[j])
                        #len_list_aux = len(ext_aux)
                        b = True
                    else:
                        j=j+1      
                
                aux_str = '%s' % ','.join(map(str, ext_aux))
                config1.set('myproxy','exten',aux_str)
                with open(SERVERS_FILE_PATH,'wb') as configfile:
                    config1.write(configfile)    
                   
                if not b :
                    
                    archi=open(SERVERS_FILE_PATH,'r')
                    lineS=archi.readlines()
                    archi.close()

                    archi=open(SERVERS_FILE_PATH,'w')                
                    archi.write("# Artemisa - Extensions configuration
file")
                    archi.writelines(lineS)
                    archi.close()
                    
                    logger.info ('Extension '+ext+' does not exists in
servers.conf')
                    return 'Extension '+ext+' does not exists'
                
                archi=open(SERVERS_FILE_PATH,'r')
                lineS=archi.readlines()
                archi.close()

                archi=open(SERVERS_FILE_PATH,'w')                
                archi.write("# Artemisa - Servers configuration file...")
                archi.writelines(lineS)
                archi.close()
                
                logger.info ('Extension '+ext+' deleted in servers.conf')
                return 'extension '+ext+' deleted' 
                    
            else:
                logger.info ('Extension '+ext+' does not exists.')
            
        else:
            logger.info ('wrong request please try with "add" or "delete"') 
            return 'wrong request please try with "add" or "delete"'
                              
        del config
 \end{verbatim}
\end{myscriptlisting}

\subsubsection{modify\_extension() para agregar o quitar extensiones}
\label{modify_api}
\begin{myscriptlisting}   
  \begin{verbatim}
XML-RPC_Object_instance.modify_extension('add','extension','username',
'password') 

XML-RPC_Object_instance.modify_extension('delete','extension','username',
'password') 
  \end{verbatim}
\end{myscriptlisting}
 
Se propone de modo genérico el nombre ``\ac{xmlrpc}\_Object\_instance'' como nombre
que referencia a una instancia de un constructor \ac{xmlrpc} de cualquier lenguaje
de programación como se detalló con anterioridad.
Luego \emph{modify\_extension()} se corresponde con el método declarado
en \emph{core.py} dentro del programa Artemisa. Como se puede apreciar este
método (o función) espera cuatro parámetros del tipo \emph{string}. Que están íntimamente
relacionados al registro de un nuevo usuario en las configuraciones de Asterisk. Recordar el
formato del \ac{uri} \ac{sip} {sip:user@registarIP:port}, o de forma más explícita la salida 
de pantalla de la consola de Artemisa \emph{Extension "1006" sip:user@registarIP:5060} para entender
el porque de los \mbox{parámetros} esperados por la \ac{api} que se detallan debajo.

  \begin{enumerate}
   \item \textbf{\emph{add || delete}}: es un parámetro estático y mandatorio que indicará el agregado o borrado y
posterior registro de una nueva extensión en nuestro \emph{honeypot}.
    \item \textbf{\emph{extension}}: será la extensión a registrar en la central. 
    \item \textbf{\emph{username}}: usuario para autenticación en el \emph{\ac{sip}-registrar}.
    \item \textbf{\emph{password}}: contraseña asociada a la autenticación del usuario en el \emph{\ac{sip}-registrar}. 
  \end{enumerate}

\subsubsection{restart() para reiniciar el proceso de Artemisa}

\begin{myscriptlisting}   
  \begin{verbatim}
XML-RPC_Object_instance.restart()
  \end{verbatim}
\end{myscriptlisting}
 
\emph{restart()} se corresponde con el método declarado
en \emph{core.py} dentro del programa Artemisa el cual nos permitirá
reiniciar el proceso de Artemisa. De esta manera los cambios realizados con 
XML-RPC\_Object\_instance.modify\_extension() tomarán efecto inmediato
registrando o borrando las nuevas extensiones virtuales a nuestro señuelo.

\subsection{\ac{xmlrpc} ejemplo de implementación}

A continuación se expondrá mediante un ejemplo la nueva funcionalidad
programada en Artemisa. Este caso de estudio permitirá ver más claramente el
alcance de esta nueva \emph{feature} (característica).

Consideremos el siguiente escenario presentado en la Figura~\ref{diagrama_xmlrpc}:

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig7.jpg}
\caption{Diagrama topología \ac{xmlrpc} cliente/servidor implementación.}
\label{diagrama_xmlrpc}
\end{figure}

Como fue desarrollado en la sección \ref{honeypot_artemisa} ''\emph{Honeypots} \ac{voip} específicos y Artemisa
\emph{honeypot}``, nuestra instancia de Artemisa habrá registrado las
extensiones virtuales según los valores de sus archivos de configuración en los
correspondientes emph{\ac{sip}-registrar/proxy servers}.

A partir de la nueva versión desarrollada, será posible para nuestro
administrador realizar modificaciones vía la linea de comandos \emph{\ac{cli}} de nuestro software. 
Como así también, permitir modificaciones de manera remota mediante un 
cliente \ac{xmlrpc} adaptado a sus necesidades. 

Considerando la capacidad de añadir y eliminar nuevas extensiones \ac{sip} vía
\ac{api} \emph{server}. Se plantea un escenario donde el administrador de sistemas integre
los demás componentes de su arquitectura de \ac{voip}, para incrementar los niveles
de seguridad del entorno de voz. 

En este caso mediante el uso de un aplicativo conformado por ciertos
Python scripts se integra y automatiza el registro de nuevas extensiones
virtuales en tiempo real, que resultasen sospechosas en nuestra central VoIP
(Asterisk).

\newpage

\paragraph{Ejecución de Artemisa según el escenario planteado}
\begin{myscriptlisting}   
  \begin{verbatim}
Artemisa vrepvernumber Copyright (C) 2009-2013 Mohamed Nassar, Rodrigo do Carmo,
Pablo Masri, Mauro Villarroel and Exequiel Barrirero

This program comes with ABSOLUTELY NO WARRANTY; for details type 'show
warranty'.
This is free software, and you are welcome to redistribute it under certain
conditions; type 'show license' for details.


Type 'help' for help.

19:42:46.528 os_core_unix.c !pjlib 2.0.1 for POSIX initialized
19:42:46.528 sip_endpoint.c  .Creating endpoint instance...
19:42:46.528          pjlib  .select() I/O Queue created (0x9788760)
19:42:46.528 sip_endpoint.c  .Module "mod-msg-print" registered
19:42:46.528 sip_transport.  .Transport manager created.
19:42:46.528   pjsua_core.c  .PJSUA state changed: NULL --> CREATED
SIP User-Agent  listening on: 10.10.0.250:5061
XML-RPC service listening on: 10.10.0.250:9000
Behaviour mode: active
Starting extensions registration process...
2014-03-05 19:42:46,624 Extension 1006 registration sent. Status: 100 (In
Progress)
2014-03-05 19:42:46,634 Extension 1007 registration sent. Status: 100 (In
Progress)
2014-03-05 19:42:46,638 Extension 1008 registration sent. Status: 100 (In
Progress)
2014-03-05 19:42:46,646 Extension 1009 registration sent. Status: 100 (In
Progress)
2014-03-05 19:42:46,704 Extension "1006" <sip:1006@10.10.0.245:5060> registered,
status=200 (OK)
2014-03-05 19:42:46,706 Extension "1007" <sip:1007@10.10.0.245:5060> registered,
status=200 (OK)
2014-03-05 19:42:46,713 Extension "1008" <sip:1008@10.10.0.245:5060> registered,
status=200 (OK)
2014-03-05 19:42:46,716 Extension "1009" <sip:1009@10.10.0.245:5060> registered,
status=200 (OK)
delivery> 
  \end{verbatim}
\end{myscriptlisting}

Mediante el diagrama de la Figura~\ref{diagrama_xmlrpc_ataque}, se resume un posible caso de aplicación. Se
observan en escena dos atacantes, interno y externo. Y por otro lado el
administrador de red o sistemas quien tiene la capacidad de ejecutar
comandos desde la CLI de Artemisa de manera local o mediante una conexión
remota al propio \emph{server}, vía SSH por ejemplo. O sacar provecho de la nueva
funcionalidad pudiendo ejecutar modificaciones a las configuraciones de
Artemisa antes mencionadas de forma remota con un \ac{xmlrpc} \emph{client}. Cabe aclarar
que, idealmente nuestro \ac{xmlrpc} \emph{client} será ejecutado de forma dinámica y
persistente en el mismo \emph{\ac{sip} \mbox{proxy/registrar}} (Asterisk o \ac{ser}), ya se demostrará el
por qué en el desarrollo que continúa en esta sección.

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig8.jpg}
\caption{Diagrama topología \ac{xmlrpc} cliente/servidor \emph{enumeration}/\ac{dos}.}
\label{diagrama_xmlrpc_ataque}
\end{figure} 

Para nuestro caso de estudio los usuarios maliciosos detrás de un ataque
de enumeración de extensiones y/o de un ataque de denegación de servicio. 
Cabe aclarar que los mismos son complementarios, debido que en base a los resultados de la
enumeración se podrá generar un ataque de \ac{dos} más efectivo.

La enumeración de extensiones puede favorecer al atacante
permitiéndole descubrir extensiones válidas en un sistema \ac{voip} que más
tarde podrá guiar a un \emph{(brute force attack)} sobre
las cuentas \ac{sip}. El método de enumeración de extensiones trabaja mediante
procesamiento de los errores devueltos a los \emph{(\ac{sip} request methods)}
como REGISTER, OPTIONS e INVITE. 

Mientras que, un ataque de \ac{dos} en servicios \ac{voip} puede lograr su
cometido causando
un daño intencional a la red y a la disponibilidad de sistemas \ac{voip}. Este
ataque puede ocurrir en dos niveles, ataques \ac{dos} estándar y ataques
\ac{dos} específicos para \ac{voip}. Generalmente enviaríamos altísimas cargas de
tráfico para inundar la red y consumir todos sus recursos o un protocolo
específico para saturarlo con un gran número de peticiones. 

Se tomarán como referencia la herramientas Inviteflood \&
SVWAR incluidas en \emph{Linux \mbox{Backtrack} R2 distribution}.

\begin{itemize}
\item SVWAR: es una herramienta pertenecientes a la \emph{suite} SIPVicious que
permite enumerar extensiones mediante la utilización de un rango de extensiones
o usando un archivo de diccionario. Este aplicativo soporta los tres métodos de
enumeración posibles como fueron detallados previamente, el método por defecto
para la enumeración es \mbox{REGISTER}. 

\emph{Sintaxis de utilización básica:}
\begin{myscriptlisting}   
  \begin{verbatim}
root@bt:/pentest/voip/sipvicious# ./svwar.py
Usage: svwar.py [options] target
examples:
svwar.py -e100-999 10.0.0.1
svwar.py -d dictionary.txt 10.0.0.2
  \end{verbatim}
\end{myscriptlisting}

%\hspace*{\fill} \\[.1cm]
\item Inviteflood: esta en una herramienta que puede ser utilizada para inundar un objetivo con
peticiones \ac{sip} INVITE. También se implementa para alcanzar
\ac{sip} \emph{gateways/proxies} y teléfonos \ac{sip}.

\paragraph{Inviteflood cli}
\begin{myscriptlisting}   
  \begin{verbatim}
root@bt:/pentest/voip/inviteflood# ./inviteflood
inviteflood - Version 2.0
              June 09, 2006
 Usage:
 Mandatory -
        interface (e.g. eth0)
        target user (e.g. "" or john.doe or 5000 or "1+210-555-1212")
        target domain (e.g. enterprise.com or an IPv4 address)
        IPv4 addr of flood target (ddd.ddd.ddd.ddd)
        flood stage (i.e. number of packets)
 Optional -
        -a flood tool "From:" alias (e.g. jane.doe)
        -i IPv4 source IP address [default is IP address of interface]
        -S srcPort  (0 - 65535) [default is well-known discard port 9]
        -D destPort (0 - 65535) [default is well-known SIP port 5060]
        -l lineString line used by SNOM [default is blank]
        -s sleep time btwn INVITE msgs (usec)
        -h help - print this usage
        -v verbose output mode
  \end{verbatim}
\end{myscriptlisting}

\emph{Sintaxis de utilización básica:}
\begin{myscriptlisting}   
  \begin{verbatim}
./inviteflood eth0 target_extension target_domain target_ip number_of_packets
  \end{verbatim}
\end{myscriptlisting}

\end{itemize}

Recordando los escenarios presentado en la sección \ref{imple_tetsbed_ubp}
''Implementación \emph{testbed} \ac{ubp}''. Se adjunta a continuación los output relacionados
de la consola de Backtrack para Inviteflood y SVWAR para
ser consideras como ejemplo. Cabe aclarar que se obtendrían salidas en pantalla
similares para el caso de estudio de esta unidad.\\  

Atacante interno - \ac{lan} SVWAR:
\begin{myscriptlisting}   
  \begin{verbatim}
root@bt:/pentest/voip/sipvicious# ./svwar.py -d
/root/Desktop/svwar_wordlist/extensions_list.dic ubpsipserver.myvnc.com -m
INVITE -p 5065
WARNING:TakeASip:extension '2520696194' probably exists but the response is
unexpected
WARNING:TakeASip:extension '1892677372' probably exists but the response is
unexpected
| Extension   | Authentication |
--------------------------------
| 1008        | reqauth        |
| 1009        | reqauth        |
| 1006	       | reqauth        |
| 1007        | reqauth        |
| 1004	       | reqauth        |
| 1005        | reqauth        |
| 1002        | reqauth        |
| 1003        | reqauth        |
| 1000        | reqauth        |
| 1001        | reqauth        |
| 1892677372  | weird          |
| 2520696194  | weird          |

  \end{verbatim}
\end{myscriptlisting}

Atacante externo - \ac{wan} SVWAR:
\begin{myscriptlisting}   
  \begin{verbatim}
root@bt:/pentest/voip/sipvicious# ./svwar.py -d
/root/Desktop/svwar_wordlist/extensions_list.dic ubpsipserver.myvnc.com -m
INVITE -p 5065
WARNING:TakeASip:extension '486246286' probably exists but the response is%\begin{center}
%\textbf{\large{\color[rgb]{1,0,0}{Análisis formal de attack responses -
%PENDIENTE}}} 
%end{center} 
unexpected
WARNING:TakeASip:extension '3742607132' probably exists but the response is
unexpected
| Extension   | Authentication |
--------------------------------
| 486246286   | weird          |
| 2008        | reqauth        |
| 2009	       | reqauth        |
| 2006        | reqauth        |
| 2007        | reqauth        |
| 2004        | reqauth        |
| 2005        | reqauth        |
| 2002        | reqauth        |
| 2003        | reqauth        |
| 2000        | reqauth        |
| 2001        | reqauth        |
| 3742607132  | weird          |
  \end{verbatim}
\end{myscriptlisting}

Atacante interno - \ac{lan} Inviteflood:
\begin{myscriptlisting}   
  \begin{verbatim}
root@bt:/pentest/voip/inviteflood# ./inviteflood eth0 1000
ubpsipserver.myvnc.com 20.20.0.240 5 -D 5065 

inviteflood - Version 2.0
              June 09, 2006

source IPv4 addr:port   = 20.20.0.7:9
dest   IPv4 addr:port   = 20.20.0.240:5065
targeted UA             = 1000@ubpsipserver.myvnc.com

Flooding destination with 5 packets
sent: 5s
  \end{verbatim}
\end{myscriptlisting}

Atacante externo - \ac{wan} Inviteflood:
\begin{myscriptlisting}   
  \begin{verbatim}
root@bt:/pentest/voip/inviteflood# ./inviteflood eth0 1000
ubpsipserver.myvnc.com 186.109.2.218 5 -D 5065 

inviteflood - Version 2.0
              June 09, 2006

source IPv4 addr:port   = 10.0.0.86:9
dest   IPv4 addr:port   = 186.109.2.218:5065
targeted UA             = 1000@ubpsipserver.myvnc.com

Flooding destination with 5 packets
sent: 5
  \end{verbatim}
\end{myscriptlisting}

\cite{shair}\\

%\hspace*{\fill} \\[.2cm]

Estas herramientas maliciosas alcanzarán de forma directa a nuestro
\ac{sip} \emph{registrar} sin ser advertidas por Artemisa en caso de que las
extensiones no fueran previamente cargadas en los archivos de configuración. Es
aquí cuando mediante un \ac{xmlrpc} \emph{client} que facilite la integración \ac{sip}
\emph{registrar/proxy} - \emph{honeypot} se podrá aumentar la eficacia de este sistema
de detección.

Debajo se muestra un sencillo \ac{xmlrpc} Python \emph{client} que fue desarrollado
para demostrar lo expuesto en el párrafo inmediatamente anterior. Este sencillo
programa al recibir como input un archivo de texto, en este caso el log
perteneciente a el \emph{registrar \ac{sip} Asterisk 1.6}. Exactamente
\texttt{/var/log/asterisk/messages.x} realizará una búsqueda en el mismo, de
extensiones que resultasen sospechosas. Para posteriormente registrarlas en
Artemisa en caso de un futuro ataque. Lo que resultaría en neutralizar un
próximo \ac{dos} y/o \emph{enumeration attack} con similares características. Por ejemplo
donde el atacante haga uso del mismo diccionario de extensiones para realizar
una enumeración, un intento de registro o un \ac{dos}.

%\hspace*{\fill} \\[.2cm]
El \ac{xmlrpc} \emph{client} está compuesto por dos scripts en Python:
ast\_log\_pars.py permite obtener a partir de un archivo de log de
Arterisk las extensiones que han sido alcanzadas por el usuario
malintencionado.

\paragraph{ast\_log\_pars.py}
\begin{myscriptlisting}   
  \begin{verbatim}
class AsteriskLogParser():

    def ExtLogParser(self):
    
        fileLog = open('./asterisk_logs/messages_svwar_WAN.log','r')

        ext=[]
        ext_return=[]

        line=fileLog.readline()
        while line!='':
    
            if line.find(',Extension')!=-1:
                index=line.find(',Extension')
                ext.append(line[index+11:index+15])
            
            line=fileLog.readline()
            
        # Clearing repeated entries in returned extension list
        for i in ext:
            if i not in ext_return:
                ext_return.append(i)
     
        return ext_return
  \end{verbatim}
\end{myscriptlisting}


Conjuntamente, artemisa\_XML-RPC\_client.py el cual por un lado
instancia a la clase donde se codifico el \emph{parser} de texto para obtener
las extensiones involucradas. Y por el otro, en base a estas extensiones
las pasará como parámetros a nuestro método principal para agregar
o quitar números registrados:\\

En el \ac{xmlrpc} \emph{client}
\begin{myscriptlisting}   
  \begin{verbatim}
XML-RPC\_Object\_in.modify\_extension('add','extension','username',
'password')

XML-RPC\_Object\_in.modify\_extension('delete','extension','username',
'password')

XML-RPC_Object_in.restart()
  \end{verbatim}
\end{myscriptlisting}

Finalmente llegará al \ac{xmlrpc} \emph{server}
\begin{myscriptlisting}   
  \begin{verbatim}
ModifyExt(self,mod,ext,user,passwd)

RestartArtemisa()
  \end{verbatim}
\end{myscriptlisting}

Recordar la sintaxis de la \ac{xmlrpc} \ac{api} presentada en la sección \ref{modify_api} 

\paragraph{artemisa\_XML-RPC\_client.py}
\begin{myscriptlisting}   
  \begin{verbatim}
from ast_log_pars import AsteriskLogParser 
import xmlrpclib

asteriskExt = AsteriskLogParser()
extension = asteriskExt.ExtLogParser()
print 'List of Extension to be registered based on suspisous registar logs:'
print extension 

s = xmlrpclib.ServerProxy('http://10.10.0.250:9000')

for i in extension:
    print 'Trying to modify the extension '+i
    print s.modify_extension('add',i,i,i)
    #print s.modify_extension('delete','phone_7','phone_7','1007')
    #print s.modify_extension('add','phone_8','phone_8','1008')

s.restart()
    
# Print list of available methods.
# Hope you feel confident to add new methods to XML-RPC service. 
print s.system.listMethods()
  \end{verbatim}
\end{myscriptlisting}

Será menester a la hora de realizar un Cliente \ac{xmlrpc}, tomar
en consideración todas las variables y validaciones necesarias por parte del
administrador de sistemas para evitar cualquier posible conflicto o
inconsistencia en cuanto al registro y borrado de usuarios. Como así también
cualquier tipo de configuración que sea modificada en Artemisa que pueda
impactar en el entorno de voz sobre \ac{ip}. Por lo que, el ejemplo planteado puede
ser entendido como un sencillo código cliente a modo de referencia, que para
ser utilizado en la práctica debería ser estrictamente revisado y modificado
según corresponda. En otras palabras, el administrador deberá ajustar
su scripts considerando solo ataques y extensiones sospechosas evitando
secuestrar una sesión \ac{sip} de un usuario válido.

\newpage

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig9.jpg}
\caption{Diagrama topología \ac{xmlrpc} cliente/servidor luego de su ejecución.}
\label{api_xmlrpc_execution}
\end{figure}

Como se aprecia en la Figura \ref{api_xmlrpc_execution}, se acotará nuestro ejemplo al
resultante de un ataque \ac{lan}/\ac{wan} con SVWAR/Inviteflood a las extensiones \ac{wan}
2015, 2016, 2017 y 2018. Y \ac{lan} 1020, 1021, 1022, 1023 y 1024. Se realizará el
desarrollo en detalle solo de este último, es decir en un entorno de área local.

Luego de recibir una enumeración con mensajes \ac{sip} INVITE mediante SVWAR
contra nuestro \ac{sip} \emph{registrar} Asterisk 1.6} sus
\emph{logs} acusarán el evento en \texttt{/var/log/asterisk\-/messages.x}\\

Fragmento de /var/log/asterisk/messages.x
\begin{myscriptlisting}   
  \begin{verbatim}
[Feb 13 17:09:31] VERBOSE[9054] pbx.c:     -- Executing [1020@default:1]
Verbose("SIP/ubpsipserver.myvnc.com-00000017", "1,Extension 1020") in new stack
[Feb 13 17:09:31] VERBOSE[9054] app_verbose.c:  Extension 1020
[Feb 13 17:09:31] VERBOSE[9054] pbx.c:     -- Executing [1020@default:2]
Playback("SIP/ubpsipserver.myvnc.com-00000017", "queue-thankyou") in new stack
[Feb 13 17:09:31] VERBOSE[8906] netsock.c:   == Using SIP RTP CoS mark 5
[Feb 13 17:09:31] VERBOSE[9055] pbx.c:     -- Executing [1021@default:1]
Verbose("SIP/ubpsipserver.myvnc.com-00000018", "1,Extension 1021") in new stack
[Feb 13 17:09:31] VERBOSE[9055] app_verbose.c:  Extension 1021
[Feb 13 17:09:31] VERBOSE[9055] pbx.c:     -- Executing [1021@default:2]
Playback("SIP/ubpsipserver.myvnc.com-00000018", "queue-thankyou") in new stack
[Feb 13 17:09:31] VERBOSE[8906] netsock.c:   == Using SIP RTP CoS mark 5
[Feb 13 17:09:31] VERBOSE[9056] pbx.c:     -- Executing [1022@default:1]
Wait("SIP/ubpsipserver.myvnc.com-00000019", "1") in new stack
[Feb 13 17:09:31] VERBOSE[8906] netsock.c:   == Using SIP RTP CoS mark 5
[Feb 13 17:09:31] VERBOSE[9057] pbx.c:     -- Executing [1023@default:1]
Verbose("SIP/ubpsipserver.myvnc.com-0000001a", "1,Extension 1023") in new stack
[Feb 13 17:09:31] VERBOSE[9057] app_verbose.c:  Extension 1023
[Feb 13 17:09:31] VERBOSE[9057] pbx.c:     -- Executing [1023@default:2]
Playback("SIP/ubpsipserver.myvnc.com-0000001a", "queue-thankyou") in new stack
[Feb 13 17:09:31] VERBOSE[8906] netsock.c:   == Using SIP RTP CoS mark 5
[Feb 13 17:09:31] VERBOSE[9057] pbx.c:     -- Executing [1024@default:1]
Verbose("SIP/ubpsipserver.myvnc.com-0000001a", "1,Extension 1024") in new stack
[Feb 13 17:09:31] VERBOSE[9057] app_verbose.c:  Extension 1024
[Feb 13 17:09:31] VERBOSE[9057] pbx.c:     -- Executing [1024@default:2]
Playback("SIP/ubpsipserver.myvnc.com-0000001a", "queue-thankyou") in new stack
  \end{verbatim}
\end{myscriptlisting}

Frente a esto podría ejecutarse nuestro sencillo aplicativo \ac{xml} mediante un
\emph{cron} bajo cualquier plataforma Linux de manera de obtener a partir de los \emph{logs}
de nuestro \ac{sip} \emph{registrar} las posibles extensiones utilizadas por el
atacante como objetivo. Se podría leer en tiempo real cualquier tipo de \emph{logs}
para poder realizar un ajuste más eficiente de los \emph{users} \ac{sip} logueados a la
central. Desde el punto de vista del administrador de sistemas del entorno,
podrían proponerse diferentes alternativas en base a las características de
este habiendo infinidad de posibilidades para ser mejorado.

Se expone la salida en pantalla de ejecución de nuestro Cliente \ac{xmlrpc}. Quien
luego de identificar las extensiones comprometidas intentará registrarlas
siempre y cuando no existan previamente. Y no se haya superado la capacidad de
ocho usuarios virtuales que soporta Artemisa actualmente.\\

\emph{Output} \ac{xmlrpc} \emph{client}
\begin{myscriptlisting}   
  \begin{verbatim}
List of Extension to be registered based on suspisous registar logs:
['1006', '1007', '1008', '1009', '1015','1020', '1021', '1022', '1023', '1024']
Trying to modify the extension 1006
Extension 1006 already exists
Trying to modify the extension 1007
Extension 1007 already exists
Trying to modify the extension 1008
Extension 1008 already exists
Trying to modify the extension 1009
Extension 1009 already exists
Trying to modify the extension 1020
Extension 1020 added
Trying to modify the extension 1021
Extension 1021 added
Trying to modify the extension 1022
Extension 1022 added
Trying to modify the extension 1023
Extension 1023 added
Trying to modify the extension 1024
Max number of extensions registered. Run another artemisa instance to register
more extensions.

['modify_extension', 'restart', 'system.listMethods', 'system.methodHelp',
'system.methodSignature']
  \end{verbatim}
\end{myscriptlisting}

Desde el punto de vista del servidor \ac{xmlrpc} ejecutado con el \emph{honeypot}
se aprecia claramente el mismo comportamiento:\\ 

\emph{Output} de Artemisa CLI a una \ac{xmlrpc} \emph{client request}
\begin{myscriptlisting}   
  \begin{verbatim}
2014-03-12 21:07:55,470 Extension 1006 already exists in extensions.conf
10.10.0.250 - - [12/Mar/2014 21:07:55] "POST /RPC2 HTTP/1.0" 200 -
2014-03-12 21:07:55,473 Extension 1007 already exists in extensions.conf
10.10.0.250 - - [12/Mar/2014 21:07:55] "POST /RPC2 HTTP/1.0" 200 -
2014-03-12 21:07:55,470 Extension 1008 already exists in extensions.conf
10.10.0.250 - - [12/Mar/2014 21:07:55] "POST /RPC2 HTTP/1.0" 200 -
2014-03-12 21:07:55,473 Extension 1009 already exists in extensions.conf
10.10.0.250 - - [12/Mar/2014 21:07:55] "POST /RPC2 HTTP/1.0" 200 -
2014-03-12 21:07:55,478 Extension 1020 added in extensions.conf
2014-03-12 21:07:55,479 Extension 1020 added in servers.conf
10.10.0.250 - - [12/Mar/2014 21:07:55] "POST /RPC2 HTTP/1.0" 200 -
2014-03-12 21:07:55,484 Extension 1021 added in extensions.conf
2014-03-12 21:07:55,484 Extension 1021 added in servers.conf
10.10.0.250 - - [12/Mar/2014 21:07:55] "POST /RPC2 HTTP/1.0" 200 -
2014-03-12 21:07:55,488 Extension 1022 added in extensions.conf
2014-03-12 21:07:55,489 Extension 1022 added in servers.conf
10.10.0.250 - - [12/Mar/2014 21:07:55] "POST /RPC2 HTTP/1.0" 200 -
2014-03-12 21:07:55,494 Extension 1023 added in extensions.conf
2014-03-12 21:07:55,494 Extension 1023 added in servers.conf
10.10.0.250 - - [12/Mar/2014 21:07:55] "POST /RPC2 HTTP/1.0" 200 -
2014-03-12 21:07:55,501 Max number of extensions registered. Run another
artemisa instance to register more extensions.
  \end{verbatim}
\end{myscriptlisting}

Resultando finalmente en una configuración de Artemisa en base sus
archivos \\
\texttt{artemisa\_1.1.8/conf/extension.conf} y \texttt{/../conf/servers.conf}\\

artemisa\_1.1.8/conf/extension.conf
\begin{myscriptlisting}   
  \begin{verbatim}
# Artemisa - Extensions configuration file
#
# Be careful when modifying this file!


# Here you are able to set up the extensions that shall be used by Artemisa in
the registration process. In order to use them, they must be defined in the
servers.conf file.
#
# The sections name hereunder, such as 3000 in section [3000], refers to a SIP
extension and it must be unique in this file, as well as correctly configured in
the registrar server.

[1006]
username = "1006"
password = 1006

[1007]
username = "1007"
password = 1007

[1008]
username = "1008"
password = 1008

[1009]
username = "1009"
password = 1009

[1020]
username = "1020"
password = 1020

[1021]
username = "1021"
password = 1021

[1022]
username = "1022"
password = 1022

[1023]
username = "1023"
password = 1023
  \end{verbatim}
\end{myscriptlisting}

artemisa\_1.1.8/conf/servers.conf
\begin{myscriptlisting}   
  \begin{verbatim}
# Artemisa - Servers configuration file
#
# Be careful when modifying this file!


# Here you are able to set the registrar servers configuration that Artemisa
shall use to register itself.
#
# registrar_time=
# Is the time in minutes between automatic registrations. This is performed in
order to avoid
# being disconnected from the server because of a lack of activity.
#
# nat_keepalive_interal=
# When dealing with NAT proxies, you can set a value in seconds which indicates
the time interval between keep alive messages. If zero is written, then the NAT
keep alive messages shall not be sent.
#
# exten=
# In this field you should set the extensions to be used. They must be declared
in extensions.conf.

[myproxy]
nat_keepalive_interval = 30
exten = 1006,1007,1008,1009,1020,1021,1022,1023
registrar_ip = 10.10.0.245
registrar_time = 15
registrar_port = 5060
  \end{verbatim}
\end{myscriptlisting}

Ejecución de Artemisa luego de correr el cliente \ac{xmlrpc} donde se puede ver el
registro de las nuevas extensiones sospechosas.\\

Artemisa cli output
\begin{myscriptlisting}   
  \begin{verbatim}
Artemisa vrepvernumber Copyright (C) 2009-2013 Mohamed Nassar, Rodrigo do Carmo,
Pablo Masri, Mauro Villarroel and Exequiel Barrirero

This program comes with ABSOLUTELY NO WARRANTY; for details type 'show
warranty'.
This is free software, and you are welcome to redistribute it under certain
conditions; type 'show license' for details.


Type 'help' for help.

19:42:46.528 os_core_unix.c !pjlib 2.0.1 for POSIX initialized
19:42:46.528 sip_endpoint.c  .Creating endpoint instance...
19:42:46.528          pjlib  .select() I/O Queue created (0x9788760)
19:42:46.528 sip_endpoint.c  .Module "mod-msg-print" registered
19:42:46.528 sip_transport.  .Transport manager created.
19:42:46.528   pjsua_core.c  .PJSUA state changed: NULL --> CREATED
SIP User-Agent  listening on: 10.10.0.250:5061
XML-RPC service listening on: 10.10.0.250:9000
Behaviour mode: active
Starting extensions registration process...
2014-03-05 19:42:46,624 Extension 1006 registration sent. Status: 100 (In
Progress)
2014-03-05 19:42:46,634 Extension 1007 registration sent. Status: 100 (In
Progress)
2014-03-05 19:42:46,638 Extension 1008 registration sent. Status: 100 (In
Progress)
2014-03-05 19:42:46,646 Extension 1009 registration sent. Status: 100 (In
Progress)
2014-03-05 19:42:46,624 Extension 1020 registration sent. Status: 100 (In
Progress)
2014-03-05 19:42:46,634 Extension 1021 registration sent. Status: 100 (In
Progress)
2014-03-05 19:42:46,638 Extension 1022 registration sent. Status: 100 (In
Progress)
2014-03-05 19:42:46,638 Extension 1023 registration sent. Status: 100 (In
Progress)
2014-03-05 19:42:46,704 Extension "1006" <sip:1006@10.10.0.245:5060> registered,
status=200 (OK)
2014-03-05 19:42:46,706 Extension "1007" <sip:1007@10.10.0.245:5060> registered,
status=200 (OK)
2014-03-05 19:42:46,713 Extension "1008" <sip:1008@10.10.0.245:5060> registered,
status=200 (OK)
2014-03-05 19:42:46,716 Extension "1009" <sip:1009@10.10.0.245:5060> registered,
status=200 (OK)
2014-03-05 19:42:46,704 Extension "1020" <sip:1006@10.10.0.245:5060> registered,
status=200 (OK)
2014-03-05 19:42:46,706 Extension "1021" <sip:1007@10.10.0.245:5060> registered,
status=200 (OK)
2014-03-05 19:42:46,713 Extension "1022" <sip:1008@10.10.0.245:5060> registered,
status=200 (OK)
2014-03-05 19:42:46,716 Extension "1023" <sip:1009@10.10.0.245:5060> registered,
status=200 (OK)
delivery> 
  \end{verbatim}
\end{myscriptlisting}

Luego de analizar el escenario exhibido quedan plasmadas todas las posibilidades
y ventajas que brinda una interfaz programable al \emph{honeypot} Artemisa. Una
interfaz de programación representa la capacidad de comunicación entre
componentes o entidades de software, en este caso, todos los que integran la
arquitectura de \ac{voip}-\ac{sip} (\ac{sip} \emph{phone}, \emph{proxy}, \emph{registrar},
\ac{ipbx}, \ac{ldap}, \ac{fw},\ac{sip}-\ac{pstn} GW, entre otros). 
Resultando en el incremento del nivel de
seguridad del entorno de voz sobre \ac{ip} mediante la integración de las entidades
antedichas. Como se estudió mediante un monitoreo preventivo, se toman acciones
anticipadas y se disparan en tiempo real. 

Para la cama de prueba se definió el empleo de \emph{inviteflood},
mientras la herramienta se mantenga inundando el \emph{gateway} \ac{sip} va a
prevenir a los usuarios cursar llamadas. Por ejemplo, podría inundarse el
\emph{proxy} \ac{sip} con una extensión inexistente, de esta manera de mantenerlo
ocupado al ir generando mensajes de respuesta \emph{404 not found}. Este
ataque se vería anegado al integrar nuestro \emph{registrar} para acusar todo tipo de
eventos no deseados o sospechosos.\\

Ejemplo de \emph{strings} no esperados en /var/log/asterisk/messages.x
\begin{myscriptlisting}   
  \begin{verbatim}
NOTICE.* .*: Registration from '.*' failed for '<HOST>:.*' - Wrong password
            NOTICE.* .*: Registration from '.*' failed for '<HOST>:.*' - No
matching peer found
            NOTICE.* .*: Registration from '.*' failed for '<HOST>:.*' - No
matching peer found
            NOTICE.* .*: Registration from '.*' failed for '<HOST>:.*' -
Username/auth name mismatch
            NOTICE.* .*: Registration from '.*' failed for '<HOST>:.*' - Device
does not match ACL
            NOTICE.* .*: Registration from '.*' failed for '<HOST>:.*' - Peer is
not supposed to register
            NOTICE.* .*: Registration from '.*' failed for '<HOST>:.*' - ACL
error (permit/deny)
            NOTICE.* .*: Registration from '.*' failed for '<HOST>:.*' - Device
does not match ACL
            NOTICE.* .*: Registration from '\".*\".*' failed for '<HOST>:.*' -
No matching peer found
            NOTICE.* .*: Registration from '\".*\".*' failed for '<HOST>:.*' -
Wrong password
            NOTICE.* <HOST> failed to authenticate as '.*'$
            NOTICE.* .*: No registration for peer '.*' \(from <HOST>\)
            NOTICE.* .*: Host <HOST> failed MD5 authentication for '.*' (.*)
            NOTICE.* .*: Failed to authenticate user .*@<HOST>.*
            NOTICE.* .*: <HOST> failed to authenticate as '.*'
            NOTICE.* .*: <HOST> tried  to authenticate with nonexistent user
'.*'
            VERBOSE.*SIP/<HOST>-.*Received incoming SIP connection from unknown
peer
  \end{verbatim}
\end{myscriptlisting}


De esta forma, los administradores de sistema y programadores podrán utilizar
las funcionalidades de la \ac{api} o incluso mejorar la misma para elevar las
defensas de la infraestructura \ac{sip} de una organización cuanto crean necesario.

\newpage

\subsection{Actualización de \emph{fingerprints}}
Adición de \emph{fingerprints} - SMAP: se definirá el concepto de \emph{fingerprint}
(identificador de tipo de agente) en base a Nmap (Escaner de seguridad). Nmap (Network
Mapper) es una utilidad gratuita y de código abierto para
descubrimiento de red y auditorías de seguridad informática. Muchos
administradores de sistemas y redes también lo encuentran útil para obtener
in\-ven\-ta\-rios de red, administrar tareas de actualización de servicios de manera
programada, y monitorear disponibilidad de servicios o monitorear dispositivos
de red. Nmap utiliza paquetes \ac{ip} en bruto de una manera novedosa para determinar
cuales \emph{hosts} están disponibles en la red, qué servicios (nombre y versión del
aplicativo) estos \emph{hosts} están ofreciendo, qué \ac{os} y versión de
\ac{os} éstos están ejecutando, qué tipo de corta fuegos/filtros de  paquetes están
en uso, y decenas de otras características. Fue diseñado para rápidamente poder
realizar escaneos a grandes redes de datos, a su vez funciona muy bien contra un
terminal individual. Nmap corre en todos los \ac{os} de
computadoras, paquetes binarios oficiales están disponibles para Linux, Windows,
y MAC OS X. 
Una de las características más conocidas de Nmap es la detección de
\ac{os} remota utilizando \emph{fingerprinting} (identificación de tipo de
agente). Nmap envía una serie de paquetes
\ac{tcp} y \ac{udp} al \emph{host} remoto y examina prácticamente cada bit en las respuestas a
estos. Luego de realizar decenas de pruebas tales como muestreo \ac{tcp}, \ac{isn}
\footnote{\ac{isn} (\emph{Initial Sequence Number}):
intenta determinar el patrón de generación de secuencia de los números de
secuencia iniciales de \ac{tcp} (también conocido como muestreo \ac{tcp} \ac{isn}), los
números de identificación \ac{ip} (también conocidos como muestreo IPID), y los
números de \emph{time stamp} (estampa de tiempo). La prueba es realizada
mediante el envío de seis paquetes \ac{tcp} con la bandera SYN habilitada para un
puerto \ac{tcp} abierto. \cite{eccouncil}}, soporte y
ordenamiento de opciones \ac{tcp}, muestreo de ID \ac{ip} y la verificación de tamaño de
ventana inicial. Nmap compara los resultados contra la base de datos nmap-os-db
de más de 2600 \emph{fingerprints} de \ac{os}
conocidos y presenta en pantalla los detalles del OS que coincide con  la
búsqueda comparativa. Cada \emph{fingerprint} incluye una descripción de forma textual
libre del \ac{os} en cuestión, y una clasificación que provee el
nombre del proveedor o compañía (ej.: Sun), nombre OS (ej.: Solaris), generación
o  versión del OS (ej.: 10), y tipo de dispositivo (de propósito general,
\emph{router}, \emph{switch}, consola de juegos, etc). La mayor parte de los \emph{fingerprints}
también poseen una representación de Plataforma Común de Enumeración
(\ac{cpe}), tal como
cpe:/o:linux:linux\_kernel:2.6. \cite{lyon}

Y complementariamente, recordando la descripción de SMAP presentada
en la sección \ref{scanning} caso 1, herramienta SMAP el lector ya habrá ganado el
entendimiento del concepto de \emph{fingerprint}.

Como se analizó previamente Artemisa \emph{honeypot} dispone de un archivo donde se
encuentran los \emph{fingerprints} utilizados para identificar las herramientas de
ataques contra nuestro entorno de voz sobre
\ac{ip}, más precisamente en el directorio \\
\texttt{/home/delivery/Desktop/artemisa\_1.1.8/fingerprint}. A
continuación se presentará el agregado de un nuevo \emph{fingerprint} para reconocer
la herramienta SMAP con sus aparejadas capturas. La misma se
ejecutó en un entorno de prueba simple, con la extensión virtual ''1000''
registrada en un \ac{sip} \emph{registrar} Asterisk 1.6. El ataque de prueba se ejecuto con
\emph{Backtrack Linux 5 R2}.\\

Sintaxis SMAP 0.6.0
\begin{myscriptlisting}   
  \begin{verbatim}
root@bt:/pentest/voip/smap# ./smap 

smap 0.6.0 <hs@123.org> http://www.wormulon.net/

usage: smap [ Options ] <ip | ip:port | ip/mask | host>

            -h: this help
            -d: increase debugging
            -o: enable fingerprinting
            -O: enable more verbose fingerprinting
            -l: fingerprint learning mode
            -t: TCP transport
            -u: UDP transport (default
           -P0: Treat all hosts as online - skip host discovery
     -p <port>: destination port
     -r <rate>: messages per second rate limit
   -D <domain>: SIP domain to use without leading sip:
  -w <timeout>: timeout in msec
  \end{verbatim}
\end{myscriptlisting}

Escaneo con SMAP contra Artemisa
\begin{myscriptlisting}   
  \begin{verbatim}
root@bt:/pentest/voip/smap# ./smap -o 10.10.0.250 -p 5062

smap 0.6.0 <hs@123.org> http://www.wormulon.net/

sendto: Network is unreachable
NOTICE: STUN based IP discovery failed, falling back to ioctl()
NOTICE: Could not obtain local port 5060. Scanning may be unreliable!
10.10.0.250: ICMP reachable, SIP enabled
       Guess: Cisco 79x0 series Phone (version 7.5)
  User-Agent: Twinkle/1.4.2

1 host scanned, 1 ICMP reachable, 1 SIP enabled (100.0%)
  \end{verbatim}
\end{myscriptlisting}

Correlación final Artemisa sin \emph{fingerprint} SMAP
\begin{myscriptlisting}   
  \begin{verbatim}
 **************************** Correlation *****************************
 Artemisa concludes that the arrived message is likely to be:
 
 * A scanning attempt.
 
 Executing bash ./scripts/on_scanning.sh 10.10.0.60 12345 10.10.0.60 12345 smap 
...
 * The message belongs to a ringing attack.
 
This report has been saved on file ./results/2014-05-10_1.txt
 NOTICE This report has been saved on file ./results/2014-05-10_1.html
 E-mail notification is disabled.
 Call from <sip:smap@localhost> is DISCONNCTD, last code = 406 (Not Acceptable)
 Error while closing the conferences in method on_state().
 Call from <sip:smap@localhost> is DISCONNCTD, last code = 406 (Not Acceptable)
 Error while closing the conferences in method on_state().
  \end{verbatim}
\end{myscriptlisting}

Correlación final Artemisa con \emph{fingerprint} SMAP
\begin{myscriptlisting}   
  \begin{verbatim}
 **************************** Correlation *****************************

 Artemisa concludes that the arrived message is likely to be:
 
 * The attack was created employing the tool SMAP.
 * A scanning attempt.
 
 Executing bash ./scripts/on_scanning.sh 10.10.0.60 12345 10.10.0.60 12345 smap
SMAP ...
 * The message belongs to a ringing attack.
 
This report has been saved on file ./results/2014-05-10_7.txt
 NOTICE This report has been saved on file ./results/2014-05-10_7.html
 E-mail notification is disabled.
 Call from <sip:smap@localhost> is DISCONNCTD, last code = 406 (Not Acceptable)
 Error while closing the conferences in method on_state().
 Call from <sip:smap@localhost> is DISCONNCTD, last code = 406 (Not Acceptable)
 Error while closing the conferences in method on_state().
  \end{verbatim}
\end{myscriptlisting}

Se podrá notar que el \emph{honeypot} concluye que el dominio VoIP recibió un
ataque de escaneo utilizando SMAP: \emph{``The attack was created employing the tool SMAP''}.

\subsection{Resumen de resultados}

\textbf{Sobre los desarrollos Funcionales sobre Artemisa:}

\begin{itemize}
\item{La interfaz \ac{xmlrpc} añadida al código fuente agiliza y facilita la
configuración, y permite la integración del \emph{honeypot} con otros agentes de la
red. Por su parte, a partir de la misma podrían fácilmente agregarse otros módulos para impactar
cambios en todas las configuraciones de Artemisa y no solo el agregado dinámico de extensiones 
a proteger.}

\item{A través del ejemplo de implementación \ac{xmlrpc} quedó demostrada la efectividad de Artemisa con
la nueva \ac{api} en un escenario probable de la vida real, es decir, contra un atacante externo
que hace uso de herramientas maliciosas desde la \ac{wan}. El \emph{honeypot} puede responder 
de forma dinámica y en tiempo real protegiendo las extensiones que están siendo atacadas en ese 
instante de tiempo.}
\end{itemize}

\clearpage

\section{Conclusiones}

\textbf{Sobre la evaluación de respuestas empíricas a partir de su implementación y
experimentación:}

\begin{itemize}
\item{Este \emph{honeypot} se hace fuerte en entornos de red privada, acusando en
tiempo real y con registros detallados la presencia de un atacante interno.}

\item{Una configuración en el \ac{sip} \emph{registrar} del entorno que encamine hacia
el \emph{honeypot} todo intento de comunicación contra un agente \ac{sip} que no 
pertenezca al dominio, aumenta el grado de detección de atacantes, tanto internos como
externos.}

\item{Considerar en el caso de un atacante interno, que disponer de dos instancias de Artemisa,
una con \emph{fingerprint} de un \emph{softphone} y otra de \emph{registrar} será muy ventajoso.
Ya que de esta manera podremos detectar a través de nuestros \emph{honeypots} tanto las \ac{ip} de
origen y de destino de los ataques dentro de la \ac{lan}}. 
\end{itemize}

\textbf{Sobre el estudio descriptivo estadístico de las características de Artemisa
\emph{honeypot} en entornos reales en mesa de prueba:}

\begin{itemize}
\item{Al exponer al \emph{honeypoy} a Internet se descubrió predominancia de mensajes 
\emph{500 Server Internal Error} asociado a que Artemisa solo tiene la capacidad de responder
a ciertos \ac{sip} \emph{messages} considerando que el mismo actúa como un \ac{ua} y no tiene la
capacidad de un \emph{proxy} \ac{sip} o \emph{registrar}. A pesar de esto como herramienta
de estudio sobre ataques en la red pública,  Artemisa, o mejor aún, una 
segunda instancia de Artemisa debe configurarse idealmente para que entregue como su \emph{fingerprint},
el de un \emph{proxy} \ac{sip} para disuadir al atacante.}

\item{En cuanto a la cantidad de llamadas \ac{voip} \ac{sip} total (\emph{registrars})
se validó un número importantísimo de llamadas rechazadas, lo que se ve directamente
reflejado por las estadísticas del método REGISTER, como así también de los mensajes \ac{sip}
\emph{401 unauthorized} y \emph{404 not found} presentes en gran número e involucrados en este proceso. 
Los cuales resultan de una gran cantidad de registros fallidos. Por su número exagerado y \mbox{contrastando}
con los \emph{logs} de Asterisk es que se acreditaron como intentos de
registro mal intencionados.}

\item{Integrando todo el tráfico con origen o destino a direcciones \ac{ip} públicas
se destaca que Argentina y Alemania fueron los países de mayor protagonismo. 
Todo el tráfico recibido de una nacionalidad diferente a la Argentina, puede considerarse sospechoso.
En tercer lugar Estados Unidos habiendo generado un tráfico también
considerable. Y por último Corea, Irlanda y Polonia con un porcentaje mucho
menor.}

\item{La efectividad que tuvo la plataforma en los entornos propuestos 
para detectar los ataques cubiertos por la misma. Principalmente, los ataques de inundación 
en un número mayor a 180.000 durante el período de exposición de seis meses. Sin descontar 
los 102 ataques de \emph{ringing} y \emph{scanning attemps}. Luego podríamos decir que los entornos no 
recibieron ataques de \ac{spit}.}

\item{Tomando como referencia todas las conclusiones antes presentadas sobre el estudio 
descriptivo estadístico de Artemisa, se hace notorio que permitiría proteger de forma más efectiva
el dominio de comunicaciones \ac{sip} si se incrementa el alcance del
\emph{honeypot} para simular el rol de un servidor de registro \ac{sip}, es decir, agregar algunos
métodos para que tenga funciones básicas de un \emph{registrar} y así lograr desviar todos los ataques
a los que la actual versión de Artemisa no se ve expuesto por su rol de \emph{back-end user-agent}.}
\end{itemize}

\textbf{Sobre los desarrollos Funcionales sobre Artemisa:}

\begin{itemize}
\item{La interfaz \ac{xmlrpc} añadida al código fuente agiliza y facilita la
configuración, y permite la integración del \emph{honeypot} con otros agentes de la
red. Por su parte, a partir de la misma podrían fácilmente agregarse otros módulos para impactar
cambios en todas las configuraciones de Artemisa y no solo el agregado dinámico de extensiones 
a proteger.}

\item{A través de la implementación \ac{xmlrpc} el \emph{honeypot} puede responder 
de forma dinámica y en tiempo real protegiendo las extensiones que están siendo atacadas en ese 
instante de tiempo.}
\end{itemize}

\textbf{Sobre el proyecto en general:}\\

    Este proyecto presenta una variante de prácticas de laboratorio para alumnos avanzados
de ingeniería en materias como seguridad de la información, protocolos y gestión de red.
    Por su parte, permite la integración de estas materias con otras relacionadas con redes de computadoras
y sistemas operativos. Se comenta lo anterior, ya que siguiendo las configuraciones que fueron presentadas y 
haciendo uso de los servidores, teléfonos \ac{sip} y dispositivos de red instalados para el mismo, podrán
implementarse entornos de comunicaciones seguras de voz sobre \ac{ip}. Esto posibilitaría a los alumnos estudiar el comportamiento
de dichos entornos y
protocolos, como su respuesta a una infinidad de modificaciones y pruebas.
    Si bien aquí se apuntó a la implementación y desarrollos sobre un señuelo para \ac{voip} \emph{Open Source},
utilizando las bases de este trabajo podría instalarse y poner a prueba cualquier dispositivo o \emph{soft}
\ac{voip} basado principalmente en tecnologías \ac{sip}. Los entornos virtuales pueden crearse en muy poco
tiempo y sin costo, para un gran número de servicios de red como \emph{web servers}, servidores 
\ac{dns}, proxy, \ac{nat}, \emph{web mail}, \ac{ftp}, \ac{nfs}, monitoreo 
(Nagios, Cacti, OpenNMS), \ac{vpn} aportando una gran flexibilidad al proceso de aprendizaje 
dentro del ámbito teórico práctico del futuro ingeniero.
    La \ac{ubp} ya cuenta con todo lo necesario, por lo que es posible aplicar el proyecto
en materias como las antes mencionadas para la puesta en marcha y desarrollo de aplicativos, 
entornos en mesa de prueba y configuraciones para prácticas de laboratorio. Incluso en el Anexo F 
se proponen algunos \emph{To-Do} (ha realizar) que podrían considerarse para un futuro
\ac{tfc} de la carrera de Ing. en Telecomunicaciones. La combinación con
varias materias ofrece mayor amplitud y un sin numero de posibilidades para la realización de nuevos 
casos de estudio. Todo esto contribuye con experiencia muy valiosa al perfil
profesional del egresado.

\clearpage

\bibliography{miscitas}

\chapter*{Siglas y Acr\'onimos}
\addcontentsline{toc}{chapter}{Siglas y Acr\'onimos}

\begin{acronym}

\acro{agi}[AGI]{Interfaz de Puerta de Enlace de Asterisk}
\acro{ani}[ANI]{Identificación de Número Automática}
\acro{aor}[AoR]{Registros de Direcciones}
\acro{api}[API]{Interfaz de Programación de Aplicaciones}
\acro{arp}[ARP]{Protocolo de Resolución de Direcciones}
\acro{b2bua}[B2BUA]{Agente de Usuario Espalda a Espalda}
\acro{astdb}[AstDb]{Base Datos de Asterisk}
\acro{cas}[CAS]{Señalización Asociada a Circuito}
\acro{cdn}[CDN]{Entrega de Numero Llamante}
\acro{cdr}[CDR]{Registros de Detalle de Llamadas}
\acro{cli}[CLI]{Interfaz de linea de comandos}
\acro{cpe}[CPE]{Equipamiento de Permisos de Usuario}
\acro{dhcp}[DHCP]{Protocolo de Configuración de Clientes Dinámico}
\acro{dmz}[DMZ]{Zona Desmilitarizada}
\acro{dos}[DoS]{Denegación de Servicio}
\acro{ddos}[DDoS]{Denegación de Servicio Distribuida}
\acro{dns}[DNS]{Sistema de Nombre de Dominio}
\acro{fbi}[FBI]{Oficina Federal de Investigación}
\acro{ftp}[FTP]{Protocolo de Transferencia de Archivos}
\acro{fw}[FW]{Corta Fuego}
\acro{gnu}[GNU]{GNU's Not Unix!}
\acro{gw}[GW]{Puerta de Enlace}
\acro{http}[HTTP]{Protocolo de Transferencia de Hipertexto}
\acro{iana}[IANA]{Autoridad de Asignación de Números de Internet}
\acro{icmp}[ICMP]{Protocolo de Mensajes de Control de Internet}
\acro{ip}[IP]{Protocolo de Internet}
\acro{ipbx}[IPBX]{Ramales Privados de Conmutación IP}
\acro{isn}[ISN]{Número de Secuencia Inicial}
\acro{isp}[ISP]{Proveedor de Servicios de Internet}
\acro{it}[IT]{Tecnología de la Información}
\acro{lan}[LAN]{Red de Área Local}
\acro{ldap}[LDAP]{Protocolo Ligero/Simplificado de Acceso a Directorios}
\acro{mg}[MG]{Puerta de Enlace de Medios}
\acro{mgc}[MGC]{Controlador de Puerta de Enlace de Medios}
\acro{mitm}[MITM]{Hombre en el Medio}
\acro{nat}[NAT]{Traductor de Direcciones de Red}
\acro{nfs}[NFS]{Sistema de Archivos de Red}
\acro{naptr}[NAPTR]{Autoridad Puntero de Nombramiento} 
\acro{os}[OS]{Sistema Operativo}
\acro{pbx}[PBX]{Ramales Privados de Conmutación}
\acro{pstn}[PSTN]{Red de Telefonía Pública Conmutada}
\acro{qos}[QoS]{Calidad de Servicio}
\acro{rir}[RIR]{Registros de Internet Regionales}
\acro{rtp}[RTP]{Protocolo de Transporte en Tiempo Real}
\acro{sdp}[SDP]{Protocolo de Descripción de Sesión}
\acro{ser}[SER]{SIP Express Router}
\acro{sip}[SIP]{Protocolo de Inicio de Sesión}
\acro{spit}[SPIT]{Spam sobre Telefonía IP}
\acro{stdout}[STDOUT]{Salida Estándar}
\acro{stderr}[STDERR]{Salida de Error Estándar}
\acro{tfc}[TFC]{Trabajo Final de Carrera}
\acro{tftp}[TFTP]{Protocolo de Transferencia de Archivos Trivial}
\acro{trip}[TRIP]{Telefonía ruteada sobre \ac{ip}}
\acro{tgrep}[TGREP]{Protocolo de Registro de Puerta de Enlace de Telefonía}
\acro{tcp}[TCP]{Protocolo de Control de Transporte}
\acro{ua}[UA]{Agente de Usuario}
\acro{uac}[UAC]{Agente de Usuario Cliente}
\acro{uas}[UAS]{Servidor de Agente de Usuario}
\acro{ubp}[UBP]{Universidad Blas Pascal}
\acro{udp}[UDP]{Protocolo de Datagrama de Usuario}
\acro{uri}[URI]{Identificadores de Recursos Uniformes}
\acro{vm}[VM]{Máquina Virtual}
\acro{voip}[VoIP]{Voz sobre IP}
\acro{vpn}[VPN]{Red Privada Virtual}
\acro{wan}[WAN]{Red de Area Extensa}
\acro{wlan}[WLAN]{Redes de Acceso Local Inalámbricas}
\acro{xml}[XML]{Lenguaje de Marcas Extensibles}
\acro{xmlrpc}[XML-RPC]{Llamada de procedimiento remoto de Lenguaje de Marcas Extensibles}
% Internet, honeypot,}
\end{acronym}

\chapter*{\begin{center}
\vspace*{\fill}
 {\Huge\bf Anexo A}\\ 
 \vspace*{\fill}
 \end{center}}
\addcontentsline{toc}{chapter}{Anexo A: carta de participación en foros y comunidades de seguridad
informática}
\newpage

%\subsection{Carta de participación en foros y comunidades de seguridad
%informática}
\paragraph{Carta de participación en foros y comunidades de seguridad
informática\\ \\}

La misma fue presentada en diferentes sitios entre estos:\\
http://www.comptia.org\\
http://www.dragonjar.org/\\
http://www.linkedin.com\\
http://www.hack3r.com/\\
http://www.hackthissite.org/\\
http://www.hackxcrack.es/\\
http://krebsonsecurity.com/2012/05/service-automates-boobytrapping-of-hacked-sites/\\
http://www.security-forums.com\\
http://www.segu-info.com.ar/\\
http://www.soldierx.com/\\
http://www.textfiles.com/hacking/\\
http://www.wilderssecurity.com/\\

Otros sitios:\\
http://www.livingInternet.com/i/ia\_hackers\_sites.htm\\
http://www.protectivehacks.com/hacking-sites.html\\
http://www.eh1infotech.com/hackingtopsites/\\

La misma se presenta debajo:

\emph{Dear VoIP enthusiasts and Community members,\\}

\emph{We're writing in order to invite you all to participate in a research
Open Source project, we've been working in since the beginning of this year.
This project is sponsored by the Science and Technology Government Department \&
Blas Pascal University, both organizations from Córdoba province,
Argentina.\\}

\emph{The link to the project: http://artemisa.sourceforge.net/ . Our work is
related to an Open Source honeypot, named Artemisa, for VoIP networks deploying
the \ac{sip} protocol. We'll really appreciate the participation of anyone that has
interest to play the attacker's role, if possible concentrating in the VoIP
service we are exposing. So as to let us capture relevant information related
with real attacks. As a result, we'll be able to do an analysis of the
efficiency of the platform. Furthermore, a statistical analysis, of all the
received attacks, will be performed.\\}

\emph{Target \ac{sip} extensions:\\
1) sip:ubp1@iptel.org or sip:229049@iptel.org (Public Free ext)\\
2) sip:ubp2@iptel.org or sip:229056@iptel.org (Public Free ext)\\
3) sip:2xxx@ubpsipserver.myvnc.com (\ac{ser})\\
4) sip:metropolitan1@iptel.org or sip:229061@iptel.org (Public Free ext)\\
5) sip:metropolitan2@iptel.org or sip:229063@iptel.org (Public Free ext)\\
6) sip:1xxx@asteriskserver.myvnc.com (Asterisk)\\
7) sip:2xxx@asteriskserver.myvnc.com:5061 (\ac{ser})\\
8) sip:1xxx@asterisksipserver.myvnc.com (Asterisk)\\}

\emph{We briefly give you a description of the \emph{honeypot}:\\
Artemisa is a VoIP/SIP-specific \emph{honeypot} software designed to connect to a VoIP
enterprise domain as a \emph{user-agent} \emph{back-end} in order to detect malicious activity
at an early stage. It registers multiple \ac{sip} accounts, which do not represent
real human subscribers, at one or more VoIP service providers, and wait for
incoming attacks. Besides, Artemisa can play a role in the real-time adjustment
of the security policies of the enterprise domain where it is deployed (e.g.
setting rules in a \emph{firewall} to ban IPs or in the VoIP \ac{pbx} to ban
caller-IDs).\\}

\emph{Thanks for your time, hope you'll actively participate (attack!) the \ac{sip}
extension presented above. To contact us: artemisa.notifications@gmail.com\\}

\emph{Best regards,
Exequiel Barrirero / Mauro Villarroel.-}


\chapter*{\begin{center}
\vspace*{\fill}
 {\Huge\bf Anexo B}\\ 
 \vspace*{\fill}
 \end{center}}
\addcontentsline{toc}{chapter}{Anexo B: SIP - RFC 3665}
\newpage

%\subsection{SIP - RFC: 3665 \emph{\cite[JohnstonA.,2003)]{18}}}
\paragraph{SIP - RFC 3665 \cite{johnrfc3665}}

\paragraph{Successful Session Establishment}
\begin{myscriptlisting}
\begin{verbatim}

   Alice                     Bob
     |                        |
     |       INVITE F1        |
     |----------------------->|
     |    180 Ringing F2      |
     |<-----------------------|
     |                        |
     |       200 OK F3        |
     |<-----------------------|
     |         ACK F4         |
     |----------------------->|
     |   Both Way RTP Media   |
     |<======================>|
     |                        |
     |         BYE F5         |
     |<-----------------------|
     |       200 OK F6        |
     |----------------------->|
     |                        |

   In this scenario, Alice completes a call to Bob directly.

   Message Details

   F1 INVITE Alice -> Bob

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>


   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F2 180 Ringing Bob -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=8321234356
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com;transport=tcp>
   Content-Length: 0


   F3 200 OK Bob -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=8321234356
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 ACK Alice -> Bob

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bd5
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=8321234356
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0

   /* RTP streams are established between Alice and Bob */

   /* Bob Hangs Up with Alice. Note that the CSeq is NOT 2, since
      Alice and Bob maintain their own independent CSeq counts.
      (The INVITE was request 1 generated by Alice, and the BYE is
      request 1 generated by Bob) */


   F5 BYE Bob -> Alice

   BYE sip:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
   Max-Forwards: 70
   From: Bob <sip:bob@biloxi.example.com>;tag=8321234356
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F6 200 OK Alice -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   From: Bob <sip:bob@biloxi.example.com>;tag=8321234356
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0
\end{verbatim}
\end{myscriptlisting}
\cite{johnrfc3665}

\newpage

\chapter*{\begin{center}
\vspace*{\fill}
 {\Huge\bf Anexo C}\\ 
 \vspace*{\fill}
 \end{center}}
\addcontentsline{toc}{chapter}{Anexo C: estudio descriptivo estadístico en entornos reales en
mesa de prueba}
\newpage

%\subsection{Anexo unidad estudio descriptivo estadístico en entornos reales en
%mesa de prueba (test-beds)}
\paragraph{Anexo unidad estudio descriptivo estadístico en entornos reales en
mesa de prueba (testbeds)\\ \\}

\textbf{Tablas unidad estudio descriptivo estadístico en entornos reales
en mesa de prueba (testbeds)}

\begin{table}[h!]
\caption{Cantidad de paquetes \ac{sip} total por tipo de mensaje \ac{sip}
(Artemisa).}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab6.jpg}
\end{table}

\begin{table}[h!]
\caption{Cantidad de paquetes \ac{sip} total por tipo de método \ac{sip}
(Artemisa).}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab7.jpg}
\end{table}

\begin{table}[h!]
\caption{Cantidad de llamadas \ac{voip} total (Artemisa).}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab8.jpg}
\end{table}

\clearpage

\begin{table}[h!]
\caption{Cantidad de paquetes \ac{sip} total por tipo de mensaje \ac{sip}
(\emph{registrars}).}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab8.jpg}
\end{table}

\begin{table}[h!]
\caption{Cantidad de paquetes \ac{sip} total por tipo de método \ac{sip}
(\emph{registrars}).}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab9.jpg}
\end{table}

\begin{table}[h!]
\caption{Cantidad de llamadas \ac{voip} \ac{sip} total (\emph{registrars}).}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab91.jpg}
\end{table}

\begin{table}[h!]
\caption{Cantidad de paquetes \ac{sip} total por tipo de ataque.}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab92.jpg}
\end{table}

\begin{table}[h!]
\caption{Cantidad de paquetes \ac{sip} por tipo ataque (Asterisk Metropolitan).}
\centering
\includegraphics[width=.5 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab94.jpg}
\end{table}

\clearpage
%\pagebreak

\paragraph{Tablas y gráficos Wireshark unidad estudio descriptivo
estadístico en entornos reales en mesa de prueba (\emph{testbeds})\\}

Considerar que solo se adjuntan Tablas y Figuras con diagramas topológicos para la implementación de
una de las camas de prueba a modo de referencia. En este caso del \ac{ubp} testbed,
tanto del \emph{registrar} (\ac{ser}) y de la instancia de Artemisa protegiendo el mismo.
Puede generalizarse el análisis mediante Wireshark para entender de que manera
se generaron las tablas y gráficos de la unidad de análisis estadístico.

\begin{table}[h!]
\caption{Wireshark \ac{sip} Statistics with filter (\ac{ubp} \ac{ser} Regitrar).}
\centering
\includegraphics[width=0.45 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab94a.jpg}
\end{table}

\clearpage

\begin{table}[h!]
\caption{Wireshark \ac{voip} calls (\ac{ubp} \ac{ser} \emph{registrar}).}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab94b.jpg}
\end{table}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92q.jpg}
\caption{Wireshark I/O Graph Statistics w/ \ac{sip} filters (\ac{ubp} \ac{ser} \emph{registrar}).}
\end{figure}

\begin{table}[h!]
\caption{Wireshark \ac{sip} Statistics with filter (\ac{ubp} \ac{ser} registered
Artemisa).}
\centering
\includegraphics[width=0.6 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab94c.jpg}
\end{table}

\clearpage

\begin{table}[h!]
\caption{Wireshark VoIP Calls (\ac{ubp} \ac{ser} registered Artemisa).}
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Tab94d.jpg}
\end{table}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92r.jpg}
\caption{Wireshark I/O Graph Statistics w/ \ac{sip} filters (\ac{ubp} \ac{ser}
registered Artemisa).}
\end{figure}

\begin{figure}[h!] 
\centering
\includegraphics[width=1 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Fig92s.jpg}
\caption{Wireshark I/O Graph Statistics w/ \ac{sip} filters (\ac{ubp} \ac{ser}
registered Artemisa).}
\end{figure}

\clearpage

\chapter*{\begin{center}
\vspace*{\fill}
 {\Huge\bf Anexo D}\\ 
 \vspace*{\fill}
 \end{center}}
\addcontentsline{toc}{chapter}{Anexo D: configuraciones componentes \emph{testbeds} (\emph{firewall} Iptables, Artemisa, Asterisk,
\ac{ser})}
\newpage

\paragraph{Configuraciones\\}
En el Anexo subsiguiente se presentan las configuraciones de los
componentes fundamentales implementados en los entornos de prueba en
cuestión. Las cuales son equivalentes, esto se debe a que los servicios fueron
implementados en \ac{vm} como se detalla a continuación:

\paragraph{Firewall Iptables}

\paragraph{root@firewall\# iptables-save}
\begin{myscriptlisting}
\begin{verbatim}
# Generated by iptables-save v1.4.8 on Mon Jul 30 17:25:24 2012
*nat
:PREROUTING ACCEPT [979:290313]
:POSTROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [1035:61633]
-A POSTROUTING -o eth0 -j MASQUERADE 
COMMIT
# Completed on Mon Jul 30 17:25:24 2012
# Generated by iptables-save v1.4.8 on Mon Jul 30 17:25:24 2012
*mangle
:PREROUTING ACCEPT [5728:3386520]
:INPUT ACCEPT [4774:3104304]
:FORWARD ACCEPT [30:1620]
:OUTPUT ACCEPT [5258:529761]
:POSTROUTING ACCEPT [4872:502687]
COMMIT
# Completed on Mon Jul 30 17:25:24 2012
# Generated by iptables-save v1.4.8 on Mon Jul 30 17:25:24 2012
*filter
:INPUT DROP [24:7872]
:FORWARD DROP [30:1620]
:OUTPUT DROP [0:0]
:INBOUND - [0:0]
:LOG_FILTER - [0:0]
:LSI - [0:0]
:LSO - [0:0]
:OUTBOUND - [0:0]
-A INPUT -s 10.10.0.1/32 -p tcp -m tcp ! --tcp-flags FIN,SYN,RST,ACK SYN -j
ACCEPT 
-A INPUT -s 10.10.0.1/32 -p udp -j ACCEPT 
-A INPUT -s 10.0.0.1/32 -p tcp -m tcp ! --tcp-flags FIN,SYN,RST,ACK SYN -j
ACCEPT 
-A INPUT -s 10.0.0.1/32 -p udp -j ACCEPT 
-A INPUT -i lo -j ACCEPT 
-A INPUT -p icmp -m limit --limit 10/sec -j ACCEPT 
-A INPUT -d 255.255.255.255/32 -i eth0 -j DROP 
-A INPUT -d 10.10.0.255/32 -j DROP 
-A INPUT -s 224.0.0.0/8 -j DROP 
-A INPUT -d 224.0.0.0/8 -j DROP 
-A INPUT -s 255.255.255.255/32 -j DROP 
-A INPUT -d 0.0.0.0/32 -j DROP 
-A INPUT -m state --state INVALID -j DROP 
-A INPUT -f -m limit --limit 10/min -j LSI 
-A INPUT -i eth0 -j INBOUND 
-A INPUT -d 10.10.0.254/32 -i eth0 -j INBOUND 
-A INPUT -d 10.10.0.255/32 -i eth0 -j INBOUND 
-A INPUT -d 20.20.0.254/32 -i eth1 -j INBOUND 
-A INPUT -d 10.10.0.254/32 -i eth1 -j INBOUND 
-A INPUT -d 20.20.0.255/32 -i eth1 -j INBOUND 
-A INPUT -j LOG_FILTER 
-A INPUT -j LOG --log-prefix "Unknown Input" --log-level 6 
-A FORWARD -p icmp -m limit --limit 10/sec -j ACCEPT 
-A FORWARD -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu 
-A FORWARD -i eth0 -j OUTBOUND 
-A FORWARD -i eth1 -j OUTBOUND 
-A FORWARD -d 10.10.0.0/24 -p tcp -m state --state RELATED,ESTABLISHED -j
ACCEPT 
-A FORWARD -d 10.10.0.0/24 -p udp -m state --state RELATED,ESTABLISHED -j
ACCEPT 
-A FORWARD -d 20.20.0.0/24 -p tcp -m state --state RELATED,ESTABLISHED -j
ACCEPT 
-A FORWARD -d 20.20.0.0/24 -p udp -m state --state RELATED,ESTABLISHED -j
ACCEPT 
-A FORWARD -j LOG_FILTER 
-A FORWARD -j LOG --log-prefix "Unknown Forward" --log-level 6 
-A OUTPUT -s 10.10.0.254/32 -d 10.10.0.1/32 -p tcp -m tcp --dport 53 -j ACCEPT 
-A OUTPUT -s 10.10.0.254/32 -d 10.10.0.1/32 -p udp -m udp --dport 53 -j ACCEPT 
-A OUTPUT -s 10.10.0.254/32 -d 10.0.0.1/32 -p tcp -m tcp --dport 53 -j ACCEPT 
-A OUTPUT -s 10.10.0.254/32 -d 10.0.0.1/32 -p udp -m udp --dport 53 -j ACCEPT 
-A OUTPUT -o lo -j ACCEPT 
-A OUTPUT -s 224.0.0.0/8 -j DROP 
-A OUTPUT -d 224.0.0.0/8 -j DROP 
-A OUTPUT -s 255.255.255.255/32 -j DROP 
-A OUTPUT -d 0.0.0.0/32 -j DROP 
-A OUTPUT -m state --state INVALID -j DROP 
-A OUTPUT -o eth0 -j OUTBOUND 
-A OUTPUT -o eth1 -j OUTBOUND 
-A OUTPUT -j LOG_FILTER 
-A OUTPUT -j LOG --log-prefix "Unknown Output" --log-level 6 
-A INBOUND -p tcp -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A INBOUND -p udp -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A INBOUND -s 10.10.0.0/24 -j ACCEPT 
-A INBOUND -s 20.20.0.0/24 -j ACCEPT 
-A INBOUND -p tcp -m tcp --dport 22 -j ACCEPT 
-A INBOUND -p udp -m udp --dport 22 -j ACCEPT 
-A INBOUND -p tcp -m tcp --dport 5060 -j ACCEPT 
-A INBOUND -p udp -m udp --dport 5060 -j ACCEPT 
-A INBOUND -p tcp -m tcp --dport 10001:20000 -j ACCEPT
-A INBOUND -p udp -m udp --dport 10001:20000 -j ACCEPT 
#-A INBOUND -p tcp -m tcp --dport 80 -j ACCEPT 
#-A INBOUND -p udp -m udp --dport 80 -j ACCEPT 
-A INBOUND -j LSI 
-A LSI -j LOG_FILTER 
-A LSI -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m limit --limit 1/sec -j
LOG
--log-prefix "Inbound " --log-level 6 
-A LSI -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j DROP 
-A LSI -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK RST -m limit --limit 1/sec -j
LOG
--log-prefix "Inbound " --log-level 6 
-A LSI -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK RST -j DROP 
-A LSI -p icmp -m icmp --icmp-type 8 -m limit --limit 1/sec -j LOG --log-prefix
"Inbound " --log-level 6 
-A LSI -p icmp -m icmp --icmp-type 8 -j DROP 
-A LSI -m limit --limit 5/sec -j LOG --log-prefix "Inbound " --log-level 6 
-A LSI -j DROP 
-A LSO -j LOG_FILTER 
-A LSO -m limit --limit 5/sec -j LOG --log-prefix "Outbound " --log-level 6 
-A LSO -j REJECT --reject-with icmp-port-unreachable 
-A OUTBOUND -p icmp -j ACCEPT 
-A OUTBOUND -p tcp -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A OUTBOUND -p udp -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A OUTBOUND -j ACCEPT 
COMMIT
# Completed on Mon Jul 30 17:25:24 2012
\end{verbatim}
\end{myscriptlisting}

\paragraph{root@firewall\# iptables -L}
\begin{myscriptlisting}
\begin{verbatim}
Chain INPUT (policy DROP)
target     prot opt origen               destination         
ACCEPT     tcp  --  10.10.0.1            anywhere            tcp
flags:!FIN,SYN,RST,ACK/SYN 
ACCEPT     udp  --  10.10.0.1            anywhere            
ACCEPT     tcp  --  10.0.0.1             anywhere            tcp
flags:!FIN,SYN,RST,ACK/SYN 
ACCEPT     udp  --  10.0.0.1             anywhere            
ACCEPT     all  --  anywhere             anywhere            
ACCEPT     icmp --  anywhere             anywhere            limit: avg 10/sec
burst 5 
DROP       all  --  anywhere             255.255.255.255     
DROP       all  --  anywhere             10.10.0.255         
DROP       all  --  base-address.mcast.net/8  anywhere            
DROP       all  --  anywhere             base-address.mcast.net/8 
DROP       all  --  255.255.255.255      anywhere            
DROP       all  --  anywhere             default             
DROP       all  --  anywhere             anywhere            state INVALID 
LSI        all  -f  anywhere             anywhere            limit: avg 10/min
burst 5 
INBOUND    all  --  anywhere             anywhere            
INBOUND    all  --  anywhere             10.10.0.254         
INBOUND    all  --  anywhere             10.10.0.255         
INBOUND    all  --  anywhere             20.20.0.254         
INBOUND    all  --  anywhere             10.10.0.254         
INBOUND    all  --  anywhere             20.20.0.255         
LOG_FILTER  all  --  anywhere             anywhere            
LOG        all  --  anywhere             anywhere            LOG level info
prefix
`Unknown Input' 

Chain FORWARD (policy DROP)
target     prot opt source               destination         
ACCEPT     icmp --  anywhere             anywhere            limit: avg 10/sec
burst 5 
TCPMSS     tcp  --  anywhere             anywhere            tcp
flags:SYN,RST/SYN
TCPMSS clamp to PMTU 
OUTBOUND   all  --  anywhere             anywhere            
OUTBOUND   all  --  anywhere             anywhere            
ACCEPT     tcp  --  anywhere             10.10.0.0/24        state
RELATED,ESTABLISHED 
ACCEPT     udp  --  anywhere             10.10.0.0/24        state
RELATED,ESTABLISHED 
ACCEPT     tcp  --  anywhere             20.20.0.0/24        state
RELATED,ESTABLISHED 
ACCEPT     udp  --  anywhere             20.20.0.0/24        state
RELATED,ESTABLISHED 
LOG_FILTER  all  --  anywhere             anywhere            
LOG        all  --  anywhere             anywhere            LOG level info
prefix
`Unknown Forward' 

Chain OUTPUT (policy DROP)
target     prot opt source               destination         
ACCEPT     tcp  --  10.10.0.254          10.10.0.1           tcp dpt:domain 
ACCEPT     udp  --  10.10.0.254          10.10.0.1           udp dpt:domain 
ACCEPT     tcp  --  10.10.0.254          10.0.0.1            tcp dpt:domain 
ACCEPT     udp  --  10.10.0.254          10.0.0.1            udp dpt:domain 
ACCEPT     all  --  anywhere             anywhere            
DROP       all  --  base-address.mcast.net/8  anywhere            
DROP       all  --  anywhere             base-address.mcast.net/8 
DROP       all  --  255.255.255.255      anywhere            
DROP       all  --  anywhere             default             
DROP       all  --  anywhere             anywhere            state INVALID 
OUTBOUND   all  --  anywhere             anywhere            
OUTBOUND   all  --  anywhere             anywhere            
LOG_FILTER  all  --  anywhere             anywhere            
LOG        all  --  anywhere             anywhere            LOG level info
prefix
`Unknown Output' 

Chain INBOUND (6 references)
target     prot opt source               destination         
ACCEPT     tcp  --  anywhere             anywhere            state
RELATED,ESTABLISHED 
ACCEPT     udp  --  anywhere             anywhere            state
RELATED,ESTABLISHED 
ACCEPT     all  --  10.10.0.0/24         anywhere            
ACCEPT     all  --  20.20.0.0/24         anywhere            
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:ssh 
ACCEPT     udp  --  anywhere             anywhere            udp dpt:ssh 
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:sip 
ACCEPT     udp  --  anywhere             anywhere            udp dpt:sip 
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:www 
ACCEPT     udp  --  anywhere             anywhere            udp dpt:www 
LSI        all  --  anywhere             anywhere            

Chain LOG_FILTER (5 references)
target     prot opt source               destination         

Chain LSI (2 references)
target     prot opt source               destination         
LOG_FILTER  all  --  anywhere             anywhere            
LOG        tcp  --  anywhere             anywhere            tcp
flags:FIN,SYN,RST,ACK/SYN limit: avg 1/sec burst 5 LOG level info prefix
`Inbound
' 
DROP       tcp  --  anywhere             anywhere            tcp
flags:FIN,SYN,RST,ACK/SYN 
LOG        tcp  --  anywhere             anywhere            tcp
flags:FIN,SYN,RST,ACK/RST limit: avg 1/sec burst 5 LOG level info prefix
`Inbound
' 
DROP       tcp  --  anywhere             anywhere            tcp
flags:FIN,SYN,RST,ACK/RST 
LOG        icmp --  anywhere             anywhere            icmp echo-request
limit: avg 1/sec burst 5 LOG level info prefix `Inbound ' 
DROP       icmp --  anywhere             anywhere            icmp echo-request 
LOG        all  --  anywhere             anywhere            limit: avg 5/sec
burst 5 LOG level info prefix `Inbound ' 
DROP       all  --  anywhere             anywhere            

Chain LSO (0 references)
target     prot opt source               destination         
LOG_FILTER  all  --  anywhere             anywhere            
LOG        all  --  anywhere             anywhere            limit: avg 5/sec
burst 5 LOG level info prefix `Outbound ' 
REJECT     all  --  anywhere             anywhere            reject-with
icmp-port-unreachable 

Chain OUTBOUND (4 references)
target     prot opt source               destination         
ACCEPT     icmp --  anywhere             anywhere            
ACCEPT     tcp  --  anywhere             anywhere            state
RELATED,ESTABLISHED 
ACCEPT     udp  --  anywhere             anywhere            state
RELATED,ESTABLISHED 
ACCEPT     all  --  anywhere             anywhere   
\end{verbatim}
\end{myscriptlisting}

\newpage

\paragraph{Sip Express Router (SER)}

\paragraph{ser.cfg}
\begin{myscriptlisting}
 \begin{verbatim}
  #
# $Id: ser.cfg,v 1.25.2.1 2005/02/18 14:30:44 andrei Exp $
#
# simple quick-start config script
#

# ----------- global configuration parameters ------------------------

debug=3         # debug level (cmd line: -dddddddddd)
fork=yes
log_stderror=no	# (cmd line: -E)

listen=10.10.0.240
listen=127.0.0.1

# hostname matching an alias will satisfy the condition uri==myself".
alias=ubpsipserver.myvnc.com
alias=10.10.0.240

# dns - Uses dns to check if it is necessary to add a "received=" field
# to a via. Default is no.
# rev_dns - Same as dns but use reverse DNS.

dns=no
rev_dns=no

port=5060
children=4

# check_via - Turn on or off Via host checking when forwarding replies.
# Default is no. arcane. looks for discrepancy between name and
# ip address when forwarding replies.

check_via=yes

# syn_branch - Shall the server use stateful synonym branches? It is
# faster but not reboot-safe. Default is yes.

syn_branch=yes

# memlog - Debugging level for final memory statistics report. Default
# is L_DBG -- memory statistics are dumped only if debug is set high.

memlog=3

# sip_warning - Should replies include extensive warnings? By default
# yes, it is good for trouble-shooting.

sip_warning=yes

# fifo - FIFO special file pathname

fifo="/tmp/ser_fifo"

# server_signature - Should locally-generated messages include server's
# signature? By default yes, it is good for trouble-shooting.

server_signature=yes

# reply_to_via - A hint to reply modules whether they should send reply
# to IP advertised in Via. Turned off by default, which means that
# replies are sent to IP address from which requests came.

reply_to_via=no

# ------------------ module loading ----------------------------------

# Uncomment this if you want to use SQL database
loadmodule "/usr/local/lib/ser/modules/mysql.so"

loadmodule "/usr/local/lib/ser/modules/sl.so"
loadmodule "/usr/local/lib/ser/modules/tm.so"
loadmodule "/usr/local/lib/ser/modules/rr.so"
loadmodule "/usr/local/lib/ser/modules/maxfwd.so"
loadmodule "/usr/local/lib/ser/modules/usrloc.so"
loadmodule "/usr/local/lib/ser/modules/registrar.so"
loadmodule "/usr/local/lib/ser/modules/textops.so"

# Uncomment this if you want digest authentication
# mysql.so must be loaded !
loadmodule "/usr/local/lib/ser/modules/auth.so"
loadmodule "/usr/local/lib/ser/modules/auth_db.so"

# ----------------- setting module-specific parameters ---------------

# -- usrloc params --

#modparam("usrloc", "db_mode",   0)

# Uncomment this if you want to use SQL database 
# for persistent storage and comment the previous line
modparam("usrloc", "db_mode", 2)

# -- auth params --
# Uncomment if you are using auth module
#
modparam("auth_db", "calculate_ha1", yes)
#
# If you set "calculate_ha1" parameter to yes (which true in this
config), 
# uncomment also the following parameter)
#
modparam("auth_db", "password_column", "password")

# -- rr params --
# add value to ;lr param to make some broken UAs happy
modparam("rr", "enable_full_lr", 1)

# database location
modparam("usrloc", "db_url", "mysql://ser:heslo@localhost/ser")

# ------------- auth parameters

# database location
modparam("auth_db", "db_url", "mysql://ser:heslo@localhost/ser")

# -------------------------  request routing logic -------------------

# main routing logic

route{

	# initial sanity checks -- messages with
	# max_forwards==0, or excessively long requests
	if (!mf_process_maxfwd_header("10")) {
		sl_send_reply("483","Too Many Hops");
		break;
	};
	if (msg:len >=  2048 ) {
		sl_send_reply("513", "Message too big");
		break;
	};
	

	# we record-route all messages -- to make sure that
	# subsequent messages will go through our proxy; that's
	# particularly good if upstream and downstream entities
	# use different transport protocol
	if (!method=="REGISTER") record_route();	

	# subsequent messages withing a dialog should take the
	# path determined by record-routing
	if (loose_route()) {
		# mark routing logic in request
		append_hf("P-hint: rr-enforced\r\n"); 
		route(1);
		break;
	};

	if (!uri==myself) {
		# mark routing logic in request
		append_hf("P-hint: outbound\r\n"); 
		route(1);
		break;
	};

	# if the request is for other domain use UsrLoc
	# (in case, it does not work, use the following command
	# with proper names and addresses in it)
	if (uri==myself) {

		if (method=="REGISTER") {

# Uncomment this if you want to use digest authentication
			if (!www_authorize("localhost", "subscriber")) {
				www_challenge("localhost", "0");
				break;
			};

			save("location");
			break;
		};

		lookup("aliases");
		if (!uri==myself) {
			append_hf("P-hint: outbound alias\r\n"); 
			route(1);
			break;
		};

		# native SIP destinations are handled using our USRLOC
DB
		if (!lookup("location")) {
			sl_send_reply("404", "Not Found");
			break;
		};
	};
	append_hf("P-hint: usrloc applied\r\n"); 
	route(1);
}

route[1] 
{
	# send it out now; use stateful forwarding as it works reliably
	# even for UDP2TCP
	if (!t_relay()) {
		sl_reply_error();
	};
}
 \end{verbatim}
\end{myscriptlisting}

\newpage

\paragraph{Asterisk PBX}
\paragraph{extension.conf}
\begin{myscriptlisting}
\begin{verbatim}
[globals]

[general]

autofallthrough=yes

clearglobalvars=no

[default]

exten => s,1,Verbose(1,Unrouted call handler)
exten => s,n,Answer()
exten => s,n,Wait(1)
exten => s,n,Playback(pbx-invalidpark)
include => internal
exten => s,n,WaitExten(5)                               
exten => s,n,Hangup() 

exten => i,1,Verbose(1,Unrouted call handler)
exten => i,n,Answer()
exten => i,n,Playback(pbx-invalidpark)
exten => i,n,WaitExten()
exten => i,n,Hangup() 

[internal]

exten => 1000,1,Verbose(3,Extension 1001)
exten => 1000,n,Playback(queue-thankyou)
exten => 1000,n,Dial(SIP/phone_0,20,Tt) 
exten => 1000,n,Voicemail(1001)
exten => 1000,n,Hangup()

exten => 1001,1,Verbose(1,Extension 1001)
exten => 1001,n,Playback(queue-thankyou)
exten => 1001,n,Dial(SIP/phone_1,20,Tt) 
exten => 1001,n,Voicemail(1001)
exten => 1001,n,Hangup()

exten => 1002,1,Verbose(3,Extension 1002)
exten => 1002,n,Playback(queue-thankyou)
exten => 1002,n,Dial(SIP/phone_2,20,Tt) 
exten => 1002,n,Voicemail(1002)
exten => 1002,n,Hangup()

exten => 1003,1,Verbose(3,Extension 1003)
exten => 1003,n,Wait(1) 
exten => 1003,n,Playback(queue-thankyou)
exten => 1003,n,Dial(SIP/phone_3,20,Tt) 
exten => 1003,n,Voicemail(1003)
exten => 1003,n,Hangup()

...

exten => 1015,1,Verbose(1,Extension 1015)
exten => 1015,n,Playback(queue-thankyou)
exten => 1015,n,Dial(SIP/phone_15,20,Tt) 
exten => 1015,n,Voicemail(1015)
exten => 1015,n,Hangup()

exten => echo,1,Playback(demo-echotest) 
exten => echo,n,Echo
exten => echo,n,Playback(demo-echodone)
exten => echo,n,Hangup

exten => *555,1,VoicemailMain

exten => _X.,1,Goto(default,s,1)
\end{verbatim}
\end{myscriptlisting}

\paragraph{rtp.conf}
\begin{myscriptlisting}
\begin{verbatim}
;
; RTP Configuration
;
[general]
;
; RTP start and RTP end configure start and end addresses
;
; Defaults are rtpstart=5000 and rtpend=31000
;
rtpstart=10001
rtpend=20000
;
; Whether to enable or disable UDP checksums on RTP traffic
;RTP
;rtpchecksums=no
;
; The amount of time a DTMF digit with no 'end' marker should be
; allowed to continue (in 'samples', 1/8000 of a second)
;
;dtmftimeout=3000
; rtcpinterval = 5000 	; Milliseconds between rtcp reports 
			;(min 500, max 60000, default 5000)
;
; Enable strict RTP protection. This will drop RTP packets that
; do not come from the source of the RTP stream. This option is
; disabled by default.

; strictrtp=yes 
\end{verbatim}
\end{myscriptlisting}

\paragraph{sip.conf}
\begin{myscriptlisting}
\begin{verbatim}
 [general]

context=default

allowoverlap=no

bindport=5060 

bindaddr=10.10.0.254

externip=asteriskserver.myvnc.com
;externip=asterissipkserver.myvnc.com
;externip=UBPsipserver.myvnc.com

localnet=192.168.18.0/255.255.255.0
;localnet=10.10.0.0/255.255.255.0
;localnet=172.16.0.0/255.255.255.0

srvlookup=yes ; Activates the DNS SRV Server

[phone_0]
type=friend
secret=1000
username=phone_0 
callerid=phone_0 <1000> 
qualify=no
nat=yes
context=phones
host=dynamic
careinvite=no
context=internal
mailbox=1000@default

[phone_1]
type=friend 
secret=1001
username=phone_1; suele ser el mismo que el titulo de la seccion 
callerid=phone_1 <1001> 
qualify=no
nat=yes
context=phones
host=dynamic
canreinvite=no         
context=internal  
mailbox=1001@default
 
[phone_2]
type=friend
secret=1002
username=phone_2 
callerid=phone_2 <1002> 
qualify=no
nat=yes
context=phones
host=dynamic
careinvite=no
context=internal
mailbox=1002@default

[phone_3]
type=friend
secret=1003
username=phone_3 
callerid=phone_3 <1003> 
qualify=no
nat=yes
context=phones
host=dynamic
careinvite=no
context=internal
mailbox=1003@default

...

[phone_15]
type=friend
secret=1015
username=phone_15
callerid=phone_15 <1015> 
qualify=no
nat=yes
context=phones
host=dynamic
careinvite=no
context=internal
mailbox=1015@default
\end{verbatim}
\end{myscriptlisting}

\paragraph{voicemail.conf}
\begin{myscriptlisting}
\begin{verbatim}
[general] 

attach=yes 

format=wav 

maxmessage=180 

minmessage=3 

saycid=yes 

maxlogins=3 

cidinternalcontexts=house_local,house_toll,house_admin 

[default]

1000 => 1000,Phone_0,artemisa.notifications@gmail.com
1001 => 1001,Phone_1,artemisa.notifications@gmail.com
1002 => 1002,Phone_2,artemisa.notifications@gmail.com
1003 => 1003,Phone_3,artemisa.notifications@gmail.com
1004 => 1004,Phone_4,artemisa.notifications@gmail.com
1005 => 1005,Phone_5,artemisa.notifications@gmail.com
1006 => 1006,Phone_6,artemisa.notifications@gmail.com
1007 => 1007,Phone_7,artemisa.notifications@gmail.com
1008 => 1008,Phone_8,artemisa.notifications@gmail.com
1009 => 1009,Phone_9,artemisa.notifications@gmail.com
1010 => 1010,Phone_10,artemisa.notifications@gmail.com
1011 => 1011,Phone_11,artemisa.notifications@gmail.com
1012 => 1012,Phone_12,artemisa.notifications@gmail.com
1013 => 1013,Phone_13,artemisa.notifications@gmail.com
1014 => 1014,Phone_14,artemisa.notifications@gmail.com
1015 => 1015,Phone_15,artemisa.notifications@gmail.com
\end{verbatim}
\end{myscriptlisting}

\paragraph{Asterisk CLI}
\begin{myscriptlisting}
\begin{verbatim}
debiannv*CLI> sip show settings 

Global Settings:
----------------
  UDP SIP Port:           5060
  UDP Bindaddress:        10.10.0.245
  TCP SIP Port:           Disabled
  TLS SIP Port:           Disabled
  Videosupport:           No
  Textsupport:            No
  Ignore SDP sess. ver.:  No
  AutoCreate Peer:        No
  Match Auth Username:    No
  Allow unknown access:   Yes
  Allow subscriptions:    Yes
  Allow overlap dialing:  No
  Allow promsic. redir:   No
  Enable call counters:   No
  SIP domain support:     No
  Realm. auth:            No
  Our auth realm          asterisk
  Call to non-local dom.: Yes
  URI user is phone no:   No
  Always auth rejects:    No
  Direct RTP setup:       No
  User Agent:             Asterisk PBX 1.6.2.9-2+squeeze5
  SDP Session Name:       Asterisk PBX 1.6.2.9-2+squeeze5
  SDP Owner Name:         root
  Reg. context:           (not set)
  Regexten on Qualify:    No
  Caller ID:              asterisk
  From: Domain:           
  Record SIP history:     Off
  Call Events:            Off
  Auth. Failure Events:   Off
  T.38 support:           No
  T.38 EC mode:           Unknown
  T.38 MaxDtgrm:          -1
  SIP realtime:           Disabled
  Qualify Freq :          60000 ms

Network QoS Settings:
---------------------------
  IP ToS SIP:             CS0
  IP ToS RTP audio:       CS0
  IP ToS RTP video:       CS0
  IP ToS RTP text:        CS0
  802.1p CoS SIP:         4
  802.1p CoS RTP audio:   5
  802.1p CoS RTP video:   6
  802.1p CoS RTP text:    5
  Jitterbuffer enabled:   No
  Jitterbuffer forced:    No
  Jitterbuffer max size:  -1
  Jitterbuffer resync:    -1
  Jitterbuffer impl:      
  Jitterbuffer log:       No

Network Settings:
---------------------------
  SIP address remapping:  Disabled, externip is 0.0.0.0
  Externhost:             <none>
  Externip:               0.0.0.0:5060
  Externrefresh:          10
  Internal IP:            10.10.0.245:5060
  Localnet:               10.10.0.0/255.255.255.0
  STUN server:            0.0.0.0:0

Global Signalling Settings:
---------------------------
  Codecs:                 0x8000e (gsm|ulaw|alaw|h263)
  Codec Order:            none
  Relax DTMF:             No
  RFC2833 Compensation:   No
  Compact SIP headers:    No
  RTP Keepalive:          0 (Disabled)
  RTP Timeout:            0 (Disabled)
  RTP Hold Timeout:       0 (Disabled)
  MWI NOTIFY mime type:   application/simple-message-summary
  DNS SRV lookup:         Yes
  Pedantic SIP support:   No
  Reg. min duration       60 secs
  Reg. max duration:      3600 secs
  Reg. default duration:  120 secs
  Outbound reg. timeout:  20 secs
  Outbound reg. attempts: 0
  Notify ringing state:   Yes
    Include CID:          No
  Notify hold state:      No
  SIP Transfer mode:      open
  Max Call Bitrate:       384 kbps
  Auto-Framing:           No
  Outb. proxy:            <not set> 
  Session Timers:         Accept
  Session Refresher:      uas
  Session Expires:        1800 secs
  Session Min-SE:         90 secs
  Timer T1:               500
  Timer T1 minimum:       100
  Timer B:                32000
  No premature media:     Yes

Default Settings:
-----------------
  Allowed transports:     UDP
  Outbound transport:	  UDP
  Context:                default
  Nat:                    Always
  DTMF:                   rfc2833
  Qualify:                0
  Use ClientCode:         No
  Progress inband:        Never
  Language:               
  MOH Interpret:          default
  MOH Suggest:            
  Voice Mail Extension:   asterisk

----

\end{verbatim}
\end{myscriptlisting}

\newpage

\paragraph{Artemisa honeypot}
\paragraph{Librerías y Dependencias\\ \\}

Se pueden encontrar las librerías mandatorias en la documentación oficial del aplicativo artemisa \cite{docarmom}.
Debajo se detallan todas las utilizadas en la distribución de Linux Debian aplicadas para el \ac{tfc}.
Recordar que estas son fundamentales para poder ejecutar Artemisa con todas sus funciones. Como por 
ejemplo para que detecte la \emph{sound card} en Artemisa y puede reproducir audio al responder una 
\emph{call}.

\begin{myscriptlisting}
 \begin{verbatim}
 delivery@debianDUH:~$ dpkg -l | egrep -i
'alsa|dnsutils|gcc|jwhois|make|nmap|pjlib|pjsip|python|ssl|tcpdump|twinkle' |
grep
-v grep
ii  alsa-base                            1.0.23+dfsg-2                  ALSA
driver configuration files
ii  alsa-oss                             1.0.17-4                       ALSA
wrapper for OSS applications
ii  alsa-utils                           1.0.23-3                      
Utilities
for configuring and using ALSA
ii  dnsutils                             1:9.7.3.dfsg-1~squeeze5        Clients
provided with BIND
ii  gcc                                  4:4.4.5-1                      The GNU
C
compiler
ii  gcc-4.3                              4.3.5-4                        The GNU
C
compiler
ii  gcc-4.3-base                         4.3.5-4                        The GNU
Compiler Collection (base package)
ii  gcc-4.4                              4.4.5-8                        The GNU
C
compiler
ii  gcc-4.4-base                         4.4.5-8                        The GNU
Compiler Collection (base package)
ii  gstreamer0.10-alsa                   0.10.30-1                     
GStreamer
plugin for ALSA
ii  jwhois                               4.0-1                          Improved
Caching Whois client
ii  libasound2                           1.0.23-2.1                     shared
library for ALSA applications
ii  libcurl3                             7.21.0-2.1+squeeze2           
Multi-protocol file transfer library (OpenSSL)
ii  libflac8                             1.2.1-2+b1                     Free
Lossless Audio Codec - runtime C library
ii  libgcc1                              1:4.4.5-8                      GCC
support library
ii  libgomp1                             4.4.5-8                        GCC
OpenMP
(GOMP) support library
ii  libpython2.6                         2.6.6-8+b1                     Shared
Python runtime library (version 2.6)
ii  libsdl1.2debian-alsa                 1.2.14-6.1                     Simple
DirectMedia Layer (with X11 and ALSA options)
ii  libssl-dev                           0.9.8o-4squeeze13              SSL
development libraries, header files and documentation
ii  libssl0.9.8                          0.9.8o-4squeeze13              SSL
shared
libraries
ii  libwavpack1                          4.60.1-1                       an audio
codec (lossy and lossless) - library
ii  linux-sound-base                     1.0.23+dfsg-2                  base
package for ALSA and OSS sound systems
ii  make                                 3.81-8                         An
utility
for Directing compilation.
ii  nmap                                 5.00-3                         The
Network Mapper
ii  openssl                              0.9.8o-4squeeze13              Secure
Socket Layer (SSL) binary and related cryptographic tools
ii  python                               2.6.6-3+squeeze7              
interactive high-level object-oriented language (default version)
ii  python-all                           2.6.6-3+squeeze7               package
depending on all supported Python runtime versions
ii  python-all-dev                       2.6.6-3+squeeze7               package
depending on all supported Python development packages
ii  python-apt                           0.7.100.1+squeeze1             Python
interface to libapt-pkg
ii  python-apt-common                    0.7.100.1+squeeze1             Python
interface to libapt-pkg (locales)
ii  python-cairo                         1.8.8-1+b1                     Python
bindings for the Cairo vector graphics library
ii  python-central                       0.6.16+nmu1                    register
and build utility for Python packages
ii  python-dbus                          0.83.1-1                       simple
interprocess messaging system (Python interface)
ii  python-dev                           2.6.6-3+squeeze7               header
files and a static library for Python (default)
ii  python-gconf                         2.28.1-1                       Python
bindings for the GConf configuration database system
ii  python-glade2                        2.17.0-4                       GTK+
bindings: Glade support
ii  python-gmenu                         2.30.3-1                       an
implementation of the freedesktop menu specification for GNOME
ii  python-gnome2                        2.28.1-1                       Python
bindings for the GNOME desktop environment
ii  python-gobject                       2.21.4+is.2.21.3-1             Python
bindings for the GObject library
ii  python-gtk2                          2.17.0-4                       Python
bindings for the GTK+ widget set
ii  python-gtksourceview2                2.10.1-1                       Python
bindings for the GtkSourceView widget
ii  python-libxml2                       2.7.8.dfsg-2+squeeze4          Python
bindings for the GNOME XML library
ii  python-minimal                       2.6.6-3+squeeze7               minimal
subset of the Python language (default version)
ii  python-notify                        0.1.1-2+b2                     Python
bindings for libnotify
ii  python-numpy                         1:1.4.1-5                     
Numerical
Python adds a fast array facility to the Python language
ii  python-pyorbit                       2.24.0-6                       A Python
language binding for the ORBit2 CORBA implementation
ii  python-reportbug                     4.12.6                         Python
modules for interacting with bug tracking systems
ii  python-support                       1.0.10                        
automated
rebuilding support for Python modules
ii  python-vte                           1:0.24.3-3                     Python
bindings for the VTE widget set
ii  python2.5                            2.5.5-11                       An
interactive high-level object-oriented language (version 2.5)
ii  python2.5-dev                        2.5.5-11                       Header
files and a static library for Python (v2.5)
ii  python2.5-minimal                    2.5.5-11                       A
minimal
subset of the Python language (version 2.5)
ii  python2.6                            2.6.6-8+b1                     An
interactive high-level object-oriented language (version 2.6)
ii  python2.6-dev                        2.6.6-8+b1                     Header
files and a static library for Python (v2.6)
ii  python2.6-minimal                    2.6.6-8+b1                     A
minimal
subset of the Python language (version 2.6)
ii  ssl-cert                             1.0.28                         simple
debconf wrapper for OpenSSL
ii  tcpdump                              4.1.1-1                        A
powerful
tool for network monitoring and data acquisition
 \end{verbatim}
\end{myscriptlisting}

\paragraph{actions.conf}
\begin{myscriptlisting}
 \begin{verbatim}
  # Artemisa - Configuration file for the actions of the scripts
#
# Be careful when modifying this file! 

# In this configuration file you can define the parameters used when
calling the user-configurable
# scripts such as "on_flood.sh".
# Use a blank space to separate the parameters.

# List of available parameters to insert in each section:
#
# $From_Extension$
# $From_IP$
# $From_Port$
# $From_Transport$
# $Contact_IP$
# $Contact_Port$
# $Contact_Transport$
# $Connection_IP$
# $Owner_IP$
# $Via_IP$ This is the first Via detected
# $Via_Port$
# $Tool_name$
#
# You can put your own parameters also. For example:
# on_flood=$From_IP$ DROP
# This will make that Artemisa run the command:
# bash ./scripts/on_flood.sh xxx.xxx.xxx.xxx DROP 
# where xxx.xxx.xxx.xxx is the replaced variable $From_IP$

# [actions]
# on_flood contains the parameters to be sent when calling the file
on_flood.sh
# on_spit contains the parameters to be sent when calling the file
on_spit.sh
# on_scanning contains the parameters to be sent when calling the file
on_scanning.sh

[actions]
on_flood=$Contact_IP$ $Contact_Port$ $From_Extension$ $Tool_name$
on_spit=$From_IP$ $From_Port$ $From_Extension$ $Owner_IP$ $Tool_name$
on_scanning=$Contact_IP$ $Contact_Port$ $Via_IP$ $Via_Port$
$From_Extension$ $Tool_name$
 \end{verbatim}
\end{myscriptlisting}

\paragraph{artemisa.conf}
\begin{myscriptlisting}
 \begin{verbatim}
  # Artemisa - Main configuration file
#
# Be careful when modifying this file! 


# [environment]
#
# behaviour_mode=
# There are three available values for behaviour_mode: active, passive
and aggressive. 
#     active: messages are analyzed.
#     passive: messages are not analyzed.
#     aggressive: messages are analyzed and Artemisa tries to
counter-attack the caller.
#
# These modes are defined in file behaviour.conf.
# The call is answered in all cases and the messages are also logged.
#
# max_calls=
# Number of calls that Artemisa can handle at the same time. Use this
number to prevent flooding.
#
# playfile=
# Name of the WAV file that will be played after sending an 200 OK to
the caller. The file
# is searched into the ./audiofiles directory. The format must be
uncompressed 16 bit PCM 
# or compressed G.711 A-law/U-law.

[environment]
local_ip=10.10.0.250
local_port=5060
sip_domain=10.10.0.240
user_agent=Twinkle/1.4.2
playfile=/sample.wav

behaviour_mode=active

max_calls=3
#fingerprint_mode=passive         NOT YET IMPLEMENTED


# [sound]
# In this section some sound parameters can be configured. Please, do
not simply modify it unless
# you have troubles with the sound recording process. 
#
# enabled=
# If it contains 'false' the media shall not be recorded.
#
# device=
# Index of the sound device to be used. DO NOT simply modify this line
unless you are sure of what you are changing. In order to get a list of
the available sound devices run Artemisa with command-line parameter
'-g'. 

[sound]
enabled=true
device=0
rate=44100


# [email]
# In this section you can configure the e-mail account that Artemisa
shall use to report detections. 

[email]
# If enabled is set to 'false', no e-mail shall be sent. 
enabled=true
smtp_server_ip=smtp.gmail.com
smtp_server_port=587
smtp_server_use_tsl_ssl=true
smtp_server_username=artemisa.notifications@gmail.com
smtp_server_password=********
from_mail=artemisa.notifications@gmail.com

# Here you can add more than one recipient address.
# Example: recipients_mail=john@admin.yourcompany.com,
mike@admin.yourcompany.com
# The e-mails shall be delivered as BCC to each one. 

recipients_mail=artemisa.notifications@gmail.com
to_header="Administrator"
subject="Artemisa's report of activity 2xxx@ubpsipserver.myvnc.com
[2000-2007]"
 \end{verbatim}
\end{myscriptlisting}

\paragraph{behaviour.conf}
\begin{myscriptlisting}
 \begin{verbatim}
  # Artemisa - Program behaviour modes configuration file
#
# Be careful when modifying this file! 

# In this file you can define each behaviour mode.

# List of available commands to insert in each section:
#
# NOT YET IMPLEMENTED!

[passive]
send_180
send_200

[active]
send_180
send_200

[aggressive]

 \end{verbatim}
\end{myscriptlisting}

\paragraph{extensions.conf}
\begin{myscriptlisting}
 \begin{verbatim}
  # Artemisa - Extensions configuration file
#
# Be careful when modifying this file! 


# Here you are able to set up the extensions that shall be used by
Artemisa in the registration process. In order to use them, they must be
defined in the servers.conf file.
#
# The sections name hereunder, such as 3000 in section [3000], refers to
a SIP extension and it must be unique in this file, as well as correctly
configured in the registrar \emph{server}.

[1000]
username="1000"
password=1000

[1001]
username="1001"
password=1001

[1002]
username="1002"
password=1002

[1003]
username="1003"
password=1003

...

[1007]
username="1007"
password=1007
 \end{verbatim}
\end{myscriptlisting}

\paragraph{servers.conf}
\begin{myscriptlisting}
 \begin{verbatim}
  # Artemisa - Servers configuration file
#
# Be careful when modifying this file! 


# Here you are able to set the registrar servers configuration that
Artemisa shall use to register itself.
#
# registrar_time=
# Is the time in minutes between automatic registrations. This is
performed in order to avoid
# being disconnected from the \emph{server} because of a lack of activity.
#
# nat_keepalive_interal=
# When dealing with NAT proxies, you can set a value in seconds which
indicates the time interval between keep alive messages. If zero is
written, then the NAT keep alive messages shall not be sent.
#
# exten=
# In this field you should set the extensions to be used. They must be
declared in extensions.conf.

[myproxy]
registrar_ip=10.10.0.240
registrar_port=5060
registrar_time=15
nat_keepalive_interval=30
exten=1000,1001,1002,1003,1004,1005,1006,1007
 \end{verbatim}
\end{myscriptlisting}

\chapter*{\begin{center}
\vspace*{\fill}
 {\Huge\bf Anexo E}\\ 
 \vspace*{\fill}
 \end{center}}
\addcontentsline{toc}{chapter}{Anexo E: Artemisa full output ataque SMAP}
\newpage

\paragraph{\label{Anexo_Artemisa_full_output} Informe generado por Artemisa honeypot para el ataque con SMAP a su dirección
\ac{dos}}
\begin{mytinylisting}
 \begin{verbatim}
2012-07-11 18:02:37,496 Audio device not found. Calls will not be recorded.
2012-07-11 18:02:37,498 Extension phone_0 registration sent. Status: 100 (In Progress)
2012-07-11 18:02:37,499 Extension phone_1 registration sent. Status: 100 (In Progress)
2012-07-11 18:02:37,500 Extension phone_7 registration sent. Status: 100 (In Progress)
2012-07-11 18:02:37,502 Extension phone_8 registration sent. Status: 100 (In Progress)
2012-07-11 18:02:37,503 Extension phone_9 registration sent. Status: 100 (In Progress)
2012-07-11 18:02:37,604 Extension "phone_0" <sip:phone_0@10.10.0.240:5060> registered, status=200 (OK)
2012-07-11 18:02:37,605 Extension "phone_1" <sip:phone_1@10.10.0.240:5060> registered, status=200 (OK)
2012-07-11 18:02:37,656 Extension "phone_7" <sip:phone_7@10.10.0.240:5060> registered, status=200 (OK)
2012-07-11 18:02:37,657 Extension "phone_8" <sip:phone_8@10.10.0.240:5060> registered, status=200 (OK)
2012-07-11 18:02:37,658 Extension "phone_9" <sip:phone_9@10.10.0.240:5060> registered, status=200 (OK)
2012-07-11 18:02:43,186 OPTIONS message detected in extension smap from 201.252.57.89:12345
2012-07-11 18:02:44,157 OPTIONS message detected in extension  from 201.252.57.89:12345
2012-07-11 18:02:47,172 INVITE message detected.
2012-07-11 18:02:47,172 Waiting for SIP messages (5)...
2012-07-11 18:02:47,174 Incoming call from <sip:smap@localhost>
2012-07-11 18:02:47,175 Call from <sip:smap@localhost> is EARLY, last code = 180 (Ringing)
2012-07-11 18:02:47,176 Call from <sip:smap@localhost> is CONNECTING, last code = 200 (OK)
2012-07-11 18:02:48,174 Waiting for SIP messages (4)...
2012-07-11 18:02:49,172 INVITE message detected.
2012-07-11 18:02:49,172 Waiting for SIP messages (5)...
2012-07-11 18:02:49,174 Incoming call from <sip:smap@localhost>
2012-07-11 18:02:49,175 Call from <sip:smap@localhost> is EARLY, last code = 180 (Ringing)
2012-07-11 18:02:49,175 Waiting for SIP messages (3)...
2012-07-11 18:02:49,176 Call from <sip:smap@localhost> is CONNECTING, last code = 200 (OK)
2012-07-11 18:02:50,173 Waiting for SIP messages (4)...
2012-07-11 18:02:50,176 Waiting for SIP messages (2)...
2012-07-11 18:02:51,175 Waiting for SIP messages (3)...
2012-07-11 18:02:51,178 Waiting for SIP messages (1)...
2012-07-11 18:02:52,176 Waiting for SIP messages (2)...
2012-07-11 18:02:52,179 
2012-07-11 18:02:52,179 ******************************* Information about the call *******************************
2012-07-11 18:02:52,179 
2012-07-11 18:02:52,179 From: smap in localhost:12345/udp
2012-07-11 18:02:52,179 To: smap in localhost
2012-07-11 18:02:52,179 Contact: smap in 201.252.57.89:12345/udp
2012-07-11 18:02:52,180 Connection: 
2012-07-11 18:02:52,180 Owner: 
2012-07-11 18:02:52,180 Via 0: 201.252.57.89:12345/udp
2012-07-11 18:02:52,180 User-Agent: smap 0.6.0
2012-07-11 18:02:52,180 
2012-07-11 18:02:52,180 ************************************* Classification *************************************
2012-07-11 18:02:52,180 
2012-07-11 18:02:52,180 + Checking fingerprint...
2012-07-11 18:02:52,181 |
2012-07-11 18:02:52,181 | User-Agent: smap 0.6.0
2012-07-11 18:02:52,193 |
2012-07-11 18:02:52,193 | No fingerprint found.
2012-07-11 18:02:52,193 
2012-07-11 18:02:52,193 + Checking DNS...
2012-07-11 18:02:52,193 |
2012-07-11 18:02:52,193 | + Checking localhost...
2012-07-11 18:02:52,194 | |
2012-07-11 18:02:52,235 | | IP resolved: 127.0.0.1
2012-07-11 18:02:52,235 | | WHOIS data found.
2012-07-11 18:02:52,235 | |
2012-07-11 18:02:52,235 | | Category: Interactive attack
2012-07-11 18:02:52,235 |
2012-07-11 18:02:52,236 | + Checking 201.252.57.89...
2012-07-11 18:02:52,236 | |
2012-07-11 18:02:52,236 | | This is already an IP address. Nothing done.
2012-07-11 18:02:52,236 |
2012-07-11 18:02:52,236 | + Checking ...
2012-07-11 18:02:52,236 | |
2012-07-11 18:02:52,236 | | IP cannot be resolved.
2012-07-11 18:02:52,236 | |
2012-07-11 18:02:52,237 | | Category: Spoofed message
2012-07-11 18:02:52,237 
2012-07-11 18:02:52,237 + Checking if SIP port is opened...
2012-07-11 18:02:52,237 |
2012-07-11 18:02:52,237 | + Checking 201.252.57.89:12345/udp...
2012-07-11 18:02:52,237 | |
2012-07-11 18:02:52,528 | | Port state: closed
2012-07-11 18:02:52,528 | |
2012-07-11 18:02:52,528 | | Category: Spoofed message
2012-07-11 18:02:52,528 
2012-07-11 18:02:52,528 + Checking if media port is opened...
2012-07-11 18:02:52,528 |
2012-07-11 18:02:52,528 | No RTP info delivered.
2012-07-11 18:02:52,529 |
2012-07-11 18:02:52,529 | Category: Spoofed message
2012-07-11 18:02:52,529 
2012-07-11 18:02:52,529 + Checking request URI...
2012-07-11 18:02:52,529 |
2012-07-11 18:02:52,529 | Extension in field To: smap
2012-07-11 18:02:52,529 |
2012-07-11 18:02:52,529 | Request addressed to the honeypot? No
2012-07-11 18:02:52,530 
2012-07-11 18:02:52,530 + Checking if proxy in Via...
2012-07-11 18:02:52,530 |
2012-07-11 18:02:52,530 | + Checking 201.252.57.89:12345/udp...
2012-07-11 18:02:52,530 | |
2012-07-11 18:02:52,703 | | Result: There is no SIP proxy
2012-07-11 18:02:52,704 | |
2012-07-11 18:02:52,704 | | Category: Dial plan fault
2012-07-11 18:02:52,704 
2012-07-11 18:02:52,704 + Checking for ACK...
2012-07-11 18:02:52,704 |
2012-07-11 18:02:52,704 | ACK received: No
2012-07-11 18:02:52,704 |
2012-07-11 18:02:52,704 | Category: Scanning
2012-07-11 18:02:52,705 
2012-07-11 18:02:52,705 + Checking for received media...
2012-07-11 18:02:52,705 |
2012-07-11 18:02:52,705 | Media received: No
2012-07-11 18:02:52,705 |
2012-07-11 18:02:52,705 | Category: Ringing
2012-07-11 18:02:52,705 
2012-07-11 18:02:52,705 + The message is classified as:
2012-07-11 18:02:52,705 | Interactive attack
2012-07-11 18:02:52,706 | Spoofed message
2012-07-11 18:02:52,706 | Dial plan fault
2012-07-11 18:02:52,706 | Scanning
2012-07-11 18:02:52,706 | Ringing
2012-07-11 18:02:52,706 
2012-07-11 18:02:52,706 ************************************** Correlation ***************************************
2012-07-11 18:02:52,706 
2012-07-11 18:02:52,706 Artemisa concludes that the arrived message is likely to be:
2012-07-11 18:02:52,707 
2012-07-11 18:02:52,708 * A scanning attempt.
2012-07-11 18:02:52,708 
2012-07-11 18:02:52,708 Executing bash ./scripts/on_scanning.sh 201.252.57.89 12345 201.252.57.89 12345 smap  ...
2012-07-11 18:02:52,710 * The message belongs to a ringing attack.
2012-07-11 18:02:52,711 
2012-07-11 18:02:52,711 This report has been saved on file ./results/2012-07-11_5.txt
2012-07-11 18:02:52,711 NOTICE This report has been saved on file ./results/2012-07-11_5.html
2012-07-11 18:02:52,711 Sending this report by e-mail...
2012-07-11 18:02:53,177 Waiting for SIP messages (1)...
2012-07-11 18:02:54,179 
2012-07-11 18:02:54,179 ******************************* Information about the call *******************************
2012-07-11 18:02:54,179 
2012-07-11 18:02:54,179 From: smap in localhost:12345/udp
2012-07-11 18:02:54,179 To: smap in localhost
2012-07-11 18:02:54,179 Contact: smap in 201.252.57.89:12345/udp
2012-07-11 18:02:54,179 Connection: 
2012-07-11 18:02:54,179 Owner: 
2012-07-11 18:02:54,180 Via 0: 201.252.57.89:12345/udp
2012-07-11 18:02:54,180 User-Agent: smap 0.6.0
2012-07-11 18:02:54,180 
2012-07-11 18:02:54,180 ************************************* Classification *************************************
2012-07-11 18:02:54,180 
2012-07-11 18:02:54,180 + Checking fingerprint...
2012-07-11 18:02:54,180 |
2012-07-11 18:02:54,180 | User-Agent: smap 0.6.0
2012-07-11 18:02:54,194 |
2012-07-11 18:02:54,194 | No fingerprint found.
2012-07-11 18:02:54,194 
2012-07-11 18:02:54,194 + Checking DNS...
2012-07-11 18:02:54,194 |
2012-07-11 18:02:54,194 | + Checking localhost...
2012-07-11 18:02:54,194 | |
2012-07-11 18:02:54,226 | | IP resolved: 127.0.0.1
2012-07-11 18:02:54,226 | | WHOIS data found.
2012-07-11 18:02:54,226 | |
2012-07-11 18:02:54,226 | | Category: Interactive attack
2012-07-11 18:02:54,226 |
2012-07-11 18:02:54,227 | + Checking 201.252.57.89...
2012-07-11 18:02:54,227 | |
2012-07-11 18:02:54,227 | | This is already an IP address. Nothing done.
2012-07-11 18:02:54,227 |
2012-07-11 18:02:54,227 | + Checking ...
2012-07-11 18:02:54,227 | |
2012-07-11 18:02:54,227 | | IP cannot be resolved.
2012-07-11 18:02:54,227 | |
2012-07-11 18:02:54,228 | | Category: Spoofed message
2012-07-11 18:02:54,228 
2012-07-11 18:02:54,228 + Checking if SIP port is opened...
2012-07-11 18:02:54,228 |
2012-07-11 18:02:54,228 | + Checking 201.252.57.89:12345/udp...
2012-07-11 18:02:54,228 | |
2012-07-11 18:02:54,401 | | Port state: closed
2012-07-11 18:02:54,401 | |
2012-07-11 18:02:54,402 | | Category: Spoofed message
2012-07-11 18:02:54,402 
2012-07-11 18:02:54,402 + Checking if media port is opened...
2012-07-11 18:02:54,402 |
2012-07-11 18:02:54,402 | No RTP info delivered.
2012-07-11 18:02:54,402 |
2012-07-11 18:02:54,402 | Category: Spoofed message
2012-07-11 18:02:54,402 
2012-07-11 18:02:54,402 + Checking request URI...
2012-07-11 18:02:54,403 |
2012-07-11 18:02:54,403 | Extension in field To: smap
2012-07-11 18:02:54,403 |
2012-07-11 18:02:54,403 | Request addressed to the honeypot? No
2012-07-11 18:02:54,403 
2012-07-11 18:02:54,403 + Checking if proxy in Via...
2012-07-11 18:02:54,403 |
2012-07-11 18:02:54,403 | + Checking 201.252.57.89:12345/udp...
2012-07-11 18:02:54,404 | |
2012-07-11 18:02:54,576 | | Result: There is no SIP proxy
2012-07-11 18:02:54,576 | |
2012-07-11 18:02:54,576 | | Category: Dial plan fault
2012-07-11 18:02:54,576 
2012-07-11 18:02:54,577 + Checking for ACK...
2012-07-11 18:02:54,577 |
2012-07-11 18:02:54,577 | ACK received: No
2012-07-11 18:02:54,577 |
2012-07-11 18:02:54,577 | Category: Scanning
2012-07-11 18:02:54,577 
2012-07-11 18:02:54,577 + Checking for received media...
2012-07-11 18:02:54,577 |
2012-07-11 18:02:54,577 | Media received: No
2012-07-11 18:02:54,578 |
2012-07-11 18:02:54,578 | Category: Ringing
2012-07-11 18:02:54,578 
2012-07-11 18:02:54,578 + The message is classified as:
2012-07-11 18:02:54,578 | Interactive attack
2012-07-11 18:02:54,578 | Spoofed message
2012-07-11 18:02:54,578 | Dial plan fault
2012-07-11 18:02:54,578 | Scanning
2012-07-11 18:02:54,579 | Ringing
2012-07-11 18:02:54,579 
2012-07-11 18:02:54,579 ************************************** Correlation ***************************************
2012-07-11 18:02:54,579 
2012-07-11 18:02:54,579 Artemisa concludes that the arrived message is likely to be:
2012-07-11 18:02:54,579 
2012-07-11 18:02:54,579 * A scanning attempt.
2012-07-11 18:02:54,579 
2012-07-11 18:02:54,579 Executing bash ./scripts/on_scanning.sh 201.252.57.89 12345 201.252.57.89 12345 smap  ...
2012-07-11 18:02:54,582 * The message belongs to a ringing attack.
2012-07-11 18:02:54,582 
2012-07-11 18:02:54,582 This report has been saved on file ./results/2012-07-11_6.txt
2012-07-11 18:02:54,583 NOTICE This report has been saved on file ./results/2012-07-11_6.html
2012-07-11 18:02:54,583 Sending this report by e-mail...
2012-07-11 18:03:19,255 Call from <sip:smap@localhost> is DISCONNCTD, last code = 406 (Not Acceptable)
2012-07-11 18:03:19,255 Error while closing the conferences in method on_state().
2012-07-11 18:03:21,251 Call from <sip:smap@localhost> is DISCONNCTD, last code = 406 (Not Acceptable)
2012-07-11 18:03:21,251 Error while closing the conferences in method on_state().
2012-07-11 18:03:56,598 Extension "phone_0" <sip:phone_0@10.10.0.240:5060> unregistered, status=200 (OK)
2012-07-11 18:03:56,615 Extension "phone_1" <sip:phone_1@10.10.0.240:5060> unregistered, status=200 (OK)
2012-07-11 18:03:56,632 Extension "phone_7" <sip:phone_7@10.10.0.240:5060> unregistered, status=200 (OK)
2012-07-11 18:03:56,649 Extension "phone_8" <sip:phone_8@10.10.0.240:5060> unregistered, status=200 (OK)
2012-07-11 18:03:56,666 Extension "phone_9" <sip:phone_9@10.10.0.240:5060> unregistered, status=200 (OK)
Artemisa v1.0.91 Copyright (C) 2009-2011 Mohamed Nassar, Rodrigo do Carmo, and Pablo Masri

This program comes with ABSOLUTELY NO WARRANTY; for details type 'show warranty'.
This is free software, and you are welcome to redistribute it under certain
conditions; type 'show license' for details.


Type 'help' for help.

 18:02:37.481 os_core_unix.c  pjlib 1.14.0 for POSIX initialized
 18:02:37.481 sip_endpoint.c  Creating endpoint instance...
 18:02:37.481          pjlib  select() I/O Queue created (0x8858140)
 18:02:37.481 sip_endpoint.c  Module "mod-msg-print" registered
 18:02:37.481 sip_transport.  Transport manager created.
SIP User-Agent listening on: 10.10.0.250:5060
Behaviour mode: active
Starting extensions registration process...
root> 
 \end{verbatim}
\end{mytinylisting}

\newpage

\chapter*{\begin{center}
\vspace*{\fill}
 {\Huge\bf Anexo F}\\ 
 \vspace*{\fill}
 \end{center}}
\addcontentsline{toc}{chapter}{Anexo F: To-Do list}
\newpage

\paragraph{To-Do \emph{list}:}
\paragraph{Implementación corporativa (entorno en producción)\\}
A fines prácticos se propone su implementación para la
continuación de una 2da etapa del proyecto.

\paragraph{Realizar prueba exhaustiva con herramientas de \emph{penetration
testing} \ac{voip}\\}
Realizar pruebas con todos los aplicativos presentes en la lista VoIP Security
Tool List (\emph{http://www.voipsa.org/Resources/tools.php}) de modo de por una
parte ampliar más el diccionario de \emph{fingerprints} de Artemisa. Como también, mesurar
cuantas de estas herramientas son detectadas por nuestro \emph{honeypot}.

Más herramientas de seguridad \ac{voip}:\\
http://securitytools.wikidot.com/voip\\
http://www.0daysecurity.com/penetration-testing/VoIP-security.html

\paragraph{Modos activos y agresivo de Artemisa\\}
Considerar leer campo \emph{user-agent} dentro del mensaje \ac{sip} (puede verse en el
output de la consola de Artemisa - realizar parse - o guardarlo en variable
utilizando pjsua como lo hace Artemisa actualmente y agregar al archivo
\emph{fingerprint}).

\paragraph{Interoperabilidad de Artemisa con VoIP honey\\}
Lograr la interoperabilidad de Artemisa con VoIP honey \footnote{http://voiphoney.sourceforge.net/ 
Por su parte, sera de gran utilidad considerar los
comentarios realizados en la publicación http://bytecoders.net/content/honeypot-voip-artemisa.html} 
pudiendo Artemisa formar parte (si el usuario así lo desea) del conjunto de herramientas VoIP honey.
Todo ello a nivel de plugins que permitan configurar Artemisa como un honeypot externo aunque
integrado en la solución VoIP honey.

\newpage
\thispagestyle{empty}

\begin{center}
\color{white}{.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
.\\
}
\end{center}

%\begin{flushright}
\begin{figure}[h!] 
\centering
\includegraphics[width=.4 \textwidth,
keepaspectratio]{/home/delivery/Desktop/ArtemisaLatex1/Figuras/Firma_Dir_Dr_Do_Carmo.jpg}
\end{figure}
%\end{flushright}

\end{document}

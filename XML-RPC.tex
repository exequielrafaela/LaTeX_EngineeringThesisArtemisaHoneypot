\documentclass{article}
\usepackage{fancyvrb}
\usepackage{color}
\usepackage[UTF-8]{inputenc}



\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\def\PY@tok@gd{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\def\PY@tok@gu{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\def\PY@tok@gt{\def\PY@tc##1{\textcolor[rgb]{0.00,0.25,0.82}{##1}}}
\def\PY@tok@gs{\let\PY@bf=\textbf}
\def\PY@tok@gr{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\def\PY@tok@cm{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\def\PY@tok@vg{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\def\PY@tok@m{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@mh{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@go{\def\PY@tc##1{\textcolor[rgb]{0.50,0.50,0.50}{##1}}}
\def\PY@tok@ge{\let\PY@it=\textit}
\def\PY@tok@vc{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\def\PY@tok@il{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@cs{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\def\PY@tok@cp{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\def\PY@tok@gi{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\def\PY@tok@gh{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\def\PY@tok@ni{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\def\PY@tok@nl{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\def\PY@tok@nn{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\def\PY@tok@no{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\def\PY@tok@na{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\def\PY@tok@nb{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@nc{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\def\PY@tok@nd{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\def\PY@tok@ne{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\def\PY@tok@nf{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\def\PY@tok@si{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\def\PY@tok@s2{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\def\PY@tok@vi{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\def\PY@tok@nt{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@nv{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\def\PY@tok@s1{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\def\PY@tok@sh{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\def\PY@tok@sc{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\def\PY@tok@sx{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@bp{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@c1{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\def\PY@tok@kc{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@c{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\def\PY@tok@mf{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@err{\def\PY@bc##1{\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{##1}}}
\def\PY@tok@kd{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@ss{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\def\PY@tok@sr{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\def\PY@tok@mo{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@kn{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@mi{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@gp{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\def\PY@tok@o{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\def\PY@tok@kr{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@s{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\def\PY@tok@kp{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@w{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\def\PY@tok@kt{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\def\PY@tok@ow{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\def\PY@tok@sb{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\def\PY@tok@k{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\def\PY@tok@se{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\def\PY@tok@sd{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


\begin{document}

\section*{}

\begin{Verbatim}[commandchars=\\\{\}]
   \PY{k}{def} \PY{n+nf}{XmlServer}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{)}\PY{p}{:}
        \PY{l+s+sd}{"""}
\PY{l+s+sd}{        Creation of the XML Server}
\PY{l+s+sd}{        """}
        \PY{k}{global} \PY{n}{xml\PYZus{}serv}
        \PY{n}{xml\PYZus{}serv} \PY{o}{=} \PY{n}{SimpleXMLRPCServer}\PY{p}{(}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{Local\PYZus{}IP}\PY{p}{,} \PY{n+nb}{int}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{Local\PYZus{}xml\PYZus{}port}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{requestHandler}\PY{o}{=}\PY{n}{RequestHandler}\PY{p}{)}
        \PY{c}{### Function to allow Clients (XML-RPC connections) to access XML-RPC service methos - API Interface}
        \PY{n}{xml\PYZus{}serv}\PY{o}{.}\PY{n}{register\PYZus{}introspection\PYZus{}functions}\PY{p}{(}\PY{p}{)}
        
        \PY{k}{print} \PY{l+s}{'}\PY{l+s}{'} \PY{c}{# necessary to correct the console for a better output visualization}
        \PY{c}{#logger.info('XML-RPC service running...')}
       
        \PY{n}{xml\PYZus{}serv}\PY{o}{.}\PY{n}{register\PYZus{}function}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{ModifyExt}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{modify\PYZus{}extension}\PY{l+s}{'}\PY{p}{)}
              
        \PY{k}{def} \PY{n+nf}{RestartArtemisa}\PY{p}{(}\PY{p}{)}\PY{p}{:}
            \PY{n}{f}\PY{o}{=} \PY{n+nb}{open}\PY{p}{(}\PY{l+s}{'}\PY{l+s}{/dev/stdin}\PY{l+s}{'}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{w}\PY{l+s}{'}\PY{p}{)}
            \PY{n}{f}\PY{o}{.}\PY{n}{write}\PY{p}{(}\PY{l+s}{'}\PY{l+s}{restart}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{'}\PY{p}{)}
            \PY{c}{#self.ArtemisaRestart()}
        \PY{n}{xml\PYZus{}serv}\PY{o}{.}\PY{n}{register\PYZus{}function}\PY{p}{(}\PY{n}{RestartArtemisa}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{restart}\PY{l+s}{'}\PY{p}{)}
        
        \PY{c}{#### Run the XML-RPC\PYZus{}service main loop}
        \PY{n}{xml\PYZus{}serv}\PY{o}{.}\PY{n}{serve\PYZus{}forever}\PY{p}{(}\PY{p}{)}
        
                
    \PY{k}{def} \PY{n+nf}{ModifyExt}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{mod}\PY{p}{,}\PY{n}{ext}\PY{p}{,}\PY{n}{user}\PY{p}{,}\PY{n}{passwd}\PY{p}{)}\PY{p}{:}
        \PY{l+s+sd}{"""}
\PY{l+s+sd}{        Modify extensions from file extensions.conf}
\PY{l+s+sd}{        """}
        
        \PY{n}{config} \PY{o}{=} \PY{n}{ConfigParser}\PY{o}{.}\PY{n}{ConfigParser}\PY{p}{(}\PY{p}{)}
        \PY{n}{config}\PY{o}{.}\PY{n}{read}\PY{p}{(}\PY{n}{EXTENSIONS\PYZus{}FILE\PYZus{}PATH}\PY{p}{)}
        
        \PY{n}{config1} \PY{o}{=} \PY{n}{ConfigParser}\PY{o}{.}\PY{n}{ConfigParser}\PY{p}{(}\PY{p}{)}
        \PY{n}{config1}\PY{o}{.}\PY{n}{read}\PY{p}{(}\PY{n}{SERVERS\PYZus{}FILE\PYZus{}PATH}\PY{p}{)}
        
        \PY{n}{ext\PYZus{}aux} \PY{o}{=} \PY{p}{[}\PY{p}{]}
        
        \PY{c}{# se usara la instancia configServer de la clase ConfigParser para}
        \PY{c}{# escribir en server.conf }
        \PY{c}{#configServer = ConfigParser.ConfigParser()}
        \PY{c}{#configServer.read(EXTENSIONS\PYZus{}FILE\PYZus{}PATH)}
        
        \PY{k}{if} \PY{n}{mod} \PY{o}{==} \PY{l+s}{'}\PY{l+s}{add}\PY{l+s}{'}\PY{p}{:}
            \PY{k}{if} \PY{n}{config}\PY{o}{.}\PY{n}{has\PYZus{}section}\PY{p}{(}\PY{n}{ext}\PY{p}{)}\PY{p}{:}
                \PY{n}{logger}\PY{o}{.}\PY{n}{info} \PY{p}{(}\PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ already exists in extensions.conf}\PY{l+s}{'}\PY{p}{)}
                \PY{k}{return} \PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ already exists}\PY{l+s}{'}

            \PY{k}{elif} \PY{n+nb}{len}\PY{p}{(}\PY{n}{config}\PY{o}{.}\PY{n}{sections}\PY{p}{(}\PY{p}{)}\PY{p}{)} \PY{o}{<}\PY{o}{=} \PY{l+m+mi}{7}\PY{p}{:}
                
                \PY{n}{config}\PY{o}{.}\PY{n}{add\PYZus{}section}\PY{p}{(}\PY{n}{ext}\PY{p}{)}
                \PY{n}{config}\PY{o}{.}\PY{n}{set}\PY{p}{(}\PY{n}{ext}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{username}\PY{l+s}{'}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{"}\PY{l+s}{'}\PY{o}{+}\PY{n}{user}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{"}\PY{l+s}{'}\PY{p}{)}
                \PY{n}{config}\PY{o}{.}\PY{n}{set}\PY{p}{(}\PY{n}{ext}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{password}\PY{l+s}{'}\PY{p}{,}\PY{n}{passwd}\PY{p}{)}
                
                \PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{EXTENSIONS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{wb}\PY{l+s}{'}\PY{p}{)} \PY{k}{as} \PY{n}{configfile}\PY{p}{:}
                    \PY{n}{config}\PY{o}{.}\PY{n}{write}\PY{p}{(}\PY{n}{configfile}\PY{p}{)}
                
                \PY{n}{archi}\PY{o}{=}\PY{n+nb}{open}\PY{p}{(}\PY{n}{EXTENSIONS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{r}\PY{l+s}{'}\PY{p}{)}
                \PY{n}{lineS}\PY{o}{=}\PY{n}{archi}\PY{o}{.}\PY{n}{readlines}\PY{p}{(}\PY{p}{)}
                \PY{n}{archi}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}

                \PY{n}{archi}\PY{o}{=}\PY{n+nb}{open}\PY{p}{(}\PY{n}{EXTENSIONS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{w}\PY{l+s}{'}\PY{p}{)}                
                \PY{n}{archi}\PY{o}{.}\PY{n}{write}\PY{p}{(}\PY{l+s}{"}\PY{l+s}{# Artemisa - Extensions configuration file}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# Be careful when modifying this file!}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# Here you are able to set up the extensions that shall be used by Artemisa in the registration process. In order to use them, they must be defined in the servers.conf file.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# The sections name hereunder, such as 3000 in section [3000], refers to a SIP extension and it must be unique in this file, as well as correctly configured in the registrar server.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{"}\PY{p}{)}
                \PY{n}{archi}\PY{o}{.}\PY{n}{writelines}\PY{p}{(}\PY{n}{lineS}\PY{p}{)}
                \PY{n}{archi}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}
                
                \PY{n}{logger}\PY{o}{.}\PY{n}{info} \PY{p}{(}\PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ added in extensions.conf}\PY{l+s}{'}\PY{p}{)}
            
                \PY{k}{if} \PY{n}{config1}\PY{o}{.}\PY{n}{has\PYZus{}option}\PY{p}{(}\PY{l+s}{'}\PY{l+s}{myproxy}\PY{l+s}{'}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{exten}\PY{l+s}{'}\PY{p}{)}\PY{p}{:}
                    \PY{n}{b} \PY{o}{=} \PY{n+nb+bp}{False}
                    \PY{n}{ext\PYZus{}aux} \PY{o}{=} \PY{n}{config1}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s}{'}\PY{l+s}{myproxy}\PY{l+s}{'}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{exten}\PY{l+s}{'}\PY{p}{)}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{l+s}{'}\PY{l+s}{,}\PY{l+s}{'}\PY{p}{)}
                    \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{ext\PYZus{}aux}\PY{p}{:}
                        \PY{k}{if} \PY{n}{ext} \PY{o}{==} \PY{n}{i}\PY{p}{:}
                            \PY{n}{logger}\PY{o}{.}\PY{n}{info} \PY{p}{(}\PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ already exists in servers.conf}\PY{l+s}{'}\PY{p}{)}
                            \PY{k}{return} \PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ already exists.}\PY{l+s}{'}
                       
                        \PY{n}{aux\PYZus{}str} \PY{o}{=} \PY{l+s}{'}\PY{l+s+si}{%s}\PY{l+s}{'} \PY{o}{%} \PY{l+s}{'}\PY{l+s}{,}\PY{l+s}{'}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n+nb}{map}\PY{p}{(}\PY{n+nb}{str}\PY{p}{,} \PY{n}{ext\PYZus{}aux}\PY{p}{)}\PY{p}{)}
                        \PY{n}{config1}\PY{o}{.}\PY{n}{set}\PY{p}{(}\PY{l+s}{'}\PY{l+s}{myproxy}\PY{l+s}{'}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{exten}\PY{l+s}{'}\PY{p}{,}\PY{n+nb}{str}\PY{p}{(}\PY{n}{aux\PYZus{}str}\PY{p}{)}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{,}\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{p}{)}
                        \PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{SERVERS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{wb}\PY{l+s}{'}\PY{p}{)} \PY{k}{as} \PY{n}{configfile}\PY{p}{:}
                            \PY{n}{config1}\PY{o}{.}\PY{n}{write}\PY{p}{(}\PY{n}{configfile}\PY{p}{)}
                        
                        \PY{n}{archi}\PY{o}{=}\PY{n+nb}{open}\PY{p}{(}\PY{n}{SERVERS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{r}\PY{l+s}{'}\PY{p}{)}
                        \PY{n}{lineS}\PY{o}{=}\PY{n}{archi}\PY{o}{.}\PY{n}{readlines}\PY{p}{(}\PY{p}{)}
                        \PY{n}{archi}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}

                        \PY{n}{archi}\PY{o}{=}\PY{n+nb}{open}\PY{p}{(}\PY{n}{SERVERS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{w}\PY{l+s}{'}\PY{p}{)}                
                        \PY{n}{archi}\PY{o}{.}\PY{n}{write}\PY{p}{(}\PY{l+s}{"}\PY{l+s}{# Artemisa - Servers configuration file}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# Be careful when modifying this file!}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# Here you are able to set the registrar servers configuration that Artemisa shall use to register itself.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# registrar\PYZus{}time=}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# Is the time in minutes between automatic registrations. This is performed in order to avoid}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# being disconnected from the server because of a lack of activity.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# nat\PYZus{}keepalive\PYZus{}interal=}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# When dealing with NAT proxies, you can set a value in seconds which indicates the time interval between keep alive messages. If zero is written, then the NAT keep alive messages shall not be sent.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# exten=}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# In this field you should set the extensions to be used. They must be declared in extensions.conf.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{"}\PY{p}{)}
                        \PY{n}{archi}\PY{o}{.}\PY{n}{writelines}\PY{p}{(}\PY{n}{lineS}\PY{p}{)}
                        \PY{n}{archi}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}
                                                
                        \PY{n}{logger}\PY{o}{.}\PY{n}{info} \PY{p}{(}\PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ added in servers.conf}\PY{l+s}{'}\PY{p}{)}
                        \PY{k}{return} \PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ added}\PY{l+s}{'}
                       
            \PY{k}{else}\PY{p}{:}
                \PY{n}{logger}\PY{o}{.}\PY{n}{info} \PY{p}{(}\PY{l+s}{'}\PY{l+s}{Max number of extensions registered. Run another artemisa instance to register more extensions.}\PY{l+s}{'}\PY{p}{)}
                \PY{k}{return} \PY{l+s}{'}\PY{l+s}{Max number of extensions registered. Run another artemisa instance to register more extensions.}\PY{l+s}{'}
        \PY{k}{elif} \PY{n}{mod} \PY{o}{==} \PY{l+s}{'}\PY{l+s}{delete}\PY{l+s}{'}\PY{p}{:}
            \PY{k}{if} \PY{n}{config}\PY{o}{.}\PY{n}{has\PYZus{}section}\PY{p}{(}\PY{n}{ext}\PY{p}{)}\PY{p}{:}
                \PY{n}{config}\PY{o}{.}\PY{n}{remove\PYZus{}section}\PY{p}{(}\PY{n}{ext}\PY{p}{)}
                \PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{EXTENSIONS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{wb}\PY{l+s}{'}\PY{p}{)} \PY{k}{as} \PY{n}{configfile}\PY{p}{:}
                    \PY{n}{config}\PY{o}{.}\PY{n}{write}\PY{p}{(}\PY{n}{configfile}\PY{p}{)}
                
                \PY{n}{archi}\PY{o}{=}\PY{n+nb}{open}\PY{p}{(}\PY{n}{EXTENSIONS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{r}\PY{l+s}{'}\PY{p}{)}
                \PY{n}{lineS}\PY{o}{=}\PY{n}{archi}\PY{o}{.}\PY{n}{readlines}\PY{p}{(}\PY{p}{)}
                \PY{n}{archi}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}

                \PY{n}{archi}\PY{o}{=}\PY{n+nb}{open}\PY{p}{(}\PY{n}{EXTENSIONS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{w}\PY{l+s}{'}\PY{p}{)}                
                \PY{n}{archi}\PY{o}{.}\PY{n}{write}\PY{p}{(}\PY{l+s}{"}\PY{l+s}{# Artemisa - Extensions configuration file}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# Be careful when modifying this file!}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# Here you are able to set up the extensions that shall be used by Artemisa in the registration process. In order to use them, they must be defined in the servers.conf file.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# The sections name hereunder, such as 3000 in section [3000], refers to a SIP extension and it must be unique in this file, as well as correctly configured in the registrar server.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{"}\PY{p}{)}
                \PY{n}{archi}\PY{o}{.}\PY{n}{writelines}\PY{p}{(}\PY{n}{lineS}\PY{p}{)}
                \PY{n}{archi}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}
                
                \PY{n}{logger}\PY{o}{.}\PY{n}{info} \PY{p}{(}\PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ deleted in extensions.conf}\PY{l+s}{'}\PY{p}{)}
                
            \PY{k}{else}\PY{p}{:}
                
                \PY{n}{logger}\PY{o}{.}\PY{n}{info} \PY{p}{(}\PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ does not exists in extensions.conf}\PY{l+s}{'}\PY{p}{)}
        
            \PY{k}{if} \PY{n}{config1}\PY{o}{.}\PY{n}{has\PYZus{}option}\PY{p}{(}\PY{l+s}{'}\PY{l+s}{myproxy}\PY{l+s}{'}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{exten}\PY{l+s}{'}\PY{p}{)}\PY{p}{:}
                \PY{n}{b} \PY{o}{=} \PY{n+nb+bp}{False}
                \PY{n}{ext\PYZus{}aux} \PY{o}{=} \PY{n}{config1}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s}{'}\PY{l+s}{myproxy}\PY{l+s}{'}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{exten}\PY{l+s}{'}\PY{p}{)}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{l+s}{'}\PY{l+s}{,}\PY{l+s}{'}\PY{p}{)}
                
                \PY{c}{#len\PYZus{}list\PYZus{}aux = len(ext\PYZus{}aux)}
                \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{0}
                \PY{k}{while} \PY{n}{j}\PY{o}{<}\PY{n+nb}{len}\PY{p}{(}\PY{n}{ext\PYZus{}aux}\PY{p}{)}\PY{p}{:}
                    \PY{k}{if} \PY{n}{ext} \PY{o}{==}  \PY{n}{ext\PYZus{}aux}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{:}
                        \PY{k}{del}\PY{p}{(}\PY{n}{ext\PYZus{}aux}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}
                        \PY{c}{#len\PYZus{}list\PYZus{}aux = len(ext\PYZus{}aux)}
                        \PY{n}{b} \PY{o}{=} \PY{n+nb+bp}{True}
                    \PY{k}{else}\PY{p}{:}
                        \PY{n}{j}\PY{o}{=}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}      
                
                \PY{n}{aux\PYZus{}str} \PY{o}{=} \PY{l+s}{'}\PY{l+s+si}{%s}\PY{l+s}{'} \PY{o}{%} \PY{l+s}{'}\PY{l+s}{,}\PY{l+s}{'}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n+nb}{map}\PY{p}{(}\PY{n+nb}{str}\PY{p}{,} \PY{n}{ext\PYZus{}aux}\PY{p}{)}\PY{p}{)}
                \PY{n}{config1}\PY{o}{.}\PY{n}{set}\PY{p}{(}\PY{l+s}{'}\PY{l+s}{myproxy}\PY{l+s}{'}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{exten}\PY{l+s}{'}\PY{p}{,}\PY{n}{aux\PYZus{}str}\PY{p}{)}
                \PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{SERVERS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{wb}\PY{l+s}{'}\PY{p}{)} \PY{k}{as} \PY{n}{configfile}\PY{p}{:}
                    \PY{n}{config1}\PY{o}{.}\PY{n}{write}\PY{p}{(}\PY{n}{configfile}\PY{p}{)}    
                   
                \PY{k}{if} \PY{o+ow}{not} \PY{n}{b} \PY{p}{:}
                    
                    \PY{n}{archi}\PY{o}{=}\PY{n+nb}{open}\PY{p}{(}\PY{n}{SERVERS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{r}\PY{l+s}{'}\PY{p}{)}
                    \PY{n}{lineS}\PY{o}{=}\PY{n}{archi}\PY{o}{.}\PY{n}{readlines}\PY{p}{(}\PY{p}{)}
                    \PY{n}{archi}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}

                    \PY{n}{archi}\PY{o}{=}\PY{n+nb}{open}\PY{p}{(}\PY{n}{SERVERS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{w}\PY{l+s}{'}\PY{p}{)}                
                    \PY{n}{archi}\PY{o}{.}\PY{n}{write}\PY{p}{(}\PY{l+s}{"}\PY{l+s}{# Artemisa - Extensions configuration file}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# Be careful when modifying this file!}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# Here you are able to set up the extensions that shall be used by Artemisa in the registration process. In order to use them, they must be defined in the servers.conf file.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# The sections name hereunder, such as 3000 in section [3000], refers to a SIP extension and it must be unique in this file, as well as correctly configured in the registrar server.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{"}\PY{p}{)}
                    \PY{n}{archi}\PY{o}{.}\PY{n}{writelines}\PY{p}{(}\PY{n}{lineS}\PY{p}{)}
                    \PY{n}{archi}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}
                    
                    \PY{n}{logger}\PY{o}{.}\PY{n}{info} \PY{p}{(}\PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ does not exists in servers.conf}\PY{l+s}{'}\PY{p}{)}
                    \PY{k}{return} \PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ does not exists}\PY{l+s}{'}
                
                \PY{n}{archi}\PY{o}{=}\PY{n+nb}{open}\PY{p}{(}\PY{n}{SERVERS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{r}\PY{l+s}{'}\PY{p}{)}
                \PY{n}{lineS}\PY{o}{=}\PY{n}{archi}\PY{o}{.}\PY{n}{readlines}\PY{p}{(}\PY{p}{)}
                \PY{n}{archi}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}

                \PY{n}{archi}\PY{o}{=}\PY{n+nb}{open}\PY{p}{(}\PY{n}{SERVERS\PYZus{}FILE\PYZus{}PATH}\PY{p}{,}\PY{l+s}{'}\PY{l+s}{w}\PY{l+s}{'}\PY{p}{)}                
                \PY{n}{archi}\PY{o}{.}\PY{n}{write}\PY{p}{(}\PY{l+s}{"}\PY{l+s}{# Artemisa - Servers configuration file}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# Be careful when modifying this file!}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# Here you are able to set the registrar servers configuration that Artemisa shall use to register itself.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# registrar\PYZus{}time=}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# Is the time in minutes between automatic registrations. This is performed in order to avoid}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# being disconnected from the server because of a lack of activity.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# nat\PYZus{}keepalive\PYZus{}interal=}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# When dealing with NAT proxies, you can set a value in seconds which indicates the time interval between keep alive messages. If zero is written, then the NAT keep alive messages shall not be sent.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{#}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# exten=}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{# In this field you should set the extensions to be used. They must be declared in extensions.conf.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{"}\PY{p}{)}
                \PY{n}{archi}\PY{o}{.}\PY{n}{writelines}\PY{p}{(}\PY{n}{lineS}\PY{p}{)}
                \PY{n}{archi}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}
                
                \PY{n}{logger}\PY{o}{.}\PY{n}{info} \PY{p}{(}\PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ deleted in servers.conf}\PY{l+s}{'}\PY{p}{)}
                \PY{k}{return} \PY{l+s}{'}\PY{l+s}{extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ deleted}\PY{l+s}{'} 
                    
            \PY{k}{else}\PY{p}{:}
                \PY{n}{logger}\PY{o}{.}\PY{n}{info} \PY{p}{(}\PY{l+s}{'}\PY{l+s}{Extension }\PY{l+s}{'}\PY{o}{+}\PY{n}{ext}\PY{o}{+}\PY{l+s}{'}\PY{l+s}{ does not exists.}\PY{l+s}{'}\PY{p}{)}
            
        \PY{k}{else}\PY{p}{:}
            \PY{n}{logger}\PY{o}{.}\PY{n}{info} \PY{p}{(}\PY{l+s}{'}\PY{l+s}{wrong request please try with }\PY{l+s}{"}\PY{l+s}{add}\PY{l+s}{"}\PY{l+s}{ or }\PY{l+s}{"}\PY{l+s}{delete}\PY{l+s}{"}\PY{l+s}{'}\PY{p}{)} 
            \PY{k}{return} \PY{l+s}{'}\PY{l+s}{wrong request please try with }\PY{l+s}{"}\PY{l+s}{add}\PY{l+s}{"}\PY{l+s}{ or }\PY{l+s}{"}\PY{l+s}{delete}\PY{l+s}{"}\PY{l+s}{'}
                              
        \PY{k}{del} \PY{n}{config}
\end{Verbatim}

\end{document}
